function in_array(a,b,c){var d="";if(!c){for(d in b)if(b[d]==a)return!0}else for(d in b)if(b[d]===a)return!0;return!1}function strip_tags(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return a.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})}function ucFirst(a){return a?a.charAt(0).toUpperCase()+a.slice(1):a}function lerp(a,b,c){var d=Math.max(Math.min(c,1),0);return(1-d)*a+d*b}function doscroll(a,b,c){var d=a-b;return c+=(c+d/36)/d,newY=1==c?b+d:b+d*(1-Math.pow(2,-20*c/1)),c&&window.scrollTo(0,newY),c>=1||lastT==c||!c?clearTimeout(timer):timer=setTimeout("doscroll("+a+","+b+","+c+")",1),lastT=c,!1}function number_format(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=void 0===d?",":d,h=void 0===c?".":c,i="";return i=(f?function(a,b){var c=Math.pow(10,b);return""+(Math.round(a*c)/c).toFixed(b)}(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=new Array(f-i[1].length+1).join("0")),i.join(h)}function getQueryStringParam(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}!function(a,b,c){function d(a,b,c){return a.call.apply(a.bind,arguments)}function e(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function f(a,b,c){return f=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?d:e,f.apply(null,arguments)}function g(a,b){this.J=a,this.w=b||a,this.F=this.w.document}function h(a,c,d){a=a.F.getElementsByTagName(c)[0],a||(a=b.documentElement),a&&a.lastChild&&a.insertBefore(d,a.lastChild)}function i(a,b){function c(){a.F.body?b():setTimeout(c,0)}c()}function j(a,b,c){b=b||[],c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}for(b=[],e=0;e<d.length;e+=1){for(f=!1,g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function k(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}function l(a){if("string"==typeof a.na)return a.na;var b=a.w.location.protocol;return"about:"==b&&(b=a.J.location.protocol),"https:"==b?"https:":"http:"}function m(a,b){var c=a.createElement("link",{rel:"stylesheet",href:b,media:"all"}),d=!1;c.onload=function(){d||(d=!0)},c.onerror=function(){d||(d=!0)},h(a,"head",c)}function n(b,c,d,e){var f=b.F.getElementsByTagName("head")[0];if(f){var g=b.createElement("script",{src:c}),h=!1;return g.onload=g.onreadystatechange=function(){h||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(h=!0,d&&d(null),g.onload=g.onreadystatechange=null,"HEAD"==g.parentNode.tagName&&f.removeChild(g))},f.appendChild(g),a.setTimeout(function(){h||(h=!0,d&&d(Error("Script load timeout")))},e||5e3),g}return null}function o(a,b){this.N=a,this.ga=b}function p(a,b,c,d){this.d=null!=a?a:null,this.g=null!=b?b:null,this.B=null!=c?c:null,this.f=null!=d?d:null}function q(a){a=aa.exec(a);var b=null,c=null,d=null,e=null;return a&&(null!==a[1]&&a[1]&&(b=parseInt(a[1],10)),null!==a[2]&&a[2]&&(c=parseInt(a[2],10)),null!==a[3]&&a[3]&&(d=parseInt(a[3],10)),null!==a[4]&&a[4]&&(e=/^[0-9]+$/.test(a[4])?parseInt(a[4],10):a[4])),new p(b,c,d,e)}function r(a,b,c,d,e,f,g,h){this.L=a,this.m=h}function s(a){this.a=a}function t(a){var b=w(a.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);return""!=b?(/BB\d{2}/.test(b)&&(b="BlackBerry"),b):(a=w(a.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS|PlayStation|CrKey)/,1),""!=a?("Mac_PowerPC"==a?a="Macintosh":"PlayStation"==a&&(a="Linux"),a):"Unknown")}function u(a){var b=w(a.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(b||(b=w(a.a,/Windows Phone( OS)? ([^;)]+)/,2))||(b=w(a.a,/(iPhone )?OS ([\d_]+)/,2)))return b;if(b=w(a.a,/(?:Linux|CrOS|CrKey) ([^;)]+)/,1))for(var b=b.split(/\s/),c=0;c<b.length;c+=1)if(/^[\d\._]+$/.test(b[c]))return b[c];return(a=w(a.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?a:"Unknown"}function v(a){var b=t(a),c=q(u(a)),d=q(w(a.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1)),e="Unknown",f=new p,f="Unknown",g=!1;return/OPR\/[\d.]+/.test(a.a)?e="Opera":-1!=a.a.indexOf("Chrome")||-1!=a.a.indexOf("CrMo")||-1!=a.a.indexOf("CriOS")?e="Chrome":/Silk\/\d/.test(a.a)?e="Silk":"BlackBerry"==b||"Android"==b?e="BuiltinBrowser":-1!=a.a.indexOf("PhantomJS")?e="PhantomJS":-1!=a.a.indexOf("Safari")?e="Safari":-1!=a.a.indexOf("AdobeAIR")?e="AdobeAIR":-1!=a.a.indexOf("PlayStation")&&(e="BuiltinBrowser"),"BuiltinBrowser"==e?f="Unknown":"Silk"==e?f=w(a.a,/Silk\/([\d\._]+)/,1):"Chrome"==e?f=w(a.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=a.a.indexOf("Version/")?f=w(a.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==e?f=w(a.a,/AdobeAIR\/([\d\.]+)/,1):"Opera"==e?f=w(a.a,/OPR\/([\d.]+)/,1):"PhantomJS"==e&&(f=w(a.a,/PhantomJS\/([\d.]+)/,1)),f=q(f),g="AdobeAIR"==e?2<f.d||2==f.d&&5<=f.g:"BlackBerry"==b?10<=c.d:"Android"==b?2<c.d||2==c.d&&1<c.g:526<=d.d||525<=d.d&&13<=d.g,new r(e,0,0,0,0,0,0,new o(g,536>d.d||536==d.d&&11>d.g))}function w(a,b,c){return(a=a.match(b))&&a[c]?a[c]:""}function x(a){this.ma=a||"-"}function y(a,b){this.L=a,this.X=4,this.M="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.M=c[1],this.X=parseInt(c[2],10))}function z(a){return a.M+a.X}function A(a){var b=4,c="n",d=null;return a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10)))),c+b}function B(a,b){this.c=a,this.q=a.w.document.documentElement,this.P=b,this.j="wf",this.h=new x("-"),this.ha=!1!==b.events,this.C=!1!==b.classes}function C(a){if(a.C){var b=k(a.q,a.h.f(a.j,"active")),c=[],d=[a.h.f(a.j,"loading")];b||c.push(a.h.f(a.j,"inactive")),j(a.q,c,d)}D(a,"inactive")}function D(a,b,c){a.ha&&a.P[b]&&(c?a.P[b](c.getName(),z(c)):a.P[b]())}function E(){this.ca={}}function F(a,b){this.c=a,this.H=b,this.k=this.c.createElement("span",{"aria-hidden":"true"},this.H)}function G(a){h(a.c,"body",a.k)}function H(a){var b;b=[];for(var c=a.L.split(/,\s*/),d=0;d<c.length;d++){var e=c[d].replace(/['"]/g,"");-1==e.indexOf(" ")?b.push(e):b.push("'"+e+"'")}return b=b.join(","),c="normal","o"===a.M?c="oblique":"i"===a.M&&(c="italic"),"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b+";font-style:"+c+";font-weight:"+a.X+"00;"}function I(a,b,c,d,e,f,g,h){this.Y=a,this.ka=b,this.c=c,this.o=d,this.m=e,this.H=h||"BESbswy",this.v={},this.W=f||3e3,this.ba=g||null,this.G=this.u=this.t=null,this.t=new F(this.c,this.H),this.u=new F(this.c,this.H),this.G=new F(this.c,this.H),a=new y("serif",z(this.o)),a=H(a),this.t.k.style.cssText=a,a=new y("sans-serif",z(this.o)),a=H(a),this.u.k.style.cssText=a,a=new y("monospace",z(this.o)),a=H(a),this.G.k.style.cssText=a,G(this.t),G(this.u),G(this.G),this.v.serif=this.t.k.offsetWidth,this.v["sans-serif"]=this.u.k.offsetWidth,this.v.monospace=this.G.k.offsetWidth}function J(a,b,c){for(var d in ca)if(ca.hasOwnProperty(d)&&b===a.v[ca[d]]&&c===a.v[ca[d]])return!0;return!1}function K(a){var b=a.t.k.offsetWidth,c=a.u.k.offsetWidth;b===a.v.serif&&c===a.v["sans-serif"]||a.m.ga&&J(a,b,c)?_()-a.oa>=a.W?a.m.ga&&J(a,b,c)&&(null===a.ba||a.ba.hasOwnProperty(a.o.getName()))?M(a,a.Y):M(a,a.ka):L(a):M(a,a.Y)}function L(a){setTimeout(f(function(){K(this)},a),50)}function M(a,b){a.t.remove(),a.u.remove(),a.G.remove(),b(a.o)}function N(a,b,c,d){this.c=b,this.A=c,this.R=0,this.ea=this.aa=!1,this.W=d,this.m=a.m}function O(a,b,c,d,e){if(c=c||{},0===b.length&&e)C(a.A);else for(a.R+=b.length,e&&(a.aa=e),e=0;e<b.length;e++){var g=b[e],h=c[g.getName()],i=a.A,k=g;i.C&&j(i.q,[i.h.f(i.j,k.getName(),z(k).toString(),"loading")]),D(i,"fontloading",k),i=null,i=new I(f(a.ia,a),f(a.ja,a),a.c,g,a.m,a.W,d,h),i.start()}}function P(a){0==--a.R&&a.aa&&(a.ea?(a=a.A,a.C&&j(a.q,[a.h.f(a.j,"active")],[a.h.f(a.j,"loading"),a.h.f(a.j,"inactive")]),D(a,"active")):C(a.A))}function Q(a){this.J=a,this.Z=new E,this.pa=new s(a.navigator.userAgent),this.a=this.pa.parse(),this.T=this.U=0,this.Q=this.S=!0}function R(a,b){ja.Z.ca[a]=b}function S(a,b,c,d,e){var f=0==--a.U;(a.Q||a.S)&&setTimeout(function(){O(b,c,d||null,e||null,f)},0)}function T(a,b,c){this.O=a||b+da,this.s=[],this.V=[],this.fa=c||""}function U(a){this.s=a,this.da=[],this.K={}}function V(a,b){this.a=new s(navigator.userAgent).parse(),this.c=a,this.e=b}function W(a,b){this.c=a,this.e=b,this.p=[]}function X(a,b){this.c=a,this.e=b,this.p=[]}function Y(a,b){this.c=a,this.e=b,this.p=[]}function Z(a,b){this.c=a,this.e=b}function $(a,b){this.c=a,this.e=b}var _=Date.now||function(){return+new Date};g.prototype.createElement=function(a,b,c){if(a=this.F.createElement(a),b)for(var d in b)b.hasOwnProperty(d)&&("style"==d?a.style.cssText=b[d]:a.setAttribute(d,b[d]));return c&&a.appendChild(this.F.createTextNode(c)),a};var aa=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;p.prototype.compare=function(a){return this.d>a.d||this.d===a.d&&this.g>a.g||this.d===a.d&&this.g===a.g&&this.B>a.B?1:this.d<a.d||this.d===a.d&&this.g<a.g||this.d===a.d&&this.g===a.g&&this.B<a.B?-1:0},p.prototype.toString=function(){return[this.d,this.g||"",this.B||"",this.f||""].join("")},r.prototype.getName=function(){return this.L};var ba=new r("Unknown",0,0,0,0,0,0,new o(!1,!1));s.prototype.parse=function(){var a;if(-1!=this.a.indexOf("MSIE")||-1!=this.a.indexOf("Trident/")){a=t(this);var b=q(u(this)),c=null,d=w(this.a,/Trident\/([\d\w\.]+)/,1),c=q(-1!=this.a.indexOf("MSIE")?w(this.a,/MSIE ([\d\w\.]+)/,1):w(this.a,/rv:([\d\w\.]+)/,1));""!=d&&q(d),a=new r("MSIE",0,0,0,0,0,0,new o("Windows"==a&&6<=c.d||"Windows Phone"==a&&8<=b.d,!1))}else if(-1!=this.a.indexOf("Opera"))a:if(a=q(w(this.a,/Presto\/([\d\w\.]+)/,1)),q(u(this)),null!==a.d||q(w(this.a,/rv:([^\)]+)/,1)),-1!=this.a.indexOf("Opera Mini/"))a=q(w(this.a,/Opera Mini\/([\d\.]+)/,1)),a=new r("OperaMini",0,0,0,t(this),0,0,new o(!1,!1));else{if(-1!=this.a.indexOf("Version/")&&(a=q(w(this.a,/Version\/([\d\.]+)/,1)),null!==a.d)){a=new r("Opera",0,0,0,t(this),0,0,new o(10<=a.d,!1));break a}a=q(w(this.a,/Opera[\/ ]([\d\.]+)/,1)),a=null!==a.d?new r("Opera",0,0,0,t(this),0,0,new o(10<=a.d,!1)):new r("Opera",0,0,0,t(this),0,0,new o(!1,!1))}else/OPR\/[\d.]+/.test(this.a)?a=v(this):/AppleWeb(K|k)it/.test(this.a)?a=v(this):-1!=this.a.indexOf("Gecko")?(a="Unknown",b=new p,q(u(this)),b=!1,-1!=this.a.indexOf("Firefox")?(a="Firefox",b=q(w(this.a,/Firefox\/([\d\w\.]+)/,1)),b=3<=b.d&&5<=b.g):-1!=this.a.indexOf("Mozilla")&&(a="Mozilla"),c=q(w(this.a,/rv:([^\)]+)/,1)),b||(b=1<c.d||1==c.d&&9<c.g||1==c.d&&9==c.g&&2<=c.B),a=new r(a,0,0,0,t(this),0,0,new o(b,!1))):a=ba;return a},x.prototype.f=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.ma)},y.prototype.getName=function(){return this.L},F.prototype.remove=function(){var a=this.k;a.parentNode&&a.parentNode.removeChild(a)};var ca={sa:"serif",ra:"sans-serif",qa:"monospace"};I.prototype.start=function(){this.oa=_();var a=new y(this.o.getName()+",serif",z(this.o)),a=H(a);this.t.k.style.cssText=a,a=new y(this.o.getName()+",sans-serif",z(this.o)),a=H(a),this.u.k.style.cssText=a,K(this)},N.prototype.ia=function(a){var b=this.A;b.C&&j(b.q,[b.h.f(b.j,a.getName(),z(a).toString(),"active")],[b.h.f(b.j,a.getName(),z(a).toString(),"loading"),b.h.f(b.j,a.getName(),z(a).toString(),"inactive")]),D(b,"fontactive",a),this.ea=!0,P(this)},N.prototype.ja=function(a){var b=this.A;if(b.C){var c=k(b.q,b.h.f(b.j,a.getName(),z(a).toString(),"active")),d=[],e=[b.h.f(b.j,a.getName(),z(a).toString(),"loading")];c||d.push(b.h.f(b.j,a.getName(),z(a).toString(),"inactive")),j(b.q,d,e)}D(b,"fontinactive",a),P(this)},Q.prototype.load=function(a){this.c=new g(this.J,a.context||this.J),this.S=!1!==a.events,this.Q=!1!==a.classes;var b=new B(this.c,a),c=[],d=a.timeout;b.C&&j(b.q,[b.h.f(b.j,"loading")]),D(b,"loading");var e,c=this.Z,h=this.c,i=[];for(e in a)if(a.hasOwnProperty(e)){var k=c.ca[e];k&&i.push(k(a[e],h))}for(c=i,this.T=this.U=c.length,a=new N(this.a,this.c,b,d),d=0,e=c.length;d<e;d++)h=c[d],h.D(this.a,f(this.la,this,h,b,a))},Q.prototype.la=function(a,b,c,d){var e=this;d?a.load(function(a,b,d){S(e,c,a,b,d)}):(a=0==--this.U,this.T--,a&&0==this.T?C(b):(this.Q||this.S)&&O(c,[],{},null,a))};var da="//fonts.googleapis.com/css";T.prototype.f=function(){if(0==this.s.length)throw Error("No fonts to load!");if(-1!=this.O.indexOf("kit="))return this.O;for(var a=this.s.length,b=[],c=0;c<a;c++)b.push(this.s[c].replace(/ /g,"+"));return a=this.O+"?family="+b.join("%7C"),0<this.V.length&&(a+="&subset="+this.V.join(",")),0<this.fa.length&&(a+="&text="+encodeURIComponent(this.fa)),a};var ea={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},fa={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ga={i:"i",italic:"i",n:"n",normal:"n"},ha=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;U.prototype.parse=function(){for(var a=this.s.length,b=0;b<a;b++){var c=this.s[b].split(":"),d=c[0].replace(/\+/g," "),e=["n4"];if(2<=c.length){var f,g=c[1];if(f=[],g)for(var g=g.split(","),h=g.length,i=0;i<h;i++){var j;if(j=g[i],j.match(/^[\w-]+$/)){j=ha.exec(j.toLowerCase());var k=void 0;if(null==j)k="";else{if(k=void 0,null==(k=j[1])||""==k)k="4";else var l=fa[k],k=l||(isNaN(k)?"4":k.substr(0,1));j=j[2],k=[null==j||""==j?"n":ga[j],k].join("")}j=k}else j="";j&&f.push(j)}0<f.length&&(e=f),3==c.length&&(c=c[2],f=[],c=c?c.split(","):f,0<c.length&&(c=ea[c[0]])&&(this.K[d]=c))}for(this.K[d]||(c=ea[d])&&(this.K[d]=c),c=0;c<e.length;c+=1)this.da.push(new y(d,e[c]))}};var ia={Arimo:!0,Cousine:!0,Tinos:!0};V.prototype.D=function(a,b){b(a.m.N)},V.prototype.load=function(a){var b=this.c;"MSIE"==this.a.getName()&&1!=this.e.blocking?i(b,f(this.$,this,a)):this.$(a)},V.prototype.$=function(a){for(var b=this.c,c=new T(this.e.api,l(b),this.e.text),d=this.e.families,e=d.length,f=0;f<e;f++){var g=d[f].split(":");3==g.length&&c.V.push(g.pop());var h="";2==g.length&&""!=g[1]&&(h=":"),c.s.push(g.join(h))}d=new U(d),d.parse(),m(b,c.f()),a(d.da,d.K,ia)},W.prototype.I=function(a){var b=this.c;return l(this.c)+(this.e.api||"//f.fontdeck.com/s/css/js/")+(b.w.location.hostname||b.J.location.hostname)+"/"+a+".js"},W.prototype.D=function(a,b){var c=this.e.id,d=this.c.w,e=this;c?(d.__webfontfontdeckmodule__||(d.__webfontfontdeckmodule__={}),d.__webfontfontdeckmodule__[c]=function(a,c){for(var d=0,f=c.fonts.length;d<f;++d){var g=c.fonts[d];e.p.push(new y(g.name,A("font-weight:"+g.weight+";font-style:"+g.style)))}b(a)},n(this.c,this.I(c),function(a){a&&b(!1)})):b(!1)},W.prototype.load=function(a){a(this.p)},X.prototype.I=function(a){var b=l(this.c);return(this.e.api||b+"//use.typekit.net")+"/"+a+".js"},X.prototype.D=function(a,b){var c=this.e.id,d=this.c.w,e=this;c?n(this.c,this.I(c),function(a){if(a)b(!1);else{if(d.Typekit&&d.Typekit.config&&d.Typekit.config.fn){a=d.Typekit.config.fn;for(var c=0;c<a.length;c+=2)for(var f=a[c],g=a[c+1],h=0;h<g.length;h++)e.p.push(new y(f,g[h]));try{d.Typekit.load({events:!1,classes:!1})}catch(a){}}b(!0)}},2e3):b(!1)},X.prototype.load=function(a){a(this.p)},Y.prototype.D=function(a,b){var c=this,d=c.e.projectId,e=c.e.version;if(d){var f=c.c.w;n(this.c,c.I(d,e),function(e){if(e)b(!1);else{if(f["__mti_fntLst"+d]&&(e=f["__mti_fntLst"+d]()))for(var g=0;g<e.length;g++)c.p.push(new y(e[g].fontfamily));b(a.m.N)}}).id="__MonotypeAPIScript__"+d}else b(!1)},Y.prototype.I=function(a,b){return l(this.c)+"//"+(this.e.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"")+"/"+a+".js"+(b?"?v="+b:"")},Y.prototype.load=function(a){a(this.p)},Z.prototype.load=function(a){var b,c,d=this.e.urls||[],e=this.e.families||[],f=this.e.testStrings||{};for(b=0,c=d.length;b<c;b++)m(this.c,d[b]);for(d=[],b=0,c=e.length;b<c;b++){var g=e[b].split(":");if(g[1])for(var h=g[1].split(","),i=0;i<h.length;i+=1)d.push(new y(g[0],h[i]));else d.push(new y(g[0]))}a(d,f)},Z.prototype.D=function(a,b){return b(a.m.N)},$.prototype.load=function(a){var b,c,d=this.e.families||[];0<d.length&&""!==(b=d.join("|"))&&(b=b.replace(/ /g,""),m(this.c,"/type/css?family="+b));var e=[];for(b=0,c=d.length;b<c;b++){var f=d[b].split(":");if(f[1])for(var g=f[1].split(","),h=0;h<g.length;h+=1)e.push(new y(f[0],g[h]));else e.push(new y(f[0]))}a(e)},$.prototype.D=function(a,b){return b(a.m.N)};var ja=new Q(this);R("custom",function(a,b){return new Z(b,a)}),R("Persona",function(a,b){return new $(b,a)}),R("fontdeck",function(a,b){return new W(b,a)}),R("monotype",function(a,b){return new Y(b,a)}),R("typekit",function(a,b){return new X(b,a)}),R("google",function(a,b){return new V(b,a)}),this.WebFont||(this.WebFont={},this.WebFont.load=f(ja.load,ja),this.WebFontConfig&&ja.load(this.WebFontConfig))}(this,document);var Cargo={};Cargo.o={},Cargo.o.model={},Cargo.o.collection={},Cargo.o.view={},Cargo.Router={},Cargo.Template={},Cargo.Helper={},Cargo.API={},Cargo.Event={},Cargo.Collection={},Cargo.Model={},Cargo.View={};var Action=window.Action||{};Cargo.Core={log:function(a){"undefined"!=typeof console&&window.console&&console.log(a)},KeyboardShortcut:{Add:function(a,b,c){var d={type:"keydown",disable_in_input:!0,propagate:!0,keycode:b};shortcut.add(a,c,d)},Remove:function(a){shortcut.remove(a)},InitDefaults:function(){Cargo.Helper.IsAdminPath()||(this.Add("X",88,function(){lightbox.isActive||Action.Page.Home()}),this.Add("I",73,function(){lightbox.isActive||Action.Page.Home()}),this.Add("J",74,function(){lightbox.isActive||Action.Page.Next()}),this.Add("K",75,function(){lightbox.isActive||Action.Page.Prev()}),this.Add("Right",39,function(){lightbox.isActive||Action.Page.Next()}),this.Add("Left",37,function(){lightbox.isActive||Action.Page.Prev()}),this.Add("R",82,function(){lightbox.isActive||Action.Page.Random()}),this.Add("Shift+G",71,function(){lightbox.isActive||Cargo.Helper.GoToUrl("img")}),this.Add("Meta+/",191,function(a){a.preventDefault(),Action.yepThisIsACargoSite()})),this.Add("Shift+A",65,function(){Cargo.Helper.GoToUrl("admin")});var a=0;mouseY=0,Cargo.Model.DisplayOptions.get("layout_options").is_feed&&window.addEventListener("mousemove",function(b){a=b.clientX,mouseY=b.clientY}),Cargo.Core.loadAdminForActivePage=function(){if(parent.location==window.location)if(Cargo.Model.Site.GetIsEditor()){var b,c,d,e,f,g,h=Cargo.View.Content.el.querySelectorAll(".page.container[data-id]"),i=window.innerHeight/2,j=9e9;_.each(h,function(a){a.style.minHeight="1px"}),_.each(h,function(e){f=e.getBoundingClientRect(),f.top<mouseY&&f.bottom>mouseY&&f.left<a&&f.right>a&&(c=e),f.top<i&&f.bottom>i?(b=e,j=0):j>0&&(f.top>i?d=Math.abs(i-f.top):f.bottom<i&&(d=Math.abs(i-f.bottom)),d<j&&(b=e,j=d))}),_.each(h,function(a){a.style.minHeight=""}),(b||c)&&(c?g=parseInt(c.getAttribute("data-id")):b&&(g=parseInt(b.getAttribute("data-id"))),e=Cargo.Collection.Scaffolding.getModel({id:g})),!e&&Cargo.View.Content.currentSet&&(e=Cargo.View.Content.currentSet.model),e&&!e.get("pin")?((e.get("stack")||e.get("is_set"))&&e.get("pages")&&e.get("pages").length>0&&(e=e.get("pages").models[0]),Cargo.Helper.GoToUrl("admin/"+e.id)):Cargo.Helper.GoToUrl("admin")}else Cargo.Helper.GoToUrl("admin")},this.Add("Shift+E",69,Cargo.Core.loadAdminForActivePage),this.Add("Shift+H",72,function(){Cargo.Helper.GoToUrl("admin/design/html")}),this.Add("Shift+C",67,function(){Cargo.Helper.GoToUrl("admin/design/css")}),this.Add("Shift+I",73,function(){Cargo.Helper.GoToUrl("admin/design/css")}),this.Add("Shift+D",68,function(){Cargo.Helper.GoToUrl("admin/design")}),this.Add("Shift+X",88,function(){Cargo.Helper.GoToUrl("")}),this.Add("Esc",27,function(){Cargo.Helper.IsAdminPath()||(Cargo.View.Following.isActive()&&!Cargo.Modal.isActive()?Cargo.View.Following.Toggle():Cargo.View.SiteMenu.isActive()?Cargo.View.SiteMenu.hide():lightbox.isActive||Action.Page.Home())})}},InitKeycodeListener:function(){var a=_.bind(function(a){a.shiftKey||(83==a.keyCode&&(navigator.platform.match("Mac")?a.metaKey:a.ctrlKey)&&(a.preventDefault(),Cargo.Event.trigger("save_shortcut_triggered",a),Cargo.contentWindow||window.top.Cargo.Event.trigger("save_shortcut_triggered",a)),13==a.keyCode&&Cargo.Event.trigger("enter_keycode_triggered",a),27==a.keyCode&&Cargo.Event.trigger("esc_keycode_triggered",a))},this);document.addEventListener("keydown",a,!1)},InitMessageListener:function(){window.addEventListener("message",function(a){"object"==typeof a.data&&"retrieve-newsletter-html"===a.data.type&&a.data.pid&&Cargo.View.Content.retrieveActivePageViewForPID(a.data.pid,_.bind(function(b){b&&setTimeout(function(){var c="https://weekly.cargocollective.com/w/",d=b.el.querySelector(".page_content");_.each(d.querySelectorAll("a[href]"),function(b){b.setAttribute("href",c+a.data.newsLetterID+"/[email-id]/click?l="+b.href)}),_.each(d.querySelectorAll("img"),function(a){var b=a.getAttribute("src"),c=a.offsetWidth,d=a.offsetHeight;for(a.hasAttribute("data-lazy-src")&&(b=a.getAttribute("data-lazy-src"));a.attributes.length>0;)a.removeAttribute(a.attributes[0].name);a.setAttribute("src",b),a.setAttribute("width",c),a.setAttribute("height",d)});var e=document.createElement("a"),f=document.createElement("img");e.href=c+a.data.newsLetterID+"/[email-id]/unsubscribe",e.className="unsubscribe-link",e.innerHTML="Unsubscribe",f.src=c+a.data.newsLetterID+"/[email-id]/open.gif",f.width=1,f.height=1,f.style.visibility="hidden",f.className="tracking_pixel",d.appendChild(e),d.insertBefore(f,d.firstChild),parent.postMessage({type:"retrieve-newsletter-html-response",html:d.outerHTML,css:b.getLocalCSSElement().innerHTML.trim()},"*")},1e3)},this))},!1)},ReseedThumbnailCollection:function(){Cargo.Event.trigger("thumbnails:clear_cache"),Cargo.Collection.GlobalThumbnails.fetch({params:Cargo.Collection.GlobalThumbnails.currentParams,from_thumbnail_reseed:!0,reset:!0,merge:!0,success:function(){Cargo.View.Thumbnail.checkAndLoadThumbnails(Cargo.Helper.GetCurrentProjectId()),Cargo.Event.trigger("reseed_thumbnails_complete")}})}},Cargo.o.analytics=Backbone.View.extend({Config:{id:"UA-1837333-7",name:"__cargo_analytics"},initialize:function(){this.enabled=!0!==Cargo.Model.DisplayOptions.get("analytics_disabled"),this.enabled&&(Cargo.API.Config.is_domain&&(this.Config.custom_url="/"+document.location.host),function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(f,g)}(window,document,"script",0,"ga"),ga("create",this.Config.id,"auto",{name:this.Config.name,cookieName:this.Config.name}),this.pageview(!1))},setDimension:function(a,b){this.enabled&&ga(this.Config.name+".set",a,b)},pageview:function(a,b){var c=this.Config.name,d=document.location.pathname.replace(/\/$/,"");if(this.enabled){if(void 0!==b&&!a)return void ga(this.Config.name+".send","pageview",{page:b,dimension3:"Cargo 2"});void 0!==this.Config.custom_url?ga(this.Config.name+".send","pageview",{page:this.Config.custom_url+d,dimension3:"Cargo 2"}):ga(this.Config.name+".send","pageview",{dimension3:"Cargo 2"})}"function"==typeof ga&&a&&(ga(function(){ga.getAll().map(function(a){var b=a.get("name");b!=c&&ga(b+".send","pageview",{page:d})})}),"undefined"!=typeof _gaq&&_gaq.push(["_trackPageview",d]))}}),Cargo.o.api=Backbone.View.extend({Config:{Version:"v0",api_path:"/_api",cargo_id:"",cargo_url:"",filter:"",search_term:"",route_name:"",current_offset:0,current_page:1,is_filter:!1,is_search:!1,is_editor:!1,is_template:!1,is_solo:!1,is_direct_link:!1,is_custom_route:!1,admin_edit_project:!1,first_load_finished:!1,tags:null},initialize:function(){_.extend(this.Config,$.parseJSON($("script[data-set='defaults']").html()))},fetch:function(a,b){$.getJSON(a,b)},GetBasePath:function(){var a=this.Config;return a.api_path+"/"+a.Version},GetSitePath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/site/"+a.cargo_url},GetDesignPath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/design/"+a.cargo_url},GetTemplatesPath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/templates"},GetDesignFile:function(a){return this.GetDesignPath()+"?file="+a},GetTemplatePath:function(){var a=this.Config,b=a.route_name?a.route_name+"/":"";return this.GetDesignFile(b)},GetFilesPath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/files"},GetDesignAndFile:function(a,b){var c=this.GetTemplatePath()+a;return b&&(c+="&to_var=true"),c},GetDisplayOptionsPath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/displayoptions/"+a.cargo_url},GetImagesPath:function(a,b,c){a=a||"newest",b=b||"true",c=c||"false";var d=this.GetSitePath()+"/images";return d+="?sort="+a+"&unique="+b+"&projectsonly="+c},GetPluginsPath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/backdrops"},GetPagesPath:function(a,b,c){var d=this.GetSitePath()+"/pages";if(void 0!==a||void 0!==b||void 0!==c){"string"==typeof a&&(a=a.replace(/\ /g,"-")),d+="?";var e=new Array;void 0!==a&&e.push("tags="+a),void 0!==b&&e.push("offset="+b),void 0!==c&&e.push("limit="+c),d+=e.join("&")}return d},GetContentCollectionPath:function(a){var b=this.GetSitePath()+"/content";return a&&(b+="?tags="+a),b},GetAdminListPath:function(a,b){return a=a||this.Config.current_offset,b=b||Cargo.Helper.GetPageLimit(),this.GetSitePath()+"/admincollection"},GetSinglePagePath:function(a){var b=this.Config,c=b.api_path+"/"+b.Version+"/page";return a&&void 0!==a&&(c+="/"+a),c},GetSingleContentPath:function(a){var b=this.GetContentCollectionPath();return a?b+"/"+a:b},GetSingleStackPath:function(a){return this.GetSitePath()+"/stack/"+a},GetSiteFilesPutPath:function(){return"/dispatch/files/putFile"},GetDataPackage:function(a,b){var c={site:Cargo.Model.Site.toJSON(),display_options:Cargo.Model.DisplayOptions.toJSON(),config:this.Config};return c[a]=b,c},GetThumbnailsPath:function(a,b,c,d,e,f,g){var h=this.Config,i=h.api_path+"/"+h.Version+"/thumbnails/"+h.cargo_url;if(void 0!==a||void 0!==c||void 0!==d||void 0!==e||void 0!==f||void 0!==g||void 0!==b){"string"==typeof c&&(c=c.replace(/\ /g,"-")),i+="?";var j=new Array;void 0!==a&&j.push("page_id="+a),void 0!==b&&j.push("all=true"),void 0!==c&&j.push("tags="+c),void 0!==d&&j.push("set_id="+d),void 0!==e&&j.push("offset="+e),void 0!==g?(j.push("random_limit="+g),j.push("random=true")):void 0!==f&&j.push("limit="+f),i+=j.join("&")}return i},GetThumbnailModesPath:function(){var a=this.Config;return a.api_path+"/"+a.Version+"/thumbnailsettings/modes"},GetAllThumbnailSettingsPath:function(a,b,c){var d=this.Config,e=d.api_path+"/"+d.Version+"/thumbnailsettings/"+d.cargo_url+"/all";if(a||c||b){e+="?";var f=new Array;a&&f.push("page_id="+a),c&&f.push("iterator="+c),b&&f.push("mode_id="+b),e+=f.join("&")}return e},GetActiveThumbnailSettingsPath:function(a,b,c,d){var e=this.Config,f=e.api_path+"/"+e.Version+"/thumbnailsettings/"+e.cargo_url+"/single";if(d&&(f+="/"+d),a||c||b){f+="?";var g=new Array;a&&g.push("page_id="+a),c&&g.push("iterator="+c),b&&g.push("mode_id="+b),f+=g.join("&")}return f},PutSiteFile:function(a,b,c){$.ajax({type:"POST",url:this.GetSiteFilesPutPath(),context:this,data:{file:a,data:b,uid:Cargo.Model.Site.GetId()},dataType:"json",success:function(a){"function"==typeof c&&c.call(this,a)},error:function(a){}})}}),Action={Page:{Home:function(a){Cargo.View.Main.ShowHome(void 0,a)},Next:function(){Cargo.View.Main.NextPage()},Prev:function(){Cargo.View.Main.PrevPage()},Random:function(){Cargo.View.Main.RandomPage()}},yepThisIsACargoSite:function(){var a=new Image;a.onload=function(){var a=document.createElement("div");a.style.top="20%",a.style.width="100%",a.style.height="60%",a.style.zIndex="999",a.style.position="fixed",a.style.background='url("/assets/bolt.gif") center center / contain no-repeat',setTimeout(function(){a.style.transition="opacity 500ms",setTimeout(function(){a.parentNode.removeChild(a),a=null},700),setTimeout(function(){a.style.opacity="0"})},1e3),document.body.appendChild(a)},a.src="/assets/bolt.gif"},Start:function(a){$("[data-example-start]").html('<div class="loading_animation pulsing white inline right"><div></div></div>'),Cargo.API.Config.cookie_link&&Cargo.API.Config.cookie_site_count>0?Cargo.Modal.Alert({message:"<em>You’re already logged in; you can create new Sites in your Settings panel.</em>",confirm:function(){top.document.location.href=Cargo.API.Config.cookie_link+"/admin"}}):require(["/_jsapps/admin/_models/adminsite.js"],function(b){var c=new b;c.bind("sync",function(a,b){document.location.href=b.redirect}),c.bind("error",function(a,b){var c=JSON.parse(b.responseText);c&&c.message?Cargo.Modal.Alert({message:c.message,confirm:function(){c.data.redirect&&(document.location.href=c.data.redirect)}}):Cargo.Modal.Alert({message:"There was a problem submitting. Refresh and try again."}),$("[data-example-start]").html("Choose Style")}),a=a||Cargo.Model.Site.GetId(),c.set({template_id:a}),c.save()})}},Cargo.Event=Cargo.Event||{},_.extend(Cargo.Event,Backbone.Events),Cargo.Event.on("add_history",function(a,b){if(Cargo.Router.is_first_route=!1,(a=Cargo.Helper.NormalizeRouteLink(a))===Cargo.Helper.GetCurrentProjectUrl())return void(Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop());Cargo.Helper.IsCurrentRoute(a)?Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop():(b=b||Cargo.Helper.GetPidFromPurl(a),"admin"==a||/^following/.test(a)||/^cart/.test(a)||Cargo.Helper.ShowLoadingAnimation(b,a)),(!/^following/.test(Cargo.Router.previousRoute)&&!/^following/.test(Backbone.history.getFragment())&&/^following/.test(a)||!/^contact-form/.test(Cargo.Router.previousRoute)&&!/^contact-form/.test(Backbone.history.getFragment())&&/^contact-form/.test(a)||!/^cart/.test(Cargo.Router.previousRoute)&&!/^cart/.test(Backbone.history.getFragment())&&/^cart/.test(a))&&(Cargo.Router.previousSiteRoute=Backbone.history.getFragment()),Cargo.Router.previousRoute=Backbone.history.getFragment(),Cargo.Router.navigate(a,{trigger:!0})}),Cargo.Event.on("add_history_passive",function(a){a=Cargo.Helper.NormalizeRouteLink(a),Cargo.Router.navigate(a,{trigger:!1,replace:!0})}),Cargo.Event.on("admin_page_update",function(a,b){}),Cargo.Event.on("BaseUnit:set",function(a){var b=Cargo.Helper.IsMobileWindowSize(a.cache.window.w);Cargo.Event.trigger("mobile_size",b)}),Cargo.Event.on("custom_route_loaded",function(a){}),Cargo.Event.on("content_view_closed",function(){}),Cargo.Event.on("first_page_collection_reset",function(){Cargo.API.Config.first_load_finished=!0}),Cargo.Event.on("hide_loading_anim",function(){"object"==typeof Cargo.Helper&&Cargo.Helper.HideLoadingAnimation&&Cargo.Helper.HideLoadingAnimation()}),Cargo.Event.on("homepage_loaded",function(){Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop(),Cargo.View.Main&&(Cargo.View.Main.SetHomepageClass(),Cargo.View.Main.SetFeedClass())}),Cargo.Event.on("loading_anims_replaced",function(){}),
Cargo.Event.on("mobile_size",function(a){}),Cargo.Event.on("mobile_padding_set",function(){}),Cargo.Event.on("plugin_render",function(a){a.el.style.opacity=0,a.el.style.transition="opacity .5s ease-in-out",a.el.style.webkitTransition="opacity .5s ease-in-out",void 0===a.deferredLoadEventName?setTimeout(function(){a.el.style.opacity=1},33):Cargo.Event.once(a.deferredLoadEventName,function(){a.el.style.opacity=1})}),Cargo.Event.on("page_change",function(){}),Cargo.Event.on("page_collection_reset",function(){}),Cargo.Event.on("page_load_complete",function(a){Cargo.Event.PageTransition=new $.Deferred,Cargo.View.Main&&!Cargo.Helper.IsOnHomepage()?(Cargo.View.Main.RemoveHomepageClass(),Cargo.View.Main.RemoveFeedClass()):null!==Cargo.View.Content.activeContentModel&&Cargo.View.Content.activeContentModel.get("id")!==Cargo.Helper.GetHomepageId()&&(Cargo.View.Main.RemoveHomepageClass(),Cargo.View.Main.RemoveFeedClass()),Cargo.Helper.HideLoadingAnimation(),Cargo.View.Main.SetWindowTitle(),Cargo.Event.trigger("project_load_complete",a)}),Cargo.Event.on("content_load_complete",function(a){Cargo.View.Main&&!Cargo.Helper.IsOnHomepage()?Cargo.View.Main.RemoveHomepageClass():null!==Cargo.View.Content.activeContentModel&&Cargo.View.Content.activeContentModel.get("id")!==Cargo.Helper.GetHomepageId()&&Cargo.View.Main.RemoveHomepageClass(),Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop(),Cargo.View.Main.SetPageId(a),Cargo.API.Config.is_direct_link||Cargo.Helper.IsOnHomepage()||Cargo.Analytics.pageview(!0),Cargo.Helper.HideLoadingAnimation()}),Cargo.Event.on("set_render_complete",function(a){}),Cargo.Event.on("image_gallery_init_complete",function(a){}),Cargo.Event.on("image_gallery_render_complete",function(a){}),Cargo.Event.on("image_upload_complete",function(a){}),Cargo.Event.on("image_delete_complete",function(a){}),Cargo.Event.on("pagination_complete",function(a,b,c){c&&c.render_changes&&($(window).trigger("resize"),Cargo.Plugins.elementResizer.update())}),Cargo.Event.on("page_load_start",function(a){Cargo.Event.trigger("page_change")}),Cargo.Event.on("project_load_start",function(a){Cargo.Event.trigger("page_load_start",a)}),Cargo.Event.on("reseed_pages_complete",function(a){}),Cargo.Event.on("show_index_complete",function(a){Cargo.View.Main.SetWindowTitle(!0),Cargo.Event.IndexTransition=new $.Deferred}),Cargo.Event.on("show_index_start",function(a){Cargo.Event.trigger("page_change")}),Cargo.Event.on("show_loading_anim",function(){Cargo.Helper.ShowLoadingAnimation(null,"page")}),Cargo.Event.on("solo_link_loaded",function(a){}),Cargo.Event.on("template_loaded",function(a){}),Cargo.Event.PageTransition=new $.Deferred,Cargo.Event.IndexTransition=new $.Deferred,Cargo.Event.ShowPageTransition=function(a,b,c){return Cargo.Event.PageTransition.resolve(),Cargo.Event.PageTransition.promise()},Cargo.Event.ShowIndexTransition=function(a,b){return Cargo.Event.IndexTransition.resolve(),Cargo.Event.IndexTransition.promise()},window.addEventListener("popstate",function(){"object"==typeof lightbox&&void 0!==lightbox.activeGallery&&lightbox.activeGallery.close()}),Cargo.o.helpers=Backbone.View.extend({Data:{is_loading:!1,loading_timout:1e3,projectlist_volatile:!1},initialize:function(){Cargo.Event.on("adminlist_volatile",function(){this.Data.projectlist_volatile=!0},this),Cargo.Event.on("adminlist_stable",function(){this.Data.projectlist_volatile=!1},this)},FindCollectionByProjectUrl:function(a){var b=!1;return _.each(Cargo.Collection.Page,function(c){if(!b){var d=new Backbone.Collection;d.reset(c);d.where({project_url:a})[0]&&(b=c)}}),b},GetActiveIndex:function(a){var b=Cargo.Helper.GetHomeUrl(!0,!0);return a?location.protocol+"//"+this.GetBaseDomain()+b:b},GetBackboneCaseInsensitive:function(a,b){var c={};for(var d in a)!a.hasOwnProperty(d)||"function"!=typeof a[d]&&"object"!=typeof a[d]||(c[d.toLowerCase()]=d);return b?c[b.toLowerCase()]:""},GetBaseUrl:function(a,b){if(Cargo.API.Config.is_domain)return b?"/":"";var c=a?Cargo.API.Config.cargo_url:"";return b?"/"+c:c},IsAdminProjectListSorting:function(){return this.Data.projectlist_volatile},GetBaseCargoDomain:function(){var a=Cargo.Model.Site.get("home_url");return a?a.replace(/(http(s)?:\/\/)/,""):document.location.host},GetAuthDomain:function(){var a=Cargo.Model.Site.get("auth_url");return a||"//"+document.location.host},GetBaseDomain:function(){return Cargo.Model.Site.get("home_url").replace(/(http(s)?:\/\/)/,"")},IsIndexableModel:function(a){return!(!a||"set"!==a.attributes.type)||!!a&&!(!1===a.attributes.display||a.attributes.pin||a.attributes.is_homepage&&!a.attributes.is_set)},GetCurrentProjectUrl:function(){var a=Cargo.View.Content.getActiveContentModel();return a?a.get("project_url"):null},GetCurrentProjectId:function(){if(void 0===Cargo.View.Content)return null;var a=Cargo.View.Content.getActiveContentModel();return a?a.get("id"):null},GetCurrentRoute:function(){return Backbone.history.fragment},GetDomainOrUrl:function(){return Cargo.API.Config.is_domain?this.GetUrl():location.pathname.split("/")[1]},GetHomeUrl:function(a,b){var c=b?"/":"";return Cargo.API.Config.set&&Cargo.API.Config.filter?Cargo.API.Config.is_domain?c+Cargo.API.Config.set+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):this.GetBaseUrl(a,b)+"/"+Cargo.API.Config.set+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):Cargo.API.Config.route&&Cargo.API.Config.filter?Cargo.API.Config.is_domain?Cargo.Helper.GetRouteUrl()+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):this.GetBaseUrl(a,!1)+Cargo.Helper.GetRouteUrl()+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):Cargo.API.Config.filter?Cargo.API.Config.is_domain?c+"filter/"+encodeURIComponent(Cargo.API.Config.filter):this.GetBaseUrl(a,b)+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):Cargo.API.Config.set?Cargo.API.Config.is_domain?c+Cargo.API.Config.set:this.GetBaseUrl(a,b)+"/"+Cargo.API.Config.set:Cargo.API.Config.route&&Cargo.API.Config.is_domain?Cargo.Helper.GetRouteUrl():this.GetBaseUrl(a,b)},GetOffsetFromPage:function(a){var b=this.GetPageLimit();return--a*b},GetPageLimit:function(){var a=Cargo.Model.DisplayOptions.GetPaginationCount();return a&&Cargo.Model.DisplayOptions.GetIndexRouteName()&&Cargo.Model.DisplayOptions.GetIndexRouteName().toUpperCase()==Cargo.Helper.GetRouteName().toUpperCase()&&Cargo.Model.DisplayOptions.get("index_pagination_count")?a=Cargo.Model.DisplayOptions.get("index_pagination_count"):Cargo.Model.DisplayOptions.get("mobile_pagination_count")&&this.isMobile()&&(a=Cargo.Model.DisplayOptions.get("mobile_pagination_count")),a||10},IsMobileWindowSize:function(a){return a<this.GetMobileWindowBreakPoint()},GetMobileWindowBreakPoint:function(a){return 770},GetPageViewById:function(a){var b;return void 0===b&&Cargo.View.Content&&(b=Cargo.View.Content.getPageViewById(a)),void 0===b&&Cargo.View.PinnedTop&&(b=Cargo.View.PinnedTop.getPageViewById(a)),void 0===b&&Cargo.View.PinnedBottom&&(b=Cargo.View.PinnedBottom.getPageViewById(a)),b},GetPidFromPurl:function(a){var b=Cargo.Collection.Scaffolding.getModel({project_url:a});return b?b.get("id"):0},GetRouteName:function(){var a=Cargo.API.Config.route_name;return/display_options/.test(Cargo.API.Config.route)&&(a=Cargo.Model.DisplayOptions.GetIndexRouteName()),a},GetRouteUrl:function(){var a=Cargo.API.Config.route_name;return(/display_options/.test(Cargo.API.Config.route)||"feed"==a||"index"==a)&&(a=Cargo.Model.DisplayOptions.GetIndexRouteUrl()),a},GetHomepageId:function(){return Math.floor(Cargo.Model.Site.GetHomepageId())},GetUrl:function(){return Cargo.API.Config.cargo_url},GoToUrl:function(a){top.document.location.href=document.location.origin+"/"+a},HideLoadingAnimation:function(a){this.ClearLoadingAnimationTimeout(),this.Data.is_loading=!1,$("[data-loading]").hide()},IsAdminEdit:function(){var a=/\/adminedit/.test(document.location.pathname)||/\/admin/.test(document.location.pathname);try{var b=parent!=window&&"object"==typeof parent.Cargo,c=void 0!=Cargo.Editor;return a||b||c}catch(a){return!1}},IsAdminBackdrop:function(){return/\/adminbackdrop/.test(document.location.pathname)},IsStandaloneAdmin:function(){return!!(Cargo&&Cargo.Editor&&Cargo.Editor.hasOwnProperty("Standalone"))},IsCurrentRoute:function(a){return a=this.NormalizeRouteLink(a),Cargo.Helper.GetCurrentRoute()==a},isFeed:function(){return Cargo.Model.DisplayOptions.get("layout_options").is_feed},isFirefox:function(){return/Firefox\/\d+\.\d+/.test(navigator.userAgent)},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")},isIE:function(){return/MSIE (\d+\.\d+);/.test(navigator.userAgent)},isEdge:function(){return/Edge/.test(navigator.userAgent)},isIE8:function(){var a=-1;if(this.isIE()){null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1))}return a<9&&a>0},isIOS:function(){return!!navigator.userAgent.match(/i(Phone|Pod|Pad)/i)},isMobile:function(){if(this.isIOS())return!0;var a=!1,b=navigator.userAgent||navigator.vendor||window.opera;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(b),a=a||!a&&/(android)/i.test(b.substr(0,40))},isIOSWebView:function(){var a=window.navigator.standalone,b=window.navigator.userAgent.toLowerCase(),c=/safari/.test(b);if(/iphone|ipod|ipad/.test(b)){if(!a&&c)return!1;if(a&&!c)return!1;if(!a&&!c)return!0}return!1},IsOnHomepage:function(){return(""==Cargo.Helper.GetCurrentRoute()||"adminedit"==Cargo.Helper.GetCurrentRoute())&&null!=Cargo.Helper.GetHomepageId()},isOldIE:function(){var a=-1;if(this.isIE()){null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1))}return a<=9&&a>0},IsAdminPath:function(){return/\/admin(\/|$)/.test(document.location.pathname)},IsPresetPreview:function(){return/\/presetpreview(\/|$)/.test(document.location.pathname)},IsCurrentRoute:function(a){return a=a.replace("/",""),this.GetCurrentRoute()&&a&&this.GetCurrentRoute().toLowerCase()==a.toLowerCase()},isTablet:function(){return"string"==typeof new MobileDetect(window.navigator.userAgent).tablet()},NormalizeRouteLink:function(a){if(!a)return a;-1!==a.indexOf(Cargo.Helper.GetBaseDomain())&&(a=a.split(Cargo.Helper.GetBaseDomain())[1]),"/"==a.charAt(0)&&(a=a.replace("/","")),!/following/.test(a)&&this.GetHomeUrl(!0)&&0==a.search(this.GetHomeUrl(!0))&&(a=a.replace(this.GetHomeUrl(!0)+"/","")),"/"==a.charAt(a.length-1)&&(a=a.substr(0,a.length-1));var b=Cargo.Collection.Scaffolding.getModel({project_url:a});return void 0!==b&&b.get("id")==Cargo.Helper.GetHomepageId()&&(a=""),a},ScrollToTop:function(){var a=Cargo.Router.scrollPositions[Backbone.history.getFragment()];requestAnimationFrame(function(){window.scrollTo(0,a)})},ShowLoadingAnimation:function(a,b){this.Data.is_loading=!0,a?this.Data.loadingAnimationTimeoutID=_.delay(function(){Cargo.Helper.ShowLoadingAnimationById(a)},Cargo.Helper.Data.loading_timout):b&&(this.Data.loadingAnimationTimeoutID=_.delay(function(){Cargo.Helper.ShowLoadingAnimationById("page")},Cargo.Helper.Data.loading_timout)),$("*[data-loading=global], *[data-loading=global] .retinaSpinner").show()},ClearLoadingAnimationTimeout:function(){window.clearTimeout(this.Data.loadingAnimationTimeoutID)},ShowLoadingAnimationById:function(a){this.Data.is_loading&&$("*[data-loading="+a+"], *[data-loading="+a+"] .retinaSpinner").show()},TestUrlCaseAndRedirect:function(){if(!Cargo.API.Config.is_domain){var a=document.location.pathname.split("/")[1],b=Cargo.API.Config.cargo_url;a!=b&&a.toUpperCase()==b.toUpperCase()&&history.replaceState(document.location.pathname.replace(a,b),Cargo.Model.Site.GetWebsiteTitle())}},UpdatePinPages:function(a){"top"==a?Cargo.View.PinnedTop.formatOverlayPages():"bottom"==a?Cargo.View.PinnedBottom.formatOverlayPages():(Cargo.View.PinnedTop.formatOverlayPages(),Cargo.View.PinnedBottom.formatOverlayPages())},htmlDecode:function(a){var b=document.createElement("div");return b.innerHTML=a,0===b.childNodes.length?"":b.childNodes[0].nodeValue}}),Cargo.o.router=Backbone.Router.extend({routes:{"":"Home",adminedit:"Home",cart:"Cart","contact-form":"Contact","preview/:which":"Home","search/:query":"Search",":purl/adminedit":"AdminEdit",":purl":"slashProxy",":purl1/:purl2":"slashProxy",":purl1/:purl2/:purl3":"slashProxy","*actions":"defaultAction"},is_first_route:!0,defaultAction:function(a){this.route(a)},preventQueryStringRemoval:!1,initialize:function(){document.location.search&&"?example=true"!=document.location.search&&(this.handleQueryString(document.location.search),this.preventQueryStringRemoval||window.history.replaceState({},document.title,document.location.href.replace(document.location.search,""))),this._lastFrag=null,this.scrollPositions={}},handleQueryString:function(a){if("string"==typeof a){var b=["fontsinuse","wetransfer","wepresent","sightunseen","core77","NYABF2018"],c=b.indexOf(a.substring(1));-1!==c&&setTimeout(function(){Cargo.Analytics.setDimension("dimension5",b[c])}),this.queryString=a}},execute:function(a,b,c){null!==this._lastFrag&&document.scrollingElement&&(this.scrollPositions[this._lastFrag]=document.scrollingElement.scrollTop),this._lastFrag=Backbone.history.getFragment(),Backbone.Router.prototype.execute.apply(this,arguments)},navigate:function(a){this.scrollPositions.hasOwnProperty(a)&&delete this.scrollPositions[a],Backbone.Router.prototype.navigate.apply(this,arguments)},slashProxy:function(a,b,c){if(this.RouteIsHome(a))this.Home(a);else if(/\,|\~|\+/.test(a)&&!/\?/.test(a))Cargo.Event.trigger("thumbnails:load_tag",a),b?this.Page(b):Cargo.View.Content.hideActiveView();else if(/\,|\~\+/.test(b)){Cargo.Event.trigger("thumbnails:load_tag",b,a);var d=c||a;this.Page(d)}else if(a&&b&&!c){var e=Cargo.Collection.Tags.findTagByUrl(a),f=Cargo.Collection.Tags.findTagByUrl(b);e?(Cargo.Event.trigger("thumbnails:load_tag",e.get("url")),this.Page(b)):f&&(Cargo.Event.trigger("thumbnails:load_tag",f.get("url"),a),Cargo.View.Content.hideActiveView())}else this.Page(a)},Home:function(a){this.CheckToggleFollowing(),a||(a=""),Cargo.Event.trigger("before_purl_render",a),0!==Cargo.Helper.GetHomepageId()||Cargo.Helper.isFeed()?(Cargo.View.Content.RenderHomepage(),Cargo.View.Main&&(Cargo.View.Main.SetHomepageClass(),Cargo.View.Main.SetFeedClass())):Cargo.API.Config.offline?(Cargo.Event.trigger("page_load_complete"),Cargo.Event.trigger("content_load_complete")):(Cargo.View.Content.hideActiveView(),Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()))},Following:function(){},FollowedBy:function(){},Contact:function(){Cargo.View.Following.loadSection("contact")},Cart:function(){Cargo.View.Following.loadSection("cart",!0)},Page:function(a){Cargo.Event.trigger("before_purl_render",a),this.CheckToggleFollowing(),a+="",a=a.replace(/\//g,""),Cargo.View.Content.RenderPidOrPurl(a)},Search:function(a){this.Home()},AdminEdit:function(a){return this.CheckToggleFollowing(),Cargo.API.Config.admin_edit_project=!0,this.Page(a)},CheckToggleFollowing:function(){!0===Cargo.View.Following.isActive()&&Cargo.View.Following.disable()},_routeToRegExp:function(a){return a=a.replace(/[-{}[\]+?.,\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/:\w+/g,"([^/]+/?)").replace(/\*\w+/g,"(.*?)"),new RegExp("^"+a+"$","i")},addroute:function(a,b,c){for(var d=["","/","?*querystring","/?*querystring"],e=0;e<d.length;e++){var f=d[e];this.route(a+f,b,c)}},RouteIsHome:function(a){var b=!1;return Cargo.API.Config.is_domain||a.toLowerCase()!=Cargo.Helper.GetDomainOrUrl().toLowerCase()||document.location.pathname.replace("/").split("/").length<=1&&(b=!0),b}}),Cargo.o.templates=Backbone.View.extend({Data:{},Get:function(a,b){var c=Cargo.Helper.GetBackboneCaseInsensitive(this.Data,a);if(c=c||a,this.Data[c]&&this.Data[c].template)return this.Data[c].template;this.Load(c,b)},Add:function(a,b,c){Cargo.Template.Data[a]={dataset:b,setname:c}},FindAndAddViewStubs:function(){$("[data-view]").each(function(){var a=$(this).data("view"),b=$(this).data("set"),c=new Backbone.Collection;if(b){var d=Cargo.Helper.GetBackboneCaseInsensitive(Cargo.Collection,b),e=Cargo.Helper.GetBackboneCaseInsensitive(Cargo.Model,b);d?c=Cargo.Collection[d]:e&&(c=Cargo.Model[e])}Cargo.Template.Add(a,c,b)})},Load:function(which,file_path){if(!file_path){var file_name=which;file_path=Cargo.API.GetDesignAndFile(file_name,!1)}Cargo.Template.Data[which]&&Cargo.Template.Data[which].loading||(Cargo.Template.Data[which]||(Cargo.Template.Data[which]={}),Cargo.Template.Data[which].loading=!0,Cargo.Event.trigger("template_preload",which),$.loadFiles(file_path).done(function(template){if(template){try{var template=eval(template)}catch(a){}Cargo.Template.Data[which].template=template}else{var template_var="templatesdesign"+file_name.replace(/(\/|\.)/g,"");Cargo.Template.Data[which].template=window[template_var]}return Cargo.Event.trigger("template_loaded",which),Cargo.Template.Data[which].template}))},LoadAll:function(){for(key in this.Data)void 0===this.Data[key].template&&this.Load(key)},LoadFoundViews:function(){for(key in this.Data){var a=0==key.indexOf("pinned")?"Pin":key,b=Cargo.Helper.GetBackboneCaseInsensitive(Cargo.o.view,a);if("function"==typeof Cargo.o.view[b]&&void 0===Cargo.View[b]){var c=0==key.indexOf("pinned")?key.toCamel(!0):b.toCamel(!0);if(void 0===Cargo.View[c]){var d=this;$("[data-view='"+key+"']").each(function(a){c=a>0?b+"_"+a:c,Cargo.View[c]=new Cargo.o.view[b]({el:this,collection:d.Data[key].dataset,template:d.Data[key].template,className:c}),void 0==d.Data[key].template&&Cargo.View[c].template&&(d.Data[key].template=Cargo.View[c].template)})}}}}}),Cargo.o.model.StripeProductModel=Backbone.Model.extend({initialize:function(){},parse:function(a,b){return a.is_file=!1,a&&a.attributes&&-1!==a.attributes.indexOf("link_to_file")&&(a.is_file=!0,a.attributes=[],a.skus.total_count>1&&a.attributes.push("description")),a&&a.skus&&a.skus.data&&_.each(a.skus.data,function(b){a.is_file&&a.skus.total_count>1&&"object"==typeof b.attributes&&0===_.keys(b.attributes).length&&(b.attributes.description=a.name+" - "+Cargo.o.view.ProductWidget.prototype.formatPriceForCurrency(b.price,b.currency)),b.is_file=a.is_file}),a},getSku:function(a){if(void 0!=this.attributes.skus)return _.findWhere(this.attributes.skus.data,{id:a})}}),Cargo.o.collection.StripeProductCollection=Backbone.Collection.extend({model:Cargo.o.model.StripeProductModel,productSyncOccurred:!1,initialize:function(){this.cart_items=void 0,Cargo.Event.on("cart-size-changed",function(a){this.cart_items=a,this.updateCartText()},this),Cargo.Event.on("stripe_account_connected stripe_account_disconnected",this.fetch,this)},updateCartText:function(a,b){if(!0===b||void 0!==Cargo.Model.DisplayOptions.get("ecommerce_options")&&"text"==Cargo.Model.DisplayOptions.get("ecommerce_options").shop_icon){var c=document.getElementById("shop_button");a||(a=Cargo.Model.DisplayOptions.get("ecommerce_options").shop_icon_text),c&&a&&(void 0===this.cart_items||0===this.cart_items?c.innerHTML=a.replace(/&lt;(.*?)#(.*?)&gt;/gi,""):c.innerHTML="string"==typeof a&&""!==a?a.replace(/&lt;(.*?)#(.*?)&gt;/gi,"$1"+this.cart_items+"$2"):"")}},url:function(){return"/_api/v0/ecommerce/products/"+Cargo.Model.Site.get("id")}}),function(){Cargo.Core.PageviewFactory={pageViewTypes:[],constructPageView:function(){var a,b=Cargo.o.view.Page;for(a=0;a<this.pageViewTypes.length;a++)if(!0===this.pageViewTypes[a].filter.apply(this,arguments)){b=this.pageViewTypes[a].constructor;break}return new(Function.prototype.bind.apply(b,[].concat.apply([null],arguments)))},addPageViewType:function(a,b){b.constructor=function(){this.__super__=Object.getPrototypeOf(Object.getPrototypeOf(this)),Backbone.View.prototype.constructor.apply(this,arguments)},this.pageViewTypes.push({filter:a,constructor:Cargo.o.view.Page.extend(b)})}}}(),function(){Cargo.Core.SetViewFactory={setViewTypes:[],constructSetView:function(){var a,b=Cargo.o.view.Set;for(a=0;a<this.setViewTypes.length;a++)if(!0===this.setViewTypes[a].filter.apply(this,arguments)){b=this.setViewTypes[a].constructor;break}return new(Function.prototype.bind.apply(b,[].concat.apply([null],arguments)))},addSetViewType:function(a,b){b.constructor=function(){this.__super__=Object.getPrototypeOf(Object.getPrototypeOf(this)),Backbone.View.prototype.constructor.apply(this,arguments)},this.setViewTypes.push({filter:a,constructor:Cargo.o.view.Set.extend(b)})}}}(),Cargo.Core.ImageGallery={draggingOverGallery:!1,draggingInEditor:!1,idIndex:0,imageGalleryObjects:{},cachedScrollPosition:-1,imageGalleryModes:{},allModesLoaded:!1,galleryLoadInProgress:!1,currentEditableGallery:void 0,loadGalleryModes:function(){var a=this;!Cargo.Helper.IsAdminEdit()||this.allModesLoaded||this.galleryLoadInProgress||(this.galleryLoadInProgress=!0,require(["/_jsapps/imagegallery/columns/main.js?nocache=18-11-26","/_jsapps/imagegallery/freeform/main.js?nocache=18-11-26","/_jsapps/imagegallery/grid/main.js?nocache=18-11-26","/_jsapps/imagegallery/justify/main.js?nocache=18-11-26","/_jsapps/imagegallery/montessori/main.js?nocache=18-11-26","/_jsapps/imagegallery/slideshow/main.js?nocache=18-11-26"],function(b,c,d,e,f,g){a.imageGalleryModes={columns:b,freeform:c,grid:d,justify:e,montessori:f,slideshow:g},a.allModesLoaded=!0,a.galleryLoadInProgress=!1,a.InitImageGallery()}))},addEditorEvents:function(){"undefined"!=typeof CargoEditor&&CargoEditor.events&&_.each(this.editorEvents,function(a,b){this.boundEditorEvents.push(CargoEditor.events.on(b,_.bind(a,this)))},this)},initialize:function(){this.boundEditorEvents=[],this.addEditorEvents(),Cargo.Event.on("gallery-drag-end",function(a,b){var c=$('.image-gallery[gid="'+b+'"] [data-gallery-uid="'+a+'"]')[0];c&&Cargo.Core.ImageGallery.normalizeSelection(void 0,c)},this),this.InitImageGallery()},galleryDefaults:function(){return{name:"Columns",path:"columns",mode_id:2,gallery_instance_id:0,data:{column_size:10,columns:3,image_padding:2,responsive:!0,mobile_data:{columns:2,column_size:11,image_padding:1,separate_mobile_view:!1},meta_data:{}}}},init_options_defaults:{forceReCollectionOfItems:!1,targetElement:!1},parseGalleryOptions:function(a){for(var b=decodeURIComponent(a),c=0;"{"!==b[0]&&c<3;)b=decodeURIComponent(b),c++;return"{"!==b[0]?this.galleryDefaults():JSON.parse(b)},InitImageGallery:function(a){var b=this;if(Cargo.Helper.IsAdminEdit()&&!this.allModesLoaded)return void this.loadGalleryModes();if(a||(a={}),a=_.defaults(a,this.init_options_defaults),!a.targetElement||jQuery.contains(document.documentElement,a.targetElement)){var c=[],d=[];(a.targetElement?$(a.targetElement).find(".image-gallery[gid-clone]"):$(".image-gallery[gid-clone]")).remove();var e=a.targetElement?$(a.targetElement).find(".image-gallery[gid]"):$(".image-gallery[gid]"),f=a.targetElement?$(a.targetElement).find(".image-gallery").not(".initialized, .initialization-in-progress").length:$(".image-gallery").not(".initialized, .initialization-in-progress").length;e.each(function(){var a=this.getAttribute("gid");-1==d.indexOf(a)?d.push(a):(this.removeAttribute("gid"),this.setAttribute("gid-clone",a))});(a.targetElement?$(a.targetElement).find(".image-gallery"):$(".image-gallery")).each(function(){if($(this.parentNode).closest(".image-gallery").length>0)return void this.parentNode.removeChild(this);if(this.setAttribute("contenteditable",!1),!1===$(this).hasClass("initialized")&&!1===$(this).hasClass("initialization-in-progress")){$(this).addClass("initialization-in-progress"),c.push(parseInt($(this).closest(".page").attr("data-id"))),this.hasAttribute("data-gallery")&&this.setAttribute("data-gallery",JSON.stringify(Cargo.Core.ImageGallery.parseGalleryOptions(this.getAttribute("data-gallery"))));var d,e=this.hasAttribute("gid")&&b.imageGalleryObjects.hasOwnProperty(this.getAttribute("gid"));this.hasAttribute("data-force-gid")&&this.hasAttribute("gid")?(d=this.getAttribute("gid"),this.removeAttribute("data-force-gid")):d=e?this.getAttribute("gid"):++b.idIndex,this.setAttribute("gid",d);var g={};if(e)b.imageGalleryObjects[d].el=this,g=b.imageGalleryObjects[this.getAttribute("gid")],g.subviewInited=!1,g.mobileSubviewInited=!1,g.subviewActive=!1,g.mobileSubviewActive=!1,a.forceReCollectionOfItems&&(g.images=null,g.removeViews(),g.checkMobileAndLoadSubview()),b.imageGalleryObjects[d].storeOptionsOnElement();else{if(g={options:Cargo.Core.ImageGallery.galleryDefaults(d),el:this,images:null,isEditing:!1,hasClick:!1,isEditable:!1,MobileSubview:null,mobileSubviewInitInProgress:!1,mobileSubviewInited:!1,mobileSubviewActive:!1,Subview:null,subviewInitInProgress:!1,subviewInited:!1,inited:!1,bindEvents:function(){var a=this;Cargo.Helper.IsAdminEdit()&&($(this.el).on("mousedown.gallery",function(){a.hasClick=!0}),$(this.el).on("mouseup.gallery mouseleave.gallery",function(){a.hasClick=!1}),this.enableEditable=_.bind(this.enableEditable,this),this.checkIfStillEditable=_.bind(this.checkIfStillEditable,this),$(this.el).on("mousedown.editable",this.enableEditable),$(this.el).on("mouseup.editable mouseleave.editable",this.checkIfStillEditable),CargoEditor.events.on("editor-drop",this.checkIfStillEditable),CargoEditor.events.on("cursor-activity",this.checkIfStillEditable),CargoEditor.events.on("editor-deactivated",this.checkIfStillEditable)),Cargo.Event.on("mobile_size",this.requestTick,this)},unbindEvents:function(){$(this.el).off("mousedown.gallery mouseup.gallery mouseleave.gallery mousedown.editable mouseup.editable mouseleave.editable"),Cargo.Event.off("mobile_size",this.requestTick),Cargo.Helper.IsAdminEdit()&&(CargoEditor.events.off("editor-drop",this.checkIfStillEditable),CargoEditor.events.off("cursor-activity",this.checkIfStillEditable),CargoEditor.events.off("editor-deactivated",this.checkIfStillEditable))},enableEditable:function(){!0!==this.isEditable&&(Cargo.Core.ImageGallery.currentEditableGallery&&Cargo.Core.ImageGallery.currentEditableGallery.disableEditable(),this.el.removeAttribute("contenteditable"),this.isEditable=!0,Cargo.Core.ImageGallery.currentEditableGallery=this,Cargo.Event.trigger("gallery_editing_enabled",this))},disableEditable:function(){!1!==this.isEditable&&(this.el.setAttribute("contenteditable",!1),this.isEditable=!1,Cargo.Event.trigger("gallery_editing_disabled",this),Cargo.Core.ImageGallery.currentEditableGallery&&Cargo.Core.ImageGallery.currentEditableGallery.options.gallery_instance_id==this.options.gallery_instance_id&&(Cargo.Core.ImageGallery.currentEditableGallery=void 0))},checkIfStillEditable:function(a){if(!1!==this.isEditable){var b=CargoEditor.getActiveRange(),c=!1;if(b){var d=b.commonAncestorContainer;d.nodeType!==Node.ELEMENT_NODE&&(d=d.parentNode),c=this.el.contains(d)}c||this.disableEditable()}},setEditMode:function(a){a&&!this.isEditing?$(window).on("scroll.imagegalleryEdit",function(){g.cachedRects.needsUpdate=!0}):!a&&this.isEditing&&$(window).off("scroll.imagegalleryEdit"),this.isEditing=a},checkMobileAndLoadSubview:function(){var a=Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth),b=this.options.data.mobile_data.separate_mobile_view,c=this.options.data.responsive,d=this.mobileSubviewActive,e=this.mobileSubviewInitInProgress,f=this.mobileSubviewInited,g=this.subviewInited,h=this.subviewInitInProgress;a&&b&&!d&&c?e||(f&&this.MobileSubview.galleryOptions.data.mobile_design_path==this.options.data.mobile_data.mobile_design_path?(this.MobileSubview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewActive=!0):this.loadMobileSubview(),this.cachedRects.needsUpdate=!0):a&&b&&c||h||(!g||this.Subview&&this.Subview.galleryOptions.path!=this.options.path?this.loadSubview():d&&(this.Subview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewActive=!1),this.cachedRects.needsUpdate=!0)},loadSubview:function(){var a=this;this.Subview&&this.subviewInited&&(this.Subview.destroy(),this.subviewInited=!1),this.subviewInitInProgress=!0,Cargo.Core.ImageGallery.imageGalleryModes.hasOwnProperty(this.options.path)?this.finishSubviewSetup(Cargo.Core.ImageGallery.imageGalleryModes[this.options.path]):require(["/_jsapps/imagegallery/"+this.options.path+"/main.js?nocache=17-12-11.1"],function(b){Cargo.Core.ImageGallery.imageGalleryModes[a.options.path]=b,a.finishSubviewSetup(b)})},finishSubviewSetup:function(a){var d=Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth),e=new a({el:this.el,galleryOptions:this.options,parentView:this,mobile_active:d}),g=!b.inited;if(this.Subview=e,this.images||(this.images=this.Subview.serialize()),(_.keys(this.images).length<2&&!Cargo.Core.ImageGallery.draggingInEditor||0==_.keys(this.images).length)&&this.destroy(),$(this.el).removeClass("initialization-in-progress"),this.Subview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewActive=!1,this.subviewInited=!0,this.subviewInitInProgress=!1,this.inited=!0,this.lastSerializedState=this.Subview.serialize(),this.unbindEvents(),this.bindEvents(),this.isEditing||this.hasClick)if(-1==Cargo.Core.ImageGallery.cachedScrollPosition){var h=this.el.getBoundingClientRect();(h.top>window.innerHeight-30||h.bottom<30)&&window.scrollTo(0,h.top+$(window).scrollTop())}else window.scrollTo(0,Cargo.Core.ImageGallery.cachedScrollPosition);g&&(Cargo.Event.trigger("image_gallery_render_complete",this),0==--f&&Cargo.Event.trigger("image_gallery_init_complete",c))},loadMobileSubview:function(){var a=this;this.MobileSubview&&this.mobileSubviewInited&&(this.MobileSubview.destroy(),this.mobileSubviewInited=!1),this.options.data.mobile_data.separate_mobile_view&&(this.mobileSubviewInitInProgress=!0,Cargo.Core.ImageGallery.imageGalleryModes.hasOwnProperty(this.options.data.mobile_data.mobile_design_path)?this.finishMobileSubviewSetup(Cargo.Core.ImageGallery.imageGalleryModes[this.options.data.mobile_data.mobile_design_path]):require(["/_jsapps/imagegallery/"+this.options.data.mobile_data.mobile_design_path+"/main.js"],function(b){Cargo.Core.ImageGallery.imageGalleryModes[a.options.data.mobile_data.mobile_design_path]=b,a.finishMobileSubviewSetup(b)}))},finishMobileSubviewSetup:function(a){var b=$.extend(!0,{},this.options);b.data=_.extend(b.data,b.data.mobile_data),b.data.responsive=!1
;var d=!this.inited,e=new a({el:this.el,galleryOptions:b,parentView:this,mobile_active:!0});if(this.MobileSubview=e,this.images=this.MobileSubview.serialize(),(_.keys(this.images).length<2&&!Cargo.Core.ImageGallery.draggingInEditor||0==_.keys(this.images).length)&&this.destroy(),$(this.el).removeClass("initialization-in-progress"),this.MobileSubview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewActive=!0,this.mobileSubviewInited=!0,this.mobileSubviewInitInProgress=!1,this.inited=!0,this.unbindEvents(),this.bindEvents(),this.lastSerializedState=this.MobileSubview.serialize(),this.isEditing||this.hasClick)if(-1==Cargo.Core.ImageGallery.cachedScrollPosition){var g=this.el.getBoundingClientRect();(g.top>window.innerHeight-30||g.bottom<30)&&window.scrollTo(0,g.top+$(window).scrollTop())}else window.scrollTo(0,Cargo.Core.ImageGallery.cachedScrollPosition);d&&(Cargo.Event.trigger("image_gallery_render_complete",this),0==--f&&Cargo.Event.trigger("image_gallery_init_complete",c))},handleUpdates:function(a){var b=this;"responsive"==a.changing&&this.options.data.mobile_data.separate_mobile_view?this.checkMobileAndLoadSubview():b.routeUpdatesToActiveSubview(a)},checkForChanges:function(){var a=this.lastSerializedState,b=this.mobileSubviewActive?this.MobileSubview.serialize():this.Subview.serialize();if(a){var c=_.filter(a,function(a,c){return!b.hasOwnProperty(c)}),d=_.filter(b,function(b,c){return!a.hasOwnProperty(c)}),e={};_.each(b,function(b,c){if(void 0!=a[c]){var d=_.omit(b,function(b,d){return"data"==d||"itemSrc"==d||("object"==typeof a[c][d]&&"object"==typeof b?_.isEqual(a[c][d],b):a[c][d]==b)},this);_.keys(d).length>0&&(e[c]=d)}},this),(d.length>0||c.length>0||_.keys(e).length>0)&&(this.images=b,this.applyChanges({added:d,removed:c,updated:e}))}this.lastSerializedState=b},applyChanges:function(a){var b=[];for(var c in a.removed)b.push(a.removed[c].index);var d,e,f=CargoEditor.getActiveRange();if(f){var g=Cargo.Core.ImageGallery.getselectedGalleryId(f);g&&(d=e=g),_.each(a.removed,function(a){a.index<=e&&d--}),_.each(a.added,function(a){a.index<=e&&d++})}if(this.removeViews(),this.checkMobileAndLoadSubview(),this.routeUpdatesToActiveSubview({changing:"gallery_changed"}),void 0!==d&&!isNaN(d)&&!Cargo.Core.ImageGallery.draggingInEditor){var h=this.Subview.$el.find('[data-gallery-item-id="'+d+'"]')[0];h&&Cargo.Core.ImageGallery.normalizeSelection(void 0,h)}try{window.top.hasOwnProperty("Cargo")&&window.top.Cargo.hasOwnProperty("Editor")&&window.top.Cargo.Editor.View.ContentView.SaveButton.trigger("save_enable")}catch(a){console.warn("Cargo Editor not found, Image Gallery settings will not be saved")}},routeUpdatesToActiveSubview:function(a){var b=Cargo.Core.ImageGallery.getselectedGalleryId();if(this.mobileSubviewActive){var c=$.extend(!0,{},this.options);c.data=_.extend(c.data,c.data.mobile_data),this.MobileSubview.handleUpdates(c,a)}else this.Subview.handleUpdates(this.options,a);if(void 0!==b&&!isNaN(b)&&!Cargo.Core.ImageGallery.draggingInEditor){var d=this.Subview.$el.find('[data-gallery-item-id="'+b+'"]')[0];d&&Cargo.Core.ImageGallery.normalizeSelection(void 0,d)}},indicateInsertion:function(a,b,c){this.draggingOverGallery=!0,this.updateCacheRects(),this.mobileSubviewActive?"function"==typeof this.MobileSubview.indicateInsertion&&this.MobileSubview.indicateInsertion(a,b,c):"function"==typeof this.Subview.indicateInsertion&&this.Subview.indicateInsertion(a,b,c)},resetIndication:function(){this.draggingOverGallery&&(this.draggingOverGallery=!1,this.mobileSubviewActive?"function"==typeof this.MobileSubview.resetIndication&&this.MobileSubview.resetIndication():"function"==typeof this.Subview.resetIndication&&this.Subview.resetIndication())},removeViews:function(a){!this.isEditing&&!this.hasClick||a?Cargo.Core.ImageGallery.cachedScrollPosition=-1:Cargo.Core.ImageGallery.cachedScrollPosition=$(window).scrollTop(),this.mobileSubviewInited&&"function"==typeof this.MobileSubview.destroy&&this.MobileSubview.destroy(),this.subviewInited&&"function"==typeof this.Subview.destroy&&this.Subview.destroy(),this.inited=!1,this.subviewInited=!1,this.mobileSubviewInited=!1,this.mobileSubviewActive=!1},destroy:function(){this.unbindEvents(),this.setEditMode(!1),this.disableEditable();for(var a=_.sortBy(this.images,"index"),b=0;b<a.length;b++){var c=this.mobileSubviewActive?this.MobileSubview.createItem(a[b],!0):this.Subview.createItem(a[b],!0);this.el.parentNode.insertBefore(c,this.el)}this.removeViews(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.images=void 0,Cargo.Plugins.elementResizer.refresh(),delete Cargo.Core.ImageGallery.imageGalleryObjects[this.el.getAttribute("gid")]},cachedRects:{rects:{default:{top:-9e9,left:-9e9,bottom:-9e9,width:0,height:0,positions:{distance:9e9}}},needsUpdate:!0},updateCacheRects:function(){if(this.cachedRects.needsUpdate){var a=window.innerHeight,b=_.clone(this.cachedRects.rects.default);this.cachedRects.rects={default:b};for(var c=this.el.querySelectorAll("[data-gallery-item-id]"),d=0;d<c.length;d++){var e=c[d].getAttribute("data-gallery-item-id"),f=c[d].getBoundingClientRect();f.bottom>=0&&f.top<=a&&(this.cachedRects.rects[e]=f,this.cachedRects.rects[e].midPoint={x:f.left+.5*f.width,y:f.top+.5*f.height})}this.cachedRects.needsUpdate=!1}},requestTick:function(){var a=this;this.ticking||(window.requestAnimationFrame(function(){a.checkMobileAndLoadSubview(),a.ticking=!1}),this.ticking=!0),this.cachedRects.needsUpdate=!0},updateOptions:function(a,b){var c=this,d=this.options.path,e=a.path;this.options=a,b&&c.storeOptionsOnElement(),d!=e&&(this.removeViews(!0),this.checkMobileAndLoadSubview())},storeOptionsOnElement:function(){try{this.el.setAttribute("data-gallery",JSON.stringify(this.options))}catch(a){console.warn("unable to store image gallery settings",a)}},addItem:function(a){var b=this,c=parseInt(this.insertionPoint)||0;if($(a).is(".ce-in-progress"))return void parent.Cargo.Event.once("image_upload_complete",function(c){b.addItem(a)});a.setAttribute("data-gallery-item-index",c),$(a).find("[data-gallery-item-index]").attr("data-gallery-item-index",c),this.meta_data_cache&&(a.setAttribute("data-meta",this.meta_data_cache),$(a).find("[data-meta]").attr("data-meta",this.meta_data_cache),this.meta_data_cache=""),$(this.el).find("[data-gallery-item-index]").each(function(){var a=parseInt(this.getAttribute("data-gallery-item-index"));a>=c&&this.setAttribute("data-gallery-item-index",a+1)}),a.removeAttribute("data-exclude-item"),$(a).find("[data-exclude-item]").removeAttr("data-exclude-item"),this.el.insertBefore(a,null),this.checkForChanges()}},!this)return;if(this.hasAttribute("data-gallery"))g.options=Cargo.Core.ImageGallery.parseGalleryOptions(this.getAttribute("data-gallery"));else if(this.hasAttribute("gid-clone")){if(!b.imageGalleryObjects.hasOwnProperty(this.getAttribute("gid-clone")))return void this.parentNode.removeChild(this);g.options=b.imageGalleryObjects[this.getAttribute("gid-clone")].options,this.removeAttribute("gid-clone")}g.options.gallery_instance_id=d,g.storeOptionsOnElement()}g.el=this,this.setAttribute("contenteditable",!1),g.checkMobileAndLoadSubview(),b.imageGalleryObjects[d]=g}}),0==f&&Cargo.Event.trigger("image_gallery_init_complete",c)}},doDelete:function(){CargoEditor.execCommand("delete")},removeMID:function(a){var b=this,c=0,d=$(".image-gallery img[data-mid="+a+"]");if(d.length>0){var e=d.first();parseInt(e.closest("[data-gallery-item-id]").attr("data-gallery-item-id")),c=e.closest(".image-gallery").attr("gid"),d.length>1&&Cargo.Event.once("image_gallery_render_complete",function(c){b.removeMID(a)}),null!==e.get(0).parentNode&&e.get(0).parentNode.removeChild(e.get(0)),this.imageGalleryObjects[c].checkForChanges()}},normalizeSelection:function(a,b){var b,c=CargoEditor.getActiveRange();if(c){void 0===b&&(b=a?a.target:c.endContainer);var d=$(b).closest(".gallery_card").get(0);if(d){var e=d.querySelectorAll("img, iframe, video")[0];if(e){var f=CargoEditor.rangy.createRange();f.selectNode(e),CargoEditor.helpers.setActiveRange(f)}else c.setStartBefore(d.firstChild),c.setEndAfter(d.lastChild),CargoEditor.helpers.setActiveRange(c)}}},getselectedGalleryId:function(a){if(a||(a=CargoEditor.getActiveRange())){var b=void 0,c=a.getNodes([Node.ELEMENT_NODE],function(a){return a.hasAttribute("data-gallery-item-id")});return 0==c.length&&(c=$(a.commonAncestorContainer).closest("[data-gallery-item-id]")),c[0]&&(b=parseInt(c[0].getAttribute("data-gallery-item-id"))),b}},editorEvents:{"editor-keydown":function(a,b){Cargo.Core.ImageGallery.currentEditableGallery&&(8===b.keyCode&&this.doDelete(),!1===b.metaKey&&(b.preventDefault(),b.stopImmediatePropagation()))},"editor-mousedown":function(a,b){Cargo.Core.ImageGallery.currentEditableGallery&&Cargo.Core.ImageGallery.currentEditableGallery.el.contains(b.target)&&((b&&"IMG"!==b.target.nodeName||$(b.target).closest('[draggable="true"]').length>0)&&b.preventDefault(),this.normalizeSelection(b))},"cursor-activity":function(){Cargo.Core.ImageGallery.currentEditableGallery&&this.normalizeSelection()},"editor-paste":function(a,b){Cargo.Core.ImageGallery.currentEditableGallery&&(b.preventDefault(),b.stopImmediatePropagation())},"editor-cut":function(a,b){Cargo.Core.ImageGallery.currentEditableGallery&&(b.preventDefault(),b.stopImmediatePropagation())},"editor-copy":function(a,b){Cargo.Core.ImageGallery.currentEditableGallery&&(b.preventDefault(),b.stopImmediatePropagation())},"editor-before-summary-report":function(a){Cargo.Core.ImageGallery.currentEditableGallery&&0!==a.generateUnreportedMutationSummaries().length&&Cargo.Core.ImageGallery.currentEditableGallery.checkForChanges()},"history-add":function(a,b){b.modifiedGalleryIDs=[],b.removedNodes.forEach(function(a){a&&a.__galleryInstanceUID__&&b.modifiedGalleryIDs.indexOf(a.__galleryInstanceUID__)&&b.modifiedGalleryIDs.push(a.__galleryInstanceUID__)})},"history-before-undo":function(a,b){_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(a,c){-1!==b.modifiedGalleryIDs.indexOf(parseInt(c))&&(a.el.innerHTML="")})},"history-undo":function(a,b){var c={},d=!1;_.each(b.removedNodes,function(a){$(a).hasClass("image-gallery")&&(a.className="image-gallery",a.setAttribute("data-force-gid",a.getAttribute("gid")),d=!0)}),_.each(b.attributeChanges,function(a){if("data-gallery"==a.attribute&&$(a.element).hasClass("image-gallery")){var b=a.element.getAttribute("gid"),d=Cargo.Core.ImageGallery.imageGalleryObjects[b];if(d){var e=JSON.parse(a.oldValue);d.updateOptions(e,!0),c[e.gallery_instance_id]=d}}}),_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(a,d){-1!==b.modifiedGalleryIDs.indexOf(parseInt(d))&&(c[d]=a)});for(var e in c)c[e].mobileSubviewActive?c[e].images=c[e].MobileSubview.serialize():c[e].images=c[e].Subview.serialize(),c[e].removeViews(!0),c[e].checkMobileAndLoadSubview();d&&_.defer(function(){Cargo.Core.ImageGallery.InitImageGallery({forceReCollectionOfItems:!0,targetElement:a.getElement()})})},"history-before-redo":function(a,b){_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(a,c){-1!==b.modifiedGalleryIDs.indexOf(parseInt(c))&&(a.el.innerHTML="")})},"history-redo":function(a,b){var c={},d=!1;_.each(b.addedNodes,function(a){$(a).hasClass("image-gallery")&&(a.className="image-gallery",a.setAttribute("data-force-gid",a.getAttribute("gid")),d=!0)}),_.each(b.attributeChanges,function(a){if("data-gallery"==a.attribute&&$(a.element).hasClass("image-gallery")){var b=a.element.getAttribute("gid"),d=Cargo.Core.ImageGallery.imageGalleryObjects[b];if(d){var e=JSON.parse(a.newValue);d.updateOptions(e,!0),c[e.gallery_instance_id]=d}}}),_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(a,d){-1!==b.modifiedGalleryIDs.indexOf(parseInt(d))&&(c[d]=a)});for(var e in c)c[e].mobileSubviewActive?c[e].images=c[e].MobileSubview.serialize():c[e].images=c[e].Subview.serialize(),c[e].removeViews(!0),c[e].checkMobileAndLoadSubview();d&&_.defer(function(){Cargo.Core.ImageGallery.InitImageGallery({forceReCollectionOfItems:!0,targetElement:a.getElement()})})}}},Cargo.Core.Embeds={initialize:function(){this.embeds=[],this.instagramInitialized=!1},initializeInstagram:function(a){requirejs(["https://platform.instagram.com/en_US/embeds.js"],a)},initializeTwitter:function(a){requirejs(["//platform.twitter.com/widgets.js"],a)},initializeBandsInTown:function(a){requirejs(["https://widget.bandsintown.com/main.min.js"],function(){BIT.widgetInitializer?a():BIT.onReady=a})},findEmbedsIn:function(a){_.each(a.querySelectorAll("cargo-embed, persona-embed"),this.add,this)},add:function(a){if(a&&a.nodeType===Node.ELEMENT_NODE){var b=a.getAttribute("data-type");if(b&&a&&a.nodeType===Node.ELEMENT_NODE&&-1===this.embeds.indexOf(a))switch(b){case"tweet":this.handleTwitterEmbed(a);break;case"twitter-timeline":this.handleTwitterTimelineEmbed(a);break;case"bandsintown":this.handleBandsIntownEmbed(a);case"instagram":this.handleInstagramEmbed(a)}}},handleBandsIntownEmbed:function(a){this.initializeBandsInTown(_.bind(function(){var b={};_.each(a.attributes,function(a){if(/^data-/.test(a.name)&&"data-type"!==a.name){var c=a.name.substr(5).replace(/-/g,"_");b[c]=a.value}});var c=document.createElement("div");c.setAttribute("id","bit-widget-"+_.uniqueId()),c.setAttribute("contenteditable","false"),_.each(b,function(a,b){c.setAttribute("data-"+b.replace(/_/g,"-"),a)}),a.appendChild(c),BIT.widgetInitializer.buildWidget(c).render()},this))},handleTwitterEmbed:function(a){var b=a.getAttribute("data-id");b&&""!==b&&this.initializeTwitter(_.bind(function(){twttr.widgets.createTweet(b,a).then(function(a){a.setAttribute("contenteditable","false")}),this.embeds.push(a)},this))},handleTwitterTimelineEmbed:function(a){try{var b=JSON.parse(a.getAttribute("data-source"))}catch(a){return}"number"==typeof b&&(b=a.getAttribute("data-source"));var c;if(a.hasAttribute("data-options"))try{c=JSON.parse(a.getAttribute("data-options"))}catch(a){}this.initializeTwitter(_.bind(function(){twttr.widgets.createTimeline(b,a,c).then(function(a){a&&a.setAttribute("contenteditable","false")}),this.embeds.push(a)},this))},handleInstagramEmbed:function(a){var b=a.getAttribute("data-url");b&&$.get("https://api.instagram.com/oembed?url="+b,_.bind(function(b){"object"==typeof b&&this.initializeInstagram(_.bind(function(){a.innerHTML=b.html,instgrm.Embeds.process()},this))},this))},remove:function(){}},Cargo.Core.Ecommerce={activeWidgets:[],settingsStorage:{},settingsStorageIndex:0,findWidgets:function(a){if(Cargo.Collection.StripeProducts.productSyncOccurred){var b=Array.prototype.slice.call(document.body.querySelectorAll("shop")),c=[],d=0;a&&a.querySelectorAll&&_.each(a.querySelectorAll("shop"),function(a){-1===b.indexOf(a)&&b.push(a)}),_.each(b,function(a){if(a&&a.nodeType===Node.ELEMENT_NODE){var b=a.getAttribute("product");if(b){var e=Cargo.Collection.StripeProducts.findWhere({id:b.trim()});if(!a.__ecommerce_view__||a.__ecommerce_view__.model!==e){var f=new Cargo.o.view.ProductWidget({model:e});if(a.hasAttribute("sid")){var g=a.getAttribute("sid");this.settingsStorage[g]&&f.updateOptions(this.settingsStorage[g]),a.removeAttribute("sid")}f.setElement(a),f.render(),a.__ecommerce_view__=f,c.push({el:a,view:f,id:d++})}}}},this),this.activeWidgets=c}},storeSettingsAndSaveReferences:function(){_.each(this.activeWidgets,function(a){var b=this.settingsStorageIndex++;this.settingsStorage[b]=a.view.getOptions(),a.view.el.setAttribute("sid",b)},this)},initialize:function(){Cargo.Collection.StripeProducts.on("sync error",function(){this.findWidgets()},this),Cargo.Event.on("cargoEditor:before-html-to-projectcontent",function(){this.storeSettingsAndSaveReferences()},this),this.findWidgets()},countryMap:{AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",CR:"Costa Rica",CI:"Côte d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory, Occupied",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Réunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthélemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"}},function(){var a=function(a){if(!a)return void console.error("no element passed.");a.setAttribute("contenteditable","false"),a.innerHTML='<div class="button"><svg class="play icon" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><polygon points="4,2 4,14 15.3,8 "/></svg><svg class="pause icon" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><polygon points="3,2 3,14 4,14 7,14 7,2 4,2"/><polygon points="12,2 9,2 9,14 12,14 13,14 13,2"/></svg>\t</div>\t<div class="separator"> </div></div><div class="bar">\t<div class="buffer"> </div>\t<div class="progress"><div class="progress-indicator"></div></div><svg class="note-icon" x="0px" y="0px" viewBox="0 0 42 49.9" style="enable-background:new 0 0 42 49.9;" xml:space="preserve">\t<g>\t\t<g>\t\t\t<path d="M41.5,34.9c0,5.5-3.1,8.2-9.2,8.2c-2.2,0-3.9-0.4-5.2-1.6c-1.3-1-1.9-2.4-1.9-4s0.7-3.1,2.4-4.3c1.6-1.2,3.6-1.8,5.8-1.8 c1.8,0,3.4,0.4,5.2,1.2V9.2L16.8,16v25.1c0,5.5-3.1,8.3-9.3,8.3c-2.2,0-3.9-0.4-5.2-1.5c-1.2-1-1.9-2.4-1.9-4s0.7-3.1,2.2-4.3 s3.4-1.8,5.6-1.8c1.8,0,3.7,0.4,5.6,1V9.2l27.7-8.7L41.5,34.9L41.5,34.9z"/>\t\t</g>\t</g></svg>\t<div class="current-time">0:00</div>\t<div data-title class="title">Play</div>\t<div class="total-time">0:00</div></div><audio preload="metadata"></audio>',this.elements={container:a,play_pause:a.querySelector(".button"),play:a.querySelector(".play"),pause:a.querySelector(".pause"),current_time:a.querySelector(".current-time"),note:a.querySelector(".note-icon"),track_buffer:a.querySelector(".buffer"),progress:a.querySelector(".progress"),progress_ind:a.querySelector(".progress-indicator"),bar:a.querySelector(".bar"),track_length:a.querySelector(".total-time"),play_text:a.querySelector(".title")},this.audio_track=a.querySelector("audio"),this.onMouseInteraction=this.onMouseInteraction.bind(this),this.updatePlayerTime=this.updatePlayerTime.bind(this),this.onError=this.onError.bind(this),this.clearError=this.clearError.bind(this),this.togglePlay=this.togglePlay.bind(this),this.onProgress=this.onProgress.bind(this),this.onTrackEnd=this.onTrackEnd.bind(this),this.onSeekStart=this.onSeekStart.bind(this),this.onSeekEnd=this.onSeekEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.destroy=this.destroy.bind(this),this.removeEl=this.removeEl.bind(this),this.bindEvents(),this.mouseFlow,this.paused,this.started,this.dragging,this.hasError=!1,this.mouseInteractionDisabled=!1,this.isAdminEdit=Cargo.Helper.IsAdminEdit(),this.elements.container.__cargo_audio_player_=this,this.setSrc(a.getAttribute("data-src")),this.setTitle(a.getAttribute("data-title"))};a.prototype.setSrc=function(a){this.audio_track.getAttribute("src")!==a&&(this.setInitialState(),this.audio_track.src=a,this.elements.container.setAttribute("data-src",a))},a.prototype.setTitle=function(a){this.setInitialState(),a&&""!==a||(a="Play"),this.elements.play_text.innerText=a,this.elements.container.setAttribute("data-title",a)},a.prototype.bindEvents=function(){this.audio_track.addEventListener("progress",this.onProgress),this.audio_track.addEventListener("loadedmetadata",this.onProgress),this.audio_track.addEventListener("timeupdate",this.updatePlayerTime),this.audio_track.addEventListener("seeking",this.onSeekStart),this.audio_track.addEventListener("seeked",this.onSeekEnd),this.audio_track.addEventListener("ended",this.onTrackEnd),this.audio_track.addEventListener("error",this.onError),this.audio_track.addEventListener("canplay",this.clearError),this.elements.play_pause.addEventListener("click",this.togglePlay),this.elements.bar.addEventListener("mousedown",this.onMouseDown),this.elements.bar.addEventListener("touchstart",this.onMouseDown),this.elements.bar.addEventListener("touchend",this.onMouseUp),Cargo.Event.on("css_inspector_activated",this.disableMouseInteraction,this),Cargo.Event.on("css_inspector_deactivated",this.enableMouseInteraction,this),window.addEventListener("mouseup",this.onMouseUp)},a.prototype.destroy=function(){this.audio_track.removeEventListener("progress",this.onProgress),this.audio_track.removeEventListener("loadedmetadata",this.onProgress),this.audio_track.removeEventListener("timeupdate",this.updatePlayerTime),this.audio_track.removeEventListener("seeking",this.onSeekStart),this.audio_track.removeEventListener("seeked",this.onSeekEnd),this.audio_track.removeEventListener("ended",this.onTrackEnd),this.audio_track.removeEventListener("error",this.onError),this.audio_track.removeEventListener("canplay",this.clearError),this.elements.play_pause.removeEventListener("click",this.togglePlay),this.elements.bar.removeEventListener("mousedown",this.onMouseDown),this.elements.bar.removeEventListener("touchstart",this.onMouseDown),this.elements.bar.removeEventListener("touchend",this.onMouseUp),Cargo.Event.off("css_inspector_activated",this.disableMouseInteraction),Cargo.Event.off("css_inspector_deactivated",this.enableMouseInteraction),window.removeEventListener("mouseup",this.onMouseUp),this.audio_track.pause(),this.audio_track.src="",delete this.elements.container.__cargo_audio_player_},a.prototype.disableMouseInteraction=function(){this.mouseInteractionDisabled=!0},a.prototype.enableMouseInteraction=function(){this.mouseInteractionDisabled=!1},a.prototype.removeEl=function(){this.elements.container&&this.elements.container&&this.elements.container.parentNode.removeChild(this.elements.container)},a.prototype.setPlayState=function(){this.elements.play.style.display="none",this.elements.pause.style.display="",this.elements.play_text.style.display="none",this.elements.current_time.style.display="",this.elements.note.style.display="none",this.elements.progress.style.display="",this.elements.track_length.style.display="",this.elements.track_buffer.style.display="",this.paused=!1,this.started=!0,this.dragging=!0},a.prototype.setInitialState=function(){this.elements.play.style.display="",this.elements.play_text.style.display="",this.elements.pause.style.display="none",this.elements.note.style.display="",this.elements.progress.style.display="none",this.elements.current_time.style.display="none",this.elements.track_length.style.display="none",this.elements.track_buffer.style.display="none",this.elements.progress.style.width="0%",this.elements.track_buffer.style.left="0",this.elements.track_buffer.style.width="0",this.paused=!0,this.dragging=!1,this.started=!1,this.currentPlayerTimestamp=0},a.prototype.setPauseState=function(){this.paused=!0,this.elements.play.style.display="",this.elements.pause.style.display="none"},a.prototype.togglePlay=function(){if(!this.mouseInteractionDisabled)if(this.audio_track.paused){var a=this.audio_track.play();a?(this.elements.container.classList.add("seeking"),a.then(function(){this.setPlayState()}.bind(this)).catch(this.onError).finally(function(){requestAnimationFrame(function(){this.elements.container.classList.remove("seeking")}.bind(this))}.bind(this))):this.setPlayState()}else this.audio_track.pause(),this.setPauseState()},a.prototype.onError=function(a){if(this.isAdminEdit&&""===this.audio_track.getAttribute("src"))return!0;this.hasError=!0,this.setInitialState(),this.elements.play_text.innerText="Unable to load file",a instanceof DOMException&&console.error(a)},a.prototype.clearError=function(a){this.hasError&&(this.setTitle(this.elements.container.getAttribute("data-title")),this.hasError=!1)},a.prototype.onTrackEnd=function(){!0!==this.dragging&&(this.started=!1,this.setPauseState())},a.prototype.onProgress=function(a){a&&"loadedmetadata"===a.type&&(this.elements.track_length.innerText=this.timestampToHumanReadable(this.audio_track.duration)),this.updateBufferSize()},a.prototype.updatePlayerTime=function(){if(this.started&&this.audio_track.readyState!==this.audio_track.HAVE_NOTHING){this.currentPlayerTimestamp=this.audio_track.currentTime,this.elements.current_time.textContent=this.timestampToHumanReadable(this.currentPlayerTimestamp);var a=this.currentPlayerTimestamp/this.audio_track.duration*100,b=this.elements.bar.clientWidth,c=parseInt(window.getComputedStyle(this.elements.progress_ind).width);b*(a/100)<c?(a=c/b*(100-a),this.elements.progress.style.transition="none",this.elements.track_buffer.style.transition="none"):(this.elements.progress.style.transition="",this.elements.track_buffer.style.transition=""),this.elements.progress.style.width=a+"%",this.elements.track_buffer.style.left=a+"%",this.updateBufferSize()}},a.prototype.updateBufferSize=function(){for(var a,b=0,c=0;c<this.audio_track.buffered.length;c++)if(this.currentPlayerTimestamp>=this.audio_track.buffered.start(c)&&this.currentPlayerTimestamp<=this.audio_track.buffered.end(c)){a=Math.max(this.audio_track.buffered.end(c)-this.currentPlayerTimestamp,0),b=a/this.audio_track.duration*100;break}b+=1,this.elements.track_buffer.style.width=b+"%"},a.prototype.timestampToHumanReadable=function(a){if(isNaN(a))return"0:00";var b=Math.floor(a%60),c=Math.floor(a/60),d=Math.floor(c/60);return b<10&&(b="0"+b),d>0?(c-=60*d,c<10&&(c="0"+c),d+":"+c+":"+b):c+":"+b},a.prototype.onMouseInteraction=function(a){if(!this.mouseInteractionDisabled&&this.started&&this.audio_track.readyState!==this.audio_track.HAVE_NOTHING&&this.dragging){var b=this.elements.bar.getBoundingClientRect(),c=a.clientX||a.touches[0].clientX;c<b.left?this.audio_track.currentTime=0:c>b.right?this.audio_track.currentTime=this.audio_track.duration:this.audio_track.currentTime=this.audio_track.duration*((c-b.left)/this.elements.bar.clientWidth)}},a.prototype.onMouseDown=function(a){a.preventDefault(),this.mouseInteractionDisabled||2===a.button||(!1===this.paused&&this.audio_track.pause(),document.body.classList.add("audio-player-dragging"),this.elements.bar.addEventListener("mousemove",this.onMouseInteraction),window.addEventListener("mousemove",this.onMouseInteraction),this.elements.bar.addEventListener("touchmove",this.onMouseInteraction),this.elements.container.classList.add("seeking"),this.dragging=!0,this.onMouseInteraction(a))},a.prototype.onMouseUp=function(a){1==this.dragging&&(document.body.classList.remove("audio-player-dragging"),this.elements.bar.removeEventListener("mousemove",this.onMouseInteraction),this.elements.bar.removeEventListener("touchmove",this.onMouseInteraction),window.removeEventListener("mousemove",this.onMouseInteraction),this.dragging=!1,!1===this.paused&&!0===this.started&&(this.audio_track.currentTime>=this.audio_track.duration-.001?this.setPauseState():this.audio_track.play())),this.onSeekEnd()},a.prototype.onSeekStart=function(){this.elements.container.classList.add("seeking"),requestAnimationFrame(function(){this.updatePlayerTime()}.bind(this))},a.prototype.onSeekEnd=function(){this.updatePlayerTime(),this.dragging||requestAnimationFrame(function(){this.elements.container.classList.remove("seeking")}.bind(this))},Cargo.Core.AudioPlayer={instances:[],findPlayers:function(b){if(b){var c,d=[];return c=$(b).is("div.audio-player")?[b]:b.querySelectorAll("div.audio-player"),_.each(c,function(c){if(void 0===_.findWhere(this.instances,{el:c})){var e=new a(c);this.instances.push({parent:b,el:c,player:e}),d.push(e)}},this),d}},destroyPlayers:function(a){a&&_.each(this.instances,function(b){b.parent===a&&b.player.destroy()})}}}(),Cargo.Core=window.Cargo.Core||{},Cargo.Core.Handlebars={Render:function(a,b){var c=Handlebars.compile(a);return Handlebars.registerPartial("loading_animation",$("#loading_animation").html()),Handlebars.registerPartial("images",$('[type="text/x-handlebars-template"]#images').html()),Handlebars.registerPartial("page_master",this.ParseScriptTags($("#page_master").html())),Handlebars.registerPartial("page",this.ParseScriptTags($("#page").html())),Handlebars.registerPartial("pin",this.ParseScriptTags($("#pin").html())),Handlebars.registerPartial("content",this.ParseScriptTags($("#content").html())),
Handlebars.registerPartial("sitemenu_item",this.ParseScriptTags($("#sitemenu_item").html())),this.RegisterHelper_Print(),this.RegisterHelper_IfAny(),this.RegisterHelper_IfAll(),this.RegisterHelper_IfEqual(),this.RegisterHelper_UnlessAny(),this.RegisterHelper_UnlessAll(),this.RegisterHelper_IfOption(),this.RegisterHelper_UnlessOption(),this.RegisterHelper_DisplayOptions(),this.RegisterHelper_Truncate(),this.RegisterHelper_Image(),this.RegisterHelper_Var(),this.RegisterHelper_Stringify(),this.RegisterHelper_IsAdmin(),this.RegisterHelper_FillDefaultThumbnailCrop(),c(b)},ParseScriptTags:function(a){if(a)return a.replace(/\[script/g,"<script").replace(/\[\/script/g,"</script")},RegisterHelper_Print:function(){Handlebars.registerHelper("print",function(a,b){var c=wrapper_tail="";"project.content"!=a&&"content"!=a||(c="<projectcontent>",wrapper_tail="</projectcontent>"),a=a.replace("project.","");var d="object"==typeof this.project?this.project:this;return new Handlebars.SafeString(c+d[a]+wrapper_tail)})},RegisterHelper_IfAny:function(){Handlebars.registerHelper("if_any",function(){for(var a=!1,b=arguments[arguments.length-1],c=arguments.length-2;c>=0;c--)if(arguments[c]){a=!0;break}return a?b.fn(this):b.inverse(this)})},RegisterHelper_IfAll:function(){Handlebars.registerHelper("if_all",function(){for(var a=!0,b=arguments[arguments.length-1],c=arguments.length-2;c>=0;c--)if(!arguments[c]){a=!1;break}return a?b.fn(this):b.inverse(this)})},RegisterHelper_IfEqual:function(){Handlebars.registerHelper("if_equal",function(a,b,c){return 3!=arguments.length?"":a==b?c.fn(this):c.inverse(this)})},RegisterHelper_UnlessAny:function(){Handlebars.registerHelper("unless_any",function(){for(var a=!1,b=arguments[arguments.length-1],c=arguments.length-2;c>=0;c--)if(!arguments[c]){a=!0;break}return a?b.fn(this):b.inverse(this)})},RegisterHelper_UnlessAll:function(){Handlebars.registerHelper("unless_all",function(){for(var a=!0,b=arguments[arguments.length-1],c=arguments.length-2;c>=0;c--)if(arguments[c]){a=!1;break}return a?b.fn(this):b.inverse(this)})},RegisterHelper_DisplayOptions:function(){Handlebars.registerHelper("displayoptions",function(a,b){var c=a.replace("display_options.","").split("."),d=c.length,e=!1;return e=1==d?Cargo.Model.DisplayOptions.get(c[0]):2==d?Cargo.Model.DisplayOptions.get(c[0])[c[1]]:3==d?Cargo.Model.DisplayOptions.get(c[0])[c[1]][c[2]]:Cargo.Model.DisplayOptions.get(c[0]),e?b.fn(this):b.inverse(this)})},RegisterHelper_IfOption:function(){Handlebars.registerHelper("if_option",function(a,b){var c=a.replace("display_options.","").split("."),d=c.length,e=!1;return e=1==d?Cargo.Model.DisplayOptions.get(c[0]):2==d?Cargo.Model.DisplayOptions.get(c[0])[c[1]]:3==d?Cargo.Model.DisplayOptions.get(c[0])[c[1]][c[2]]:Cargo.Model.DisplayOptions.get(c[0]),e?b.fn(this):b.inverse(this)})},RegisterHelper_UnlessOption:function(){Handlebars.registerHelper("unless_option",function(a,b){var c=a.replace("display_options.","").split("."),d=c.length,e=!1;return e=1==d?Cargo.Model.DisplayOptions.get(c[0]):2==d?Cargo.Model.DisplayOptions.get(c[0])[c[1]]:3==d?Cargo.Model.DisplayOptions.get(c[0])[c[1]][c[2]]:Cargo.Model.DisplayOptions.get(c[0]),e?b.inverse(this):b.fn(this)})},RegisterHelper_Truncate:function(){Handlebars.registerHelper("truncate",function(a,b){if(a.length>b&&a.length>0){var c=a+" ";return c=a.substr(0,b),c=a.substr(0,c.lastIndexOf(" ")),c=c.length>0?c:a.substr(0,b),new Handlebars.SafeString(c+"...")}return a})},RegisterHelper_Image:function(){Handlebars.registerHelper("image",function(a,b){return new Cargo.o.model.image(a).getImageByWidth(b)})},RegisterHelper_Var:function(){Handlebars.registerHelper("var",function(a,b){this[a]=b})},RegisterHelper_Stringify:function(){Handlebars.registerHelper("stringify",function(a){return JSON.stringify(a)})},RegisterHelper_IsAdmin:function(){Handlebars.registerHelper("is_admin",function(a){var b=arguments[arguments.length-1];return Cargo.Helper.IsAdminEdit()?b.fn(this):b.inverse(this)})},RegisterHelper_FillDefaultThumbnailCrop:function(){Handlebars.registerHelper("fill_default_thumbnail_crop",function(a,b){var c,d,e,f=b.split(/x/),g=f[0]/f[1],h=a.imageModel.width/a.imageModel.height;return h<=g?(c=100,d=0,e=(1/h-1/g)/2*-100):(c=h/g*100,d=50*(1-h/g),e=0),"width: "+c+"%; margin-left: "+d+"%; margin-top: "+e+"%; height: auto;"})}},Cargo=Cargo||{},Cargo.utils=Cargo.utils||{},Cargo.utils.CargoXHR=function(a){var b=this;if($.extend(this.options={},this.defaultOptions,a),void 0===this.options.context&&(this.options.context=this),void 0===this.options.url)throw'no URL given, define "url" in the contructor\'s options object';this.retries=0,this.xhr=new XMLHttpRequest,this.xhr.addEventListener("abort",function(){b.options.abort.apply(b.options.context,arguments)},!1),this.xhr.addEventListener("error",function(){b.options.error.apply(b.options.context,arguments)},!1),this.xhr.addEventListener("load",function(){b.options.success.apply(b.options.context,arguments)},!1),this.xhr.addEventListener("loadend",function(){b.options.always.apply(b.options.context,arguments)},!1),this.xhr.upload.addEventListener("progress",function(a){b.options.progress.apply(b.options.context,arguments)},!1),this.send()},Cargo.utils.CargoXHR.prototype.send=function(){this.xhr.open(this.options.type,this.options.url,this.options.async);for(var a in this.options.headers)this.xhr.setRequestHeader(a,this.options.headers[a]);this.xhr.responseType=this.options.dataType,this.options.beforeSend.call(this,this.xhr),this.xhr.send(this.options.data)},Cargo.utils.CargoXHR.prototype.retry=function(){if(!(this.retries++<this.options.maxRetries))return this.abort(),!1;Cargo.utils.CargoXHR.prototype.send.apply(this,arguments)},Cargo.utils.CargoXHR.prototype.abort=function(){"object"==typeof this.xhr&&this.xhr.abort()},Cargo.utils.CargoXHR.prototype.defaultOptions={async:!0,beforeSend:function(a){},always:function(a){},success:function(a){},progress:function(a){},error:function(a){},abort:function(a){},type:"GET",url:void 0,dataType:"text",headers:{},data:null,context:void 0,maxRetries:5},function(){var a=null;Cargo.Core.MarkerInstance=function(a){this.resizedSVGOffsetX=0,this.resizedSVGOffsetY=0,this.pageView=a,this.addSVGElementHoverOutline=_.bind(this.addSVGElementHoverOutline,this),this.removeSVGElementHoverOutline=_.bind(this.removeSVGElementHoverOutline,this),a.listenTo(a,"initial-setup",_.bind(this.setupPage,this)),a.listenTo(Cargo.Event,"elementresizer_update_complete",_.bind(this.positionTetheredNodes,this)),this.loadSVGWebfonts()},Cargo.Core.MarkerInstance.prototype.hoverStatesEnabled=!1,Cargo.Core.MarkerInstance.prototype.setupPage=function(){this.findTetherTargets(),this.positionTetheredNodes(),this.pageView.listenTo(Cargo.Event,"image_gallery_rendered",_.bind(function(){this.findTetherTargets(),this.positionTetheredNodes()},this)),this.pageView.listenTo(Cargo.Event,"image_gallery_init_complete",_.bind(function(){this.positionTetheredNodes()},this))},Cargo.Core.MarkerInstance.prototype.enableSVGHoverStates=function(){if(null===a){var b=document.createElement("div");a=document.createElement("div"),b.className="marker-outline-layer",a.className="marker-outline-box",b.appendChild(a),document.body.appendChild(b)}this.svg_overlay&&(this.svg_overlay.addEventListener("mouseover",this.addSVGElementHoverOutline),this.svg_overlay.addEventListener("mouseout",this.removeSVGElementHoverOutline)),this.hoverStatesEnabled=!0},Cargo.Core.MarkerInstance.prototype.disableSVGHoverStates=function(b){this.svg_overlay&&(this.svg_overlay.removeEventListener("mouseover",this.addSVGElementHoverOutline),this.svg_overlay.removeEventListener("mouseout",this.removeSVGElementHoverOutline)),b||(null!==a&&this.removeSVGElementHoverOutline(),this.hoverStatesEnabled=!1)},Cargo.Core.MarkerInstance.prototype.addSVGElementHoverOutline=function(b){var c=b.target;"a"===c.parentNode.nodeName&&(c=c.parentNode);var d=c.getAttribute("stroke-width"),e=1;"none"===c.getAttribute("stroke")||isNaN(d)||(e+=d/2);var f=c.getBoundingClientRect();a.style.left=f.left-e+"px",a.style.top=f.top-e+document.scrollingElement.scrollTop+"px",a.style.width=f.width+2*e+"px",a.style.height=f.height+2*e+"px",a.style.display="block"},Cargo.Core.MarkerInstance.prototype.resizeSVGToFitContent=function(a){if(this.svg_overlay&&this.svg_content_layer){var b=this.svg_content_layer.getBBox(),c=this.pageView.isAdminEdit?200:0,d=offsetY=0;d=-1*(b.x-c),offsetY=-1*(b.y-c),this.svg_overlay.style.transform="translate("+-1*d+"px, "+-1*offsetY+"px)",this.svg_overlay.style.webkitTransform="translate("+-1*d+"px, "+-1*offsetY+"px)",this.svg_content_layer.setAttribute("transform","translate("+d+", "+offsetY+")"),this.svg_selector_layer&&this.svg_selector_layer.setAttribute("transform","translate("+d+", "+offsetY+")"),this.resizedSVGOffsetX=d,this.resizedSVGOffsetY=offsetY,this.svg_overlay.style.width=b.width+2*c,this.svg_overlay.style.height=b.height+2*c}},Cargo.Core.MarkerInstance.prototype.removeSVGElementHoverOutline=function(){a.style.display="none"},Cargo.Core.MarkerInstance.prototype.loadSVGWebfonts=function(){var a=_.clone(this.pageView.model.getPageOption("svg_fonts"));a&&(a.fontactive=_.bind(function(){this.positionTetheredNodes()},this),WebFont.load(a))},Cargo.Core.MarkerInstance.prototype.findTetherTargets=function(a){if(!a&&this.pageView.el.querySelector("#svgroot")&&(a=this.pageView.el.querySelector("#svgroot")),a||(a=this.pageView.el.querySelector(".marker-overlay")))return this.svg_overlay!==a&&(this.disableSVGHoverStates(!0),this.svg_overlay=a,this.svg_position_layer=this.svg_overlay,this.svg_overlay.querySelector(".marker-overlay")&&(this.svg_position_layer=this.svg_overlay.querySelector(".marker-overlay")),this.svg_content_layer=this.svg_overlay.querySelector("g.layer"),this.svg_selector_layer=this.svg_overlay.parentNode.querySelector("#selectorParentGroup"),this.resizeSVGToFitContent(),this.pageView.isAdminEdit?this.svg_overlay.addEventListener("click",function(a){Cargo.Event.trigger("marker-overlay-click",a)}):this.svg_overlay.addEventListener("click",function(a){a.preventDefault();var b=a.target;if("a"===b.parentNode.nodeName&&(b=b.parentNode),"a"===b.nodeName&&b.hasAttribute("href")&&!b.hasAttribute("rel"))if(b.hasAttribute("target")){window.open(b.getAttribute("href"),b.getAttribute("target"))}else document.location.href=b.getAttribute("href")}),this.hoverStatesEnabled&&this.enableSVGHoverStates()),this.tetherPairs={},this.tetherPairs[-1]={el:document.body,svgs:[]},this.tetherPairs[0]={el:this.pageView.el.querySelector(".page_content"),svgs:[]},_.each(this.pageView.el.querySelectorAll(".page_content [data-marker-id]"),function(a){var b=parseInt(a.getAttribute("data-marker-id"));if(!isNaN(b)&&a instanceof HTMLElement&&void 0==this.tetherPairs[b]){this.tetherPairs[b]={el:a,svgs:[]};var c=$(a).closest(".image-gallery")[0];c&&("slideshow"!==c.getAttribute("image-gallery")&&(this.tetherPairs[b].el=this.tetherPairs[b].el.parentNode),c.classList.contains("initialized")||(this.tetherPairs[b].galleryInitInProgress=!0))}},this),_.each(a.querySelectorAll("*"),function(a){if(!0===a.hasAttribute("data-marker-id")){var b=parseInt(a.getAttribute("data-marker-id"));!isNaN(b)&&a instanceof SVGElement&&this.tetherPairs.hasOwnProperty(b)&&(a.style.willChange="transform",this.tetherPairs[b].galleryInitInProgress?a.style.visibility="hidden":a.style.visibility="",this.tetherPairs[b].svgs.push({el:a,positionData:JSON.parse(a.getAttribute("data-position"))}))}},this),this.tetherPairs},Cargo.Core.MarkerInstance.prototype.positionTetheredNodes=function(){if(this.svg_overlay){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=getComputedStyle(this.svg_overlay),s=this.svg_overlay.getBoundingClientRect(),t=s.left+this.resizedSVGOffsetX+parseFloat(r.paddingLeft),u=s.top+this.resizedSVGOffsetY+parseFloat(r.paddingTop);_.each(this.tetherPairs,function(r,s){if(r.svgs.length>0&&r.el){var v,w=r.el.getBoundingClientRect();for(v=0;v<r.svgs.length;v++)if(a=r.svgs[v],b=a.el.getBBox(),c=0,d=b.x,e=b.y,f=d+t+this.resizedSVGOffsetX,g=e+u+this.resizedSVGOffsetY,h=a.positionData.left*w.width,i=a.positionData.top*w.height,j=a.positionData.width*w.width,k=a.positionData.height*w.height,l=j/b.width,m=k/b.height,l<0&&(h-=j),m<0&&(i-=k),n=w.left+h,o=w.top+i,p=n-f,q=o-g,!isNaN(l)&&isFinite(l)&&0!==l||(l=1),!isNaN(m)&&isFinite(m)&&0!==m||(m=1),0!=s&&-1!=s||"text"!==a.el.nodeName&&(m=l),a.el.hasAttribute("data-rotation")&&(c=parseFloat(a.el.getAttribute("data-rotation")),isNaN(c)&&(c=0)),!isNaN(p)&&!isNaN(q)){a.el.setAttribute("transform","translate("+(d+p)+", "+(e+q)+") scale("+l+", "+m+") translate("+-1*d+", "+-1*e+")"),a.el.__marker_scale__=l;var x=a.el.getCTM(),y="";if(x&&(0!==c&&(y="rotate("+c+" "+(d+p+b.width*l/2+this.resizedSVGOffsetX)+" "+(e+q+b.height*m/2+this.resizedSVGOffsetY)+") "),y+="matrix("+x.a+", "+x.b+", "+x.c+", "+x.d+", "+x.e+", "+x.f+")",a.el.setAttribute("transform",y)),"object"==typeof svgedit){var z=svgedit.transformlist.getTransformList(a.el);z&&z.reload&&z.reload()}}}},this),this.resizeSVGToFitContent(),this.pageView.trigger("marker-tether-position-update",this)}},Cargo.Event.on("pageview-initialized",function(a){a.markerInstance=new Cargo.Core.MarkerInstance(a)})}(),window.partial=function(a,b){return _.template(a)(b)},String.prototype.toCamel=function(a){var b=this.replace(/((\_|\-)[a-z])/g,function(a){return a.toUpperCase().replace(/(\_|\-)/g,"")});return a?b.substr(0,1).toUpperCase()+b.substr(1):b};var lastT=0,timer=null;$.fn.toggleInputError=function(a){return this.parent().toggleClass("error",a),this},window.loading_animation=function(a){return _.template($("#loading_animation").html())({extra_class:a}).replace("{{ extra_class }}","")},Cargo.o.model.css=Backbone.Model.extend({initialize:function(){},url:function(){var a=Cargo.API.Config;return a.api_path+"/"+a.Version+"/css/"+a.cargo_url}}),Cargo.o.model.set=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},name:"Set",url:function(){return Cargo.API.GetSingleContentPath(this.id)},initialize:function(){function a(b){b&&b.attributes.pages&&!b.attributes.pages instanceof Backbone.Collection&&(b.attributes.pages=new Cargo.o.collection.content(b.attributes.pages),b.attributes.pages.server_page_count=b.get("page_count"),b.attributes.pages.each(a))}this.type="set",this.attributes.pages&&(this.attributes.pages=new Cargo.o.collection.content(this.attributes.pages),this.attributes.pages.server_page_count=this.get("page_count"),this.attributes.pages.each(a))},getModelAtIndex:function(a){return _.filter(this.get("pages").filter(Cargo.Helper.IsIndexableModel),function(b){return b.get("index")==a})[0]},recursivelyFindMissingIndexesInSet:function(a,b){function c(e,f){for(var g=e.get("pages"),h=g.getMissingIndexes().reverse(),i=[],j=0;j<g.models.length;j++)if("set"===g.models[j].type){if(b.limit&&b.limit.set===e.get("id")&&g.models[j].get("index")>b.limit.index)break;for(var k=g.models[j].get("index"),l=h.length-1;l>=0&&(h[l]<k&&a>0);l--)i.push(h[l]),h.splice(l,1),a--;if(!1===c.call(this,g.models[j],f+1)){if(f>0)return!1;a=0;break}}if(a>0){var m=h.reverse().slice(0,a);b.limit&&b.limit.set===e.get("id")&&(m=m.filter(function(a){return a<=b.limit.index})),a-=m.length,i=i.concat(m)}if(i.length>0&&(d[e.get("id")]={indexes:i,model:e}),b.limit&&b.limit.set===e.get("id"))return!1}var d={};return!a||isNaN(a)?d:(b||(b={}),c.call(this,this,0),d)},paginate:function(a){if(a||(a={}),!this.paginating){if(_.extend(a,{render_changes:!0}),this.get("__tag__"))return this.paginating=!0,void Cargo.View.Content.activeContentModel.get("pages").fetch({render_changes:!0,remove:!1,from_pagination:!0,success:_.bind(function(a,b,c){this.paginating=!1,Cargo.Event.trigger("tag_pagination_complete",a,b,c),this.trigger("tag_pagination_complete",a,b,c)},this)});var b=this.recursivelyFindMissingIndexesInSet(5);this.paginateWithMissingIndexObject(b,a)}},paginateWithMissingIndexObject:function(a,b){b||(b={}),_.extend(b,{from_pagination:!0});var c=0,d=[];this.paginating=!0,_.each(a,function(a){var e=a.model.loadIndexes(a.indexes,b);e&&(c++,e.always(_.bind(function(a){d=d.concat(a),0===--c&&(this.paginating=!1,b.done&&b.done(d),$('[data-loading="page"]').hide(),Cargo.Event.trigger("pagination_complete",this,d,b))},this)))},this),0===c?this.paginating=!1:($('[data-loading="page"]').show(),Cargo.Event.trigger("pagination_start"))},loadIndexes:function(a,b){if(b||(b={}),_.extend(b,{remove:!1,merge:!1}),a.length>0){var c=!1;if(Cargo.Helper.IsAdminProjectListSorting()&&top&&top.Cargo&&top.Cargo.Collection.AdminList){c=!0;var d,e=[];if(_.each(a,function(a){(d=top.Cargo.Collection.AdminList.filter(function(b){return Cargo.Helper.IsIndexableModel(b)&&b.get("index")===a&&b.get("set_id")===this.get("id")},this)[0])&&e.push(d.get("id"))},this),e.length>0){var f=$.ajax({method:"GET",url:Cargo.API.GetPagesPath()+"?pid_list="+e.join(","),dataType:"json"});return f.done(function(a){_.each(a,function(a){d=top.Cargo.Collection.AdminList.findWhere({id:a.id}),d&&(a.sort=d.get("sort"),a.index=d.get("index"),a.set_id=d.get("set_id"),a.display=d.get("display"),a.reverse_index=d.get("reverse_index")),Cargo.Collection.Scaffolding.insertModel(a,this,b)})}),f}}if(!c)return this.get("pages").url=Cargo.API.GetContentCollectionPath()+"?set_id="+this.get("id")+"&index="+a.join(","),this.get("pages").fetch(b)}},fetchModelAtIndex:function(a,b){if(!0===isNaN(a=parseInt(a)))return!1;if(b||(b={}),!0!==b.ignore_cache){var c=this.getModelAtIndex(a);if(c)return void(b.done&&b.done(c,b))}return _.extend(b,{remove:!1,merge:!1,success:_.bind(function(a,b,c){if(b&&b[0]&&b[0].id){var d=a.get(b[0].id);d&&(Cargo.Collection.Scaffolding.insertModel(d,a,c),c.done&&c.done(d,c))}else c.error&&c.error()},this)}),this.get("pages").url=Cargo.API.GetContentCollectionPath()+"?set_id="+this.get("id")+"&index="+a,this.get("pages").fetch(b)},toJSON:function(a){function b(a){a.pages&&(void 0!==a.pages.models&&(a.pages=a.pages.toJSON()),_.each(a.pages,b))}var c=_.clone(this.attributes);return b(c),c}}),Cargo.o.model.page=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){this.type="page",this.busySendingValues=!1,this.saveValueQueue=[],null!=this.get("page_options")&&"object"==typeof this.get("page_options")||(this.attributes.page_options={}),this.on("change:images",this.addImagesToGlobalCollection,this),this.addImagesToGlobalCollection(),this.on("change:title",function(){void 0!==Cargo.contentWindow&&Cargo.contentWindow.Cargo.Event.trigger("page_model_change:title",this.get("id"),this.get("title"))})},addImagesToGlobalCollection:function(){if(Cargo.Collection.Images&&this.get("images")){var a=Cargo.Collection.Images.add(this.get("images"));this.attributes.images=a}},toJSON:function(a){function b(a){a.pages&&(void 0!==a.pages.models&&(a.pages=a.pages.toJSON()),_.each(a.pages,b))}var c=_.clone(this.attributes);return b(c),c},url:function(){return Cargo.API.GetSinglePagePath(this.id)},saveValue:function(a,b,c){if(!0!==c&&this.set(a),this.busySendingValues){console.info("saveValue, still handling previous request. Queuing.",a);var d=_.where(this.saveValueQueue,{keys:_.keys(a).join(",")})[0];return d?(d.data=a,d.callback=b,!1):(this.saveValueQueue.push({data:a,callback:b,keys:_.keys(a).join(",")}),!0)}return this.busySendingValues=!0,this.save(a,{patch:!0,success:_.bind(function(){b&&b.call(),this.busySendingValues=!1,this.saveValueQueue.length>0&&(this.saveValue(this.saveValueQueue[0].data,this.saveValueQueue[0].callback,!0),this.saveValueQueue.shift())},this)}),!0},GetThumbnailCropData:function(){var a=this.get("thumb_meta");return a?a.thumbnail_crop:null},SetThumbnailCropData:function(a){var b=this.get("thumb_meta")||{};b.thumbnail_crop=a,this.set("thumb_meta",b)},GetId:function(){return this.get("id")},GetProjectUrl:function(){return this.get("project_url")},GetType:function(){return!(!this.get("type")||0==this.get("id"))&&this.get("type")},GetBgColor:function(){return!!this.get("bgcolor")&&"#"+this.get("bgcolor")},setPageOption:function(a,b,c){return null!=this.get("page_options")&&"object"==typeof this.get("page_options")||(this.attributes.page_options={}),this.get("page_options")[a]=b,this.set("page_options",this.get("page_options"),c)},getPageOption:function(a){if(null!=this.get("page_options")&&"object"==typeof this.get("page_options"))return this.get("page_options")[a]},setPinOptions:function(a,b){var c=this.getPageOption("pin_options");c||(c={}),c[a]=b,this.setPageOption("pin_options",c);var c=this.get("pin_options");c||(c={}),c[a]=b,this.set("pin_options",c),this.set("pin_changed",!0),this.trigger("pin_option_change",a,b)},getPinOption:function(a){if(null!=this.get("pin_options")&&"object"==typeof this.get("pin_options"))return this.get("pin_options")[a]},getLayoutOption:function(a){var b=this.getPageOption("local_layout_options");return b&&a in b?b[a]:b},setLayoutOption:function(a,b,c){var d=this.getPageOption("local_layout_options");return d||(d={}),d[a]=b,this.setPageOption("local_layout_options",d,c)},getThumbnailOption:function(a){var b=this.getPageOption("thumbnail_options");if(b&&a in b)return b[a]},setThumbnailOption:function(a,b){var c=this.getPageOption("thumbnail_options");if(c||(c={}),c[a]!==b){c[a]=b,this.setPageOption("thumbnail_options",c);var d={changing:a,value:b,mobile:!1};this.trigger("change",this,d)}},isFullyPopulated:function(){return this.attributes.hasOwnProperty("thumb")}}),Cargo.o.model.pin=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var a=this.get("pageView").model,b=this.getDepth(a),c=a.get("pin_options").fixed;this.set({pageModel:a,depth:c?0:b,sort:a.get("sort"),page_padding:0}),this.addEventListeners()},getPinOptions:function(){return this.get("pageModel").get("pin_options")},getDepth:function(a){var b=0;if(a&&a.get("set_id"))for(;a&&0!=a.get("set_id");)a=Cargo.Collection.Scaffolding.getModel({id:a.get("set_id")}),b++;return b},addEventListeners:function(){var a=this.get("pageView"),b=this.get("pageModel"),c=this.collection;a.listenTo(b,"change:pin",function(){!1===this.model.get("pin")&&this.remove()}),a.listenTo(b,"pin_option_change",_.bind(function(d,e,f){var g=b.getPageOption("pin_options");if(a.$el.removeClass("overlay accommodate fixed exclude_mobile"),g){g.overlay&&a.$el.addClass("overlay"),g.accommodate&&a.$el.addClass("accommodate"),g.exclude_mobile&&a.$el.addClass("exclude_mobile"),g.fixed&&a.$el.addClass("fixed");var h=this.getDepth(b),i=this.getPinOptions().fixed;this.set("depth",i?0:h)}c.trigger("update"),this.trigger("formatting_update_required")},this)),a.listenTo(a,"remove",function(){!0!==this.__prevent_model_removal__&&c.remove(this.model.get("id"),{from_pageview_removal:!0})}),this.on("remove",function(a,b,c){c&&!0!==c.from_pageview_removal&&(a.get("pageView").__prevent_model_removal__=!0,a.get("pageView").remove(),delete a.get("pageView").__prevent_model_removal__)}),a.listenTo(b,"change:set_id",_.bind(function(){var a=this.getDepth(b),c=this.getPinOptions().fixed;this.set("depth",c?0:a)},this)),a.listenTo(b,"change:sort",_.bind(function(a,b,c){this.set("sort",b)},this))}}),Cargo.o.model.display_options=Backbone.Model.extend({fetch:function(a){$("script[data-set='DisplayOptions']").html()?this.set($.parseJSON($("script[data-set='DisplayOptions']").html()),a):Backbone.Model.prototype.fetch.apply(this,arguments)},url:function(){return Cargo.API.GetDisplayOptionsPath()},GetPaginationCount:function(){return this.get("pagination_count")},GetDisableProjectScroll:function(){return this.get("disable_project_scroll")},GetImageWidth:function(){return this.get("image_width")},GetIndexRouteUrl:function(){return this.get("index_route_url")},GetIndexRouteName:function(){return this.get("index_route_name")}}),Cargo.o.model.site=Backbone.Model.extend({fetch:function(a){a=a||{},!0!==a.force_admin_fetch&&$("script[data-set='Site']").html()?this.set($.parseJSON($("script[data-set='Site']").html()),a):Backbone.Model.prototype.fetch.apply(this,arguments)},parse:function(a){return Cargo.Helper.IsAdminEdit()||(a.is_editor=Cargo.Helper.GetIsEditor()),a},url:function(){var a=Cargo.API.GetSitePath();return""!=Cargo.API.Config.filter&&(a+="?filter="+encodeURIComponent(Cargo.API.Config.filter)),a},GetId:function(){return this.get("id")},GetPresetPreviewLink:function(a){return"//"+this.get("site_url")+"."+Cargo.Helper.GetBaseCargoDomain()+"/presetpreview/"+a},GetWebsiteTitle:function(){return this.get("website_title")},GetHomepageId:function(){return this.get("homepage_id")},GetIsEditor:function(){return this.get("is_editor")},GetUseHiRes:function(){var a=this.get("use_hi_res");return void 0==a&&(a=window.devicePixelRatio>1),a}}),Cargo.o.model.image=Backbone.Model.extend({initialize:function(){_.bindAll(this,"getImageByWidth")},urlRoot:function(){return"/_api/v0/image"},getImageByWidth:function(a){var b={};return a>this.get("width")&&(a=this.get("width")),b.w=a,this.getImageWithOptions(b).url},getImageByWidth2x:function(a){return this.getImageByWidth(2*a)},getImageWithOptions:function(a){var b={retina:!!window.devicePixelRatio&&window.devicePixelRatio>=1.2,square:!1,url:"",webgl:a.hasOwnProperty("t")&&"webgl"==a.t};if(_.extend(b,a),"original"===b.t&&(b.retina=!1),!0!==b.retina||b.webgl||(void 0==b.q&&(b.q=67),b.hasOwnProperty("w")&&(b.w=Math.min(2*b.w,this.get("width"))),b.hasOwnProperty("h")&&(b.h=Math.min(2*b.h,this.get("height")))),b.w&&b.w>this.get("width")&&(b.webgl?b.w=this.getValidWebGLSize(b.w):b.w=this.get("width")),b.h&&b.h>this.get("height")&&(b.h=this.get("height")),!0===b.square){var c=this.getSquareCrop();b.c={x:c.x,y:c.y,w:c.w,h:c.h}}var d=["t","w","h","q","c"],e=[],f=!1,g=!1;_.each(b,function(a,b){-1!==d.indexOf(b)&&""!==a&&("c"===b?e.push("c/"+a.x+"/"+a.y+"/"+a.w+"/"+a.h):e.push(b+"/"+a),f="w"==b?a:"c"==b&&a.w?a.w:f,g="h"==b?a:"c"==b&&a.h?a.h:g)},this);var h=this.getScaleSize(f,g);return b.w=h.w,b.h=h.h,void 0!==this.get("hash")&&void 0!==this.get("name")?b.url="//freight.cargocollective.com/"+e.join("/")+"/i/"+this.get("hash")+"/"+this.get("name"):b.url="",b},getSquareCrop:function(){var a=y=w=h=diff=0;return this.get("height")>this.get("width")?(w=h=this.get("width"),diff=this.get("height")-this.get("width"),y=Math.floor(diff/2),a=0):this.get("width")>this.get("height")?(w=h=this.get("height"),diff=this.get("width")-this.get("height"),a=Math.floor(diff/2),y=0):(w=this.get("width"),h=this.get("height"),a=y=0),{w:w,h:h,x:a,y:y}},getOriginalImage:function(){return this.getImageWithOptions({t:"original",retina:!1})},urlBelongsToImage:function(a){return"string"==typeof a&&-1!==a.indexOf(this.get("hash")+"/"+this.get("name"))},getValidWebGLSize:function(a){var b=[128,256,512,1024,2048,4096];return a>this.get("width")&&_.each(b,function(b){b<1e3&&(a=b)}),a},getScaleSize:function(a,b){var c=a,d=b;if(og_w=parseInt(this.get("width")),og_h=parseInt(this.get("height")),a&&b);else if(og_w==og_h)c=a||(b||og_w),d=c;else if(a)var e=og_w/a,d=Math.floor(og_h/e),c=a;else if(b)var e=og_h/b,c=Math.floor(og_w/e),d=b;return{w:c,h:d}},getFitSize:function(a,b,c,d){if(a=parseInt(a),(b=parseInt(b))>a)var e=a/c,f=Math.floor(b/e),g=c;else if(a>b)var e=b/d,g=Math.floor(a/e),f=d;else var g=a,f=b;return[g,f]}}),Cargo.o.model.localImage=Cargo.o.model.image.extend({blob_references:{},canvas:null,initialize:function(){this.blob_references={},this.canvas=document.createElement("canvas"),_.bindAll(this,"getImageByWidth")},urlRoot:function(){return""},getImageWithOptions:function(a){var b=Cargo.o.model.image.prototype.getImageWithOptions.apply(this,arguments),c=["t","w","h","q","c"],d=[],e=!1,f=!1;_.each(b,function(a,b){-1!==c.indexOf(b)&&""!==a&&("c"===b?d.push("c_"+a.x+"_"+a.y+"_"+a.w+"_"+a.h):d.push(b+"_"+a),e="w"==b?a:"c"==b&&a.w?a.w:e,f="h"==b?a:"c"==b&&a.h?a.h:f)},this);var g=d.join("_");if(this.blob_references.hasOwnProperty(g))b.url=this.blob_references[g];else{if("original"==b.t)this.canvas.setAttribute("width",this.get("width")),this.canvas.setAttribute("height",this.get("height")),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,this.get("width"),this.get("height"));else if(b.hasOwnProperty("c")){var h=Math.max(Math.min(b.c.w,this.get("width")-b.c.x),0),i=Math.max(Math.min(b.c.w,this.get("height")-b.c.y),0);this.canvas.setAttribute("width",h),this.canvas.setAttribute("height",i),this.canvas.getContext("2d").drawImage(this.get("img"),-b.c.x,-b.c.y,this.get("width"),this.get("height"))}else b.webgl?(this.canvas.setAttribute("width",b.webgl),this.canvas.setAttribute("height",b.webgl),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,b.webgl,b.webgl),this.canvas.setAttribute("width",b.w),this.canvas.setAttribute("height",b.h),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,b.w,b.h)):(this.canvas.setAttribute("width",b.w),this.canvas.setAttribute("height",b.h),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,b.w,b.h));this.canvas.toBlob(_.bind(function(a){this.blob_references[g]=URL.createObjectURL(a)},this)),b.url=this.canvas.toDataURL()}return b},urlBelongsToImage:function(a){if("string"!=typeof a)return!1;var b=!1;return _.each(this.blob_references,function(c,d){if(c==a)return void(b=!0)},this),b}}),Cargo.o.model.tag=Backbone.Model.extend({initialize:function(){this.responseCache={},this.isAdmin=Cargo.Helper.IsAdminEdit()},tag_url:"",url:function(){return Cargo.API.GetSitePath()+"/tags/"+this.tag_url},fetch:function(a){a=a||{},_.defaults(a,{});var b=this.url();if(this.responseCache.hasOwnProperty(b))return this.set(this.responseCache[b]),this.trigger("sync"),void("function"==typeof a.success&&a.success.call(a.context,this,this.responseCache[b],a));a.success=_.wrap(a.success,_.bind(function(c,d,e){!0!==this.isAdmin&&(this.responseCache[b]=e);var f=Array.prototype.slice.call(arguments);f.shift(),c&&c.apply(a.context,f)},this)),Backbone.Model.prototype.fetch.apply(this,arguments)}}),Cargo.o.model.thumbnailsettings=Backbone.Model.extend({page_id:null,mode_id:null,iterator:null,initialize:function(a){this.page_id=a&&a.page_id?a.page_id:this.page_id,this.mode_id=a&&a.mode_id?a.mode_id:this.mode_id,this.iterator=a&&a.iterator?a.iterator:this.iterator},fetch:function(a){$("script[data-set='ThumbnailSettings']").html()?(this.set($.parseJSON($("script[data-set='ThumbnailSettings']").html()),a),$("script[data-set='ThumbnailSettings']").remove()):Backbone.Model.prototype.fetch.apply(this,arguments)},url:function(){return Cargo.API.GetActiveThumbnailSettingsPath(this.page_id,this.mode_id,this.iterator,this.id)},getTemplatePath:function(a){return"/_jsapps/thumbnails/"+(a=a||this.get("path"))+"/thumbnail.handlebars"},setThumbMeta:function(a,b){window.parent.Cargo.Event.trigger("thumbnail:add_meta_data",a,b)}}),Cargo.o.collection.content=Backbone.Collection.extend({name:"Content",constructor:function(){this.server_page_count=0,this.on("add",function(a,b,c){c.from_admin_sort&&Cargo.Helper.IsIndexableModel(a)&&this.server_page_count++},this),this.on("remove",function(a,b,c){c.from_admin_sort&&Cargo.Helper.IsIndexableModel(a)&&this.server_page_count--},this),Backbone.Collection.prototype.constructor.apply(this,arguments)},initialize:function(){},comparator:"sort",model:function(a,b){return new Cargo.o.model[a.pages?"set":"page"](a,b)},isGlobal:!0,CollectionData:{},url:function(){return Cargo.API.GetPagesPath()},LoadCollection:function(a){if(!1!==Cargo.Helper.isFeed()&&(!0!==this.isGlobal||"global"!=a))if(a&&this.CollectionData[a])this.set(this.CollectionData[a]),!1===this.isGlobal&&"global"!=a?(this.trigger("sync"),this.isGlobal=!0):!0===this.isGlobal&&"global"!=a&&(this.trigger("sync"),this.isGlobal=!1);else if(a)this.tags=a,this.fetch(),this.tags=null,this.isGlobal=!1;else{if(!0===this.isGlobal)return;this.set(this.CollectionData.global),this.trigger("sync"),this.isGlobal=!0}},getLoadedIndexes:function(){return _.without(this.map(function(a){
if(Cargo.Helper.IsIndexableModel(a))return a.get("index")},this),void 0)},getMissingIndexes:function(a){for(var b=this.getLoadedIndexes(),c=[],d=0;d<this.server_page_count;){if(a&&d>a)return c;-1==b.indexOf(d)&&c.push(d),d++}return c},missingNumInSequence:function(a,b,c){if(void 0!==a&&void 0!==a.length){if(void 0===b&&(b=0),void 0===c&&(c=a.length),b>=c)return b;var d=Math.floor((b+c)/2);return a[d]===d?this.missingNumInSequence(a,d+1,c):this.missingNumInSequence(a,b,d)}},getFirstIndexGap:function(){var a=_.uniq(this.getLoadedIndexes(),!0);return this.missingNumInSequence(a)},each:function(a,b,c){function d(c){c.each(a,b);for(var e=0;e<c.models.length;e++)"set"===c.models[e].type&&d(c.models[e].get("pages"))}return c?void d(this):Backbone.Collection.prototype.find.apply(this,arguments)},getContentOrPageModelByPid:function(a,b){var c=this.getModel({id:a});return c&&b&&c.parent_model&&c.parent_model.get("stack")&&(c=c.parent_model),c},getContentOrPageModelByPurl:function(a,b){var c=this.getModel({project_url:a});if(!c){var d=this.getModel({project_url:a});d&&b&&d.parent_model&&d.parent_model.get("stack")&&(c=d.parent_model)}return c},getModel:function(a){return this.findWhere(a,!0)},getHomePageModel:function(){return this.getContentOrPageModelByPid(Cargo.Helper.GetHomepageId())},getAllContentPageIds:function(){var a=this.reject(function(a){if(a.get("pin")||0==a.get("pages").length)return a});return _.pluck(a,"id")},fetchPageModel:function(a){var b,c=this;return b=new Cargo.o.model.set({id:a}),b.fetch({error:function(b,d){try{if("no pid found"===$.parseJSON(d.responseText).message.toLowerCase()){var e=Cargo.Collection.Tags.findTagByUrl(a);e?(c.LoadCollection(e.get("url")),Cargo.Event.trigger("thumbnails:load_tag",e.get("url")),Cargo.View.Content.hideActiveView()):(Cargo.Modal.Alert({message:"That page no longer exists",confirm:function(){window.history.back()}}),Cargo.Helper.HideLoadingAnimation())}}catch(a){console.error("unable to fetch",b)}},success:function(a,b,d){"set"===a.type&&void 0===a.get("pages")&&(a=new Cargo.o.model.page(a.toJSON())),c.insertModel(a,b,d)}})},insertModel:function(a,b,c){if(a.get("set_id")){var d=this.getModel({id:a.get("set_id")});if(d)return d.get("pages").add(a),d.get("pages").sort(),this.trigger("add",a,b,c),void this.trigger("offline_model_loaded",a)}this.add(a),this.trigger("offline_model_loaded",a)},removeNonVisiblePages:function(){var a=_.filter(this.getAllPages(),function(a){return!1===a.get("display")&&!1===a.get("pin")});_.each(_.pluck(a,"id"),_.bind(function(a){var b=this.findWhere({id:a});if(b&&!b.get("is_set"))this.remove(b,{silent:!0});else{var c=this.findWhere({id:a},!0);c&&(1==c.parent_model.get("pages").length?this.remove(c.parent_model,{silent:!0}):c.parent_model.get("pages").remove(c,{silent:!0}))}},this))},findWhere:function(a,b){return b=b||!1,this.where(a,!0,b)},where:function(a,b,c){if(c=c||!1){return this[b?"find":"filter"](a,c)}return Backbone.Collection.prototype.where.call(this,a,b)},find:function(a,b){function c(b){if(d=b.findWhere(a))return e=d,void(e.parent_model=b);for(var f=0;f<b.models.length;f++)if("set"===b.models[f].type){if(d=b.models[f].get("pages").findWhere(a)){e=d,e.parent_model=b.models[f];break}"set"===b.models[f].type&&c(b.models[f].get("pages"))}}if(b=b||!1){var d,e;return c(this),e}return Backbone.Collection.prototype.find.call(this,a)},getAllPages:function(a){function b(d){for(var e=0;e<d.models.length;e++)"page"!==d.models[e].type?d.models[e].get("pages")&&d.models[e].get("pages").models&&(a&&"set"===d.models[e].type&&c.push(d.models[e]),b(d.models[e].get("pages"))):c.push(d.models[e])}var c=[];return b(this),c},filter:function(a,b){function c(b){d=_.union(d,b.filter(a));for(var e=0;e<b.models.length;e++)"set"===b.models[e].type&&c(b.models[e].get("pages"))}if(b=b||!1){var d=[];return c(this),d}return Backbone.Collection.prototype.filter.call(this,a)}}),Cargo.o.collection.scaffolding=Backbone.Collection.extend({name:"Scaffolding",constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},comparator:"sort",model:function(a,b){return new Cargo.o.model[a.pages?"set":"page"](a,b)},url:function(){return Cargo.API.GetPagesPath()},initialize:function(){this.fetchPageModelCache={},this.isAdmin=Cargo.Helper.IsAdminEdit()},applyAdminlistChangeMap:function(a,b){var c,d={};this.each(function(b){void 0!==a[b.get("id")]&&(c=a[b.get("id")],void 0!==c.sort&&b.set("sort",c.sort,{from_admin_sort:!0}),void 0!==c.index&&b.set("index",c.index,{from_admin_sort:!0}),void 0!==c.reparented&&(d[b.get("id")]={new_set:c.reparented.to,model:b}),delete a[b.get("id")])},this,!0),_.each(d,function(a,b){var c=a.model,d=this.getModel({id:c.get("set_id")}),e=this.getModel({id:a.new_set});void 0!==d&&void 0!==e&&(d.get("pages").remove(c,{from_admin_sort:!0}),c.set("set_id",e.get("id")),this.insertModel(c,this,{from_admin_sort:!0,render_changes:!0}))},this),_.each(a,function(a){if(void 0!==a.reparented&&a.reparented.indexable){var b=this.getModel({id:a.reparented.from}),c=this.getModel({id:a.reparented.to});b&&b.get("pages").server_page_count--,c&&c.get("pages").server_page_count++}},this),Cargo.View.Content.currentSet&&(_.each(_.union([Cargo.View.Content.currentSet],Cargo.View.Content.currentSet.getAllSetViews()),function(a){a.sortPagesAndUpdateDOM()}),_.each(Cargo.View.Content.currentSet.getAllPageViews(),function(a){a.addBackdrop()}),"display_state"!==b&&Cargo.View.Content.fillGapsInCurrentSet()),Cargo.Event.trigger("refresh_pins")},fetch:function(a){if($("[data-set='ScaffoldingData']").length>0){var b=JSON.parse($("[data-set='ScaffoldingData']").html());this.set(b),$("[data-set='ScaffoldingData']").remove()}else Backbone.Collection.prototype.fetch.apply(this,arguments)},parse:function(a,b){return _.each(a,function(a){var c=this._prepareModel(a,b);c&&this.insertModel(c,this,b)},this),[]},LoadTagCollection:function(a){var b=new Cargo.o.model.set({id:a.get("url"),pages:[],project_url:a.get("url"),__tag__:a.get("url"),title:a.get("tag")});!1===Cargo.Helper.isFeed()?(b.get("pages").url="",b.get("pages").fetch=function(){console.info("no paginate for non-feed tags")},Cargo.View.Content.render(b),Cargo.Event.trigger("thumbnails:load_tag",a.get("url")),Cargo.View.Main.SetWindowTitle()):(b.__offset=0,b.__increment=5,b.get("pages").url=function(){var a=Cargo.API.GetPagesPath(b.get("__tag__"),b.__offset,b.__increment);return b.__offset+=b.__increment,a},b.get("pages").on("add",function(a){this.insertModel(a,this,{render_changes:!1})},this),b.attributes.pages.fetch({success:function(a){Cargo.View.Content.render(b),Cargo.View.Main.SetWindowTitle()}}))},getSetOrPageModel:function(a,b){var c=this.getModel(a);return c&&b&&c.parent_model&&c.parent_model.get("stack")&&(c=c.parent_model),c},getContentOrPageModelByPid:function(a,b){var c=this.getModel({id:a});return c&&b&&c.parent_model&&c.parent_model.get("stack")&&(c=c.parent_model),c},getModelByPurl:function(a,b){if(void 0!==a){var c=this.filter(function(b){return"string"==typeof b.get("project_url")&&b.get("project_url").toLowerCase()===(a+"").toLowerCase()},!0)[0];return c&&b&&c.parent_model&&c.parent_model.get("stack")&&(c=c.parent_model),c}},getModel:function(a){return this.findWhere(a,!0)},getHomePageModel:function(){return this.getContentOrPageModelByPid(Cargo.Helper.GetHomepageId())},getAllContentPageIds:function(){var a=this.reject(function(a){if(a.get("pin")||0==a.get("pages").length)return a});return _.pluck(a,"id")},getPinsByPositionSetId:function(a,b){if(Number(b)){var c=this.getModel({id:b}),d=[];if(!c)return;if("page"===c.type){if(0===c.get("set_id"))return;if(!(c=this.getModel({id:c.get("set_id")})))return}for(d=d.concat(c.get("pages").models);c&&0!=c.get("set_id")&&0!=c.get("id");)(c=this.getModel({id:c.get("set_id")}))&&c.get("pages")&&(d=d.concat(c.get("pages").models));return _.filter(d,function(b){return b.get("pin")&&b.get("pin_options")&&b.get("pin_options").position==a})}if(!1===b){var d=[],c=this.getModel({id:0});return c.get("pages").filter(function(b){return b.get("pin")&&b.get("pin_options")&&b.get("pin_options").position==a})}},fetchPageModel:function(a,b){console.info("loading async",a);var c=this.fetchPageModelCache[a];if(c)return console.info("located in cache",a),this.insertModel(c,this,b),void(b.done&&b.done(c,b));var d,e=this;return d=new Cargo.o.model.set({id:a}),b||(b={}),_.extend(b,{error:function(b,c){try{if(404==c.status){var d=Cargo.View.Content.getActiveContentModel();d&&d.get("is_set")&&d.get("id");var f=Cargo.Collection.Tags.findTagByUrl(a);f?e.LoadTagCollection(f):(Cargo.Modal.Alert({message:"That page no longer exists",confirm:function(){window.history.back()}}),Cargo.Helper.HideLoadingAnimation())}else 401==c.status&&window.location.replace(window.location.href)}catch(a){console.error(a),console.warn("unable to fetch",b)}},success:function(b,c,d){if(Cargo.Helper.IsAdminProjectListSorting()&&top&&top.Cargo&&top.Cargo.Collection.AdminList){var f=top.Cargo.Collection.AdminList.findWhere({id:b.get("id")});f&&(b.attributes.sort=f.get("sort"),b.attributes.index=f.get("index"),b.attributes.set_id=f.get("set_id"),b.attributes.display=f.get("display"))}"set"===b.type&&void 0===b.get("pages")&&(b=new Cargo.o.model.page(b.toJSON()),e.isAdmin||(e.fetchPageModelCache[a]=b)),e.insertModel(b,e,d),d.done&&d.done(b,d)}}),d.fetch(b)},insertModel:function(a,b,c){var d=a;if("function"==typeof a.get&&(d=a.attributes),void 0!==d.set_id){var e=this.getModel({id:d.set_id});if(e){var f=e.get("pages");if(f.get(a))return;return f.add(a,c),f.sort(),a.collection=f,void this.trigger("add",a,f,c)}}this.add(a)},removeNonVisiblePages:function(){non_visible=_.filter(this.getAllPages(),function(a){return!1===a.get("display")&&!1===a.get("pin")&&!1===a.get("is_homepage")}),_.each(non_visible,function(a){this.getModel({id:a.get("set_id")}).get("pages").remove(a)},this)},changeDisplayStateForPID:function(a,b){var c=this.getModel({id:a});if(c){if(c.set("display",b),!1===b){var d=this.getModel({id:c.get("set_id")});d.get("pages").remove(c)}}else this.fetchPageModel(a,{render_changes:!0})},findWhere:function(a,b){return b=b||!1,this.where(a,!0,b)},where:function(a,b,c){if(c=c||!1){return this[b?"find":"filter"](a,c)}return Backbone.Collection.prototype.where.call(this,a,b)},logIndexStructure:function(){function a(b,c){b.getMissingIndexes;for(var d=0;d<b.models.length;d++)Cargo.Helper.IsIndexableModel(b.models[d])&&(console.log("---".repeat(c)+"index:",b.models[d].get("index"),"sort:",b.models[d].get("sort"),"-",b.models[d].type+":",b.models[d].get("title").substring(0,70)),"set"===b.models[d].type&&a(b.models[d].get("pages"),c+1))}console.log("\n----\n\n"),a(this,0)},getSetStructure:function(a){var b={tree:void 0,_byId:{}},c=function(d,e){for(var f=0;f<d.length;f++)d[f].pages&&(a&&!0!==a(d[f])||(b._byId[d[f].id]=d[f]),d[f].depth=e,d[f].pages=_.where(d[f].pages,{is_set:!0}),c(d[f].pages,e+1))};return c(this.toJSON(),0),b.tree=b._byId[0],b},each:function(a,b,c){function d(c){c.each(a,b);for(var e=0;e<c.models.length;e++)"set"===c.models[e].type&&d(c.models[e].get("pages"))}return c?void d(this):Backbone.Collection.prototype.find.apply(this,arguments)},find:function(a,b){function c(b){if(d=b.findWhere(a))return e=d,void(e.parent_model=b);for(var f=0;f<b.models.length;f++)if("set"===b.models[f].type){if(d=b.models[f].get("pages").findWhere(a)){e=d,e.parent_model=b.models[f];break}"set"===b.models[f].type&&c(b.models[f].get("pages"))}}if(b=b||!1){var d,e;return c(this),e}return Backbone.Collection.prototype.find.call(this,a)},getAllPages:function(a){function b(d){for(var e=0;e<d.models.length;e++)"page"!==d.models[e].type?d.models[e].get("pages")&&d.models[e].get("pages").models&&(a&&"set"===d.models[e].type&&c.push(d.models[e]),b(d.models[e].get("pages"))):c.push(d.models[e])}var c=[];return b(this),c},filter:function(a,b){function c(b){d=_.union(d,b.filter(a));for(var e=0;e<b.models.length;e++)"set"===b.models[e].type&&c(b.models[e].get("pages"))}if(b=b||!1){var d=[];return c(this),d}return Backbone.Collection.prototype.filter.call(this,a)}}),Cargo.o.collection.images=Backbone.Collection.extend({model:function(a,b){return a&&"local"===a.type?new Cargo.o.model.localImage(a,b):new Cargo.o.model.image(a,b)},responseCache:{},initialize:function(){},url:function(){var a=!!this.options&&this.options.sort;return Cargo.API.GetImagesPath(a,!0,!0)},fetchNextPage:function(a){var b=this.url+"-"+this.length;this.fetch({remove:!1,data:{offset:this.length},success:_.bind(function(c,d,e){this.responseCache[b]=d,"function"==typeof a&&a(c,d,e)},this)})},fetch:function(a){var b=a&&a.data&&a.data.offset?a.data.offset:0,c=this.url+"-"+b;return this.responseCache.hasOwnProperty(c)?(0==b?this.set(this.responseCache[c]):this.add(this.responseCache[c]),"function"==typeof a.success&&a.success.call(a.context,this,this.responseCache[c],a),void this.trigger("sync",this,this.responseCache[c])):Backbone.Collection.prototype.fetch.apply(this,arguments)},getImagesWithoutDuplications:function(){var a=[];return this.filter(function(b){return-1===a.indexOf(b.get("hash"))&&(a.push(b.get("hash")),!0)})},fetchImage:function(a,b){var c=this.findWhere({id:parseInt(a)});if(c)return c.getImageWithOptions({w:b})},fetchWebGLImage:function(a,b){var c=this.findWhere({id:parseInt(a)});if(c)return c.getImageWithOptions({t:"webgl",w:b})},fetchOriginalImage:function(a){var b=this.findWhere({id:parseInt(a)});if(b)return b.getOriginalImage()}}),Cargo.o.collection.pins=Backbone.Collection.extend({model:Cargo.o.model.pin,comparator:function(a,b){var c=a.getPinOptions(),d=b.getPinOptions(),e=a.get("pageModel").get("sort"),f=b.get("pageModel").get("sort");if(a.get("depth")!==b.get("depth"))if("bottom"===this.position){if(a.get("depth")>b.get("depth"))return-1;if(a.get("depth")<b.get("depth"))return 1}else{if(a.get("depth")>b.get("depth"))return 1;if(a.get("depth")<b.get("depth"))return-1}else if(e!==f){if(c.overlay&&(this.position===this.reversedSide?e+=9e5:e-=9e5),d.overlay&&(this.position===this.reversedSide?f+=9e5:f-=9e5),e>f)return 1;if(e<f)return-1}return 0},initialize:function(a,b){this.position=b.position,this.reversedSide="bottom",this.pid_list=[],this.debouncedSort=_.debounce(this.sort,0),this.on("reset",this.onReset),this.on("add",this.onAdd),this.on("remove",this.onRemove),this.on("update reset change:sort change:depth",this.onChange)},sort:function(){Backbone.Collection.prototype.sort.apply(this,arguments)},onReset:function(a,b){_.each(b.previousModels,function(a){a.trigger("remove")})},onChange:function(a,b){this.sort(),this.pid_list=this.pluck("id"),this.levels={},this.deepestLevel=0,this.each(function(a){void 0===this.levels[a.get("depth")]&&(this.levels[a.get("depth")]={models:[]}),a.get("depth")>this.deepestLevel&&(this.deepestLevel=a.get("depth")),this.levels[a.get("depth")].models.push(a)},this)},onAdd:function(a,b,c){a.get("pageView").listenTo(a.get("pageModel"),"change:sort",_.bind(this.debouncedSort,this))},onRemove:function(a,b,c){}}),Cargo.o.collection.tags=Backbone.Collection.extend({initialize:function(){},url:function(){return Cargo.API.GetSitePath()+"/tags"},findTagByUrl:function(a){if("string"!=typeof a||""==a||0===a.indexOf("search/"))return!1;if(/(\s|,|\+|\~)/.test(a))return Cargo.Model.Tag.set("url",a),Cargo.Model.Tag;var b=!1;return Cargo.Model.Tag.tag_url=a,Cargo.Model.Tag.fetch({async:!1,success:function(a,c){if(0===_.keys(c).length)return void(b=!1);b=a}}),b},fetch:function(){if($("[data-set='TagsCollection']").length>0){var a=JSON.parse($("[data-set='TagsCollection']").html());this.set(a),$("[data-set='TagsCollection']").remove()}else Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.collection.sitemenu=Backbone.Collection.extend({initialize:function(){Cargo.Event.on("page_model_change:title",_.bind(function(a,b){this.updatePageTitle(a,b)},this))},url:function(){var a=Cargo.Helper.IsAdminEdit()?"/inadmin":"";return Cargo.API.GetSitePath()+"/sitemenu"+a},fetch:function(a){if(!$("script[data-set='SiteMenu']").html())return Backbone.Collection.prototype.fetch.apply(this,arguments);this.set($.parseJSON($("script[data-set='SiteMenu']").html()),a),$("script[data-set='SiteMenu']").remove()},getAllPages:function(){function a(c){_.each(c,function(c){c.hasOwnProperty("pages")?(b.push(c),a(c.pages)):b.push(c)})}var b=[];return void 0!==this.models[0]&&a(this.models[0].get("pages")),b},updatePageTitle:function(a,b){var c=_.filter(this.getAllPages(),function(b){return b.id==a});void 0!==c[0]&&(c[0].project_url=b,c[0].title=b)}}),Cargo.o.collection.thumbnailmodes=Backbone.Collection.extend({initialize:function(){},url:function(){return Cargo.API.GetThumbnailModesPath()},fetch:function(a){$("script[data-set='ThumbnailModes']").html()?this.set($.parseJSON($("script[data-set='ThumbnailModes']").html()),a):Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.collection.thumbnails=Backbone.Collection.extend({initialize:function(a){this.paginating=!1,this.responseCache={},this.currentParams={},this.paginationIncrement=50,this.paginationComplete=!1,Cargo.Event.on("admin_page_update",_.bind(function(a,b){var c=this.findWhere({id:a});c&&c.set(JSON.parse(JSON.stringify(b)))},this)),Cargo.Event.on("thumbnails:clear_cache",function(){this.url=void 0,this.responseCache={}},this);var b=$("[data-set='FirstloadThumbnails']");if(b.length>0){var c=JSON.parse(b.html()),d={page_id:b.attr("data-page_id"),force_all:"all"===b.attr("data-filter_type")||void 0,tags:b.attr("data-tags"),set_id:b.attr("data-set_id"),random_limit:b.attr("data-random_limit"),offset:0,limit:this.paginationIncrement};void 0!==d.random_limit&&isNaN(parseInt(d.random_limit))&&(d.random_limit=10),c&&c.length?(this.url=Cargo.API.GetThumbnailsPath(d.page_id,d.force_all,d.tags,d.set_id,void 0,void 0,d.random_limit),this.responseCache[this.url]={data:c,offset:c.length,paginationComplete:c.length<this.paginationIncrement},this.currentParams=d):console.warn("Initial thumb data is invalid, not setting."),b.remove()}},paginate:function(){this.paginating||this.paginationComplete||void 0===this.currentParams.random_limit&&(this.paginating=!0,this.currentParams.offset+=this.paginationIncrement,$('[data-loading="page"]').show(),this.fetch({params:this.currentParams,remove:!1,from_pagination:!0,success:_.bind(function(a,b,c){$('[data-loading="page"]').hide(),this.paginating=!1,Cargo.Event.trigger("thumbnail_pagination_complete",a,b,c)},this),error:_.bind(function(){$('[data-loading="page"]').hide()},this)}))},applyAdminlistChangeMap:function(a,b,c){this.currentParams&&(this.currentParams&&void 0!==this.currentParams.random_limit||(void 0!==this.currentParams.set_id&&_.each(a,function(a,b){var b=parseInt(b),c=parseInt(this.currentParams.set_id);if(a.hasOwnProperty("reparented"))if(a.reparented.from==c)this.remove(b);else if(a.reparented.to==c&&top&&top.Cargo&&top.Cargo.Collection.AdminList){var d=top.Cargo.Collection.AdminList.findWhere({id:b});!0===d.get("display")&&!0===d.get("thumb_is_visible")&&this.add(d.toJSON())}},this),this.models.sort(function(a,b){return c.indexOf(a.id)-c.indexOf(b.id)}),Cargo.View.Thumbnail&&Cargo.View.Thumbnail.Subview&&Cargo.View.Thumbnail.Subview.render()))},fetch:function(a){a=a||{},_.defaults(a,{params:{}}),this.currentParams=a.params;var b,c=Cargo.API.GetThumbnailsPath(a.params.page_id,a.params.force_all,a.params.tags,a.params.set_id,void 0,void 0,a.params.random_limit);if(this.responseCache.hasOwnProperty(c)){if(b=this.responseCache[c],b.paginationComplete||!0!==a.from_pagination)return this.paginationComplete=b.paginationComplete,this.set(this.responseCache[c].data),this.trigger("sync",this,this.responseCache[c].data,a),void("function"==typeof a.success&&a.success.call(a.context,this,this.responseCache[c].data,a));this.url=Cargo.API.GetThumbnailsPath(a.params.page_id,a.params.force_all,a.params.tags,a.params.set_id,b.offset,this.paginationIncrement)}if(this.url!==c)return b||(this.url=c),a.success=_.wrap(a.success,_.bind(function(d,e,f){void 0!==a.params.random_limit?this.paginationComplete=!0:this.paginationComplete=f.length<this.paginationIncrement,b?(b.data=_.union(b.data,f),b.paginationComplete=this.paginationComplete,b.offset+=f.length,this.set(b.data)):this.responseCache[c]={data:f,offset:0,paginationComplete:this.paginationComplete};var g=Array.prototype.slice.call(arguments);g.shift(),d&&d.apply(a.context,g)},this)),Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.collection.thumbnailsettings=Backbone.Collection.extend({pid:null,model:Cargo.o.model.thumbnailsettings,initialize:function(a){a&&a.pid&&(this.pid=a.pid)},url:function(){return Cargo.API.GetAllThumbnailSettingsPath(this.pid)},fetch:function(a){$("script[data-set='AllThumbnailSettings']").html()?this.set($.parseJSON($("script[data-set='AllThumbnailSettings']").html()),a):Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.view.Main=Backbone.View.extend({el:"body",initialize:function(){if(this.resolveIconFontLoad=_.bind(this.resolveIconFontLoad,this),this.loadIconFont(),this.loadingRandomPage=!1,this.collection.bind("change",this.render,this),"html"==Cargo.API.Config.preview?this.WriteCustomHtmlPreview():"css"==Cargo.API.Config.preview&&this.WriteCustomCSSPreview(),window.matchMedia){var a=Cargo.Helper.GetMobileWindowBreakPoint(),b=window.matchMedia("(min-width: "+a+"px)");b.addListener(function(a){setTimeout(function(){Cargo.Event.trigger("mobile_breakpoint_triggered",b.matches)})})}Cargo.Helper.IsAdminEdit()&&this.$el.attr("data-adminview","true")},events:{"click [rel='history']":"HistoryPush","click [rel='load_admin']":"loadAdmin","click [rel='home_page']":"ShowHome","click [rel='next_page']":"NextPage","click [rel='prev_page']":"PrevPage","click [rel='add_to_cart']":"AddToCart","click [rel='show_cart']":"ShowCart","click [rel='random_page']":"RandomPage","click [rel='site_menu']":"ShowSiteMenu","click a":"preventExtLinks"},render:function(){this.collection},loadAdmin:function(a){a.preventDefault(),Cargo.Helper.IsOnHomepage()?Cargo.Helper.GoToUrl("admin"):Cargo.Core.loadAdminForActivePage()},AddToCart:function(a){a.preventDefault(),Cargo.Helper.IsAdminEdit()&&"click"==a.type||Cargo.View.Following.triggerEventInFrame("add-sku-to-cart",{sku:a.currentTarget.getAttribute("data-sku"),product:a.currentTarget.getAttribute("data-product")})},ShowCart:function(a){a.preventDefault(),Cargo.Helper.IsAdminEdit()&&"click"==a.type&&!$(a.currentTarget).is("#shop_button")||Cargo.Event.trigger("add_history","cart")},isClickInEditor:function(a){if("undefined"==typeof CargoEditor||void 0===CargoEditor.events)return!1;if(void 0===a)return!1;if(a&&"dblclick"===a.type)try{if(!1===top.editor.editorInstance.inspectorOverlay.disabled)return!1}catch(a){}for(var b=a.target;null!==(b=b.parentNode);)if(b.nodeType===Node.ELEMENT_NODE){if("true"===b.contentEditable)return!0;if(b.hasAttribute("data-ce-model-id")&&b.getAttribute("data-ce-model-id")!=Backbone.history.fragment)return!0;if("svg"===b.nodeName&&"marker-overlay"===b.className.baseVal)return!0}return!1},preventExtLinks:function(a){this.isClickInEditor(a)&&a.preventDefault()},loadIconFont:function(){if(!("fonts"in document&&"from"in Array))return void this.resolveIconFontLoad();for(var a,b=Array.from(document.fonts.values()),c=0;c<b.length;c++)if("Icons"==b[c].family){if("loaded"==b[c].status)return void this.resolveIconFontLoad();a=b[c]}this.el.classList.add("iconfont-loading"),a||(a=new FontFace("Icons","url(https://static.cargocollective.com/assets/social/IconFont-Regular-0.7.woff?content)",{unicodeRange:"U+E000-E140, U+FE0E"}));var d=a.load();this.fontTimer=setTimeout(this.resolveIconFontLoad,3e3),void 0!==d?d.then(this.resolveIconFontLoad).catch(this.resolveIconFontLoad):this.resolveIconFontLoad()},resolveIconFontLoad:function(){clearTimeout(this.fontTimer),this.el.classList.remove("iconfont-loading")},HistoryPush:function(a,b){if(!this.isClickInEditor(a)){a&&(a.preventDefault(),b=a.currentTarget);var c=$(b).attr("href")?$(b).attr("href"):$(b).data("href"),d=$(b).attr("data-id")?$(b).attr("data-id"):$(b).data("id"),e=!(!$(b).attr("target")||"_blank"!=$(b).attr("target"));a.metaKey||e?window.open(c):Cargo.Event.trigger("add_history",c,d)}},ShowHome:function(a,b){this.isClickInEditor(a)||(a&&a.preventDefault(),Cargo.Event.trigger("add_history",""))},NextPage:function(a){if(!this.isClickInEditor(a)){a&&a.preventDefault();var b=Cargo.View.Content.getActiveContentModel();if(b&&(!b.get("is_set")||b.get("stack"))){if(!1===b.get("display"))return void $.get(Cargo.API.GetBasePath()+"/page/next/"+b.get("id"),function(a){if(a){var b=Cargo.Collection.Scaffolding.model(a);Cargo.Collection.Scaffolding.insertModel(b,Cargo.Collection.Scaffolding,{}),Cargo.Event.trigger("add_history",b.get("project_url"),b.get("id"))}},"json");var c=Cargo.Collection.Scaffolding.getModel({id:b.get("set_id")});if(c&&void 0!==c.get("page_count")&&!(c.get("page_count")<=1)){var d,e,f=_.without(c.get("pages").map(function(a){return a.get("is_set")&&!a.get("stack")||0==a.get("page_count")?a.get("index"):void 0}),void 0),g=c.get("page_count"),h=b.get("index");for(e=0;e<g&&(h++,h>=g&&(h=0),-1!==f.indexOf(h));e++);d=c.getModelAtIndex(h),d?Cargo.Event.trigger("add_history",d.get("project_url"),d.get("id")):c.fetchModelAtIndex(h,{done:function(a){Cargo.Event.trigger("add_history",a.get("project_url"),a.get("id"))}})}}}},PrevPage:function(a){if(!this.isClickInEditor(a)){a&&a.preventDefault();var b=Cargo.View.Content.getActiveContentModel();if(b&&(!b.get("is_set")||b.get("stack"))){if(!1===b.get("display"))return void $.get(Cargo.API.GetBasePath()+"/page/prev/"+b.get("id"),function(a){if(a){var b=Cargo.Collection.Scaffolding.model(a);Cargo.Collection.Scaffolding.insertModel(b,Cargo.Collection.Scaffolding,{}),Cargo.Event.trigger("add_history",b.get("project_url"),b.get("id"))}},"json");var c=Cargo.Collection.Scaffolding.getModel({id:b.get("set_id")});if(c&&void 0!==c.get("page_count")&&!(c.get("page_count")<=1)){var d,e,f=_.without(c.get("pages").map(function(a){return a.get("is_set")&&!a.get("stack")||0==a.get("page_count")?a.get("index"):void 0}),void 0),g=c.get("page_count"),h=b.get("index");for(e=0;e<g&&(h--,h<0&&(h=g-1),-1!==f.indexOf(h));e++);d=c.getModelAtIndex(h),d?Cargo.Event.trigger("add_history",d.get("project_url"),d.get("id")):c.fetchModelAtIndex(h,{done:function(a){Cargo.Event.trigger("add_history",a.get("project_url"),a.get("id"))}})}}}},RandomPage:function(a){if(!this.isClickInEditor(a)&&(a&&a.preventDefault(),!0!==this.loadingRandomPage)){this.loadingRandomPage=!0;var b,c,d,e,f=[];if(Cargo.View.Content.activeContentModel&&(b=Cargo.View.Content.activeContentModel.get("id")),Cargo.Collection.Scaffolding.each(function(a){if("set"===a.type)if(a.get("stack"))a.get("page_count")>0&&b!==a.get("id")&&f.push([a.get("id")]);else if((c=a.get("page_count"))&&!isNaN(c))for(e=0;e<c;e++)(!(d=a.getModelAtIndex(e))||"set"!==d.type&&d.get("id")!==b)&&f.push([a.get("id"),e])},void 0,!0),0===f.length)return void(this.loadingRandomPage=!1);var g=f[Math.floor(Math.random()*f.length)],h=Cargo.Collection.Scaffolding.getModel({id:g[0]});2===g.length?h.fetchModelAtIndex(g[1],{done:_.bind(function(a){Cargo.Event.trigger("add_history",a.get("project_url"),a.get("id")),this.loadingRandomPage=!1},this),error:_.bind(function(){this.loadingRandomPage=!1},this)}):1===g.length?(Cargo.Event.trigger("add_history",h.get("project_url"),h.get("id")),this.loadingRandomPage=!1):this.loadingRandomPage=!1}},ShowSiteMenu:function(a){Cargo.View.SiteMenu.show(a)},WriteCustomHtmlPreview:function(){if(void 0!==parent.editframe){var a=parent.editframe.document.getElementById("syntax_highlight").value;$("customhtml").html(a)}else if(void 0!==parent.Cargo&&parent.Cargo.hasOwnProperty("Editor")&&void 0!==parent.Cargo.Editor.previewCustomHTML){var a=parent.Cargo.Editor.previewCustomHTML;$("customhtml").html(a)}},WriteCustomCSSPreview:function(){var a=parent.editframe.document.getElementById("syntax_highlight").value;$("body").append("<style>"+a+"</style>"),$("head link[rel='stylesheet']").remove()},SetWindowTitle:function(a){if(a||Cargo.Helper.IsOnHomepage())document.title=Cargo.Model.Site.GetWebsiteTitle();else{var b=Cargo.View.Content.getActiveContentModel(),c=b&&"all"!==b?b.get("title"):"";c?document.title=c+" - "+Cargo.Model.Site.GetWebsiteTitle():""===c&&(document.title=Cargo.Model.Site.GetWebsiteTitle())}},SetHomepageClass:function(){(Cargo.Model.Site.get("homepage_id")||0==Cargo.Model.Site.get("homepage_id"))&&this.$el.addClass("homepage")},SetFeedClass:function(){Cargo.Helper.isFeed()&&this.$el.addClass("feed")},RemoveHomepageClass:function(){this.$el.removeClass("homepage")},RemoveFeedClass:function(){this.$el.removeClass("feed")},SetPageId:function(a){this.$el.attr("data-page-id",a)}}),Cargo.o.view.Backdrop=Backbone.View.extend({has_webgl:null,pages:[],plugins:[],Subviews:{},ticking:!1,initialize:function(){return this.addEventListeners(),this.requestTick(),this},addEventListeners:function(){this.requestTickCallback=this.requestTick.bind(this),this.updateScrollMonitorsCallback=this.updateScrollMonitors.bind(this),this.throttledRequestTick=_.throttle(this.requestTickCallback,150),this.listenTo(Cargo.Event,"design:ready backbone-route",this.setup),this.listenTo(Cargo.Event,"handleAdminUIChange",this.requestTickCallback),this.listenTo(Cargo.Event,"pin_format_complete",this.updateScrollMonitorsCallback),window.addEventListener("scroll",this.requestTickCallback,{passive:!0}),window.addEventListener("resize",this.requestTickCallback,{passive:!0}),Cargo.Event.on("projectlist_sort",function(){_.each(this.Subviews,function(a){a._pageScrollMonitor&&(a._pageScrollMonitor.recalculateLocation(),a._pageScrollMonitor.update(),a._pageScrollMonitor.triggerCallbacks())})},this),CargoEditor&&CargoEditor.hasOwnProperty("events")&&CargoEditor.events.on("editor-content-change",this.requestTickCallback);try{parent.document,parent.hasOwnProperty("Cargo")&&parent.Cargo.hasOwnProperty("Event")&&(parent.Cargo.Event.on("applied-presets",this.requestTickCallback),parent.Cargo.Event.on("mobile-preview",_.debounce(_.bind(this.requestTickCallback,this),50)),parent.Cargo.Event.on("image_upload_complete",_.bind(this.addImage,this)),parent.Cargo.Event.on("image_delete_complete",_.bind(this.removeImage,this)))}catch(a){}return this},setup:function(){var a=$(".backdrop");if(!a.length&&_.isEmpty(this.pages))return this;var b=a.siblings(".page").map(function(){return $(this).data("id")});b=_.map(b,function(a){return parseInt(a,10)});var c=_.difference(this.pages,b),d=_.difference(b,this.pages);return _.each(d,function(a){this.add(a)},this),_.each(c,function(a){this.remove(a)},this),this},reset:function(){_.each(this.Subviews,function(a,b){this.remove(b,!0)},this),this.pages=[]},remove:function(a,b){if(!(a in this.Subviews))return this.pages=_.without(this.pages,a),this;var c=this.Subviews[a],d=_.clone(c.model);return c.prevent_removal?void 0:("function"==typeof c.destroy&&c.destroy(),"object"==typeof c._pageScrollMonitor&&c._pageScrollMonitor.destroy(),c.undelegateEvents(),c.$el.removeData().unbind(),!0===b&&void 0!==c.model.get("originalDataElement")&&null!==c.model.get("originalDataElement")&&null!==c.el.parentNode&&c.el.parentNode.appendChild(c.model.get("originalDataElement")),c.remove(),this.Subviews[a]=void 0,delete this.Subviews[a],this.pages=_.without(this.pages,a),this.markPluginInactive(d),this)},removeImage:function(a){if(a)for(var b in this.Subviews)this.Subviews.hasOwnProperty(b)&&"function"==typeof this.Subviews[b].Update&&this.Subviews[b].Update("image_delete",a)},addImage:function(a){if(a)for(var b in this.Subviews)this.Subviews.hasOwnProperty(b)&&"function"==typeof this.Subviews[b].Update&&this.Subviews[b].Update("image_upload",a)},add:function(a,b,c,d){var e=this.getRenderTargetForPID(a),f=void 0==e?null:e.parentNode.querySelector('[data-set="backdrop_data"]');if(void 0===d&&null!==f&&(d=f.innerHTML),this.pages.push(a),this.pages=_.uniq(this.pages),
e||this.createBackdropEl(a),!d){var g=new Backdrop.o.model.Settings({page_id:a,backdrop_id:b,backdrop_path:c});return g.fetch({success:$.proxy(this.loadBackdrop,this)}),this}var g=new Backdrop.o.model.Settings;return"string"==typeof d?g.set(JSON.parse(d)):g.set(d),g.set("originalDataElement",f),this.loadBackdrop(g),this},change:function(a,b,c){return this.remove(a).add(a,b,c)},get:function(a){if(void 0!==this.Subviews[a])return this.Subviews[a]},enableOrDisableBackdropForPID:function(a,b){if(a=parseInt(a),isNaN(a))return void console.warn("enableOrDisableBackdropForPID: no valid PID given.");if(!1!==b&&(b=!0),!b)return void this.remove(a);var c=Cargo.Collection.Scaffolding.getModel({id:a});if(void 0===c)return void console.warn("enableOrDisableBackdropForPID: Unable to enable backdrop. No page model found.");var d=c.get("backdrop");d&&(d=d||{},d=_.defaults(d,{backdrop_id:void 0,backdrop_path:void 0}),this.add(a,d.backdrop_id,d.backdrop_path)),this.requestTick()},createBackdropEl:function(a){var b=$('.page[data-id="'+a+'"]').closest(".page_container");return $("<div />").addClass("backdrop").attr("data-view","Backdrop").appendTo(b),this},loadBackdrop:function(a){return a.get("requires_webgl")&&!this.testWebGl()?(this.makeFallback(a),this):Backdrop.Data.require_loaded?(require.config({baseUrl:"/_jsapps/backdrop",urlArgs:__cargo_js_ver__}),void 0===this.getRenderTargetForPID(a.get("page_id"))?void console.error("no render target for backdrop"):("undefined"!=typeof __cargo_context__&&"live"===__cargo_context__?require(["_dist/"+a.get("backdrop_path")],_.bind(function(b){require([a.get("backdrop_path")+"/main"],_.bind(function(b){this.markPluginActive(a),this.loadSubview(a,b),this.requestTick()},this))},this)):require([a.get("backdrop_path")+"/main"],_.bind(function(b){this.markPluginActive(a),this.loadSubview(a,b),this.requestTick()},this)),this)):(setTimeout($.proxy(function(){this.loadBackdrop(a)},this),150),this)},getRenderTargetForPID:function(a){return $('.page[data-id="'+a+'"]').siblings(".backdrop")[0]},loadSubview:function(a,b){var c=a.get("page_id");if(void 0!==this.Subviews[c])return this;var d=this.getRenderTargetForPID(c);if(!d)return void console.error("no render target for backdrop");var e=new b({model:a});e.deferredLoadEventName&&(e.deferredLoadEventName+="_"+_.uniqueId()),d.setAttribute("data-backdrop",a.get("backdrop_path")),d.innerHTML="",d.appendChild(e.el),e.render(),"function"==typeof e.Init&&e.Init();var f=$(d).closest(".page_container").get(0),g=$(d).closest('[data-view="pinned_bottom"] .fixed, [data-view="pinned_top"] .fixed');return f&&0==g.length?(f.hasAttribute("split-responsive")?(e._split_responsive=!0,f.hasAttribute("data-padding-top")?e._has_accommodation=!0:e._has_accommodation=!1):e._split_responsive=!1,e._scroll_tracking=!0,e._positionChangeTracker=scrollMonitor.create(f,screen.height),e._positionChangeTracker.enterViewport(function(){e._trackable=!0}),e._positionChangeTracker.exitViewport(function(){e._trackable=!1}),e._pageScrollMonitor=scrollMonitor.create(f),e._pageScrollMonitor.enterViewport(function(){e.in_viewport=!0,e.Resume&&e.paused&&e.Resume()}),e._pageScrollMonitor.exitViewport(function(){e.in_viewport=!1,e.Pause&&!e.paused&&e.Pause()}),void 0!==e._containerMonitor&&e._containerMonitor.update()):e.in_viewport=!0,e._cached_size={left:0,top:0,width:0,height:0},this.Subviews[c]=e,Cargo.Event.trigger("plugin_render",e),setTimeout(function(){e._pageScrollMonitor&&(e._pageScrollMonitor.recalculateLocation(),e._pageScrollMonitor.update(),e._pageScrollMonitor.triggerCallbacks())},100),this},markPluginActive:function(a){var b=a.get("backdrop_id"),c=a.get("backdrop_path"),d=_.findWhere(this.plugins,{path:c});return d||(d={count:0,id:b,path:c},this.plugins.push(d)),d.count++,this},markPluginInactive:function(a){var b=(a.get("backdrop_id"),a.get("backdrop_path")),c=_.findWhere(this.plugins,{path:b});return c&&c.count--,0===c.count&&(this.plugins=_.without(this.plugins,c)),this},is_ios:null,testIOS:function(){return null!==this.is_ios?this.is_ios:(this.is_ios=Cargo.Helper.isIOS(),this.is_ios)},cacheChromeHeight:0,cache_window_data:{height:0,width:0,scrollY:0,scrollX:0},updateScrollMonitors:function(){for(var a in this.Subviews)if(this.Subviews.hasOwnProperty(a)){var b=this.Subviews[a];b.hasOwnProperty("_pageScrollMonitor")&&(b._pageScrollMonitor.recalculateLocation(),b._pageScrollMonitor.update())}this.requestTick()},updateBackdropScrollPosition:function(){var a=this.testIOS(),b=window.scrollY,c=window.innerHeight,d=document.documentElement.clientWidth,e=window.scrollX,f=!1;c==this.cache_window_data.height&&d==this.cache_window_data.width&&(f=!0),this.cache_window_data={width:d,height:c,scrollY:b,scrollX:e};var g=Cargo.Helper.IsMobileWindowSize(d);for(var h in this.Subviews)if(this.Subviews.hasOwnProperty(h)){var i=this.Subviews[h];if(i)if((i._trackable||i._scroll_tracking)&&i.hasOwnProperty("_positionChangeTracker")){var j=i.el.parentElement.getBoundingClientRect(),k=i.el.parentElement.parentElement.getBoundingClientRect();if(j.left==i._cached_size.left&&j.top==i._cached_size.top&&j.width==i._cached_size.width&&j.height==i._cached_size.height&&f)return;i._cached_size=j;const l=i._split_responsive&&g;if(k.height<=c||l){if(i._scroll_tracking){var m,n;if(i._has_accommodation){var o=Cargo.View.PinnedTop.pinCollection.findWhere({content_accommodate_page:!0}).get("page_height");l?(m="calc(50vh + "+o+"px)",n="translate(0, "+-o+"px)"):(m="calc(100% + "+o+"px)",n="translate(0, "+-o+"px)"),i._scroll_tracking=!0}else m="",n="",i._scroll_tracking=!1;i.el.style.transform=n,i.el.style.height=m,i.el.style.width="",i.el.style.position="",i.hasOwnProperty("auxiliary_container")&&(i.auxiliary_container._el.style.transform="",i.auxiliary_container._el.style.height=m,i.auxiliary_container._el.style.width="",i.auxiliary_container._el.style.position=""),i.el.style.willChange="initial"}}else{i._scroll_tracking&&!i._trackable?i._scroll_tracking=!1:i._scroll_tracking=!0;const p=k.bottom>=0&&k.top<0,q=k.top<=c&&k.bottom>c,r=k.top>c,s=k.bottom<0,t=k.top<=0&&k.bottom>=c;var u=0,v=0,w="absolute",m="",x=Math.ceil(j.width),y=document.documentElement.clientHeight,z=Math.abs(c-y);this.cacheChromeHeight=Math.max(z,this.cacheChromeHeight),a&&(c=y+this.cacheChromeHeight),q&&!t||r?(m=c+"px",w="absolute",v=0,u=0):p&&!t||s?(m=c+"px",u=k.height+-c,w="absolute",v=0):(m=c+"px",u=0,w="fixed",v=Math.round(j.left)),i.el.style.position=w,i.el.style.willChange="transform, width, height, position",i.el.style.width=x+"px",i.el.style.height=m,v+=-k.left,i.el.style.transform=0==v&&0==u&&0==b?"":"translate("+v+"px, "+u+"px)",i.hasOwnProperty("auxiliary_container")&&(i.auxiliary_container._el.style.height=m,i.auxiliary_container._el.style.width=x+"px",i.auxiliary_container._el.style.position=w,i.auxiliary_container._el.style.transform=0==v&&0==u&&0==b?"":"translate("+v+"px, "+u+"px)")}}else i._scroll_tracking=!1,i.el.style.willChange="initial"}},requestTick:function(a){if(!this.ticking){var b=this;requestAnimationFrame(function(){b.updateBackdropScrollPosition(),Cargo.Event.trigger("backdrop_position_update"),b.ticking=!1})}this.ticking=!0},makeFallback:function(a){var b=a.get("page_id"),c=$('[data-id="'+b+'"]').css("color"),d=c.split(","),e=[],f=0;/rgb\(/.test(c)?(d[0]=d[0].replace("rgb(",""),e[0]=parseInt(d[0]),e[1]=parseInt(d[1]),e[2]=parseInt(d[2]),f=(299*e[0]+587*e[1]+114*e[2])/1e3):/rgba\(/.test(c)?(d[0]=d[0].replace("rgb(",""),e[0]=parseInt(d[0]),e[1]=parseInt(d[1]),e[2]=parseInt(d[2]),f=(299*e[0]+587*e[1]+114*e[2])/1e3):/#/.test(c)?(e[0]=parseInt(d[0],16),e[1]=parseInt(d[1],16),e[2]=parseInt(d[2],16),f=(299*e[0]+587*e[1]+114*e[2])/1e3):f=255;var g=f>125?"#333":"#fff";return $('.page[data-id="'+b+'"]').siblings(".backdrop").css("background-color",g),this},testWebGl:function(){if(null!==this.has_webgl)return this.has_webgl;var a,b,c;if(this.has_webgl=!1,window.WebGLRenderingContext){a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1;for(var d=0;d<4;d++)try{if((c=a.getContext(b[d]))&&"function"==typeof c.getParameter)return a=void 0,this.has_webgl=!0,this.has_webgl}catch(a){}return a=void 0,this.has_webgl=!1,this.has_webgl}return this.has_webgl=!1,this.has_webgl},initAndRenderPlugin:$.noop,initPlugin:$.noop,loadActivePlugin:$.noop,render:$.noop,unloadMainPlugin:$.noop}),Cargo.o.view.Content=Backbone.View.extend({initialize:function(){this.currentSet=null,this.activeContentModel=null,$(_.bind(function(){var a=2*screen.height;Cargo.Helper.isMobile()&&(a=.75*screen.height);var b=scrollMonitor.create($("[data-autopaginate]")[0],a);b.enterViewport(_.bind(function(){this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0})},this)),b.isInViewport&&this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0}),Cargo.Event.on("set_render_complete",function(a,c){c.from_pagination||(scrollMonitor.update(),!0!==c.prevent_pagination_recheck&&b.isInViewport&&this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0}))},this),Cargo.Event.on("set_load_complete",function(){scrollMonitor.update(),b.isInViewport&&this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0})},this),Cargo.Event.on("pagination_complete",function(a,c,d){setTimeout(_.bind(function(){scrollMonitor.update();var a=d.pagination_attempts;if(isNaN(a)&&(a=!1),!(a&&a>3)&&c.length>0&&b.isInViewport){var e={};isNaN(a)||(e.pagination_attempts=++a),this.requestPagination(e)}},this),100)},this)},this)),this.activeLinks=[],Cargo.Event.on("content_load_complete",this.checkActiveLinks,this),Cargo.Event.once("init_complete",function(){this.initializePreRenderedSet()},this)},requestPagination:function(a){this.currentSet&&this.activeContentModel&&"set"===this.activeContentModel.type&&this.activeContentModel.paginate(a)},fillGapsInCurrentSet:function(){if(this.currentSet&&this.activeContentModel&&"set"===this.activeContentModel.type){var a,b,c=_.union([this.currentSet],this.currentSet.getAllSetViews()),d=[],e=[];if(c.sort(function(a,b){return a.model.get("sort")-b.model.get("sort")}),_.each(c,function(c){e.push(c),c.pageViews.length>0&&(a=c,b=c.pageViews[c.pageViews.length-1],d=_.union(d,e),e=[])}),!a||!b)return;var f=0,g=this.activeContentModel.recursivelyFindMissingIndexesInSet(16,{limit:{set:a.model.get("id"),index:b.model.get("index")}});if(_.isEmpty(g))return;if(_.each(g,function(a){f+=a.indexes.length}),f>15){var h=this.activeContentModel.recursivelyFindMissingIndexesInSet(15,{limit:{set:a.model.get("id"),index:b.model.get("index")}});this.activeContentModel.paginateWithMissingIndexObject(h,{render_changes:!0,done:_.bind(function(a){var b=a[a.length-1];_.each(Cargo.Collection.Scaffolding.getAllPages(!0),function(a){if("set"===a.type){var c=[];a.get("pages").each(function(a){"page"===a.type&&Cargo.Helper.IsIndexableModel(a)&&a.get("sort")>b.sort&&c.push(a)}),a.get("pages").remove(c)}})},this)})}else this.activeContentModel.paginateWithMissingIndexObject(g,{render_changes:!0})}},checkActiveLinks:function(a){var b=Cargo.Helper.GetHomepageId(),c=Cargo.Collection.Scaffolding.getModel({id:a}),d="";c?d=c.get("project_url")+"":this.activeContentModel&&void 0!==this.activeContentModel.get("__tag__")&&(d=this.activeContentModel.get("__tag__"));var e,f=_.filter(document.querySelectorAll(".page_container a, #site_menu > a"),function(c){return a!=b&&("string"==typeof c.getAttribute("href")&&c.getAttribute("href").replace(/\//g,"").toLowerCase()==d.replace(/\//g,"").toLowerCase()||void(c.classList.contains("active")&&-1===this.activeLinks.indexOf(c)&&this.activeLinks.push(c)))},this),g=_.difference(this.activeLinks,f),h=_.difference(f,this.activeLinks);if(0===h.length&&0===g.length)return void(this.activeLinkPID=a);for(e=0;e<h.length;e++)h[e].classList.add("active"),this.activeLinks.push(h[e]);for(e=0;e<g.length;e++)g[e].classList.remove("active"),0===g[e].classList.length&&g[e].removeAttribute("class");this.activeLinks=_.difference(this.activeLinks,g),this.activeLinkPID=a},retrieveActivePageViewForPID:function(a,b){var c=Cargo.Helper.GetPageViewById(a);if(c&&c.model.get("pin"));else if(Cargo.Helper.isFeed()||void 0===c)return void this.RenderPidOrPurl(a,!0,{complete:_.bind(function(){if(c=Cargo.Helper.GetPageViewById(a),unableToLoad=!1,void 0!==c)b&&b(c);else{unableToLoad=!0;var d=Cargo.Collection.Scaffolding.getModel({id:a});if(d){var e=Cargo.Collection.Scaffolding.getModel({id:d.get("set_id")});if(e&&e.get("stack")){var f=_.filter(e.get("pages").getMissingIndexes(),function(a){return a<=d.get("index")}),g=e.loadIndexes(f,{render_changes:!0});g&&(unableToLoad=!1,g.always(_.bind(function(){c=Cargo.Helper.GetPageViewById(a),void 0!==c?b&&b(c):Cargo.Modal.Alert({message:"Unable to load Page"})},this)))}}}unableToLoad&&Cargo.Modal.Alert({message:"Unable to load Page"})},this)});c&&b&&b(c)},render:function(a,b){if(b=b||{},_.defaults(b,{silent:!1,initial_render:!0,complete:function(){}}),this.removeCurrentView(),"set"===a.type)!0!==a.get("stack")||Cargo.Helper.IsAdminEdit()||this.collection.removeNonVisiblePages(),this.currentSet=Cargo.Core.SetViewFactory.constructSetView({model:a}),this.activeContentModel=a,this.currentSet.el.setAttribute("data-container","set"),this.currentSet.el.setAttribute("data-id",a.get("id")),this.el.appendChild(this.currentSet.el),this.currentSet.render(void 0,b),b.silent?this.checkActiveLinks(a.get("id")):(Cargo.Event.trigger("set_load_complete",a.get("id")),Cargo.Event.trigger("content_load_complete",a.get("id"))),a.get("__tag__")&&(Cargo.Event.trigger("tag_load_complete",a.get("__tag__")),Cargo.View.Main&&Cargo.View.Main.SetFeedClass()),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1),b.complete(a,b);else if("page"===a.type){var c=this.collection.getModel({id:a.get("set_id")}),d=a;this.activeContentModel=d,a=new Cargo.o.model.set({id:c.get("id"),pages:[d],stack:!1,is_set:!0,page_count:1}),this.currentSet=Cargo.Core.SetViewFactory.constructSetView({model:a}),this.currentSet.el.setAttribute("data-container","set"),this.currentSet.el.setAttribute("data-id",c.get("id")),this.el.appendChild(this.currentSet.el),this.currentSet.render(void 0,b),b.silent?this.checkActiveLinks(d.get("id")):(Cargo.Event.trigger("page_load_complete",d.get("id")),Cargo.Event.trigger("content_load_complete",d.get("id"))),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1),b.complete(d,b)}},RenderHomepage:function(a,b){return b=b||{},_.defaults(b,{silent:!1,complete:function(){},force_single:!0}),this.activeContentModel&&this.activeContentModel.get("id")===Cargo.Helper.GetHomepageId()&&!0===Cargo.Router.is_first_route&&!a?(b.complete(this.activeContentModel,b),void Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId())):Cargo.Helper.isFeed()?void((!0!==Cargo.Router.is_first_route||a)&&(this.RenderFeed(!0,b),!0!==b.silent&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()))):(this.collection.removeNonVisiblePages(),void(0===Cargo.Helper.GetHomepageId()?(this.removeCurrentView(),this.activeContentModel=this.collection.getModel({id:0}),!0!==b.silent&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()),b.complete(this.activeContentModel,b)):(b.complete=_.wrap(b.complete,_.bind(function(a){!0!==b.silent&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId());var c=Array.prototype.slice.call(arguments);c.shift(),a&&a.apply(b.context,c)},this)),this.RenderPidOrPurl(Cargo.Helper.GetHomepageId(),a,b))))},RenderFeed:function(a,b){b=b||{},_.defaults(b,{silent:!1}),this.collection.removeNonVisiblePages(),this.RenderPidOrPurl(0,a,b)},RenderPidOrPurl:function(a,b,c){if(c=c||{},_.defaults(c,{silent:!1,force_single:!1,force_set_render:!1,complete:function(){}}),!0===Cargo.Router.is_first_route&&!b)return void(Cargo.Router.is_first_route=!1);var d;return isNaN(Number(a))||"string"==typeof a&&0===Number(a)||(d=this.collection.getSetOrPageModel({id:Number(a)},Cargo.Helper.IsAdminEdit()&&!c.force_single)),d||(d=this.collection.getModelByPurl(a,Cargo.Helper.IsAdminEdit()&&!c.force_single)),d?c.force_set_render||Cargo.Helper.isFeed()||!0!==d.get("is_set")||!1!==d.get("stack")?void this.render(d,c):(this.hideActiveView(c),this.activeContentModel=d,c.silent||(Cargo.Event.trigger("content_load_complete",d.get("id")),Cargo.Event.trigger("set_load_complete",d.get("id"))),void c.complete(d,c)):void(c.from_async?(Cargo.Modal.Alert({message:"That page no longer exists"}),Cargo.Helper.HideLoadingAnimation()):this.loadSinglePage(a,_.bind(function(d){c.from_async=!0,this.RenderPidOrPurl.call(this,a,b,c)},this)))},loadSinglePage:function(a,b){this.collection.fetchPageModel(a,{done:_.bind(function(c){c.get("id")!=a&&(c.get("project_url")+"").toLowerCase()!=(a+"").toLowerCase()||b&&b(c)},this)})},ToggleFeed:function(a){a?this.RenderFeed(!0,{force_set_render:!0}):0===Cargo.Helper.GetHomepageId()?this.removeCurrentView():this.RenderPidOrPurl(Cargo.Helper.GetHomepageId(),!0)},removeCurrentView:function(){if(this.currentSet){this.activeContentModel=null;var a=this.currentSet;this.currentSet=null,a.remove(),this.checkActiveLinks(),Cargo.View.Main.SetWindowTitle(),Cargo.Event.trigger("content_view_removed")}this.el.innerHTML=""},hideActiveView:function(a){a=a||{},_.defaults(a,{silent:!1}),this.removeCurrentView(),Cargo.Helper.HideLoadingAnimation(),a.silent||Cargo.Event.trigger("content_view_closed")},initializePreRenderedSet:function(){var a=Cargo.Collection.Tags.findTagByUrl(Cargo.Helper.GetCurrentRoute().replace(window.location.search,""));if(_.each(this.el.children,function(b){var c=parseInt(b.getAttribute("data-id"),10),d=this.collection.getSetOrPageModel({id:Number(c)});if(!isNaN(c))if("set"===b.getAttribute("data-container")){var e=!!d&&d.get("stack");a&&!1===e?Cargo.Collection.Scaffolding.LoadTagCollection(a):d&&(this.activeContentModel=d,this.currentSet=Cargo.Core.SetViewFactory.constructSetView({el:b,model:d}),this.currentSet.render(!0),Cargo.Event.trigger("set_load_complete",d.get("id")),Cargo.Event.trigger("content_load_complete",d.get("id")),d.get("id")===Cargo.Helper.GetHomepageId()&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()),Cargo.Helper.isFeed()&&a&&Cargo.Event.trigger("thumbnails:load_tag",a.get("url"))),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1)}else if("page"===b.getAttribute("data-container")){if(!d)return void this.loadSinglePage(c,_.bind(function(a){this.initializePreRenderedSet()},this));var f=this.collection.getModel({id:d.get("set_id")}),g=d;d=new Cargo.o.model.set({id:f.get("id"),pages:[g],stack:!1,is_set:!0,page_count:1}),this.activeContentModel=g,this.currentSet=Cargo.Core.SetViewFactory.constructSetView({model:d}),this.currentSet.el.setAttribute("data-container","set"),this.currentSet.el.setAttribute("data-id",f.get("id")),b.parentNode.insertBefore(this.currentSet.el,b),this.currentSet.el.appendChild(b),this.currentSet.findAndInitializePrerenderedContent(),Cargo.Event.trigger("page_load_complete",g.get("id")),Cargo.Event.trigger("content_load_complete",g.get("id")),g.get("id")===Cargo.Helper.GetHomepageId()&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1)}},this),null===this.activeContentModel)if(Cargo.API.Config.direct_link_pid){var b=this.collection.getModel({id:Cargo.API.Config.direct_link_pid});b&&"set"===b.type&&(this.activeContentModel=b,Cargo.Event.trigger("content_load_complete",b.get("id")),Cargo.Event.trigger("set_load_complete",b.get("id")))}else a?Cargo.Collection.Scaffolding.LoadTagCollection(a):Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId());Cargo.API.Config.direct_link_pid=void 0},getPageViewById:function(a){if(this.currentSet)return _.filter(this.currentSet.getAllPageViews(),function(b){return b.model.get("id")==a})[0]},getFirstPageView:function(){if(this.currentSet)return _.filter(this.currentSet.getAllPageViews(),function(a){return!a.model.get("pin")})[0]},getLastPageView:function(){if(this.currentSet){var a=_.filter(this.currentSet.getAllPageViews(),function(a){return!a.model.get("pin")});return a[a.length-1]}},getActiveContentModel:function(){return this.activeContentModel},getActivePageViews:function(){return this.currentSet?this.currentSet.getAllPageViews():[]}}),Cargo.o.view.Page=Backbone.View.extend({parentView:null,template:$('[type="text/x-handlebars-template"]#page').html(),constructor:function(){Backbone.View.prototype.constructor.apply(this,arguments)},initialize:function(a){if(a&&a.parentView&&(this.parentView=a.parentView),a&&a.template&&(this.template=a.template),this.isAdminEdit=Cargo.Helper.IsAdminEdit(),void 0===this.model)return void console.warn("no model for page");this.listenTo(this,"remove",function(){this.removeBackdrop(),Cargo.Event.trigger("pageview_removed",this)}),this.listenTo(this.model,"change:backdrop_enabled",function(){this.model.get("backdrop_enabled")?this.addBackdrop():this.removeBackdrop(!1)}),Cargo.Event.trigger("pageview-initialized",this),this.listenTo(Cargo.Event,"image_gallery_init_complete",function(a){for(var b=!1,c=!1,d=0;d<a.length;d++)a[d]==this.model.get("id")&&(!Cargo.Helper.IsAdminEdit()&&Cargo.Model.DisplayOptions.get("layout_options").image_zoom&&(b=!0),c=!0);b&&this.setupLightbox(),c&&this.autoplayVideos()}),this.initialSetup()},events:{dragstart:"dragstart"},dragstart:function(a){if(Cargo.API.Config.cookie_url&&a.target.nodeType===Node.ELEMENT_NODE&&"IMG"===a.target.nodeName&&a.target.hasAttribute("data-mid")){var b=_.findWhere(this.model.get("images"),{id:parseInt(a.target.getAttribute("data-mid"))});if(b&&0==/(.*?)\.(svg)$/g.test(b.getOriginalImage().url)){var c={drag_image_src:a.target.getAttribute("src"),image_url:b.getOriginalImage().url,source_url:this.model.get("direct_link"),source_title:this.model.get("title")+" - "+Cargo.Model.Site.GetWebsiteTitle(),tags:""===this.model.get("tags")?[]:this.model.get("tags").split(", "),excerpt:this.model.get("excerpt")};a.dataTransfer.setData("cargo/imageselection",JSON.stringify(c))}}},removeBackdrop:function(a){!1!==a&&(a=!0),Backdrop.View.Backdrop.remove(this.model.get("id"),a)},addBackdrop:function(){this.model.get("backdrop")&&this.model.get("backdrop_enabled")&&Backdrop.View.Backdrop.add(this.model.get("id"),this.model.get("backdrop").backdrop_id,this.model.get("backdrop").backdrop_path)},initialSetup:function(){this.markNodesAsOriginal(),Cargo.Model.DisplayOptions.get("layout_options")&&Cargo.Model.DisplayOptions.get("layout_options").image_zoom&&this.setupLightbox(),this.removeEmptyPagePadding(),Cargo.Core.Embeds.findEmbedsIn(this.el),Cargo.Core.Ecommerce.findWidgets(this.el),Cargo.Core.AudioPlayer.findPlayers(this.el),Cargo.Core.ImageGallery.InitImageGallery({targetElement:this.el,forceReCollectionOfItems:!0}),this.trigger("initial-setup")},render:function(){if(this.preventRender)return void console.info("Prevented rendering of page",this.model.id);if(void 0===this.model)return void console.warn("no model for page");var a=Cargo.Core.Handlebars.ParseScriptTags(this.template),b=Cargo.API.GetDataPackage();_.extend(b,this.model.toJSON());var c,d=Cargo.Core.Handlebars.Render(a,b),e=document.createRange(),f=[];for(e.selectNode(document.body),c=e.createContextualFragment(d),_.each(c.querySelectorAll("script"),function(a){f.push({node:a,parentNode:a.parentNode,nextSibling:a.nextSibling}),a.parentNode.removeChild(a)}),this.el.innerHTML="";c.childNodes.length>0;)this.el.appendChild(c.childNodes[0]);var g=!1,h=function(a){g=!0};if(window.addEventListener("error",h,!1),_.each(f,function(a){g=!1;var b=$;$(a.node).on("load",function(){if($!==b){Cargo.Modal.Alert({message:"<em>External versions of jQuery are not supported. Please use the built-in version of jQuery</em>"});var a=this.ownerDocument.createComment(this.outerHTML);a.setSaveable(!0),this.parentNode.insertBefore(a,this),this.parentNode.removeChild(this),jQuery.noConflict(!0)}}),a.nextSibling&&a.nextSibling.parentNode===a.parentNode?a.parentNode.insertBefore(a.node,a.nextSibling):a.parentNode.appendChild(a.node),g&&(g=!1,a.node.parentNode.insertBefore(document.createComment(a.node.outerHTML),a.node),a.node.parentNode.removeChild(a.node),this.isAdminEdit&&Cargo.Modal.Alert({message:"<em>One or more scripts on this page are broken and were disabled.</em>"}))}),window.removeEventListener("error",h),1===this.el.children.length)if(null!==this.el.parentNode){var i=this.el.children[0];this.el.parentNode.insertBefore(i,this.el),this.el.parentNode.removeChild(this.el),this.setElement(i)}else this.setElement(this.el.children[0]);return this.$el.closest("[local-style]").attr("local-style",this.model.get("id")),this.initialSetup(),this.addBackdrop(),Cargo.Event.trigger("page_render_complete",this),this},setupLightbox:function(a){var b=/Mobi/i.test(navigator.userAgent),c=this.model.get("images");if(!this.isAdminEdit){for(var d=[],e=$("img",this.el),f=[],g=0;g<e.length;g++){var h=$(e[g]).closest(".image-gallery.initialized");if(h.length>0){f.length>0&&d.push(f),f=new Array;var i=h.find("img").toArray(),j=Cargo.Core.ImageGallery.imageGalleryObjects[h.attr("gid")];if(j&&!j.mobileSubviewActive&&"montessori"==j.options.path){var k=j.Subview.serialize();i=_.sortBy(i,function(a){var b=parseInt($(a).closest("[data-gallery-item-id]").attr("data-gallery-item-id"));return _.findWhere(k,{index:b}).meta.montessori.y})}else i=_.sortBy(i,function(a){return parseInt($(a).closest("[data-gallery-item-id]").attr("data-gallery-item-id"))});g+=i.length-1,d.push(i)}else f.push(e[g])}f.length>0&&d.push(f);var l=Cargo.Model.DisplayOptions.get("layout_options")&&!Cargo.Model.DisplayOptions.get("layout_options").image_full_zoom;$(d).each(function(a){var e=[];$(d[a]).each(function(){if($(this).is("[data-src]")&&0===$(this).closest("a").length&&!$(this).is("[data-no-zoom]")&&!$(this).is("[no-zoom]")&&0==$(this).closest(".slick-cloned").length){if(b){var a,d=_.findWhere(c,{id:parseInt(this.getAttribute("data-mid"))});if(d){a=Math.floor(Math.min(250*Math.ceil(2*screen.width/250),d.get("width")));var f=d.getImageWithOptions({w:a,q:94});this._lightboxSrc=f.url,this._lightboxWidth=f.w,this._lightboxHeight=f.h}}e.push(this),$(this).addClass("image-zoom").on("click.lightbox",function(a){var b=$(this).closest(".image-gallery");b&&b.is("[data-slideshow-in-transition]")||lightbox.openImageArray(e,this,{disableZoom:l})})}})})}},autoplayVideos:function(){var a=this.$el.find(".page_content").get(0);if(void 0!==a){var b=Cargo.Helper.isMobile();_.each(a.querySelectorAll("video[autoplay]"),function(a){a.hasAttribute("muted")&&(a.muted=!0),b&&!a.hasAttribute("playsinline")&&a.setAttribute("playsinline","");var c=a.play();void 0!==c&&c.then(function(){}).catch(function(b){a.setAttribute("controls","")})})}},getModel:function(){return this.model},markNodesAsOriginal:function(){var a=this.$el.find("projectcontent")[0];if(void 0!==a){Node.prototype.hasOwnProperty("setSaveable")&&this.getAllDescendants(a,function(a){a.setSaveable(!0)});var b=a.parentNode;for(b.setAttribute("data-ce-host","true"),b.setAttribute("data-ce-model-id",this.model.get("id"));a.childNodes.length>0;)b.insertBefore(a.childNodes[0],a);b.removeChild(a),0==b.querySelectorAll(".image-gallery").length&&this.autoplayVideos()}},getAllDescendants:function(a,b){for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c],e=b(d);if(!1===e)return!1;"continue"!==e&&this.getAllDescendants(d,b)}},removeEmptyPagePadding:function(){if((!Cargo.Helper.IsAdminEdit()||top.Backbone.history.fragment!=this.model.get("id"))&&$(".page_content",this.$el).length>0){var a=""==$(".page_content",this.$el).html().trim(),b=this.$el.find("[data-backdrop]").length>0;a&&!b&&$("bodycopy",this.$el).removeClass("content_padding")}},getLocalCSSElement:function(){return this.el.querySelector(".local-css")},remove:function(){if(this.preventRemove)return void console.info("Prevented removing of page",this.model.id);var a=$(".page_content",this.$el)[0];a&&Cargo.Helper.isMobile()&&_.each(a.querySelectorAll("video"),function(a){a.pause(),a.src="",a.innerHTML="",a.load()}),Cargo.Core.AudioPlayer.destroyPlayers(this.el),void 0!==Cargo.Helper.throttledScrollMonitorUpdate&&Cargo.Helper.throttledScrollMonitorUpdate(),Backbone.View.prototype.remove.apply(this,arguments)}}),Cargo.o.view.Set=Backbone.View.extend({constructor:function(){Backbone.View.prototype.constructor.apply(this,arguments)},initialize:function(a){this.parentSetView=a.parentSetView?a.parentSetView:null,null!==this.parentSetView&&this.listenTo(this.parentSetView,"remove",this.remove),this.listenTo(this,"remove",this.removeAllPages),this.listenTo(Cargo.Event,"pageview_removed",function(a){-1!==this.pageViews.indexOf(a)&&(this.pageViews=_.without(this.pageViews,a))});var b=!1;this.listenTo(this.model.get("pages"),"add",function(a,c,d){1==d.from_pagination?b=!0:!1!==d.render_changes&&this.render(!0,d)}),this.listenTo(this.model.get("pages"),"remove",function(a,b,c){var d=_.union(this.pageViews,this.setViews),e=_.findWhere(d,{model:a});e&&(e.remove(),this.pageViews=_.without(this.pageViews,e),this.setViews=_.without(this.setViews,e)),!0===c.render_changes&&this.render(!0,c),Cargo.Helper.throttledScrollMonitorUpdate()}),this.listenTo(Cargo.Event,"pagination_complete",function(a,c,d){b&&this.render(!0,d),b=!1}),this.listenTo(this.model,"tag_pagination_complete",function(a,c,d){b&&this.render(!0,d),b=!1}),this.listenTo(this.model,"destroy",function(){this.remove()}),this.pageViews=[],this.setViews=[],this.findAndInitializePrerenderedContent()},sortPagesAndUpdateDOM:function(){if(!(this.model.get("pages").length<=1)){this.model.get("pages").sort();var a=_.union(this.pageViews,this.setViews);a.sort(function(a,b){return a.model.get("sort")-b.model.get("sort")}),_.each(a,function(a){this.el.appendChild(a.el)},this)}},sortSetViews:function(){this.setViews.sort(function(a,b){return a.model.get("sort")-b.model.get("sort")})},sortPageViews:function(){this.pageViews.sort(function(a,b){return a.model.get("sort")-b.model.get("sort")})},removeAllPages:function(){_.each(this.pageViews,function(a){a.remove()}),this.pageViews=[]},removeAllSets:function(){_.each(this.setViews,function(a){a.remove()}),this.setViews=[]},render:function(a,b){b=b||{},_.defaults(b,{}),!0!==a&&(a=!1,this.removeAllPages(),this.removeAllSets());var c=!1,d=this.model.get("pages").getFirstIndexGap();this.model.get("pages").each(function(e,f,g){if("page"!==e.type||e.get("pin")){if("set"===e.type){if(a&&(void 0!==_.findWhere(this.setViews,{model:e})||void 0!==this.$el.children('[data-container="set"][data-id="'+e.get("id")+'"]')[0]))return;var h=Cargo.Core.SetViewFactory.constructSetView({parentSetView:this,model:e});h.el.setAttribute("data-container","set"),h.el.setAttribute("data-id",e.get("id")),this.el.appendChild(h.el),h.render(void 0,b),this.setViews.push(h),c=!0}}else{if(this.model.get("page_count")>1&&e.get("index")>d)return void console.warn("Pageview not rendered because set has gap before it.",e);if(a&&(void 0!==_.findWhere(this.pageViews,{model:e})||void 0!==this.$el.children('[data-container="page"][data-id="'+e.get("id")+'"]')[0]))return;var i;if(i="undefined"!=typeof __pin_preview_pageview__&&__pin_preview_pageview__.model===e?__pin_preview_pageview__:Cargo.Core.PageviewFactory.constructPageView({parentView:this,model:e}),a)if(f>0){var j=this.$el.children('[data-container][data-id="'+g[f-1].get("id")+'"]')[0];j?j.parentNode.insertBefore(i.el,j.nextSibling):0===e.get("index")&&Cargo.Helper.IsIndexableModel(e)?this.el.insertBefore(i.el,this.el.firstChild):this.el.appendChild(i.el)}else this.el.insertBefore(i.el,this.el.firstChild);else this.el.appendChild(i.el);i.render(),this.pageViews.push(i),c=!0}},this),c&&(this.sortPageViews(),this.sortSetViews(),Cargo.Event.trigger("set_render_complete",this,b))},findAndInitializePrerenderedContent:function(a){_.each(this.el.children,function(b){
var c=b.getAttribute("data-container"),d=parseInt(b.getAttribute("data-id"),10),e=this.model.get("pages").findWhere({id:d});if(isNaN(Number(a))||d===a){if(!e)return void Cargo.Collection.Scaffolding.fetchPageModel(d,{done:_.bind(function(a){a.get("id")===d&&(console.info("fetching",d,"success"),void 0!==this.model.get("pages").findWhere({id:d})?this.findAndInitializePrerenderedContent(d):console.info("can't locate newly added model."))},this)});if("set"===c){if(void 0===_.findWhere(this.setViews,{model:e})){var f=Cargo.Core.SetViewFactory.constructSetView({parentSetView:this,model:e,el:b});this.setViews.push(f)}}else if("page"===c&&void 0===_.findWhere(this.pageViews,{model:e})){var g=Cargo.Core.PageviewFactory.constructPageView({parentView:this,model:e,el:b});this.pageViews.push(g)}this.sortPageViews(),this.sortSetViews()}},this)},getAllPageViews:function(){function a(c){b=_.union(b,c.pageViews),_.each(c.setViews,a)}var b=[];return a(this),b},getAllSetViews:function(){function a(c){b=_.union(b,c.setViews),_.each(c.setViews,a)}var b=[];return a(this),b},remove:function(){this.preventRemove||(Cargo.Helper.throttledScrollMonitorUpdate(),Backbone.View.prototype.remove.apply(this,arguments))}}),Cargo.o.view.Pin=Backbone.View.extend({no_render:!1,Data:{tallest_height:null},initialize:function(a){this.count=0,this.debouncedSortElements=_.debounce(this.sortElements,10),this.position=this.$el.data("view").replace("pinned_",""),this.reversedSide="bottom",this.pinCollection=new Cargo.o.collection.pins(null,{position:this.position}),this.pinCollection.on("sort",this.debouncedSortElements,this),this.pinCollection.on("formatting_update_required",function(a,b){this.pinCollection.sort(),this.formatOverlayPages()},this),this.initializePreRenderedPins(),this.formatOverlayPages=_.throttle(this.formatOverlayPages,1),this.listenTo(Cargo.Event,"BaseUnit:refresh thumbnails_render_complete thumbnails_hide thumbnails_show pagination_complete inline-editor-load-complete set_render_complete",this.formatOverlayPages,this),this.listenTo(Cargo.Event,"homepage_loaded content_load_complete refresh_pins mobile_breakpoint_triggered",function(){this.render(Cargo.Helper.GetCurrentProjectId(),!0)}),this.listenTo(Cargo.Event,"content_view_removed",function(){"bottom"===this.position&&this.hideAndShowBottomPinsAfterImageInit()}),this.formatOverlayPages(),"bottom"===this.position&&this.hideAndShowBottomPinsAfterImageInit()},hideAndShowBottomPinsAfterImageInit:function(){!0!==this.bottom_pins_hidden&&"top"!=this.position&&(this.el.style.visibility="hidden",this.bottom_pins_hidden=!0,this.listenToOnce(Cargo.Event,"image_gallery_init_complete",function(){this.bottom_pins_hidden=!1,this.el.style.visibility=""}),setTimeout(_.bind(function(){!0===this.bottom_pins_hidden&&(this.bottom_pins_hidden=!1,this.el.style.visibility="")},this),500))},initializePreRenderedPins:function(a){var b=[];this.$el.find('[data-container="content"]').each(_.bind(function(a,c){var d=parseInt($(c).data("id")),e=Cargo.Collection.Scaffolding.getModel({id:d});if(e){var f=new Cargo.o.view.Page({template:$('[type="text/x-handlebars-template"]#pin').html(),parentView:this,model:e,el:c.parentNode});b.push({id:d,pageView:f})}},this)),this.pinCollection.add(b);var c=this.filterMobilePins(this.pinCollection.models);this.pinCollection.remove(_.pluck(c,"id"))},render:function(a,b){b=!0===b;var c,d,e,f=_.union(this.collection.getPinsByPositionSetId(this.position,!1),this.collection.getPinsByPositionSetId(this.position,a)),g=this.pinCollection.pluck("pageModel");e=this.filterMobilePins(f,!0),b||(this.pinCollection.reset(),e=this.filterMobilePins(this.pinCollection.models)),f=_.filter(f,function(a){return-1==e.indexOf(a)}),c=_.difference(g,f),c=_.union(c,e),d=_.difference(f,g),_.difference(g,c,d),c.length>0||d.length;var h,i=[];_.each(d,function(a){"undefined"!=typeof __pin_preview_pageview__&&__pin_preview_pageview__.model===a?(h=__pin_preview_pageview__,h.stopListening(a)):h=new Cargo.o.view.Page({template:$('[type="text/x-handlebars-template"]#pin').html(),parentView:this,model:a}),this.el.appendChild(h.el),h.render(),i.push({id:a.get("id"),pageView:h})},this),this.pinCollection.remove(_.pluck(c,"id")),this.pinCollection.add(i),(c.length>0||d.length>0)&&this.sortElements(),void 0!==Cargo.View.Content.activeLinkPID&&Cargo.View.Content.checkActiveLinks(Cargo.View.Content.activeLinkPID),(c.length>0||d.length>0)&&Cargo.Event.trigger("pin_load_complete")},filterMobilePins:function(a,b){var c=document.documentElement.clientWidth,d=Cargo.Helper.IsMobileWindowSize(c),e=void 0!==Cargo.Helper.GetCurrentRoute()?Cargo.Helper.GetCurrentRoute():window.location.pathname.replace(/\//g,"");return _this=this,_.filter(a,function(a){if(Cargo.__admin_pid_required__===a.get("id"))return!1;var c=b?a:a.get("pageModel"),f=c.get("project_url"),g=c.getPinOption("exclude_mobile");if(e==f)var h=!0;return d&&g&&!h})},sortElements:function(){this.pinCollection.each(function(a){this.el.appendChild(a.get("pageView").el)},this),this.formatOverlayPages()},getPageViewById:function(a){var b=this.pinCollection.findWhere({id:a});if(void 0!==b)return b.get("pageView")},formatOverlayPages:function(){this.formatting||(this.formatting=!0,this.levelKeys=_.keys(this.pinCollection.levels),this.pinCollection.each(function(a){var b=window.getComputedStyle(a.get("pageView").el,null),c=parseFloat(b.height)-parseFloat(b.paddingTop)-parseFloat(b.paddingBottom);a.set({page_height:c}),this.setPagePointerEvents(a.get("pageModel"),a.get("pageView").$el)},this),this.accommodatePages(),this.setHeightPerLevel(),this.positionPages(),this.setContainerHeight(),this.setContentContainerHeightforBottomPins(),Cargo.Event.trigger("pin_format_complete",this.position),this.formatting=!1,this.allowFixedSiteMenuToScroll())},allowFixedSiteMenuToScroll:function(){if(Cargo.View.SiteMenu&&Cargo.Helper.isMobile()&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)&&1==this.pinCollection.length&&1==Cargo.View.SiteMenu.collection.length&&this.pinCollection.models[0].get("id")==Cargo.View.SiteMenu.collection.models[0].get("id")&&Cargo.Router._lastFrag==Cargo.View.SiteMenu.collection.models[0].get("project_url")){this.pinCollection.models[0].get("pageView").$el.removeClass("overlay fixed"),this.$el.css("height","")}},setContainerHeight:function(){var a=0;_.each(this.pinCollection.levels,function(b,c){a+=parseFloat(b.overall_height)}),this.$el.css("height",a)},setContentContainerHeightforBottomPins:function(){var a=$(".content_container"),b=!1;if(Cargo.Helper.IsAdminEdit()&&void 0!==parent&&void 0!==parent.Cargo&&void 0!==parent.Cargo.Editor&&void 0!==parent.Cargo.Editor.View&&void 0!==parent.Cargo.Editor.View.ContentView&&"editproject"===parent.Cargo.Editor.View.ContentView.id&&void 0!==Cargo.View.Content){_.each(Cargo.View.Content.getActivePageViews(),function(a){a.model.id==Cargo.Helper.GetHomepageId()&&(b=!0)});void 0===_.findWhere(this.pinCollection.models,{id:parent.Cargo.Editor.View.ContentView.pid})||"bottom"!=this.pinCollection.position||b?a.removeClass("full_height"):a.addClass("full_height")}else a.removeClass("full_height")},setHeightPerLevel:function(){var a=this;_.each(this.pinCollection.levels,function(b,c){var c=parseInt(c,10);if(0!==b.models.length){var d=0;self_accommodating=void 0!==b.tallest&&b.tallest.get("accommodate_same_set"),height_pages=_.filter(b.models,function(a){var c=a.getPinOptions(),d=!c.overlay&&!c.fixed,e=self_accommodating&&a==b.tallest;return d||e}),_.each(height_pages,function(a){d+=a.get("page_height")});var e=_.filter(b.models,function(b){if(void 0!==b.get("accommodated_by_pid")){return a.getPageDepthByPid(b.get("accommodated_by_pid"))!==c}})[0];void 0!==e&&(d+=e.get("page_padding")),b.overall_height=d}})},positionPages:function(){var a=this,b=this.position;opposite_position="bottom"==this.position?"top":"bottom",this.pinCollection.each(function(c){var d=0,e=c.getPinOptions(),f=(c.get("id"),!e.fixed&&!e.overlay),g=!1,h=c.get("depth"),i=(c.get("sort"),a.levelKeys[a.levelKeys.indexOf(h+"")+1]),j=a.levelKeys[a.levelKeys.indexOf(h+"")-1],k=(a.pinCollection.levels[i],a.pinCollection.levels[j]),l=a.pinCollection.levels[h];if("bottom"==b){for(var m=0;m<=h;m++){var n=a.pinCollection.levels[m-1];void 0!==n&&(void 0===n.tallest||n.tallest.get("accommodated_next_set")?void 0==n.tallest&&(d+=n.overall_height):d+=n.overall_height)}f?k&&void 0==k.tallest?d-=k.overall_height:k&&void 0!==k.tallest&&k.tallest.get("accommodate_same_set")?d-=k.overall_height:0==h&&l&&l.tallest&&l.tallest.get("accommodate_same_set")&&(d-=l.tallest.get("page_height")):g=!0}else{for(var m=0;m<=h;m++)void 0!==a.pinCollection.levels[m-1]&&(d+=a.pinCollection.levels[m-1].overall_height);f?k&&void 0==k.tallest?d-=k.overall_height:k&&void 0!==k.tallest&&k.tallest.get("accommodate_same_set")?d-=k.overall_height:void 0!==l.tallest&&l.tallest.get("accommodate_same_set")&&void 0!==k&&void 0!==k.tallest&&k.tallest.get("id")!==c.get("accommodated_by_pid")&&(d+=k.tallest.get("page_height")):g=!0}g&&h>0&&void 0!==j&&void 0!==k&&void 0!==k.tallest&&k.tallest.get("id")!==c.get("accommodated_by_pid")&&1==l.accommodated_by_previous_set&&(d+=k.tallest.get("page_height"));var o=c.get("pageView").$el[0];if(o.style[b]=d+"px",o.style[opposite_position]="",e.overlay){var p=0;if(void 0!==l)var q=l.models.slice().reverse(),p=q.indexOf(c);o.style.zIndex=a.pinCollection.deepestLevel+-h+4+p}})},removeModelFlags:function(){_.each(this.pinCollection.models,function(a){a.unset("accommodated_by_pid")})},removeLevelFlags:function(){_.each(this.pinCollection.levels,function(a,b){void 0!==a.accommodated_by_previous_set&&(a.accommodated_by_previous_set=!1),void 0!==a.accommodated_by_same_set&&(a.accommodated_by_same_set=!1)})},accommodatePages:function(){this.removeAccommodatePadding(),this.removeModelFlags(),this.removeLevelFlags();var a=this.position,b=this;_.each(this.pinCollection.levels,function(c,d){if(0!==c.models.length&&(d=parseInt(d,10),next_depth=b.levelKeys[b.levelKeys.indexOf(d+"")+1],prev_depth=b.levelKeys[b.levelKeys.indexOf(d+"")-1],c.tallest&&(c.tallest.unset("accommodate_same_set"),c.tallest.unset("accommodated_next_set"),c.tallest.unset("accommodated_pin"),c.tallest.unset("accommodated_pid"),c.tallest.unset("content_accommodate_page")),c.tallest=void 0,_.each(c.models,function(a){var b=a.getPinOptions();b.overlay&&b.accommodate&&(!c.tallest||a.get("page_height")>c.tallest.get("page_height"))&&(c.tallest=a)}),void 0!=c.tallest)){var e=this.reversedSide,f=_.filter(c.models,function(a){var b=a.getPinOptions();return!b.overlay&&!b.fixed}).sort(function(b,c){return a==e?c.get("sort")-b.get("sort"):b.get("sort")-c.get("sort")})[0];if(f)return this.accommodateSinglePage(f,c.tallest),c.tallest.set({accommodate_same_set:!0,accommodated_pin:!0,accommodated_pid:f.get("id")}),void(c.accommodated_by_same_set=!0);var g=this.pinCollection.levels[next_depth];if(g){var h=_.filter(g.models,function(a){return a.getPinOptions().overlay}).sort(function(b,c){return a==e?c.get("sort")-b.get("sort"):b.get("sort")-c.get("sort")})[0];if(void 0==h&&(h=_.filter(g.models,function(a){return!a.getPinOptions().overlay}).sort(function(b,c){return a==e?c.get("sort")-b.get("sort"):b.get("sort")-c.get("sort")})[0]),h)return this.accommodateSinglePage(h,c.tallest),g.accommodated_by_previous_set=!0,void c.tallest.set({accommodated_pin:!0,accommodated_pid:h.get("id"),accommodated_next_set:!0})}d===this.pinCollection.deepestLevel&&(this.accommodateSinglePagebyElement($(this.getContentContainerElementToAccommodate()),c.tallest.get("page_height")),c.tallest.set("content_accommodate_page",!0))}},this)},removeAccommodatePadding:function(){var a="padding-"+this.position;this.pinCollection.each(function(b){b.get("page_padding")>0&&(b.get("pageView").$el.css({"padding-top":"","padding-bottom":"",top:"",bottom:""}).removeAttr("data-"+a),b.set("page_padding",0))}),$("[data-"+a+"]").css(a,"").removeAttr("data-"+a),$("[data-content-accommodated]").css(a,"").removeAttr("data-content-accommodated")},accommodateSinglePage:function(a,b){var c=b.get("page_height"),d="padding-"+this.position;a.get("pageView").$el.css(d,c).attr("data-"+d,!0),a.set({page_padding:c,accommodated_by_pid:b.get("id")})},getContentContainerElementToAccommodate:function(){var a,b,c=$('.content_container [data-container="page"]');c.length>0&&(a=c.get(0),b=c.get(c.length-1));var d=!1,e=Cargo.View.Thumbnail;return e&&(d=Cargo.View.Thumbnail.show_thumbs),"top"==this.position?a||(d?e.el:void 0):"bottom"==this.position?d&&e?e.el:b||void 0:void 0},accommodateSinglePagebyElement:function(a,b){var c="padding-"+this.position;if($(a).css(c,b).attr("data-"+c,!0).attr("data-content-accommodated",!0),void 0!==$(a).attr("data-id")){var d=_.findWhere(this.current_page_models,{id:$(a).attr("data-id")});void 0!==d&&d.set("page_padding",b)}},setPagePointerEvents:function(a,b){if(a.get("pin_options").overlay){var c=b.find(".bodycopy")[0],d=this.hasNoBackgroundColor(b.find(".page_background")[0]),e=this.hasNoBackgroundColor(b.find(".page")[0]),f=void 0!==c&&parseFloat(window.getComputedStyle(b.find(".bodycopy")[0]).height)>window.innerHeight;if(!b.find(".page_background")[0])return;0==a.get("backdrop_enabled")&&(d?b.addClass("pointer-events-none"):b.removeClass("pointer-events-none"),e&&!f||!a.get("pin_options").fixed?b.find(".page").removeClass("pointer-events-auto"):b.find(".page").addClass("pointer-events-auto")),f&&a.get("pin_options").fixed?b.find(".page").addClass("allow-scroll"):b.find(".page").removeClass("allow-scroll")}},hasNoBackgroundColor:function(a){if(void 0==a)return!1;var b=window.getComputedStyle(a,null),c=b.getPropertyValue("background-color"),d=c.match("rgba")?alpha=c.replace(/^.*,(.+)\)/,"$1"):null;return void 0==c||"transparent"==c||"initial"==c||0==d},getPageDepthByPid:function(a){return this.pinCollection.findWhere({id:parseInt(a)}).get("depth")}}),Cargo.o.view.SiteMenu=Backbone.View.extend({template:$('[type="text/x-handlebars-template"]#sitemenu').html(),events:{'click [rel="history"]':"navigate",'click [rel="home_page"]':"navigateHome",click:"close",touchstart:"close","click .close":"hide"},enabled:null,initialize:function(a){Cargo.Event.on("content_load_complete",_.bind(this.hide,this)),Cargo.Event.on("homepage_loaded",_.bind(this.hide,this)),this.collection.fetch()},generateSiteMenuTree:function(){var a=Cargo.Collection.Scaffolding.getSetStructure(),b=this.collection.toJSON();for(_.each(a._byId,function(a){a.in_nav=void 0!==_.findWhere(b,{id:a.id}),a.has_children=!1}),i=0;i<b.length;i++)menuItem=b[i],"set"!==menuItem.type?a._byId[menuItem.set_id]&&(a._byId[menuItem.set_id].has_children=!0,a._byId[menuItem.set_id].pages.push(menuItem)):i>0&&(a._byId[menuItem.id].previous_type=b[i-1].is_set?"set":"page");_.each(a._byId,function(a){a.pages.sort(function(a,b){return a.sort-b.sort})}),this.SiteMenuTree=a.tree,a=null},render:function(a){this.SiteMenuTree||this.generateSiteMenuTree(),this.site_menu_options=Cargo.Model.DisplayOptions.get("site_menu_options");var b=this.site_menu_options.display_type;if("page"!=b){var c=Cargo.API.GetDataPackage("site_menu_tree",this.SiteMenuTree);c=_.extend(c,{is_page:b});var d=Cargo.Core.Handlebars.Render(this.template,c);return $("#site_menu_panel_container",this.el).empty().show().html(d),$("html").addClass("no-scroll"),this.delegateEvents(),this.setActivePage(),this}},isActive:function(){return this.enabled},renderSinglePageView:function(a){var b=$("#site_menu_panel_container")[0];if(b){var c=Cargo.Core.PageviewFactory.constructPageView({model:a});b.innerHTML="",b.appendChild(c.el),b.style.display="",c.render(),c.$el.on("click",function(c){0==$(c.target).closest('[data-container="content"]').length&&0==a.get("backdrop_enabled")&&(b.style.display="none")})}},setActivePage:function(a){Cargo.Helper.IsOnHomepage()&&$('[rel="home_page"]',this.el).addClass("active");var b=Cargo.Helper.GetCurrentProjectUrl();$('[href="'+b+'"]',this.el).addClass("active")},show:function(a,b){var c;void 0!==a?(a.preventDefault(),c=$(a.currentTarget)):void 0!==b&&(c=b);var d=Cargo.Model.DisplayOptions.get("site_menu_options");return void 0!==c&&c.is("#site_menu_button")&&c[0].hasAttribute("href")?void("/"!==c.attr("href")?(Cargo.Event.trigger("add_history",c.attr("href")),this.enabled=!0):Cargo.Modal.Alert({message:"That page no longer exists"})):"page"==d.display_type?(Cargo.Event.trigger("add_history",d.single_page_id),void(this.enabled=!0)):($("#site_menu_button",this.el)[0].style.display="none",this.render(a),$("body")[0].style.overflow="hidden",void(this.enabled=!0))},hide:function(){var a=Cargo.Model.DisplayOptions.get("site_menu_options");$("#site_menu_panel_container",this.el)[0].style.display="none","page"===a.display_type&&a.single_page_id==parseInt(Cargo.Helper.GetCurrentProjectId())?setTimeout(_.bind(function(){this.enabled=!0,$("#site_menu_button",this.el)[0].style.display="none"},this),1):(this.enabled=!1,$("#site_menu_button",this.el)[0].style.display=""),$("body")[0].style.overflow=""},close:function(a){"site_menu_panel"==$(a.target).attr("id")&&this.hide()},navigate:function(a){Cargo.View.Main.HistoryPush(a),this.isActive()&&this.hide()},navigateHome:function(a){Cargo.View.Main.ShowHome(a),this.hide()},updateTitle:function(a,b){"page"==Cargo.Model.DisplayOptions.get("site_menu_options").display_type&&$("#site_menu_button",this.el).attr("href",b)},changeDisplayType:function(a,b,c){$("[data-type]",this.el).attr("data-type",a),this.$el.attr("data-type",a),"cargo_menu"==a?$("#site_menu_button",this.el).removeAttr("href"):this.UpdateSinglePageLink(b)},UpdateSinglePageLink:function(a){var b=Cargo.Collection.Scaffolding.getSetOrPageModel({id:Number(a)},!1);if(b)$("#site_menu_button",this.el).attr("href",b.get("project_url"));else{var c=this;Cargo.Collection.Scaffolding.fetchPageModel(a,{done:function(a,b){$("#site_menu_button",c.el).attr("href",a.get("project_url"))}})}}}),Cargo.o.view.Following=Backbone.View.extend({className:"persona-following-root",fauxFixedElements:[],animationDuration:600,animationInProgress:!1,followingWidth:"400px",enabled:!1,iframeLoadInitialized:!1,iframeLoaded:!1,section:!1,slideData:{delta:1,offset:0,lastOffset:0,closing:!0},initialize:function(){this.isInAdminOrPreviewMode=Cargo.Helper.IsAdminPath()||Cargo.Helper.IsAdminEdit()||Cargo.Helper.IsPresetPreview(),this.messageQueue=[],this.contentFrame=document.createElement("iframe"),this.contentFrame.id="following-frame",this.contentFrame.style.display="none",this.contentFrame.style.border="none",this.contentFrame.name="following-frame",this.followingOverlay=document.createElement("div"),this.followingOverlay.id="following-overlay",this.followingOverlay.style.display="none",this.followingOverlay.style.cursor="pointer",this.followingOverlay.style.position="fixed",this.followingOverlay.style.top=0,this.followingOverlay.style.left=0,this.followingOverlay.style.right=0,this.followingOverlay.style.bottom=0,this.followingOverlay.style.zIndex=2147483637,this.followingOverlay.addEventListener("click",_.bind(this.close,this)),document.body.appendChild(this.followingOverlay),$("html").append(this.render().el);var a=document.createElement("div");a.id="following-container",this.el.parentNode.insertBefore(a,this.el),a.appendChild(this.el),this.container=$(a),this.contentFrame=$(this.contentFrame),/^\/?follow/.test(document.location.pathname)||/^\/?contact-form/.test(document.location.pathname)||/^\/?cart/.test(document.location.pathname)||$(window).load(_.bind(this.loadFrameSection,this))},render:function(){return this.setElement(this.contentFrame),this},triggerEventInFrame:function(a,b){if(this.messageQueue)return this.iframeLoaded&&this.el.contentWindow&&this.el.contentWindow.Following?void this.el.contentWindow.Following.Events.trigger(a,b):void this.messageQueue.push(arguments)},Toggle:function(){if(!0!==this.animationInProgress)if(this.enabled)(void 0==Cargo.Router.previousSiteRoute||Cargo.Router.previousSiteRoute.match(/following/g)||Cargo.Router.previousSiteRoute.match(/followers/g)||Cargo.Router.previousSiteRoute.match(/contact-form/g)||Cargo.Router.previousSiteRoute.match(/cart/g))&&(Cargo.Router.previousSiteRoute="/"),Cargo.Router.navigate(Cargo.Router.previousSiteRoute,{trigger:!1}),this.disable();else{Cargo.Event.trigger("add_history","following");var a=parent.document.getElementById("login_frame");null!==a&&a.parentNode.removeChild(a)}},loadSection:function(a,b){this.enabled||this.enable(b),this.loadFrameSection(a,b)},loadFrameSection:function(a,b){this.isInAdminOrPreviewMode&&!0!==b||(!0!==this.iframeLoadInitialized?($(this.contentFrame).on("load",_.bind(function(){this.iframeLoaded=!0,this.messageQueue.length>0&&this.el.contentWindow.Following.Events.on("init-complete",function(){_.each(this.messageQueue,function(a){this.triggerEventInFrame.apply(this,a)},this),this.messageQueue=[]},this)},this)),this.contentFrame.attr("src","/followingframe/"+Cargo.Helper.GetUrl()+("string"==typeof a?"/"+a:"")+"?"+__cargo_js_ver__),this.iframeLoadInitialized=!0):this.el.contentWindow&&void 0!==this.el.contentWindow.Following&&void 0!==this.el.contentWindow.Following.View&&void 0!==this.el.contentWindow.Following.View.Main?(void 0==a&&void 0!==this.el.contentWindow.Following.View.Main.start_route&&(a=this.el.contentWindow.Following.View.Main.start_route),this.el.contentWindow.Following.Router.navigate(a,{trigger:!0,replace:!0})):this.contentFrame.attr("src","/followingframe/"+Cargo.Helper.GetUrl()+("string"==typeof a?"/"+a:"")+"?"+__cargo_js_ver__))},updateCookieData:function(){this.el.contentWindow&&void 0!==this.el.contentWindow.Following&&this.el.contentWindow.Following.Model.Default.fetch()},resizeListener:function(a){var b=document.getElementsByTagName("html")[0],c=window.innerWidth+"px",d=window.innerHeight+"px";!0===a&&(c="",d=""),b.style.width=c,b.style.height=d,document.body.style.width=c,document.body.style.height=d,$(window).width()>500?this.followingWidth="400px":this.followingWidth=$(window).width()-40+"px",this.enabled&&(document.body.style.setProperty("transform","translateX(-"+this.followingWidth+")"),document.body.style.setProperty("-webkit-transform","translateX(-"+this.followingWidth+")")),$("#following-container").css({width:this.followingWidth,height:d})},enable:function(a){if((!this.isInAdminOrPreviewMode||!0===a)&&!0!==this.animationInProgress){document.body,document.getElementsByTagName("html")[0];if(this.fixedElements=this.getFixedElements(),$('<div id="following-container-overlap" />').insertAfter(this.$el.parent()),this.animationInProgress=!0,this.scrollAnchor=document.createElement("div"),this.scrollPos=window.scrollY,this.inlineStyles=document.createElement("style"),this.tempInlineStyles=document.createElement("style"),this.scrollAnchor.style.position="absolute",this.scrollAnchor.style.width="0px",this.scrollAnchor.style.height="0px",this.scrollAnchor.style.top=this.scrollPos+"px",document.body.appendChild(this.scrollAnchor),document.body.appendChild(this.tempInlineStyles),document.body.appendChild(this.inlineStyles),Cargo.Router.is_first_route)return this.direct_route=!0,this.prepareElementsForAnimation(),void this.realEnable();window.requestAnimationFrame(_.bind(function(){this.prepareElementsForAnimation(),window.setTimeout(_.bind(function(){window.requestAnimationFrame(_.bind(this.realEnable,this))},this),150)},this))}},prepareElementsForAnimation:function(){var a=document.body,b=document.getElementsByTagName("html")[0];this.tempInlineStyles.sheet.insertRule(".backdrop > div > * { \t-webkit-transform: translateZ(0);\t\t\ttransform: translateZ(0);}",0),a.style.setProperty("z-index","1"),a.style.setProperty("transform","translateZ(0)"),a.style.setProperty("-webkit-transform","rotateZ(0)"),a.style.setProperty("min-height",window.innerHeight+"px"),b.style.setProperty("transform","translateZ(0)"),b.style.setProperty("-webkit-transform","rotateZ(0)"),b.style.setProperty("min-height",window.innerHeight+"px"),this.container.css({transform:"translateX("+this.followingWidth+")","-webkit-transform":"translateX("+this.followingWidth+")"}),this.contentFrame.css({transform:"translateX(-"+this.followingWidth+")","-webkit-transform":"translateX(-"+this.followingWidth+")"}),this.resizeListener(),this.fixFixedElements(this.fixedElements),this.fixedElements=void 0,a.style.setProperty("position","fixed"),a.style.setProperty("overflow","hidden"),b.style.setProperty("position","fixed"),b.style.setProperty("overflow","hidden"),setTimeout(_.bind(function(){this.resizeListener()},this),150),this.scrollAnchor.scrollIntoView()},realEnable:function(){this.triggerEventInFrame("frame-animation-starting",{});var a=this;this.inlineStyles.sheet.insertRule("#following-container { \twidth: "+this.followingWidth+";\theight: 100%;\tposition: absolute;\ttop: 0;\tbottom: 0;\tright: 0;}",0),this.scrollAnchor.scrollIntoView(),this.resizeListener=_.bind(this.resizeListener,this),window.addEventListener("resize",this.resizeListener,!1),this.scrollAnchor.parentNode.removeChild(this.scrollAnchor),this.scrollAnchor=void 0;var b=this.direct_route?0:a.animationDuration;try{null!==this.contentFrame[0].contentWindow.document.body&&(this.contentFrame[0].contentWindow.document.body.style.display="none",setTimeout(function(){a.contentFrame[0].contentWindow.document.body.style.display="block"}))}catch(a){console.info(a)}$("body, #following-container-overlap").velocity({translateX:"-"+a.followingWidth,translateZ:0},{duration:b,easing:[29,9],complete:function(){a.enabled=!0,a.animationInProgress=!1,a.enableClickToClose(),a.tempInlineStyles.sheet.disabled=!0,a.direct_route=!1,_.each(Cargo.Plugins.elementResizer.targets(),function(a){_.each(a.children,function(a){a&&a.element&&a.element[0]._scrollWatcher&&!a.element[0].hasAttribute("src")&&a.element[0]._scrollWatcher.recalculateLocation()})}),scrollMonitor.update(),$("#following-container-overlap").remove()}}),this.container.velocity({translateX:[0,parseInt(this.followingWidth)],tween:[0,1]},{duration:b,easing:[29,9],progress:function(b,c,d,e,f){f<0&&a.container.css({transform:"translateX(0px)","-webkit-transform":"translateX(0px)"})}}),this.contentFrame.velocity({translateX:[0,-parseInt(this.followingWidth)],tween:[0,1]},{duration:b,easing:[29,9],progress:function(b,c,d,e,f){f<0&&a.contentFrame.css({transform:"translateX(0px)","-webkit-transform":"translateX(0px)"})}}),this.el.style.display=""},enableClickToClose:function(){this.followingOverlay.style.display="block"},disableClickToClose:function(){this.followingOverlay.style.display="none"},slideStart:function(a){$(window).on("mousemove touchmove",{slideData:this.slideData,slideEnd:_.bind(this.slideEnd,this),offset:a.clientX,width:this.followingWidth},this.slideMove)},slideMove:function(a){a.preventDefault();var b=a.data.slideData,c=0,d=parseInt(a.data.width);c=event.touches?event.touches[0].clientX-a.data.offset:a.clientX-a.data.offset;var e=d-c;b.delta=1-Math.abs(c-b.offsetLast)/30*1,b.delta<.3?b.delta=.3:b.delta>1&&(b.delta=1),c<0?e=d:e<0&&(e=0,a.data.slideEnd()),$("body, #following-container-overlap").velocity("stop").velocity({translateX:-1*e},1),b.closing=c>=b.offsetLast,b.offsetLast=c},slideEnd:function(a){this.slideData.closing?this.close():$("body, #following-container-overlap").velocity("stop").velocity({translateX:"-"+this.followingWidth,translateZ:0},{duration:this.animationDuration*this.slideData.delta,easing:[29,9]}),$(window).off("mousemove touchstart",this.slideMove),this.slideData.closing=!0,this.slideData.offsetLast=0,this.slideData.delta=1},close:function(){this.Toggle()},disable:function(){window.requestAnimationFrame(_.bind(this.realDisable,this))},realDisable:function(){if(!0!==this.animationInProgress){this.animationInProgress=!0,window.focus(),void 0!==this.el.contentWindow.Following&&this.el.contentWindow.Following.Events.trigger("disable");var a=this;this.tempInlineStyles&&this.tempInlineStyles.sheet&&(this.tempInlineStyles.sheet.disabled=!1),$("body, #following-container-overlap").velocity({translateX:0,translateZ:0},{begin:function(){$(this).css("cursor","auto")},duration:this.animationDuration*this.slideData.delta,easing:[25,8.5],complete:function(){a.enabled=!1,a.animationInProgress=!1,$(this).css({transform:"","-webkit-transform":""}),a.unfixFixedElements(),void 0!==a.inlineStyles&&(a.inlineStyles.sheet.disabled=!0,a.inlineStyles.parentNode.removeChild(a.inlineStyles)),void 0!==a.tempInlineStyles&&(a.tempInlineStyles.sheet.disabled=!0,a.tempInlineStyles.parentNode.removeChild(a.tempInlineStyles));var b=document.body,c=document.getElementsByTagName("html")[0];b.style.setProperty("z-index",""),b.style.setProperty("transform",""),b.style.setProperty("-webkit-transform",""),b.style.setProperty("min-height",""),c.style.setProperty("transform",""),c.style.setProperty("-webkit-transform",""),c.style.setProperty("min-height",""),b.style.setProperty("position",""),b.style.setProperty("overflow",""),c.style.setProperty("position",""),c.style.setProperty("overflow",""),a.resizeListener(!0),window.scrollTo(0,a.scrollPos),window.removeEventListener("resize",a.resizeListener,!1),a.disableClickToClose(),a.el.style.display="none"}}),this.container.velocity({translateX:[parseInt(this.followingWidth),0]},{duration:this.animationDuration*this.slideData.delta,easing:[25,8.5]}),this.contentFrame.velocity({translateX:[-parseInt(this.followingWidth),0]},{duration:this.animationDuration*this.slideData.delta,easing:[25,8.5]})}},isActive:function(){return this.enabled},getFixedElements:function(a){void 0===a&&(a=window.document);var b,c,d,e,f,g,h,i=['[style*="position:fixed"],[style*="position: fixed"]'],j=/\bposition:\s*fixed;/,k=a.styleSheets,l=[];for(c=0;c<k.length;c++){try{f=k[c].cssRules}catch(a){continue}if(null!==f)for(e=f.length,d=0;d<e;d++)g=f[d],j.test(g.cssText)&&void 0!=g.selectorText&&i.push(g.selectorText)}for(i=i.join(","),i=a.querySelectorAll(i),e=i.length,c=0;c<e;c++)h=i[c],b=window.getComputedStyle(h,null),"fixed"===b.getPropertyValue("position")&&l.push({el:h,offset:{left:isNaN(parseInt(b.getPropertyValue("left")))?0:parseInt(b.getPropertyValue("left")),top:isNaN(parseInt(b.getPropertyValue("top")))?0:parseInt(b.getPropertyValue("top"))},webkitTransformMatrix:"none"===b.getPropertyValue("-webkit-transform")?"":b.getPropertyValue("-webkit-transform"),transformMatrix:"none"===b.getPropertyValue("transform")?"":b.getPropertyValue("transform"),styleAttribute:h.getAttribute("style")});return l},fixFixedElements:function(a){var b=this;this.unfixFixedElements();var c={top:$(window).scrollTop(),left:$(window).scrollLeft()};lastScrollPos=c.top,void 0===a&&(a=this.getFixedElements()),Cargo.Helper.isEdge()&&(c.top=0),this.scrollOffset=c,a.forEach(function(a){a.el.style.setProperty("transform","translateY("+c.top+"px) "+a.transformMatrix,"important"),a.el.style.setProperty("-webkit-transform","translateY("+c.top+"px) "+a.webkitTransformMatrix,"important"),a.el.style.setProperty("transition","none","important"),a.el.style.setProperty("-webkit-transition","none","important"),b.fauxFixedElements.push(a)})},unfixFixedElements:function(){this.fauxFixedElements.forEach(function(a){a.el.style.removeProperty("transform"),a.el.style.removeProperty("-webkit-transform"),setTimeout(function(){null===a.styleAttribute||""===a.styleAttribute?a.el.removeAttribute("style"):a.el.setAttribute("style",a.styleAttribute)},1)}),this.scrollOffset=void 0,this.fauxFixedElements=[]}}),Cargo.o.view.FollowingButton=Backbone.View.extend({initialize:function(){var a=this;if(!0!==Cargo.Helper.IsAdminPath())return Cargo.API.Config.preview||Cargo.Helper.IsAdminEdit()?($.get("/dispatch/auth/getFollowingToolset",function(a){a.html&&$("body").prepend(a.html)},"json"),!1):void $.getJSON(Cargo.Helper.GetAuthDomain()+"/dispatch/auth/followingAuth/"+Cargo.Helper.GetUrl()+"?callback=?",function(b){!0!==Cargo.InspectorLoading&&($.post("/dispatch/auth/followingAuthLocal",{token:b.jdata.token,url:b.jdata.url,muid:b.jdata.muid,cv:b.jdata.cv},function(b){a.InitFollowingClick(),
a.Init(b.jdata)},"json"),b.html&&($("body").prepend(b.html),a.InitFollowingClick(),a.Init(b.jdata)))})},InitFollowingClick:function(){return Cargo.Helper.IsAdminBackdrop()?void $("#toolset a",this.el).attr("href",Cargo.Model.Site.get("home_url")).attr("target","_top"):parent!==window?void $("#toolset_follow",this.el).addClass("noclick"):void $("#toolset_follow a").off().on("click",function(a){if(a.preventDefault(),$(this).closest("#toolset_follow").hasClass("noclick"))return!1;Cargo.View.Following.Toggle()})},Init:function(a){Cargo.API.Config.cookie_url=a.cookie_url,Cargo.API.Config.cookie_link=a.cookie_link,Cargo.API.Config.cookie_site_count=a.cookie_site_count,"object"==typeof Cargo.View.Following&&"object"==typeof Cargo.View.Following.el&&Cargo.View.Following.updateCookieData()}}),Cargo.o.view.Thumbnail=Backbone.View.extend({name:"Thumbnail",isEditing:!1,Subview:!1,MobileSubview:!1,PageModel:!1,ContentModel:!1,templates:{},initialize:function(){return this.model||(this.model=Cargo.Model.ThumbnailSettings),Cargo.Event.on("mobile_size",_.bind(this.checkSizeAndActivateView,this)),Cargo.Event.on("content_load_complete",_.bind(function(a){this.checkAndLoadThumbnails(a)},this)),Cargo.Event.on("homepage_loaded",this.checkAndLoadThumbnails,this),Cargo.Event.on("thumbnails:load_tag",function(a,b){if(b){var c;isNaN(Number(b))||(c=Cargo.Collection.Scaffolding.getSetOrPageModel({id:Number(b)})),c||(c=Cargo.Collection.Scaffolding.getModelByPurl(b)),c&&(b=c.get("id")),this.ContentModel=c,this.loadThumbnailsFor(void 0,{set_id:b,tags:a})}else this.checkAndLoadThumbnails(void 0,{tags:a})},this),this.show_thumbs=null,this},events:{dragstart:"dragstart"},dragstart:function(a){if(Cargo.API.Config.cookie_url&&a.target.nodeType===Node.ELEMENT_NODE&&"IMG"===a.target.nodeName&&a.target.hasAttribute("data-mid")){var b=parseInt($(a.target).closest("[data-id]").attr("data-id"));if(!isNaN(b)){var c=this.collection.findWhere({id:b});if(c.get("thumb_meta")&&c.get("thumb_meta").thumbnail_crop){var d=new Cargo.o.model.image(c.get("thumb_meta").thumbnail_crop.imageModel);if(d&&0==/(.*?)\.(svg)$/g.test(d.getOriginalImage().url)){var e={drag_image_src:a.target.getAttribute("src"),image_url:d.getOriginalImage().url,source_url:window.location.origin+c.get("url"),source_title:c.get("title")+" - "+Cargo.Model.Site.GetWebsiteTitle(),tags:""===c.get("tags")?[]:c.get("tags").split(", "),excerpt:c.get("excerpt")};a.dataTransfer.setData("cargo/imageselection",JSON.stringify(e))}}}}},requestTemplate:function(a,b){this.listenTo(Cargo.Event,"template_loaded",this.checkTemplate),this.listenTo(Cargo.Event,"content_load_complete",this.setActiveThumb);var c=a||this.model.get("name"),d=b||this.model.getTemplatePath();if(this.templates[c]=Cargo.Template.Get(c,d),this.templates.Thumbnail=Cargo.Template.Get("Thumbnail"),_.contains(this.templates,void 0))return this;this.stopListening(Cargo.Event,"template_loaded");var e=this.model.get("data").mobile_data;return e&&e.separate_mobile_view&&this.model.get("data").responsive&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)?this.setupMobile():this.setup(),this},checkTemplate:function(a){if(!(a in this.templates))return this;if(this.templates[a]=Cargo.Template.Get(a),_.contains(this.templates,void 0))return this;this.stopListening(Cargo.Event,"template_loaded");var b=this.model.get("data").mobile_data;return b&&b.separate_mobile_view&&this.model.get("data").responsive&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)?this.setupMobile():this.setup(),this},setup:function(){this.addEventListeners();var a=Cargo.Collection.ThumbnailModes.findWhere({mode_id:this.model.get("mode_id")});return a?(require(["/_jsapps/thumbnails/"+a.get("path")+"/main.js"],_.bind(this.setupSubView,this)),this):this},setupMobile:function(){if(this.addEventListeners(),this.MobileSubview)return void this.render(this.MobileSubview);if(!require.defined("!text")&&!Backdrop.Data.require_loaded)return void _.delay(_.bind(this.setupMobile,this),100);var a=this.model.get("data").mobile_data;return require(["text!/_jsapps/thumbnails/"+a.mobile_design_path+"/defaults.json","/_jsapps/thumbnails/"+a.mobile_design_path+"/main.js"],_.bind(this.setupMobileSubView,this)),this},activateMobile:function(){this.model.set("mobile_active",!0,{changing:"mobile_active"});var a=this.model.get("data").mobile_data;if(a&&a.separate_mobile_view&&a.mobile_design_path&&this.model.get("data").responsive){var b=a.mobile_design_path,c=this.model.getTemplatePath(b);this.templates&&this.templates[b.toCamel(!0)]?this.setupMobile():this.requestTemplate(b.toCamel(!0),c)}else a&&(this.templates&&this.templates[this.model.get("name")]||this.requestTemplate());return this},activateNormal:function(){return this.model.set("mobile_active",!1,{changing:"mobile_active"}),this.MobileSubview&&this.templates[this.model.get("name")]?void this.setup():this.templates&&this.templates[this.model.get("name")]?this:(this.requestTemplate(),this)},addEventListeners:function(){return this.stopListening(Cargo.Event,"inline-editor-destroy-complete"),this.stopListening(this.model,"change"),!1!==this.PageModel&&this.stopListening(this.PageModel,"change"),this.stopListening(this.collection,"sync"),this.listenTo(this.collection,"sync",this.checkCollectionLengthAndSize),this.listenTo(Cargo.Event,"inline-editor-destroy-complete",function(){this.checkAndLoadThumbnails(Cargo.Helper.GetCurrentProjectId())},this),this.listenTo(this.model,"change",this.handleUpdates),!1!==this.PageModel&&this.listenTo(this.PageModel,"change",this.handleUpdates),this},setResponsive:function(){this.model.get("mobile_active")&&this.model.get("data").responsive?this.el.setAttribute("responsive-layout",""):this.el.removeAttribute("responsive-layout")},checkCollectionLengthAndSize:function(a,b,c){var d=!1;c&&c.params&&void 0!==c.params.page_id&&c.params.page_id!==this.currentPageID&&(d=!0),c=c||{},this.collection.length>0?(c&&c.from_thumbnail_reseed&&!1===this.show_thumbs||d||this.showThumbs(),this.checkSizeAndActivateView(Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)),this.checkPagination(),_.defer(function(){Cargo.Plugins.elementResizer.refresh()})):d||this.hideThumbs()},checkSizeAndActivateView:function(a,b){a&&this.model.get("data").responsive?this.model.get("mobile_active")&&this.MobileSubview.inited||this.activateMobile():!this.model.get("mobile_active")&&this.Subview.inited||this.activateNormal()},hideThumbs:function(){return this.Subview&&"function"==typeof this.Subview.hideThumbs&&this.Subview.hideThumbs(),this.show_thumbs=!1,this.el.style.display="none",Cargo.Event.trigger("thumbnails_hide"),this},showThumbs:function(){return this.Subview&&"function"==typeof this.Subview.showThumbs&&this.Subview.showThumbs(),this.show_thumbs=!0,this.el.style.display="",Cargo.Event.trigger("thumbnails_show"),this},setActiveThumb:function(a){var b=this.el.querySelector(".thumbnail.active"),c=this.el.querySelector('[data-id="'+a+'"].thumbnail');b&&b.getAttribute("data-id")!=a&&$(b).removeClass("active"),$(c).addClass("active")},handleUpdates:function(a,b){var c;if("page"===a.type){if(this.PageModel&&this.PageModel!==a)return;c=_.clone(a.getPageOption("thumbnail_options")),this.PageModel=a,this.ContentModel=a}else c=_.clone(this.model.get("data"));if(c){switch("filter_type"==b.changing&&"page"===a.type&&("tag"==b.value?setTimeout($.proxy(function(){a.setThumbnailOption("filter_tags",c.filter_tags)},this),100):"set"==b.value&&setTimeout($.proxy(function(){a.setThumbnailOption("filter_set",c.filter_set)},this),100)),b.changing){case"thumb_meta":this.setup();break;case"show_thumbs":case"show_local_thumbs":!0===b.value?this.checkAndLoadThumbnails(void 0,c):this.hideThumbs();break;case"thumbnail_mode":this.requestTemplate();break;case"mobile_active":case"responsive":this.setResponsive(),this.checkSizeAndActivateView(Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth));break;case"filter_set":case"filter_tags":case"filter_type":case"random_limit":this.checkAndLoadThumbnails(void 0,c);break;default:this.ContentModel&&this.PageModel&&this.checkAndLoadThumbnails(this.PageModel.get("id"),this.PageModel.getPageOption("thumbnail_options"))}if(this.MobileSubview&&this.model.get("mobile_active")&&b&&this.model.get("data").responsive&&(b.mobile?c.mobile_data[b.mobile]=b.value:b.changing&&(c[b.changing]=b.value),c.show_thumbs||c.show_local_thumbs&&!c.show_thumbs)){var d=this.MobileSubview.model.get("data"),e=_.extend(d,c);this.MobileSubview.model.set("data",e,{silent:!0,changing:b.changing,value:b.value}),this.MobileSubview.handleUpdates(null,{changing:b.changing,value:b.value})}return this}},setupSubView:function(a){return this.Subview&&this.Subview.remove(),this.Subview=new a({model:this.model,collection:this.collection,parentView:this}),this.render(this.Subview),this.Subview.inited=!0,this},setupMobileSubView:function(a,b){this.MobileSubview&&this.MobileSubview.remove();var c=JSON.parse(a);_.extend(c,this.model.get("data"));var d=Cargo.Collection.ThumbnailModes.findWhere({path:c.mobile_data.mobile_design_path}),e=new Cargo.o.model.thumbnailsettings;return e.set({page_id:this.model.get("page_id"),site_id:this.model.get("site_id"),mobile_active:this.model.get("mobile_active"),mode_id:d.get("mode_id"),name:d.get("name"),path:d.get("path"),data:c}),this.MobileSubview=new b({model:e,collection:this.collection,parentView:this}),this.render(this.MobileSubview),this.MobileSubview.inited=!0,this},render:function(a){if(!this.canRender())return this;a||(a=this.Subview),this.setResponsive(),Handlebars.registerPartial("thumbnail_subview","");var b=Cargo.Template.Get("Thumbnail"),c=Cargo.Core.Handlebars.Render(b,{});this.$el.html(c);var d=this.$el.find(".thumbnails");return d.empty(),d.replaceWith(a.$el),a.render(),this.el._thumb_pagination_watcher||(Cargo.Event.on("thumbnail_pagination_complete",function(a,b,c){scrollMonitor.update(),this.checkPagination()},this),this.el._thumb_pagination_watcher=scrollMonitor.create(this.el,{bottom:2*-screen.height}),this.el._thumb_pagination_watcher.partiallyExitViewport(_.bind(function(){setTimeout(_.bind(this.checkPagination,this))},this)),this.checkPagination()),this},checkPagination:function(){!0===this.show_thumbs&&this.el._thumb_pagination_watcher&&!this.el._thumb_pagination_watcher.isBelowViewport&&this.collection.paginate()},canRender:function(){return!(_.contains(this.templates,void 0)||!Cargo.Collection.ThumbnailModes.length)},checkAndLoadThumbnails:function(a,b){var c,d,e=Cargo.Helper.GetPageViewById(a),f=this.ContentModel;if(this.ContentModel=Cargo.Collection.Scaffolding.getModel({id:a}),this.PageModel=!!e&&e.model,this.currentPageID=a,!Cargo.API.Config.direct_link_pid||!this.ContentModel||this.ContentModel!==f){if(!this.ContentModel)if($("script[data-set='FirstloadThumbOptions']").html()&&(d=$.parseJSON($("script[data-set='FirstloadThumbOptions']").html())),d)0===d.length&&(d=void 0);else{var g=Cargo.Collection.Tags.findTagByUrl(a);if(g)d={tags:g.get("url")};else if(_.isUndefined(b)&&!this.model.get("data").show_thumbs)return}if($("script[data-set='FirstloadThumbOptions']").remove(),!this.ContentModel&&_.isUndefined(b)&&(!d||_.size(d)<=1)&&!this.model.get("data").show_thumbs)return this.hideThumbs(),void this.addEventListeners();this.ContentModel&&("set"==this.ContentModel.type?(c=this.ContentModel.get("thumbnail_options"),d=void 0):void 0!==this.ContentModel.type&&!0!==this.ContentModel.get("pin")&&!(c=this.ContentModel.getPageOption("thumbnail_options"))&&d&&(d.use_global_thumb_settings=!0));var h=_.clone(d||(b||c));this.loadThumbnailsFor(a,h),this.addEventListeners()}},loadThumbnailsFor:function(a,b){var c;if(b)c=b.use_global_thumb_settings?_.clone(this.model.get("data")):b;else if(c=_.clone(this.model.get("data")),c.show_thumbs){var d=Cargo.Collection.Scaffolding.getModel({id:a});if(d&&0!==d.get("id")){var e=Cargo.Collection.Tags.findTagByUrl(d.get("project_url"));e?d&&d.get("is_set")?c.set_id=d.get("id"):"bdif"!==Cargo.API.Config.cargo_url&&(c.show_thumbs=!1):d&&d.get("is_set")&&!d.get("stack")&&(c.set_id=d.get("id"))}else{var e=Cargo.Collection.Tags.findTagByUrl(a);e&&(c.tags=e.get("url"))}}if(void 0!==c.show_local_thumbs&&(c.show_thumbs=c.show_local_thumbs),!1===c.show_thumbs)this.hideThumbs();else{var f=this.collection.fetch({params:this.getCollectionSettingsForOptions(a,c),reset:!0,success:_.bind(function(a,b){this.checkCollectionLengthAndSize.apply(this,arguments)},this)});f&&f.readyState!==XMLHttpRequest.DONE&&(this.el.style.visibility="hidden",Cargo.View.PinnedBottom.el.style.visibility="hidden",f.always(_.bind(function(){this.el.style.visibility="",Cargo.View.PinnedBottom.el.style.visibility=""},this)))}},getCollectionSettingsForOptions:function(a,b){var c={tags:void 0,page_id:void 0,set_id:void 0,random_limit:void 0,force_all:void 0};return b&&(b.tags||b.set_id?(c.tags=b.tags,c.set_id=b.set_id):"set"==b.filter_type?c.set_id=b.filter_set:"tag"==b.filter_type?c.tags=b.filter_tags:"random"==b.filter_type?(c.page_id=a,c.random_limit=parseInt(b.random_limit),isNaN(c.random_limit)&&(c.random_limit=10)):"all"==b.filter_type?(c.page_id=a,c.force_all=!0):c.page_id=a),c},updateIsEditing:function(a){this.isEditing=a==this.model.get("name"),this.trigger("is_editing",this.isEditing)},getIsEditing:function(){return this.isEditing},getActiveSubView:function(){return this.model.get("mobile_active")&&this.MobileSubview&&this.model.get("data").responsive?this.MobileSubview:this.Subview},updateThumbnailCrop:function(a,b,c){var d=this.collection.findWhere({id:a});if(d){if(d.set("thumb_meta",{thumbnail_crop:b},{silent:!0}),c)return void this.handleUpdates(d,{changing:"thumb_meta"});if(c)return;var e=this.el.querySelector('[data-id="'+a+'"].thumbnail img');e&&("function"==typeof b.imageModel.get?(e.setAttribute("width",b.imageModel.get("width")),e.setAttribute("height",b.imageModel.get("height"))):(e.setAttribute("width",b.imageModel.width),e.setAttribute("height",b.imageModel.height)),c?Cargo.Plugins.elementResizer.refresh():(e.style.width=b.percentWidth+"%",e.style.marginLeft=b.marginLeft+"%",e.style.marginTop=b.marginTop+"%",Cargo.Plugins.elementResizer.update()))}}}),Cargo.o.view.TemplateButton=Backbone.View.extend({data:{creating:!1},el:"body",events:{"click .new_site_button":"confirmCreate","mouseover .new_site_button":"showFull","mouseout .new_site_button":"hideFull"},enabled:null,is_inframe:!1,initialize:function(a){Cargo.API.Config.is_template&&(parent==window?this.render():($("body").addClass("template_site_inframe"),this.is_inframe=!0)),window.addEventListener("message",this.onPostMessage,!1)},render:function(a){var b=this,c=Cargo.Core.Handlebars.Render('<div class="new_site_button_wrapper"><div class="new_site_button"><div class="text">Make a site with this Template</div><div class="plus"><svg id="plus_makesite" x="0px" y="0px" viewBox="0 0 44 44" style="enable-background:new 0 0 44 44;"><defs><mask id="specialMask"><rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect><g id="specialOrderText" fill="#000000"><line class="cls-3" x1="10" x2="34" y1="22" y2="22"/><line class="cls-3" y1="10" y2="34" x1="22" x2="22"/></g></mask></defs><g class="masked" style="mask: url(\'#specialMask\');"><g id="transform-rect"><rect id="rect" x="0" y="0" width="44" height="44" style="fill: #0fce83;"></rect></g></g></svg></div></div></div>');return $("body").append(c).addClass("template_site"),this.data.currentID=Cargo.Model.Site.get("id"),this.delegateEvents(),$.get("/_jsapps/modal/modal.html",function(a){b.createsitemodal=new modal,b.createsitemodal.template=_.template(a)}),this},onPostMessage:function(a){a.data&&a.data.redirect_url&&(window.onbeforeunload=null,document.location.href=a.data.redirect_url),a.data&&a.data.tab_index&&this.is_inframe&&("off"===a.data.tab_index?setTimeout(function(){$("*").not('[tabindex="-1"]').addClass("tabindex-off").attr("tabindex","-1")},100):"clear"===a.data.tab_index&&$(".tabindex-off").attr("tabindex","").removeAttr("tabindex").removeClass("tabindex-off"))},remove:function(){window.removeEventListener("message",this.onPostMessage)},confirmCreate:function(a){var b=this;b.createsitemodal.Confirm({message:"Make a site with this Template?",confirm:function(){b.start(a)}}),b.$el.addClass("createsitemodal")},start:function(a){a.preventDefault(),require(["/_jsapps/admin/_models/adminsite.js"],_.bind(function(a){this.data.AdminSite=new a,this.data.AdminSite.set("template_id",this.data.currentID),this.data.AdminSite.save({},{success:_.bind(function(a,b,c){if(0!=b.length){Cargo.Modal.Block({message:""});var d=a.get("sites_uid"),e=a.get("master_muid"),f=a.get("progress_id"),g="https://auth.cargocollective.com/newsitesignup/"+d+"/"+e+"/"+f+"?template_id="+this.data.currentID;Cargo.Modal.$el.addClass("signup"),Cargo.Modal.$el.find(".confirm-box").html('<iframe src="'+g+'"></iframe>'),Cargo.Modal.$el.find("iframe").css({width:"100%",height:"calc(100% + 1px)",border:"none"}),document.body.style.overflow="hidden"}},this),error:_.bind(function(a,b,c){var d=$.parseJSON(b.responseText);0!=d.length&&alert(d.message)},this)})},this))},requestStartProgress:function(){this.requests++,$.ajax({method:"POST",dataType:"json",url:"/dispatch/siteservices/checkSiteCopyStatus",data:{new_site_uid:this.data.AdminSite.get("sites_uid"),template_site_uid:this.data.AdminSite.get("template_id"),progress_id:this.data.AdminSite.get("progress_id")},success:_.bind(function(a){if(!(a.error&&a.error.length>0)){var b=this.requests>100?1500:500*Math.random()+250;clearTimeout(this.data.requestTimeout),this.data.requestTimeout=setTimeout(_.bind(this.requestStartProgress,this),b),a&&a.jdata&&console.log(a.jdata)}},this),error:_.bind(function(){var a=this.requests>100?1500:500*Math.random()+250;clearTimeout(this.data.requestTimeout),this.data.requestTimeout=setTimeout(_.bind(this.requestStartProgress,this),a)},this)})},displayCompletionStatus:function(a){var b=a.percent;b<10&&(b=Math.min(.1*this.requests,10)),this.createsitemodal.UpdateProgress(Math.round(b)),b>=100&&(clearTimeout(this.data.requestTimeout),setTimeout(_.bind(function(){window.onbeforeunload=null,document.location.href=this.data.redirect_url},this),1e3))}}),Cargo.o.view.ProductWidget=Backbone.View.extend({defaults:{price:!0,button_text:"Add to Cart"},initialize:function(a){this.activeSKU=void 0,requirejs(["text!/_jsapps/ecommerce/_templates/productWidget.html"],_.bind(function(a){this.template=_.template(a),this.requestedRender&&(delete this.requestedRender,this.render())},this))},events:{"change [name='skus']":"changeSKU","click [data-add-cart]":"addToCart"},getOptions:function(){var a={};if(this.el.hasAttribute("data-options"))try{a=JSON.parse(this.el.getAttribute("data-options"))}catch(a){}return _.defaults(a,this.defaults)},updateOptions:function(a){if(a){var b=this.getOptions();b=_.extend(b,a);try{this.el.setAttribute("data-options",JSON.stringify(b))}catch(a){console.warn("unable to store widget settings",a)}return this.render(),b}},formatPriceForCurrency:function(a,b,c){var d;if(void 0!==c&&(a*=c),"string"!=typeof b)d=a/100+"";else{var e=["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","VND","VUV","XAF","XOF","XPF"],f={AED:"د.إ",AFN:"؋",ALL:"L",AMD:"֏",ANG:"ƒ",AOA:"Kz",ARS:"$",AUD:"$",AWG:"ƒ",AZN:"₼",BAM:"KM",BBD:"$",BDT:"৳",BGN:"лв",BHD:".د.ب",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTC:"฿",BTN:"Nu.",BWP:"P",BYR:"p.",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",CUC:"$",CUP:"₱",CVE:"$",CZK:"Kč",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"دج",EEK:"kr",EGP:"£",ERN:"Nfk",ETB:"Br",ETH:"Ξ",EUR:"€",FJD:"$",FKP:"£",GBP:"£",GEL:"₾",GGP:"£",GHC:"₵",GHS:"GH₵",GIP:"£",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"₪",IMP:"£",INR:"₹",IQD:"ع.د",IRR:"﷼",ISK:"kr",JEP:"£",JMD:"J$",JOD:"JD",JPY:"¥",KES:"KSh",KGS:"лв",KHR:"៛",KMF:"CF",KPW:"₩",KRW:"₩",KWD:"KD",KYD:"$",KZT:"лв",LAK:"₭",LBP:"£",LKR:"₨",LRD:"$",LSL:"M",LTC:"Ł",LTL:"Lt",LVL:"Ls",LYD:"LD",MAD:"MAD",MDL:"lei",MGA:"Ar",MKD:"ден",MMK:"K",MNT:"₮",MOP:"MOP$",MRO:"UM",MUR:"₨",MVR:"Rf",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"₦",NIO:"C$",NOK:"kr",NPR:"₨",NZD:"$",OMR:"﷼",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"₱",PKR:"₨",PLN:"zł",PYG:"Gs",QAR:"﷼",RMB:"￥",RON:"lei",RSD:"Дин.",RUB:"₽",RWF:"R₣",SAR:"﷼",SBD:"$",SCR:"₨",SDG:"ج.س.",SEK:"kr",SGD:"$",SHP:"£",SLL:"Le",SOS:"S",SRD:"$",SSP:"£",STD:"Db",SVC:"$",SYP:"£",SZL:"E",THB:"฿",TJS:"SM",TMT:"T",TND:"د.ت",TOP:"T$",TRL:"₤",TRY:"₺",TTD:"TT$",TVD:"$",TWD:"NT$",TZS:"TSh",UAH:"₴",UGX:"USh",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",VUV:"VT",WST:"WS$",XAF:"FCFA",XBT:"Ƀ",XCD:"$",XOF:"CFA",XPF:"₣",YER:"﷼",ZAR:"R",ZWD:"Z$"};b=b.toUpperCase(),-1===e.indexOf(b)&&(a/=100),d="undefined"!=typeof Intl?new Intl.NumberFormat("en-US",{style:"currency",currency:b,currencyDisplay:"symbol",useGrouping:!0,minimumFractionDigits:0}).format(a):(f.hasOwnProperty(b)?f[b]:b+" ")+""+a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}if("string"==typeof d&&-1!==d.indexOf(".")){var g=d.split(".");2===g.length&&1===g[1].length&&(g[1]=g[1]+"0",d=g.join("."))}return d},render:function(){if(!this.template)return void(this.requestedRender=!0);var a;void 0!==this.model&&(a=this.model.toJSON(),a.skus.data.sort(function(a,b){var c=_.reduce(a.attributes,function(a,b){return a+b},""),d=_.reduce(b.attributes,function(a,b){return a+b},"");return c<d?-1:c>d?1:0}),!this.activeSKU&&a.skus.data.length>0&&(this.activeSKU=a.skus.data[0]));var b=this.template({formatPriceForCurrency:this.formatPriceForCurrency,options:this.getOptions(),product:a,activeSKU:this.activeSKU,has_inventory:this.checkIfInventoryAvailable()});return this.el.innerHTML=b,this.el.setAttribute("contenteditable",!1),this},changeSKU:function(a){var b=a.target[a.target.selectedIndex].value,c=_.findWhere(this.model.get("skus").data,{id:b});c&&(this.activeSKU=c,this.render())},checkIfInventoryAvailable:function(){if(this.activeSKU){if("finite"===this.activeSKU.inventory.type&&this.activeSKU.inventory.quantity>0)return!0;if("infinite"===this.activeSKU.inventory.type)return!0;if("bucket"===this.activeSKU.inventory.type&&("in_stock"===this.activeSKU.inventory.value||"limited"===this.activeSKU.inventory.value))return!0}return!1},addToCart:function(a){this.model&&!Cargo.Helper.IsAdminEdit()&&(a.preventDefault(),Cargo.View.Following.triggerEventInFrame("add-sku-to-cart",{sku:this.activeSKU.id,product:this.model.get("id")}))}}),window.Vimeo={},$(function(){requirejs.onError=function(a){console.error(a)},requirejs.config({paths:{text:"//static.cargocollective.com/libs/require/text.min",css:"//static.cargocollective.com/libs/require/css.min"}}),document.body.style.visibility="";var a=Backbone.View.prototype.remove;Backbone.View.prototype.remove=function(){this.trigger("remove"),a.apply(this,arguments)},Cargo.API=new Cargo.o.api,Cargo.Helper=new Cargo.o.helpers,Cargo.Template=new Cargo.o.templates,Cargo.Router=new Cargo.o.router,Cargo.Model.DisplayOptions=new Cargo.o.model.display_options,Cargo.Model.Site=new Cargo.o.model.site,Cargo.Model.Image=new Cargo.o.model.image,Cargo.Model.Css=new Cargo.o.model.css,Cargo.Model.Tag=new Cargo.o.model.tag,Cargo.Model.ThumbnailSettings=new Cargo.o.model.thumbnailsettings,Cargo.Collection.Images=new Cargo.o.collection.images,Cargo.Collection.Scaffolding=new Cargo.o.collection.scaffolding,Cargo.Collection.SiteMenu=new Cargo.o.collection.sitemenu,Cargo.Collection.StripeProducts=new Cargo.o.collection.StripeProductCollection,Cargo.Collection.ThumbnailSettings=new Cargo.o.collection.thumbnailsettings,Cargo.Collection.ThumbnailModes=new Cargo.o.collection.thumbnailmodes,Cargo.Collection.GlobalThumbnails=new Cargo.o.collection.thumbnails,Cargo.Collection.Tags=new Cargo.o.collection.tags,Cargo.Model.DisplayOptions.once("change",function(){Cargo.Event.trigger("display_options_available",Cargo.Model.DisplayOptions)}),Cargo.Model.DisplayOptions.fetch({reset:!0}),Cargo.Analytics=new Cargo.o.analytics,Cargo.Model.Site.fetch(),Cargo.Model.ThumbnailSettings.fetch(),Cargo.Collection.Scaffolding.fetch(),Cargo.Collection.ThumbnailSettings.fetch(),Cargo.Collection.ThumbnailModes.fetch(),!0===Cargo.Model.Site.get("has_ecommerce")?Cargo.Collection.StripeProducts.fetch({success:function(a){Cargo.Collection.StripeProducts.productSyncOccurred=!0},error:function(){Cargo.Collection.StripeProducts.productSyncOccurred=!0}}):Cargo.Collection.StripeProducts.productSyncOccurred=!0,Cargo.Helper.TestUrlCaseAndRedirect(),Cargo.Helper.IsAdminPath()||(Cargo.Backdrop=Cargo.View.Backdrop=Backdrop.View.Backdrop=new Cargo.o.view.Backdrop),Cargo.Helper.IsAdminPath()&&(Cargo.Collection.ImageLibrary=new Cargo.o.collection.images,Cargo.Collection.ImageLibrary.fetch()),Cargo.View.Following=new Cargo.o.view.Following,Cargo.View.FollowingButton=new Cargo.o.view.FollowingButton,Cargo.View.TemplateButton=new Cargo.o.view.TemplateButton,void 0===Cargo.View.Main&&(Cargo.View.Main=new Cargo.o.view.Main({el:"body",collection:Cargo.Model.Site})),Cargo.Template.FindAndAddViewStubs(),Cargo.Template.LoadFoundViews(),Cargo.Helper.isOldIE()||Cargo.Helper.IsAdminPath()||(Cargo.Router.is_first_route=!0,Backbone.history.start({pushState:!0,hashChange:!1,root:Cargo.Helper.GetHomeUrl(!0)})),Cargo.Core.KeyboardShortcut.InitDefaults(),Cargo.Template.LoadAll(),Cargo.Template.LoadFoundViews(),Cargo.Core.ImageGallery.initialize(),Cargo.Core.Embeds.initialize(),Cargo.Core.Ecommerce.initialize(),Cargo.Core.InitKeycodeListener(),Cargo.Core.InitMessageListener(),"undefined"!=typeof scrollMonitor&&(Cargo.Helper.throttledScrollMonitorUpdate=_.throttle(scrollMonitor.update,50)),Cargo.Event.trigger("init_complete")}),function(a){"use strict";!function(a){var b=window.Slick||{};b=function(){function b(b,d){var e,f=this;f.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:a(b),appendDots:a(b),arrows:!0,asNavFor:null,prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(b,c){return a('<button type="button" data-role="none" role="button" tabindex="0" />').text(c+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,preventDefaults:!0,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},f.initials={animating:!1,dragging:!1,autoPlayTimer:null,hideUITimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},a.extend(f,f.initials),f.activeBreakpoint=null,f.animType=null,f.animProp=null,f.breakpoints=[],f.breakpointSettings=[],f.cssTransitions=!1,f.focussed=!1,f.interrupted=!1,f.hidden="hidden",f.paused=!0,f.positionProp=null,f.respondTo=null,f.rowCount=1,f.shouldClick=!0,f.$slider=a(b),f.$slidesCache=null,f.transformType=null,f.transitionType=null,f.visibilityChange="visibilitychange",f.windowWidth=0,f.windowTimer=null,e=a(b).data("slick")||{},f.options=a.extend({},f.defaults,d,e),f.currentSlide=f.options.initialSlide,f.originalSettings=f.options,void 0!==document.mozHidden?(f.hidden="mozHidden",f.visibilityChange="mozvisibilitychange"):void 0!==document.webkitHidden&&(f.hidden="webkitHidden",f.visibilityChange="webkitvisibilitychange"),f.autoPlay=a.proxy(f.autoPlay,f),f.autoPlayClear=a.proxy(f.autoPlayClear,f),f.autoPlayIterator=a.proxy(f.autoPlayIterator,f),f.changeSlide=a.proxy(f.changeSlide,f),f.clickHandler=a.proxy(f.clickHandler,f),f.selectHandler=a.proxy(f.selectHandler,f),f.setPosition=a.proxy(f.setPosition,f),f.swipeHandler=a.proxy(f.swipeHandler,f),f.dragHandler=a.proxy(f.dragHandler,f),f.keyHandler=a.proxy(f.keyHandler,f),f.hideUI=a.proxy(f.hideUI,f),f.showUI=a.proxy(f.showUI,f),f.preventDefault=a.proxy(f.preventDefault,f),f.instanceUid=c++,f.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,f.registerBreakpoints(),f.init(!0)}var c=0;return b}(),b.prototype.activateADA=function(){this.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},b.prototype.addSlide=b.prototype.slickAdd=function(b,c,d){var e=this;if("boolean"==typeof c)d=c,c=null;else if(c<0||c>=e.slideCount)return!1;e.unload(),"number"==typeof c?0===c&&0===e.$slides.length?a(b).appendTo(e.$slideTrack):d?a(b).insertBefore(e.$slides.eq(c)):a(b).insertAfter(e.$slides.eq(c)):!0===d?a(b).prependTo(e.$slideTrack):a(b).appendTo(e.$slideTrack),e.$slides=e.$slideTrack.children(this.options.slide),e.$slideTrack.children(this.options.slide).detach(),e.$slideTrack.append(e.$slides),e.$slides.each(function(b,c){a(c).attr("data-slick-index",b)}),e.$slidesCache=e.$slides,e.reinit()},b.prototype.animateHeight=function(){var a=this;if(1===a.options.slidesToShow&&!0===a.options.adaptiveHeight&&!1===a.options.vertical){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);if(a.$list.animate({height:b},a.options.speed),!0===a.options.arrows){var c=a.$slides.eq(a.currentSlide),d=c.is(".has_caption")?b-c.find(".gallery_image_caption").outerHeight(!0):b;a.$prevArrow.animate({height:d},{duration:a.options.speed}).css("overflow","visible"),a.$nextArrow.animate({height:d},{duration:a.options.speed}).css("overflow","visible")}}},b.prototype.animateSlide=function(b,c){var d={},e=this;e.animateHeight(),!0===e.options.rtl&&!1===e.options.vertical&&(b=-b),!1===e.transformsEnabled?!1===e.options.vertical?e.$slideTrack.animate({left:b},e.options.speed,e.options.easing,c):e.$slideTrack.animate({top:b},e.options.speed,e.options.easing,c):!1===e.cssTransitions?(!0===e.options.rtl&&(e.currentLeft=-e.currentLeft),a({animStart:e.currentLeft}).animate({animStart:b},{duration:e.options.speed,easing:e.options.easing,step:function(a){a=Math.ceil(a),!1===e.options.vertical?(d[e.animType]="translate("+a+"px, 0px)",e.$slideTrack.css(d)):(d[e.animType]="translate(0px,"+a+"px)",e.$slideTrack.css(d))},complete:function(){c&&c.call()}})):(e.applyTransition(),b=Math.ceil(b),!1===e.options.vertical?d[e.animType]="translate3d("+b+"px, 0px, 0px)":d[e.animType]="translate3d(0px,"+b+"px, 0px)",e.$slideTrack.css(d),c&&setTimeout(function(){e.disableTransition(),c.call()},e.options.speed))},b.prototype.getNavTarget=function(){var b=this,c=b.options.asNavFor;return c&&null!==c&&(c=a(c).not(b.$slider)),c},b.prototype.asNavFor=function(b){var c=this,d=c.getNavTarget();null!==d&&"object"==typeof d&&d.each(function(){var c=a(this).slick("getSlick");c.unslicked||c.slideHandler(b,!0)})},b.prototype.applyTransition=function(a){var b=this,c={};!1===b.options.fade?c[b.transitionType]=b.transformType+" "+b.options.speed+"ms "+b.options.cssEase:c[b.transitionType]="opacity "+b.options.speed+"ms "+b.options.cssEase,!1===b.options.fade?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.autoPlay=function(){var a=this;a.autoPlayClear(),a.slideCount>a.options.slidesToShow&&(a.autoPlayTimer=setInterval(a.autoPlayIterator,a.options.autoplaySpeed))},b.prototype.autoPlayClear=function(){var a=this;a.autoPlayTimer&&clearInterval(a.autoPlayTimer)},b.prototype.autoPlayIterator=function(){var a=this,b=a.currentSlide+a.options.slidesToScroll;a.paused||a.interrupted||a.focussed||(!1===a.options.infinite&&(1===a.direction&&a.currentSlide+1===a.slideCount-1?a.direction=0:0===a.direction&&(b=a.currentSlide-a.options.slidesToScroll,
a.currentSlide-1==0&&(a.direction=1))),a.slideHandler(b))},b.prototype.buildArrows=function(){var b=this;!0===b.options.arrows&&(b.$prevArrow=a(b.options.prevArrow).addClass("slick-arrow"),b.$nextArrow=a(b.options.nextArrow).addClass("slick-arrow"),b.slideCount>b.options.slidesToShow?(b.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.prependTo(b.options.appendArrows),b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.appendTo(b.options.appendArrows),!0!==b.options.infinite&&b.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):b.$prevArrow.add(b.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},b.prototype.buildDots=function(){var b,c,d=this;if(!0===d.options.dots&&d.slideCount>d.options.slidesToShow){for(d.$slider.addClass("slick-dotted"),c=a("<ul />").addClass(d.options.dotsClass),b=0;b<=d.getDotCount();b+=1)c.append(a("<li />").append(d.options.customPaging.call(this,d,b)));d.$dots=c.appendTo(d.options.appendDots),d.$dots.find("li").first().addClass("slick-active").attr("aria-hidden","false")}},b.prototype.buildOut=function(){var b=this;b.$slides=b.$slider.children(b.options.slide+":not(.slick-cloned)").addClass("slick-slide"),b.slideCount=b.$slides.length,b.$slides.each(function(b,c){a(c).attr("data-slick-index",b).data("originalStyling",a(c).attr("style")||"")}),b.$slider.addClass("slick-slider"),b.$slideTrack=0===b.slideCount?a('<div class="slick-track"/>').appendTo(b.$slider):b.$slides.wrapAll('<div class="slick-track"/>').parent(),b.$list=b.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent(),b.$slideTrack.css("opacity",0),!0!==b.options.centerMode&&!0!==b.options.swipeToSlide||(b.options.slidesToScroll=1),a("img[data-lazy]",b.$slider).not("[src]").addClass("slick-loading"),b.setupInfinite(),b.buildArrows(),b.buildDots(),b.updateDots(),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),!0===b.options.draggable&&b.$list.addClass("draggable")},b.prototype.buildRows=function(){var a,b,c,d,e,f,g,h=this;if(d=document.createDocumentFragment(),f=h.$slider.children(),h.options.rows>1){for(g=h.options.slidesPerRow*h.options.rows,e=Math.ceil(f.length/g),a=0;a<e;a++){var i=document.createElement("div");for(b=0;b<h.options.rows;b++){var j=document.createElement("div");for(c=0;c<h.options.slidesPerRow;c++){var k=a*g+(b*h.options.slidesPerRow+c);f.get(k)&&j.appendChild(f.get(k))}i.appendChild(j)}d.appendChild(i)}h.$slider.empty().append(d),h.$slider.children().children().children().css({width:100/h.options.slidesPerRow+"%",display:"inline-block"})}},b.prototype.checkResponsive=function(b,c){var d,e,f,g=this,h=!1,i=g.$slider.width(),j=window.innerWidth||a(window).width();if("window"===g.respondTo?f=j:"slider"===g.respondTo?f=i:"min"===g.respondTo&&(f=Math.min(j,i)),g.options.responsive&&g.options.responsive.length&&null!==g.options.responsive){e=null;for(d in g.breakpoints)g.breakpoints.hasOwnProperty(d)&&(!1===g.originalSettings.mobileFirst?f<g.breakpoints[d]&&(e=g.breakpoints[d]):f>g.breakpoints[d]&&(e=g.breakpoints[d]));null!==e?null!==g.activeBreakpoint?(e!==g.activeBreakpoint||c)&&(g.activeBreakpoint=e,"unslick"===g.breakpointSettings[e]?g.unslick(e):(g.options=a.extend({},g.originalSettings,g.breakpointSettings[e]),!0===b&&(g.currentSlide=g.options.initialSlide),g.refresh(b)),h=e):(g.activeBreakpoint=e,"unslick"===g.breakpointSettings[e]?g.unslick(e):(g.options=a.extend({},g.originalSettings,g.breakpointSettings[e]),!0===b&&(g.currentSlide=g.options.initialSlide),g.refresh(b)),h=e):null!==g.activeBreakpoint&&(g.activeBreakpoint=null,g.options=g.originalSettings,!0===b&&(g.currentSlide=g.options.initialSlide),g.refresh(b),h=e),b||!1===h||g.$slider.trigger("breakpoint",[g,h])}},b.prototype.changeSlide=function(b,c){var d,e,f,g=this,h=a(b.currentTarget);switch(h.is("a")&&b.preventDefault(),h.is("li")||(h=h.closest("li")),f=g.slideCount%g.options.slidesToScroll!=0,d=f?0:(g.slideCount-g.currentSlide)%g.options.slidesToScroll,b.data.message){case"previous":e=0===d?g.options.slidesToScroll:g.options.slidesToShow-d,g.slideCount>g.options.slidesToShow&&g.slideHandler(g.currentSlide-e,!1,c);break;case"next":e=0===d?g.options.slidesToScroll:d,g.slideCount>g.options.slidesToShow&&g.slideHandler(g.currentSlide+e,!1,c);break;case"index":var i=0===b.data.index?0:b.data.index||h.index()*g.options.slidesToScroll;g.slideHandler(g.checkNavigable(i),!1,c),h.children().trigger("focus");break;default:return}},b.prototype.checkNavigable=function(a){var b,c,d=this;if(b=d.getNavigableIndexes(),c=0,a>b[b.length-1])a=b[b.length-1];else for(var e in b){if(a<b[e]){a=c;break}c=b[e]}return a},b.prototype.cleanUpEvents=function(){var b=this;b.options.dots&&null!==b.$dots&&a("li",b.$dots).off("click.slick",b.changeSlide).off("mouseenter.slick",a.proxy(b.interrupt,b,!0)).off("mouseleave.slick",a.proxy(b.interrupt,b,!1)),b.$slider.off("focus.slick blur.slick"),!0===b.options.arrows&&b.slideCount>b.options.slidesToShow&&(b.$prevArrow&&b.$prevArrow.off("click.slick",b.changeSlide),b.$nextArrow&&b.$nextArrow.off("click.slick",b.changeSlide)),b.$slider.off("touchstart.slick mousedown.slick",b.swipeHandler),b.$slider.off("touchmove.slick mousemove.slick",b.swipeHandler),b.$slider.off("touchend.slick mouseup.slick",b.swipeHandler),b.$slider.off("touchcancel.slick mouseleave.slick",b.swipeHandler),b.$list.off("click.slick",b.clickHandler),a(document).off(b.visibilityChange,b.visibility),b.cleanUpSlideEvents(),!0===b.options.accessibility&&b.$list.off("keydown.slick",b.keyHandler),!0===b.options.focusOnSelect&&a(b.$slideTrack).children().off("click.slick",b.selectHandler),a(window).off("orientationchange.slick.slick-"+b.instanceUid,b.orientationChange),a(window).off("resize.slick.slick-"+b.instanceUid,b.resize),a("[draggable!=true]",b.$slideTrack).off("dragstart",b.preventDefault),a(window).off("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).off("ready.slick.slick-"+b.instanceUid,b.setPosition),Cargo.Event.off("slideshow-lazyload",b.lazyLoad)},b.prototype.cleanUpSlideEvents=function(){var b=this;b.$list.off("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.off("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.cleanUpRows=function(){var a,b=this;b.options.rows>1&&(a=b.$slides.children().children(),a.removeAttr("style"),b.$slider.empty().append(a))},b.prototype.clickHandler=function(a){!1===this.shouldClick&&(a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault())},b.prototype.destroy=function(b){var c=this;c.autoPlayClear(),c.touchObject={},c.cleanUpEvents(),a(".slick-cloned",c.$slider).detach(),c.$dots&&c.$dots.remove(),c.$prevArrow&&c.$prevArrow.length&&(c.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.prevArrow)&&c.$prevArrow.remove()),c.$nextArrow&&c.$nextArrow.length&&(c.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.nextArrow)&&c.$nextArrow.remove()),c.$slides&&(c.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){a(this).attr("style",a(this).data("originalStyling"))}),c.$slideTrack.children(this.options.slide).detach(),c.$slideTrack.detach(),c.$list.detach(),c.$slider.append(c.$slides)),c.cleanUpRows(),c.$slider.removeClass("slick-slider"),c.$slider.removeClass("slick-initialized"),c.$slider.removeClass("slick-dotted"),c.unslicked=!0,b||c.$slider.trigger("destroy",[c])},b.prototype.disableTransition=function(a){var b=this,c={};c[b.transitionType]="",!1===b.options.fade?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.fadeSlide=function(a,b){var c=this;!1===c.cssTransitions?(c.$slides.eq(a).css({zIndex:c.options.zIndex}),c.$slides.eq(a).animate({opacity:1},c.options.speed,c.options.easing,b)):(c.applyTransition(a),c.$slides.eq(a).css({opacity:1,zIndex:c.options.zIndex}),b&&setTimeout(function(){c.disableTransition(a),b.call()},c.options.speed))},b.prototype.fadeSlideOut=function(a){var b=this;!1===b.cssTransitions?b.$slides.eq(a).animate({opacity:0,zIndex:b.options.zIndex-2},b.options.speed,b.options.easing):(b.applyTransition(a),b.$slides.eq(a).css({opacity:0,zIndex:b.options.zIndex-2}))},b.prototype.filterSlides=b.prototype.slickFilter=function(a){var b=this;null!==a&&(b.$slidesCache=b.$slides,b.unload(),b.$slideTrack.children(this.options.slide).detach(),b.$slidesCache.filter(a).appendTo(b.$slideTrack),b.reinit())},b.prototype.focusHandler=function(){var b=this;b.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*:not(.slick-arrow)",function(c){c.stopImmediatePropagation();var d=a(this);setTimeout(function(){b.options.pauseOnFocus&&(b.focussed=d.is(":focus"),b.autoPlay())},0)})},b.prototype.getCurrent=b.prototype.slickCurrentSlide=function(){return this.currentSlide},b.prototype.getDotCount=function(){var a=this,b=0,c=0,d=0;if(!0===a.options.infinite)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else if(!0===a.options.centerMode)d=a.slideCount;else if(a.options.asNavFor)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else d=1+Math.ceil((a.slideCount-a.options.slidesToShow)/a.options.slidesToScroll);return d-1},b.prototype.getLeft=function(a){var b,c,d,e=this,f=0;return e.slideOffset=0,c=e.$slides.first().outerHeight(!0),!0===e.options.infinite?(e.slideCount>e.options.slidesToShow&&(e.slideOffset=e.slideWidth*e.options.slidesToShow*-1,f=c*e.options.slidesToShow*-1),e.slideCount%e.options.slidesToScroll!=0&&a+e.options.slidesToScroll>e.slideCount&&e.slideCount>e.options.slidesToShow&&(a>e.slideCount?(e.slideOffset=(e.options.slidesToShow-(a-e.slideCount))*e.slideWidth*-1,f=(e.options.slidesToShow-(a-e.slideCount))*c*-1):(e.slideOffset=e.slideCount%e.options.slidesToScroll*e.slideWidth*-1,f=e.slideCount%e.options.slidesToScroll*c*-1))):a+e.options.slidesToShow>e.slideCount&&(e.slideOffset=(a+e.options.slidesToShow-e.slideCount)*e.slideWidth,f=(a+e.options.slidesToShow-e.slideCount)*c),e.slideCount<=e.options.slidesToShow&&(e.slideOffset=0,f=0),!0===e.options.centerMode&&!0===e.options.infinite?e.slideOffset+=e.slideWidth*Math.floor(e.options.slidesToShow/2)-e.slideWidth:!0===e.options.centerMode&&(e.slideOffset=0,e.slideOffset+=e.slideWidth*Math.floor(e.options.slidesToShow/2)),b=!1===e.options.vertical?a*e.slideWidth*-1+e.slideOffset:a*c*-1+f,!0===e.options.variableWidth&&(d=e.slideCount<=e.options.slidesToShow||!1===e.options.infinite?e.$slideTrack.children(".slick-slide").eq(a):e.$slideTrack.children(".slick-slide").eq(a+e.options.slidesToShow),b=!0===e.options.rtl?d[0]?-1*(e.$slideTrack.width()-d[0].offsetLeft-d.width()):0:d[0]?-1*d[0].offsetLeft:0,!0===e.options.centerMode&&(d=e.slideCount<=e.options.slidesToShow||!1===e.options.infinite?e.$slideTrack.children(".slick-slide").eq(a):e.$slideTrack.children(".slick-slide").eq(a+e.options.slidesToShow+1),b=!0===e.options.rtl?d[0]?-1*(e.$slideTrack.width()-d[0].offsetLeft-d.width()):0:d[0]?-1*d[0].offsetLeft:0,b+=(e.$list.width()-d.outerWidth())/2)),b},b.prototype.getOption=b.prototype.slickGetOption=function(a){return this.options[a]},b.prototype.getNavigableIndexes=function(){var a,b=this,c=0,d=0,e=[];for(!1===b.options.infinite?a=b.slideCount:(c=-1*b.options.slidesToScroll,d=-1*b.options.slidesToScroll,a=2*b.slideCount);c<a;)e.push(c),c=d+b.options.slidesToScroll,d+=b.options.slidesToScroll<=b.options.slidesToShow?b.options.slidesToScroll:b.options.slidesToShow;return e},b.prototype.getSlick=function(){return this},b.prototype.getSlideCount=function(){var b,c,d=this;return c=!0===d.options.centerMode?d.slideWidth*Math.floor(d.options.slidesToShow/2):0,!0===d.options.swipeToSlide?(d.$slideTrack.find(".slick-slide").each(function(e,f){if(f.offsetLeft-c+a(f).outerWidth()/2>-1*d.swipeLeft)return b=f,!1}),Math.abs(a(b).attr("data-slick-index")-d.currentSlide)||1):d.options.slidesToScroll},b.prototype.goTo=b.prototype.slickGoTo=function(a,b){this.changeSlide({data:{message:"index",index:parseInt(a)}},b)},b.prototype.init=function(b){var c=this;a(c.$slider).hasClass("slick-initialized")||(a(c.$slider).addClass("slick-initialized"),c.buildRows(),c.buildOut(),c.setProps(),c.startLoad(),c.loadSlider(),c.initializeEvents(),c.updateArrows(),c.updateDots(),c.checkResponsive(!0),c.focusHandler()),b&&c.$slider.trigger("init",[c]),!0===c.options.accessibility&&c.initADA(),c.options.autoplay&&(c.paused=!1,c.autoPlay()),c.showUI(),this.hideUITimer=setTimeout(this.hideUI,1500)},b.prototype.initADA=function(){var b=this;b.$slides.add(b.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),b.$slideTrack.attr("role","listbox"),b.$slides.not(b.$slideTrack.find(".slick-cloned")).each(function(c){a(this).attr({role:"option","aria-describedby":"slick-slide"+b.instanceUid+c})}),null!==b.$dots&&b.$dots.attr("role","tablist").find("li").each(function(c){a(this).attr({role:"presentation","aria-selected":"false","aria-controls":"navigation"+b.instanceUid+c,id:"slick-slide"+b.instanceUid+c})}).first().attr("aria-selected","true").end().find("button").attr("role","button").end().closest("div").attr("role","toolbar"),b.activateADA()},b.prototype.initArrowEvents=function(){var a=this;!0===a.options.arrows&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},a.changeSlide),a.$nextArrow.off("click.slick").on("click.slick",{message:"next"},a.changeSlide))},b.prototype.initDotEvents=function(){var b=this;!0===b.options.dots&&b.slideCount>b.options.slidesToShow&&a("li",b.$dots).on("click.slick",{message:"index"},b.changeSlide),!0===b.options.dots&&!0===b.options.pauseOnDotsHover&&a("li",b.$dots).on("mouseenter.slick",a.proxy(b.interrupt,b,!0)).on("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.initSlideEvents=function(){var b=this;b.options.pauseOnHover&&(b.$prevArrow&&(b.$prevArrow.on("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$prevArrow.on("mouseleave.slick",a.proxy(b.interrupt,b,!1))),b.$nextArrow&&(b.$nextArrow.on("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$nextArrow.on("mouseleave.slick",a.proxy(b.interrupt,b,!1))),b.$list.on("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.on("mouseleave.slick",a.proxy(b.interrupt,b,!1)))},b.prototype.initializeEvents=function(){var b=this;b.initArrowEvents(),b.initDotEvents(),b.initSlideEvents(),b.$slider.on("touchstart.slick mousedown.slick",{action:"start"},b.swipeHandler),b.$slider.on("touchmove.slick mousemove.slick",{action:"move"},b.swipeHandler),b.$slider.on("touchend.slick mouseup.slick",{action:"end"},b.swipeHandler),b.$slider.on("touchcancel.slick mouseleave.slick",{action:"end"},b.swipeHandler),b.$list.on("click.slick",b.clickHandler),a(document).on(b.visibilityChange,a.proxy(b.visibility,b)),!0===b.options.accessibility&&b.$list.on("keydown.slick",b.keyHandler),!0===b.options.focusOnSelect&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),a(window).on("orientationchange.slick.slick-"+b.instanceUid,a.proxy(b.orientationChange,b)),a(window).on("resize.slick.slick-"+b.instanceUid,a.proxy(b.resize,b)),a("[draggable!=true]",b.$slideTrack).on("dragstart",b.preventDefault),a(window).on("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).on("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.initUI=function(){var a=this;!0===a.options.arrows&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.show(),a.$nextArrow.show()),!0===a.options.dots&&a.slideCount>a.options.slidesToShow&&a.$dots.show()},b.prototype.keyHandler=function(a){var b=this;a.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===a.keyCode&&!0===b.options.accessibility?b.changeSlide({data:{message:!0===b.options.rtl?"next":"previous"}}):39===a.keyCode&&!0===b.options.accessibility&&b.changeSlide({data:{message:!0===b.options.rtl?"previous":"next"}}))},b.prototype.lazyLoad=function(){function b(b){a("img[data-lazy], img[data-lazy-src]",b).each(function(){var b=a(this),c=b.attr("data-lazy")||b.attr("data-lazy-src"),d=document.createElement("img");b.removeAttr("data-lazy"),b.removeAttr("data-lazy-src"),d.onload=function(){b.attr("src",c).removeClass("slick-loading"),g.$slider.trigger("lazyLoaded",[g,b,c])},d.onerror=function(){b.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),g.$slider.trigger("lazyLoadError",[g,b,c])},d.src=c})}var c,d,e,f,g=this;!0===g.options.centerMode?!0===g.options.infinite?(e=g.currentSlide+(g.options.slidesToShow/2+1),f=e+g.options.slidesToShow+2):(e=Math.max(0,g.currentSlide-(g.options.slidesToShow/2+1)),f=g.options.slidesToShow/2+1+2+g.currentSlide):(e=g.options.infinite?g.options.slidesToShow+g.currentSlide:g.currentSlide,f=Math.ceil(e+g.options.slidesToShow),!0===g.options.fade&&(e>0&&e--,f<=g.slideCount&&f++)),e-=1,f+=3,e<0&&(e=0),c=g.$slider.find(".slick-slide").slice(e,f),b(c),g.slideCount<=g.options.slidesToShow?(d=g.$slider.find(".slick-slide"),b(d)):g.currentSlide>=g.slideCount-g.options.slidesToShow?(d=g.$slider.find(".slick-cloned").slice(0,g.options.slidesToShow),b(d)):0===g.currentSlide&&(d=g.$slider.find(".slick-cloned").slice(-1*g.options.slidesToShow),b(d))},b.prototype.loadSlider=function(){var a=this;a.setPosition(),a.$slideTrack.css({opacity:1}),a.$slider.removeClass("slick-loading"),a.initUI(),"progressive"===a.options.lazyLoad&&a.progressiveLazyLoad()},b.prototype.next=b.prototype.slickNext=function(){this.changeSlide({data:{message:"next"}})},b.prototype.orientationChange=function(){var a=this;a.checkResponsive(),a.setPosition()},b.prototype.pause=b.prototype.slickPause=function(){var a=this;a.autoPlayClear(),a.paused=!0},b.prototype.play=b.prototype.slickPlay=function(){var a=this;a.autoPlay(),a.options.autoplay=!0,a.paused=!1,a.focussed=!1,a.interrupted=!1},b.prototype.postSlide=function(a){var b=this;b.unslicked||(b.$slider.trigger("afterChange",[b,a]),b.animating=!1,b.setPosition(),b.swipeLeft=null,b.options.autoplay&&b.autoPlay(),!0===b.options.accessibility&&b.initADA())},b.prototype.prev=b.prototype.slickPrev=function(){this.changeSlide({data:{message:"previous"}})},b.prototype.preventDefault=function(a){this.options.preventDefaults&&a.preventDefault()},b.prototype.progressiveLazyLoad=function(b){b=b||1;var c,d,e,f=this,g=a("img[data-lazy]",f.$slider);g.length?(c=g.first(),d=c.attr("data-lazy"),e=document.createElement("img"),e.onload=function(){c.attr("src",d).removeAttr("data-lazy").removeClass("slick-loading"),!0===f.options.adaptiveHeight&&f.setPosition(),f.$slider.trigger("lazyLoaded",[f,c,d]),f.progressiveLazyLoad()},e.onerror=function(){b<3?setTimeout(function(){f.progressiveLazyLoad(b+1)},500):(c.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),f.$slider.trigger("lazyLoadError",[f,c,d]),f.progressiveLazyLoad())},e.src=d):f.$slider.trigger("allImagesLoaded",[f])},b.prototype.refresh=function(b){var c,d,e=this;d=e.slideCount-e.options.slidesToShow,!e.options.infinite&&e.currentSlide>d&&(e.currentSlide=d),e.slideCount<=e.options.slidesToShow&&(e.currentSlide=0),c=e.currentSlide,e.destroy(!0),a.extend(e,e.initials,{currentSlide:c}),e.init(),b||e.changeSlide({data:{message:"index",index:c}},!1)},b.prototype.registerBreakpoints=function(){var b,c,d,e=this,f=e.options.responsive||null;if("array"===a.type(f)&&f.length){e.respondTo=e.options.respondTo||"window";for(b in f)if(d=e.breakpoints.length-1,c=f[b].breakpoint,f.hasOwnProperty(b)){for(;d>=0;)e.breakpoints[d]&&e.breakpoints[d]===c&&e.breakpoints.splice(d,1),d--;e.breakpoints.push(c),e.breakpointSettings[c]=f[b].settings}e.breakpoints.sort(function(a,b){return e.options.mobileFirst?a-b:b-a})}},b.prototype.reinit=function(){var b=this;b.$slides=b.$slideTrack.children(b.options.slide).addClass("slick-slide"),b.slideCount=b.$slides.length,b.currentSlide>=b.slideCount&&0!==b.currentSlide&&(b.currentSlide=b.currentSlide-b.options.slidesToScroll),b.slideCount<=b.options.slidesToShow&&(b.currentSlide=0),b.registerBreakpoints(),b.setProps(),b.setupInfinite(),b.buildArrows(),b.updateArrows(),b.initArrowEvents(),b.buildDots(),b.updateDots(),b.initDotEvents(),b.cleanUpSlideEvents(),b.initSlideEvents(),b.checkResponsive(!1,!0),!0===b.options.focusOnSelect&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.setPosition(),b.focusHandler(),b.paused=!b.options.autoplay,b.autoPlay(),b.options.arrows&&(b.showUI(),b.hideUITimer=setTimeout(b.hideUI,1500)),b.$slider.trigger("reInit",[b])},b.prototype.resize=function(){var b=this;a(window).width()!==b.windowWidth&&(clearTimeout(b.windowDelay),b.windowDelay=window.setTimeout(function(){b.windowWidth=a(window).width(),b.checkResponsive(),b.unslicked||b.setPosition()},50))},b.prototype.removeSlide=b.prototype.slickRemove=function(a,b,c){var d=this;if("boolean"==typeof a?(b=a,a=!0===b?0:d.slideCount-1):a=!0===b?--a:a,d.slideCount<1||a<0||a>d.slideCount-1)return!1;d.unload(),!0===c?d.$slideTrack.children().remove():d.$slideTrack.children(this.options.slide).eq(a).remove(),d.$slides=d.$slideTrack.children(this.options.slide),d.$slideTrack.children(this.options.slide).detach(),d.$slideTrack.append(d.$slides),d.$slidesCache=d.$slides,d.reinit()},b.prototype.setCSS=function(a){var b,c,d=this,e={};!0===d.options.rtl&&(a=-a),b="left"==d.positionProp?Math.ceil(a)+"px":"0px",c="top"==d.positionProp?Math.ceil(a)+"px":"0px",e[d.positionProp]=a,!1===d.transformsEnabled?d.$slideTrack.css(e):(e={},!1===d.cssTransitions?(e[d.animType]="translate("+b+", "+c+")",d.$slideTrack.css(e)):(e[d.animType]="translate3d("+b+", "+c+", 0px)",d.$slideTrack.css(e)))},b.prototype.setDimensions=function(){var a=this;!1===a.options.vertical?!0===a.options.centerMode&&a.$list.css({padding:"0px "+a.options.centerPadding}):(a.$list.height(a.$slides.first().outerHeight(!0)*a.options.slidesToShow),!0===a.options.centerMode&&a.$list.css({padding:a.options.centerPadding+" 0px"})),a.listWidth=a.$list.width(),a.listHeight=a.$list.height(),!1===a.options.vertical&&!1===a.options.variableWidth?(a.slideWidth=Math.ceil(a.listWidth/a.options.slidesToShow),a.$slideTrack.width(Math.ceil(a.slideWidth*a.$slideTrack.children(".slick-slide").length))):!0===a.options.variableWidth?a.$slideTrack.width(5e3*a.slideCount):(a.slideWidth=Math.ceil(a.listWidth),a.$slideTrack.height(Math.ceil(a.$slides.first().outerHeight(!0)*a.$slideTrack.children(".slick-slide").length)));var b=a.$slides.first().outerWidth(!0)-a.$slides.first().width();!1===a.options.variableWidth&&a.$slideTrack.children(".slick-slide").width(a.slideWidth-b)},b.prototype.setFade=function(){var b,c=this;c.$slides.each(function(d,e){b=c.slideWidth*d*-1,!0===c.options.rtl?a(e).css({position:"relative",right:b,top:0,zIndex:c.options.zIndex-2,opacity:0}):a(e).css({position:"relative",left:b,top:0,zIndex:c.options.zIndex-2,opacity:0})}),c.$slides.eq(c.currentSlide).css({zIndex:c.options.zIndex-1,opacity:1})},b.prototype.setHeight=function(){var a=this;if(1===a.options.slidesToShow&&!0===a.options.adaptiveHeight&&!1===a.options.vertical){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);if(a.$list.css("height",b),!0===a.options.arrows){var c=a.$slides.eq(a.currentSlide),d=c.is(".has_caption")?b-c.find(".gallery_image_caption").outerHeight(!0):b;a.$prevArrow.css("height",d),a.$nextArrow.css("height",d)}}},b.prototype.setOption=b.prototype.slickSetOption=function(){var b,c,d,e,f,g=this,h=!1;if("object"===a.type(arguments[0])?(d=arguments[0],h=arguments[1],f="multiple"):"string"===a.type(arguments[0])&&(d=arguments[0],e=arguments[1],h=arguments[2],"responsive"===arguments[0]&&"array"===a.type(arguments[1])?f="responsive":void 0!==arguments[1]&&(f="single")),"single"===f)g.options[d]=e;else if("multiple"===f)a.each(d,function(a,b){g.options[a]=b});else if("responsive"===f)for(c in e)if("array"!==a.type(g.options.responsive))g.options.responsive=[e[c]];else{for(b=g.options.responsive.length-1;b>=0;)g.options.responsive[b].breakpoint===e[c].breakpoint&&g.options.responsive.splice(b,1),b--;g.options.responsive.push(e[c])}h&&(g.unload(),g.reinit())},b.prototype.setPosition=function(){var a=this;a.setDimensions(),a.setHeight(),!1===a.options.fade?a.setCSS(a.getLeft(a.currentSlide)):a.setFade(),a.$slider.trigger("setPosition",[a])},b.prototype.setProps=function(){var a=this,b=document.body.style;a.positionProp=!0===a.options.vertical?"top":"left","top"===a.positionProp?a.$slider.addClass("slick-vertical"):a.$slider.removeClass("slick-vertical"),void 0===b.WebkitTransition&&void 0===b.MozTransition&&void 0===b.msTransition||!0===a.options.useCSS&&(a.cssTransitions=!0),a.options.fade&&("number"==typeof a.options.zIndex?a.options.zIndex<3&&(a.options.zIndex=3):a.options.zIndex=a.defaults.zIndex),void 0!==b.OTransform&&(a.animType="OTransform",a.transformType="-o-transform",a.transitionType="OTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.MozTransform&&(a.animType="MozTransform",a.transformType="-moz-transform",a.transitionType="MozTransition",void 0===b.perspectiveProperty&&void 0===b.MozPerspective&&(a.animType=!1)),void 0!==b.webkitTransform&&(a.animType="webkitTransform",a.transformType="-webkit-transform",a.transitionType="webkitTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.msTransform&&(a.animType="msTransform",a.transformType="-ms-transform",a.transitionType="msTransition",void 0===b.msTransform&&(a.animType=!1)),void 0!==b.transform&&!1!==a.animType&&(a.animType="transform",a.transformType="transform",a.transitionType="transition"),a.transformsEnabled=a.options.useTransform&&null!==a.animType&&!1!==a.animType},b.prototype.setSlideClasses=function(a){var b,c,d,e,f=this;c=f.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),f.$slides.eq(a).addClass("slick-current"),!0===f.options.centerMode?(b=Math.floor(f.options.slidesToShow/2),!0===f.options.infinite&&(a>=b&&a<=f.slideCount-1-b?f.$slides.slice(a-b,a+b+1).addClass("slick-active").attr("aria-hidden","false"):(d=f.options.slidesToShow+a,c.slice(d-b+1,d+b+2).addClass("slick-active").attr("aria-hidden","false")),0===a?c.eq(c.length-1-f.options.slidesToShow).addClass("slick-center"):a===f.slideCount-1&&c.eq(f.options.slidesToShow).addClass("slick-center")),f.$slides.eq(a).addClass("slick-center")):a>=0&&a<=f.slideCount-f.options.slidesToShow?f.$slides.slice(a,a+f.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):c.length<=f.options.slidesToShow?c.addClass("slick-active").attr("aria-hidden","false"):(e=f.slideCount%f.options.slidesToShow,d=!0===f.options.infinite?f.options.slidesToShow+a:a,f.options.slidesToShow==f.options.slidesToScroll&&f.slideCount-a<f.options.slidesToShow?c.slice(d-(f.options.slidesToShow-e),d+e).addClass("slick-active").attr("aria-hidden","false"):c.slice(d,d+f.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false")),"ondemand"===f.options.lazyLoad&&(f.lazyLoad(),Cargo.Event.on("slideshow-lazyload",f.lazyLoad,this))},b.prototype.setupInfinite=function(){var b,c,d,e=this;if(!0===e.options.fade&&(e.options.centerMode=!1),!0===e.options.infinite&&!1===e.options.fade&&(c=null,e.slideCount>e.options.slidesToShow)){for(d=!0===e.options.centerMode?e.options.slidesToShow+1:e.options.slidesToShow,b=e.slideCount;b>e.slideCount-d;b-=1){c=b-1;var f=a(e.$slides[c]).clone(!0).attr({id:"","data-exclude-item":""});f.find("[data-gallery-item], [data-gallery-item] *").attr("data-exclude-item",""),f.attr("data-slick-index",c-e.slideCount).prependTo(e.$slideTrack).addClass("slick-cloned")}for(b=0;b<d;b+=1){c=b;var f=a(e.$slides[c]).clone(!0).attr({id:"","data-exclude-item":""});f.find("[data-gallery-item], [data-gallery-item] *").attr("data-exclude-item",""),f.attr("data-slick-index",c+e.slideCount).appendTo(e.$slideTrack).addClass("slick-cloned")}e.$slideTrack.find(".slick-cloned").find("[id]").each(function(){a(this).attr("id","")})}},b.prototype.interrupt=function(a){var b=this;a||b.autoPlay(),b.interrupted=a},b.prototype.selectHandler=function(b){var c=this,d=a(b.target).is(".slick-slide")?a(b.target):a(b.target).parents(".slick-slide"),e=parseInt(d.attr("data-slick-index"));if(e||(e=0),c.slideCount<=c.options.slidesToShow)return c.setSlideClasses(e),void c.asNavFor(e);c.slideHandler(e)},b.prototype.slideHandler=function(a,b,c){var d,e,f,g,h,i=null,j=this;if(b=b||!1,(!0!==j.animating||!0!==j.options.waitForAnimate)&&!(!0===j.options.fade&&j.currentSlide===a||j.slideCount<=j.options.slidesToShow)){if(!1===b&&j.asNavFor(a),d=a,i=j.getLeft(d),g=j.getLeft(j.currentSlide),j.currentLeft=null===j.swipeLeft?g:j.swipeLeft,!1===j.options.infinite&&!1===j.options.centerMode&&(a<0||a>j.getDotCount()*j.options.slidesToScroll))return void(!1===j.options.fade&&(d=j.currentSlide,!0!==c?j.animateSlide(g,function(){j.postSlide(d)}):j.postSlide(d)));if(!1===j.options.infinite&&!0===j.options.centerMode&&(a<0||a>j.slideCount-j.options.slidesToScroll))return void(!1===j.options.fade&&(d=j.currentSlide,!0!==c?j.animateSlide(g,function(){j.postSlide(d)}):j.postSlide(d)));if(j.options.autoplay&&clearInterval(j.autoPlayTimer),e=d<0?j.slideCount%j.options.slidesToScroll!=0?j.slideCount-j.slideCount%j.options.slidesToScroll:j.slideCount+d:d>=j.slideCount?j.slideCount%j.options.slidesToScroll!=0?0:d-j.slideCount:d,j.animating=!0,j.$slider.trigger("beforeChange",[j,j.currentSlide,e]),f=j.currentSlide,j.currentSlide=e,j.setSlideClasses(j.currentSlide),j.options.asNavFor&&(h=j.getNavTarget(),h=h.slick("getSlick"),h.slideCount<=h.options.slidesToShow&&h.setSlideClasses(j.currentSlide)),j.updateDots(),j.updateArrows(),!0===j.options.fade)return!0!==c?(j.fadeSlideOut(f),j.fadeSlide(e,function(){j.postSlide(e)})):j.postSlide(e),void j.animateHeight();!0!==c?j.animateSlide(i,function(){j.postSlide(e)}):j.postSlide(e)}},b.prototype.startLoad=function(){var a=this;!0===a.options.arrows&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.hide(),a.$nextArrow.hide()),!0===a.options.dots&&a.slideCount>a.options.slidesToShow&&a.$dots.hide(),a.$slider.addClass("slick-loading")},b.prototype.swipeDirection=function(){var a,b,c,d,e=this;return a=e.touchObject.startX-e.touchObject.curX,b=e.touchObject.startY-e.touchObject.curY,c=Math.atan2(b,a),d=Math.round(180*c/Math.PI),d<0&&(d=360-Math.abs(d)),d<=45&&d>=0?!1===e.options.rtl?"left":"right":d<=360&&d>=315?!1===e.options.rtl?"left":"right":d>=135&&d<=225?!1===e.options.rtl?"right":"left":!0===e.options.verticalSwiping?d>=35&&d<=135?"down":"up":"vertical"},b.prototype.swipeEnd=function(a){var b,c,d=this;if(d.dragging=!1,d.interrupted=!1,d.shouldClick=!(d.touchObject.swipeLength>10),d.$slider.removeAttr("data-in-transition"),void 0===d.touchObject.curX)return!1;if(!0===d.touchObject.edgeHit&&d.$slider.trigger("edge",[d,d.swipeDirection()]),d.touchObject.swipeLength>=d.touchObject.minSwipe){switch(c=d.swipeDirection()){case"left":case"down":b=d.options.swipeToSlide?d.checkNavigable(d.currentSlide+d.getSlideCount()):d.currentSlide+d.getSlideCount(),d.currentDirection=0;break;case"right":case"up":b=d.options.swipeToSlide?d.checkNavigable(d.currentSlide-d.getSlideCount()):d.currentSlide-d.getSlideCount(),d.currentDirection=1}"vertical"!=c&&(d.slideHandler(b),d.touchObject={},d.$slider.trigger("swipe",[d,c]))}else d.touchObject.startX!==d.touchObject.curX&&(d.slideHandler(d.currentSlide),d.touchObject={})},
b.prototype.swipeHandler=function(b){var c=this;if("move"===b.data.action&&c.showUI(),a(b.target).closest(".slick-arrow").length?clearTimeout(this.hideUITimer):"mouseleave"==b.type?this.hideUITimer=setTimeout(this.hideUI,250):this.hideUITimer=setTimeout(this.hideUI,1500),!(!1===c.options.swipe||"ontouchend"in document&&!1===c.options.swipe||!1===c.options.draggable&&-1!==b.type.indexOf("mouse")))switch(c.touchObject.fingerCount=b.originalEvent&&void 0!==b.originalEvent.touches?b.originalEvent.touches.length:1,c.touchObject.minSwipe=c.listWidth/c.options.touchThreshold,!0===c.options.verticalSwiping&&(c.touchObject.minSwipe=c.listHeight/c.options.touchThreshold),b.data.action){case"start":c.swipeStart(b);break;case"move":c.swipeMove(b);break;case"end":c.swipeEnd(b)}},b.prototype.showUI=function(){this.$slider.find(".slick-arrow").removeClass("hidden"),clearTimeout(this.hideUITimer)},b.prototype.hideUI=function(){this.hideUITimer=null,this.$slider.find(".slick-arrow").addClass("hidden")},b.prototype.swipeMove=function(a){var b,c,d,e,f,g=this;return f=void 0!==a.originalEvent?a.originalEvent.touches:null,!(!g.dragging||f&&1!==f.length)&&(b=g.getLeft(g.currentSlide),g.touchObject.curX=void 0!==f?f[0].pageX:a.clientX,g.touchObject.curY=void 0!==f?f[0].pageY:a.clientY,g.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(g.touchObject.curX-g.touchObject.startX,2))),!0===g.options.verticalSwiping&&(g.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(g.touchObject.curY-g.touchObject.startY,2)))),"vertical"!==(c=g.swipeDirection())?(void 0!==a.originalEvent&&g.touchObject.swipeLength>4&&a.preventDefault(),e=(!1===g.options.rtl?1:-1)*(g.touchObject.curX>g.touchObject.startX?1:-1),!0===g.options.verticalSwiping&&(e=g.touchObject.curY>g.touchObject.startY?1:-1),d=g.touchObject.swipeLength,g.touchObject.edgeHit=!1,!1===g.options.infinite&&(0===g.currentSlide&&"right"===c||g.currentSlide>=g.getDotCount()&&"left"===c)&&(d=g.touchObject.swipeLength*g.options.edgeFriction,g.touchObject.edgeHit=!0),!1===g.options.vertical?g.swipeLeft=b+d*e:g.swipeLeft=b+d*(g.$list.height()/g.listWidth)*e,!0===g.options.verticalSwiping&&(g.swipeLeft=b+d*e),!0!==g.options.fade&&!1!==g.options.touchMove&&(!0===g.animating?(g.swipeLeft=null,!1):void g.setCSS(g.swipeLeft))):void 0)},b.prototype.swipeStart=function(a){var b,c=this;if(c.interrupted=!0,1!==c.touchObject.fingerCount||c.slideCount<=c.options.slidesToShow)return c.touchObject={},!1;void 0!==a.originalEvent&&void 0!==a.originalEvent.touches&&(b=a.originalEvent.touches[0]),c.touchObject.startX=c.touchObject.curX=void 0!==b?b.pageX:a.clientX,c.touchObject.startY=c.touchObject.curY=void 0!==b?b.pageY:a.clientY,setTimeout(function(){c.interrupted&&c.$slider.attr("data-in-transition","")},10),c.dragging=!0},b.prototype.unfilterSlides=b.prototype.slickUnfilter=function(){var a=this;null!==a.$slidesCache&&(a.unload(),a.$slideTrack.children(this.options.slide).detach(),a.$slidesCache.appendTo(a.$slideTrack),a.reinit())},b.prototype.unload=function(){var b=this;a(".slick-cloned",b.$slider).remove(),b.$dots&&b.$dots.remove(),b.$prevArrow&&b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.remove(),b.$nextArrow&&b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.remove(),b.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},b.prototype.unslick=function(a){var b=this;b.$slider.trigger("unslick",[b,a]),b.destroy()},b.prototype.updateArrows=function(){var a=this;Math.floor(a.options.slidesToShow/2),!0===a.options.arrows&&a.slideCount>a.options.slidesToShow&&!a.options.infinite&&(a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===a.currentSlide?(a.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-a.options.slidesToShow&&!1===a.options.centerMode?(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-1&&!0===a.options.centerMode&&(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},b.prototype.updateDots=function(){var a=this;null!==a.$dots&&(a.$dots.find("li").removeClass("slick-active").attr("aria-hidden","true"),a.$dots.find("li").eq(Math.floor(a.currentSlide/a.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden","false"))},b.prototype.visibility=function(){var a=this;a.options.autoplay&&(document[a.hidden]?a.interrupted=!0:a.interrupted=!1)},a.fn.slick=function(){var a,c,d=this,e=arguments[0],f=Array.prototype.slice.call(arguments,1),g=d.length;for(a=0;a<g;a++)if("object"==typeof e||void 0===e?d[a].slick=new b(d[a],e):c=d[a].slick[e].apply(d[a].slick,f),void 0!==c)return c;return d}}(jQuery)}(),function(a,b){var c=function(a,b,c){if(!1!==a.prototype.hasOwnProperty(name))return!1;a.prototype[b]=c};c(Node,"saveable",!1),c(Node,"setSaveable",function(a){return this.saveable=a,this}),c(Node,"isSaveable",function(){return this.saveable}),Node.prototype.persistCloneNode=function(){var a=function(b,c,d){for(var e=0;e<b.childNodes.length;e++)d(b.childNodes[e],c.childNodes[e]),0<b.childNodes[e].childNodes.length&&a(b.childNodes[e],c.childNodes[e],d)},b=Node.prototype.cloneNode.apply(this,arguments);return!0===this.isSaveable()&&b.setSaveable(!0),0<this.childNodes.length&&a(this,b,function(a,b){!0===a.isSaveable()&&b.setSaveable(!0)}),b},this.core={markAsEditable:function(a){}}}(window.CargoEditor=window.CargoEditor||{}),function(){"use strict";function a(){return this.data={main_margin:0,mobile_formatting:!1,mobile_padding:0,mobile_zoom:20},this.cache={chrome:0,offset:0,size:0,window:{h:0,w:0}},_.extend(this,Backbone.Events),this.listenTo(Cargo.Event,"design:ready",this.initialize),$(document).on("ready.BaseUnit",_.bind(this.onDocumentReady,this)),this}a.prototype.addEventListeners=function(){this.listenTo(Cargo.Event,"content_load_complete",this.refresh),this.listenTo(Cargo.Event,"editor-image-added handleAdminUIChange",this.onEditorChange),this.listenTo(Cargo.Event,"handleAdminUIChange",this.handleAdminUIChange);var a=Cargo.Helper.isMobile(),b=(a?"orientationchange":"resize")+".BaseUnit",c=a&&!Cargo.Helper.isIOS()?_.debounce(_.bind(this.onWindowResize,this),150):a&&Cargo.Helper.isIOS()?_.debounce(_.bind(this.onWindowResize,this),150):_.bind(this.onWindowResize,this);return $(window).on(b,c),$(window).on("load.BaseUnit",_.bind(this.onWindowLoad,this)),this},a.prototype.removeEventListeners=function(){return this.stopListening(),$(document).off(".BaseUnit"),$(window).off(".BaseUnit"),this},a.prototype.handleAdminUIChange=function(a,b){switch(a){case"mobile_formatting":case"mobile_pages_full_width":this.data[a]=b;break;case"main_margin":case"mobile_padding":case"mobile_zoom":this.data[a]=parseFloat(b)}return this.setBaseUnit(),this.triggerEvent("refresh"),this},a.prototype.onDocumentReady=function(a){this.$html=$(document.documentElement),this.addEventListeners(),Cargo.Event.trigger("design:ready")},a.prototype.onWindowLoad=function(a){CargoEditor&&CargoEditor.events&&this.listenTo(CargoEditor.events,"editor-summary-created",this.onEditorChange),this.cacheWindowSize(),this.refresh()},a.prototype.isIphoneX=function(){var a=window.devicePixelRatio||1,b={width:window.screen.width*a,height:window.screen.height*a};return!(!/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||1125!=b.width||2436!==b.height)},a.prototype.onWindowResize=function(a){this.cacheWindowSize(),this.setBaseUnit(),this.triggerEvent("refresh")},a.prototype.onEditorChange=_.debounce(function(){this.refresh(),Cargo.Plugins.elementResizer.refresh()},0),a.prototype.initialize=function(){var a=Cargo.Model.DisplayOptions.get("layout_options");return this.data=_.extend(this.data,a),this.data.mobile_zoom=parseFloat(this.data.mobile_zoom),this.data.mobile_padding=parseFloat(this.data.mobile_padding),this.data.main_margin=parseFloat(this.data.main_margin),this.cacheWindowSize(),this.refresh(),Cargo.Plugins.elementResizer.refresh(),this},a.prototype.refresh=function(){return this.setBaseUnit(),this.triggerEvent("refresh"),this},a.prototype.cacheWindowSize=function(){return Cargo.Helper.isMobile()?(document.documentElement.clientWidth>window.innerHeight?(this.cache.window.h=screen.width||window.innerHeight,this.cache.window.w=screen.height||document.documentElement.clientWidth,this.isIphoneX()&&(this.cache.window.w=document.documentElement.clientWidth)):(this.cache.window.h=screen.height||window.innerHeight,this.cache.window.w=screen.width||document.documentElement.clientWidth),this.cache.chrome=this.cache.window.h-window.innerHeight,this):(this.cache.window.h=window.innerHeight,this.cache.window.w=document.documentElement.clientWidth,this)},a.prototype.setBaseUnit=function(){var a=0,b=this.data.mobile_padding,c=this.data.mobile_zoom-15,d=0;return this.cache.window.h>this.cache.window.w&&(a=this.cache.window.h/this.cache.window.w-1),a/=.777777778,a>1&&(a=1),b=Math.abs(b)/10,b=this.data.main_margin*b*a*-1,d=this.getBaseUnit({weight:9+c*a,min:20}),this.triggerEvent("set",{diff:a,offset:b,size:d}),this.cache.size===d?this:(this.$html.css("font-size",d+"%"),this.cache.size=d,this)},a.prototype.getBaseUnit=function(a){a=a||{};var b=0;return a=$.extend(!0,{height:this.cache.window.h,width:this.cache.window.w,min:11,max:!1,weight:5,round:!1,offset:1},a),b=a.width<a.height?a.width:a.height,b*=a.offset,b/=100/a.weight,a.min&&b<a.min&&(b=a.min),a.max&&b>a.max&&(b=a.max),a.round&&(b=Math.floor(b)),b},a.prototype.triggerEvent=function(a,b){return a="BaseUnit:"+a,b=b||{},Cargo.Event.trigger(a,_.extend(b,{cache:this.cache,data:this.data})),this},window.BaseUnit=a}(),function(){"use strict";function a(a,b){var c=Element.prototype,d=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||function(a){return-1!==[].indexOf.call(document.querySelectorAll(a),this)};try{return d.call(a,b)}catch(a){console.warn(a)}return!1}function b(){return this.cache={},this.data={},_.extend(this,Backbone.Events),$(document).on("ready.MobileAdjustments",_.bind(this.setup,this)),this.listenTo(Cargo.Event,"BaseUnit:refresh BaseUnit:set",this.cacheChanges),this.listenTo(Cargo.Event,"slideshow_update BaseUnit:refresh",this.stretchShortMobileContent),this.listenTo(Cargo.Event,"mobile_size",this.setMobileClass),this}b.prototype.setup=function(){this.$body=$(document.body),this.$main=$("main"),this.$containerPadding=$("[data-container-padding]"),this.$contentPadded=$(".l-content-padding"),this.$contentRuler=$("[data-content-ruler]"),this.listenTo(Cargo.Event,"BaseUnit:set content_load_complete set_render_complete thumbnails_render_complete inspector_style_changed",this.onOtherEvent)},b.prototype.stretchShortMobileContent=function(){if(!_.isEmpty(this.cache)){var a=this.cache.window.h-this.cache.chrome>=this.$contentPadded.outerHeight();return this.data.mobile_formatting||!a?(this.$main.css({position:"",top:"",bottom:"",minHeight:""}),this):(this.$main.css({position:"fixed",top:0,bottom:0,minHeight:0}),this)}},b.prototype.forceMobileSizing=function(){return this.$contentRuler.width()/this.data.window.w*100>85},b.prototype.setMobileClass=function(a){this.$body||(this.$body=$(document.body));var b=a?"addClass":"removeClass";this.is_mobile_size=a,this.$body[b]("mobile"),this.setPagesToFullWidth()},b.prototype.setMobilePaddingOffset=function(b){var c=this,d=this.$body.find(".content_padding");this.mobile_padding=parseFloat(b.mobile_padding),d.each(function(){if(c.is_mobile_size){var a,b,d=parseInt($(this).closest("[data-id]").attr("data-id")),e=Cargo.Collection.Scaffolding.getModel({id:d}),f=["top","right","bottom","left"];if(Cargo.Helper.IsAdminEdit()&&void 0!==parent.Cargo&&void 0!==parent.Cargo.Editor&&void 0!==parent.Cargo.Editor.View&&void 0!==parent.Cargo.Editor.View.ContentView&&parent.Cargo.Editor.View.ContentView.$el.is("#editproject")&&parent.Cargo.Editor.View.ContentView.pid==d){if(a=!0,void 0===parent.Cargo.Editor.View.ContentView.layoutOptions)return;b=parent.Cargo.Editor.View.ContentView.layoutOptions.getCurrentValues()}else a=!1,b=void 0!==e?e.getPageOption("local_layout_options"):Cargo.Model.DisplayOptions.get("layout_options");var g,h,i=Cargo.Model.DisplayOptions.get("layout_options");_.each(f,function(d){if(g="main_margin_"+d,h=NaN,b&&void 0!==b[g]?h=a?parseFloat(b[g].value):parseFloat(b[g]):i&&void 0!==i[g]&&(h=parseFloat(i[g])),isNaN(h))return void this.style.removeProperty("padding-"+d);var e=c.calculateMobilePaddingOffset(h);this.style.setProperty("padding-"+d,e+"rem")},this)}else this.removeAttribute("style")});var e,f=document.getElementById("site_menu_button"),g=document.getElementById("shop_button"),h=[];f&&h.push(f),g&&h.push(g),_.each(document.styleSheets,function(a){a&&a.ownerNode&&"member_stylesheet"==a.ownerNode.id&&(e=a),a&&a.publicData&&"member_stylesheet"==a.publicData.id&&(e=a)}),e&&void 0!==h[0]&&_.each(h,function(b,d){var f;try{f=e.cssRules}catch(a){console.warn(a)}if(f){var g={top:"",right:"",bottom:"",left:""};_.each(f,function(c){a(b,c.selectorText)&&_.each(c.style,function(a){g.hasOwnProperty(a)&&(g[a]=c.style[a])})}),_.each(g,function(a,d){if(c.is_mobile_size){if(""!==a){var e=parseFloat(a),f=c.calculateMobilePaddingOffset(e);b.style[d]=f+"rem"}}else b.style[d]=""})}}),Cargo.Event.trigger("mobile_padding_set")},b.prototype.calculateMobilePaddingOffset=function(a){var b=a-Math.abs(this.mobile_padding)/10*a;return Number(b.toFixed(1))},b.prototype.setPagesToFullWidth=function(a){this.mobile_pages_full_width=void 0!==a?a.mobile_pages_full_width:this.data.mobile_pages_full_width;var b=this.mobile_pages_full_width&&this.is_mobile_size?"addClass":"removeClass";this.$body[b]("full_width")},b.prototype.onOtherEvent=function(){this.setMobilePaddingOffset(this.data),this.setPagesToFullWidth(this.data)},b.prototype.cacheChanges=function(a){this.cache=a.cache,this.data=a.data},b.prototype.eventPreventDefault=function(a){a.preventDefault()},window.MobileAdjustments=b}(),Cargo=window.Cargo||{},Cargo.Modal;var modal=Backbone.View.extend({id:"confirm_modal",defaults:{message:"Save changes?",modal_type:"save",selector:"body",textarea_value:""},template:null,existingLinkElement:void 0,events:{"click .modal-overlay":"ModalClose","click [data-confirm]":"ModalConfirm","click [data-deny]":"ModalDeny"},is_active:!1,blocked:!1,initialize:function(a){if(null==this.template){var b=this;$.get("/_jsapps/modal/modal.html",function(a){b.template=_.template(a)})}},render:function(){var a=this.template({modal:this.model.toJSON()});return this.$el.html(a),void 0!==Cargo.View&&void 0!==Cargo.View.Following&&!Cargo.View.Following.enabled&&void 0==Cargo.Homepage&&Cargo.Helper.IsAdminEdit()&&setTimeout(function(){$(this.el).attr("tabindex","-1"),$(this.el).focus(),setTimeout(function(){$(this.el).focus()}.bind(this),100)}.bind(this),100),Cargo.Event.once("enter_keycode_triggered",this.ModalConfirm,this),Cargo.Event.once("esc_keycode_triggered",this.ModalClose,this),"save"==this.model.get("modal_type")&&Cargo.Event.once("save_shortcut_triggered",this.ModalConfirm,this),void 0!==Cargo.View&&void 0!==Cargo.View.Following&&Cargo.View.Following.enabled&&Cargo.View.Following.scrollOffset&&(this.$el.find(".modal-overlay").css("top",Cargo.View.Following.scrollOffset.top+"px"),this.$el.find(".confirm-box").css("top","calc("+Cargo.View.Following.scrollOffset.top+"px + 40%)")),Cargo.Event.trigger("modal_render_complete"),this},Confirm:function(a){a=a||{},a.modal_type="confirm",this.show(a)},ConfirmWithProgress:function(a){a=a||{},a.modal_type="confirm_with_progress",this.show(a)},Alert:function(a){a=a||{},a.modal_type="alert",this.show(a)},Prompt:function(a){a=a||{},a.modal_type="prompt",this.show(a),setTimeout(_.bind(function(){var a=$("[data-modal-textarea]",this.el)[0];a.focus();var b=a.value;a.value="",a.value=b},this),300)},Dialog:function(a){a=a||{},a.modal_type="dialog",this.show(a),setTimeout(_.bind(function(){$("[data-modal-textarea]",this.el).select()},this),300)},Block:function(a){a=a||{},a.modal_type="block",this.blocked=!0,this.show(a)},Save:function(a){a=a||{},a.modal_type="save",this.show(a)},show:function(a){this.model=null,this.model=new Backbone.Model(this.defaults),_.extend(this.model.attributes,a),$(this.model.get("selector")).append(this.render().el),Cargo.Event.trigger("confirm_modal:open"),this.is_active=!0},isActive:function(){return this.is_active},ModalConfirm:function(){var a,b=this.model.get("modal_type");"function"==typeof this.model.get("confirm")&&("prompt"==b&&(a=$("[data-modal-textarea]",this.el).val()),this.model.get("confirm")(a)),this.model.set("modal_type",null),"confirm_with_progress"==b?this.ShowProgress():this.ModalClose()},ModalDeny:function(){"function"==typeof this.model.get("deny")&&this.model.get("deny")(),this.ModalClose()},ModalClose:function(){if(!0!==this.blocked){if("alert"==this.model.get("modal_type"))return this.model.set("modal_type",null),void this.ModalConfirm();this.is_active=!1,Cargo.Event.off("enter_keycode_triggered",this.ModalConfirm),Cargo.Event.off("enter_keycode_triggered",this.ModalClose),Cargo.Event.off("esc_keycode_triggered",this.ModalClose),Cargo.Event.off("save_shortcut_triggered",this.ModalConfirm),Cargo.Event.trigger("confirm_modal:close"),$(document).off("keydown.confirm_modal"),this.el.remove()}},ShowProgress:function(){this.blocked=!0,$("[data-modal-message] div").html(this.model.get("progress_message")),$("[data-deny], [data-confirm]",this.el).hide(),$("[data-progress]",this.el).show(),this.UpdateProgress(0)},UpdateProgress:function(a){var b=$("[data-progress]",this.el),c=b.find(".progress-indicator"),d=b.find(".progress-percentage");0!=a||this.processing?a>10&&(c.find(".loading_animation").length>0&&(c.removeClass("waiting"),c.find(".loading_animation").remove()),c.css("width",a+"%"),d.text(a+"%")):(c.addClass("waiting").html(Cargo.Core.Handlebars.Render("{{>loading_animation}}",{})),this.processing=!0),100==a&&(this.processing=!1,this.blocked=!1)}});Cargo.Modal=new modal;var Backdrop={Data:{require_loaded:!1}};Backdrop.o={},Backdrop.o.model={},Backdrop.o.collection={},Backdrop.Model={},Backdrop.Collection={},Backdrop.View={},Backdrop.o.model.Settings=Backbone.Model.extend({constructor:function(){this.defaults={page_id:void 0,backdrop_id:1,backdrop_path:"none",data:{}},Backbone.Model.prototype.constructor.apply(this,arguments)},url:function(){var a=Cargo.API.Config;return a.api_path+"/"+a.Version+"/backdrop/"+Cargo.Model.Site.get("site_url")+"/"+this.get("page_id")+"/"+this.get("backdrop_id")}}),Backdrop.o.model.Global=Backbone.Model.extend({isNew:function(){return!0},fetch:function(a){$("[data-set='GlobalSettings']").length>0?this.set($.parseJSON($("[data-set='GlobalSettings']").html()),a):Backbone.Model.prototype.fetch.apply(this,arguments)},url:function(){var a=Cargo.API.Config;return a.api_path+"/"+a.Version+"/backdrop/"+a.cargo_url}});var Cargo=Cargo||{};Cargo.Plugins=Cargo.Plugins||{},function(){function a(){}a.prototype.initializeImage=function(a){},a.prototype.setSrcAccordingToSize=function(a){if(void 0!=a){var b=Math.floor(Math.min(250*Math.ceil(Math.max(childObj.actualWidth,parentWidth)/250),childObj.imageModel.get("width"))),c=childObj.imageModel.getImageWithOptions({w:b});c.retina&&childObj.actualWidth/c.w>.8&&(c=childObj.imageModel.getImageWithOptions({w:b,q:94})),(c.w>childObj.lastSize||c.q>childObj.lastQ)&&childObj.element.attr("src")!==c.url&&(childObj.element.attr("src",c.url),childObj.lastSize=c.w,childObj.lastQ=c.q,childObj.element[0].__cachedLastSize=c.w,childObj.element[0].__cachedLastQ=c.q)}},Cargo.Plugins.imageSrcLoader=new a}();var Cargo=Cargo||{};Cargo.Plugins=Cargo.Plugins||{},Cargo.Plugins.elementResizer=function(a){function b(a,c){var d=a&&(c(a)?a:b(a.parentNode,c));return d||null}var c=/googlebot|bingbot|crawler|spider|robot|crawling/i.test(navigator.userAgent),d={vars:{ticking:!1,initialized:!1,isInCargoFrame:function(){var a=/\/adminedit/.test(document.location.pathname)||/\/admin/.test(document.location.pathname);try{var b=parent!=window&&"object"==typeof parent.Cargo,c=void 0!=Cargo.Editor;return a||b||c}catch(a){return!1}}()},options:{cargo_refreshEvents:["homepage_loaded","show_index_complete","mobile_padding_set","inspector_preview","page_collection_reset","direct_link_loaded"],generic_refreshEvents:[],updateEvents:["resize","orientationchange"],selectors:["img","object","iframe","video",".elementresizer","[data-elementresizer-child]",".audio_component"],targets:{},minimumHeight:1,minimumWidth:1,centerElements:!0,adjustElementsToWindowHeight:!0,forceMobileImagesFullWidth:!1,forceMargin:!1,scrollTransition:!1,scrollTransitionThreshold:-100,forceVerticalMargin:40,forceHorizontalMargin:0,allowInit:!0},init:function(){function b(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}if(Cargo.Event.trigger("element_resizer_init",e),!d.options.allowInit)return!1;var c;a.each(d.options.updateEvents,function(a,e){b(window,e,function(){d.requestTick(),"resize"===e&&(clearTimeout(c),c=setTimeout(function(){d.requestTick()},100)),"orientationchange"===e&&(clearTimeout(c),c=setTimeout(function(){d.requestTick()},160))})}),a.each(d.options.generic_refreshEvents,function(a,c){b(window,c,function(){d.refresh()})}),Cargo.Event.on("pagination_complete",function(){d.matchImagesWithImageModels(),d.refresh(!0)}),a.each(d.options.cargo_refreshEvents,function(a,b){Cargo.hasOwnProperty("Event")&&Cargo.Event.on(b,function(){d.refresh()})}),Cargo.hasOwnProperty("Event")&&Cargo.Event.on("inspector_open",function(){CargoInspector.eventManager.subscribe("style_changed",function(a){d.update()})});try{var f=window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5)");"function"==typeof f.addListener&&f.addListener(function(){d.setResponsiveImageSrcs(),scrollMonitor.update()})}catch(a){}Cargo.Event.on("content_load_complete",function(){d.matchImagesWithImageModels(),d.update()}),Cargo.Event.on("thumbnails_hide",function(){_.defer(function(){d.update()})}),Cargo.Event.on("thumbnails_render_complete",function(){scrollMonitor.update()}),void 0!==Cargo.Collection&&void 0!==Cargo.Collection.Scaffolding&&Cargo.Collection.Scaffolding.on("add",_.debounce(function(){d.matchImagesWithImageModels(),d.update()},1)),Cargo.Event.on("pin_load_complete",function(){d.refresh()}),d.vars.initialized=!0,d.refresh()},refresh:function(c){if(!0!==c&&(c=!1),!d.vars.initialized)return!1;var e=a("[data-elementresizer]");c||(d.options.targets={}),e.each(function(e,f){if(c){if(_.find(d.options.targets,function(a){return a.container[0]===f}))return}var g=a(f).find(d.options.selectors.join(",")),h=a(b(f,function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.hasAttribute("data-resize-parent")}));0==h.length&&(h=a("body"));var i=[],j=[];g.each(function(c,e){var e=a(e),f=b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return a.classList.contains("image-gallery")});if(!f||f.classList.contains("initialized")){if(null===b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.hasAttribute("data-no-elementresizer")})&&!e[0].hasAttribute("data-no-elementresizer")){var g=b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.hasAttribute("grid-col")}),h=b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return a.classList.contains("slick")}),j=b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return a.hasAttribute("thumbnails")}),k=b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return"wallpaper"==a.getAttribute("data-backdrop")}),l=b(e[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return a.classList.contains("page_container")&&a.classList.contains("fixed")}),m=e.width(),n=e.height(),o=parseInt(e.attr("width")),p=parseInt(e.attr("height")),q="string"==typeof e.attr("height")&&-1!==e.attr("height").indexOf("%"),r="string"==typeof e.attr("width")&&-1!==e.attr("width").indexOf("%"),s=isNaN(o)?m:o,t=isNaN(p)?n:p,u=d.constrain(d.options.minimumHeight,0,t),v=d.constrain(d.options.minimumWidth,0,s),w={element:e,hasBeenHandled:!1,originalWidth:s,originalHeight:t,widthIsPercentage:r,heightIsPercentage:q,actualWidth:o,actualHeight:p,minimumHeight:u>t?t:u,minimumWidth:v>s?s:v,ratio:t/s,isInWallpaper:null!==k,isInSlideshow:null!==h,isInColumns:null!==g,isInThumbnails:null!==j,isInGallery:null!==f,isinFixedPinnedPage:null!==l,nodeName:e[0].nodeName.toLowerCase(),isAudioPlayer:e.hasClass("audio_component"),noResize:e.parent("[data-elementresizer-no-resize]").length>0||e[0].hasAttribute("data-elementresizer-no-resize"),noCentering:e.parent("[data-elementresizer-no-centering]").length>0||e[0].hasAttribute("data-elementresizer-no-centering"),noVerticalResize:e.parent("[data-elementresizer-no-vertical-resize]").length>0||e[0].hasAttribute("data-elementresizer-no-vertical-resize"),prevLeftMargin:0,lastSize:e[0]._cachedLastSize?e[0]._cachedLastSize:0,lastQ:e[0]._cachedLastQ?e[0]._cachedLastQ:0,isSoundCloudFrame:-1!==(e.attr("src")+"").indexOf("soundcloud")&&"IFRAME"===e[0].nodeName};i.push(w)}}}),i=i.concat(j);var k=parseInt(a(h).css("paddingLeft"))+parseInt(a(h).css("paddingRight"));isNaN(k)&&(k=0),d.options.targets[_.uniqueId()]={container:a(f),resize_parent:h,children:i,padding:k}}),d.matchImagesWithImageModels(),d.update()},matchImagesWithImageModels:function(){_.each(d.options.targets,function(a){if(Cargo.View.ImagesView)_.each(a.children,function(a){if(a.element[0].nodeType===Node.ELEMENT_NODE&&"IMG"===a.element[0].nodeName){var b=parseInt(a.element[0].getAttribute("data-mid"));isNaN(b)||(a.imageModel=Cargo.View.ImagesView.collection.findWhere({id:b}))}});else if(a.container[0].hasAttribute("thumbnails"))_.each(a.children,function(a){if(!a.imageModel){var c=b(a.element[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return a.classList.contains("thumbnail")});if(c){var d=parseInt(c.getAttribute("data-id")),e=Cargo.View.Thumbnail.collection.get(d);if(e&&e.get("thumb_meta")&&e.get("thumb_meta").thumbnail_crop&&e.get("thumb_meta").thumbnail_crop.imageModel)a.imageModel=new Cargo.o.model.image(e.get("thumb_meta").thumbnail_crop.imageModel);else{var f=Cargo.Collection.Scaffolding.getModel({id:d});if(void 0!==f&&void 0!==f.get("images")){var g=parseInt(a.element[0].getAttribute("data-mid"));isNaN(g)||(a.imageModel=_.where(f.get("images"),{id:g})[0])}}}}});else{var c,d=b(a.container[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE&&"DIV"===a.nodeName)return a.hasAttribute("data-id")});if(d&&(c=parseInt(d.getAttribute("data-id"))),!isNaN(c)){var e=Cargo.Collection.Scaffolding.getModel({id:parseInt(c)});void 0!==e&&void 0!==e.get("images")&&_.each(a.children,function(a){var b=parseInt(a.element[0].getAttribute("data-mid"));isNaN(b)||(a.imageModel=_.where(e.get("images"),{id:b})[0])})}}})},requestTick:function(){d.vars.ticking||(requestAnimationFrame(function(){d.update()}),d.vars.ticking=!0)},constrain:function(a,b,c){return a>c?c:a<b?b:a},update:function(){var c,f,g,h;for(c in d.options.targets){h=d.options.targets[c];var i=h.container.width(),j=(h.padding,h.resize_parent.width()-d.options.forceHorizontalMargin),k=d.options.adjustElementsToWindowHeight?document.documentElement.clientHeight-d.options.forceVerticalMargin:9e9,l=d.options.forceMobileImagesFullWidth&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth),m=1;d.options.adjustElementsToWindowHeight&&void 0!==window.orientation&&0!=window.orientation&&(r=document.documentElement.clientWidth-(!1===d.options.forceMargin?40:d.options.forceMargin));var n=function(){if(d.vars.isInCargoFrame){return null!==b(h.container[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.classList.contains("page_content")})}return!1}();for(f in h.children){var o=j,g=h.children[f],p=g.minimumHeight,q=g.minimumWidth,r=k,s=l?1:parseInt(g.element.attr("data-scale"))/100||1;if(!g.noResize){if(g.isInColumns){var t=b(g.element[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.hasAttribute("grid-col")});t&&(i=o=a(t).width(),o-=d.options.forceHorizontalMargin)}if(g.noVerticalResize)r=9e9;else{var u=b(h.container[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.classList.contains("content_padding")}),v=0;u&&(v+=Math.ceil(parseFloat(a(u).css("padding-top"),10))),Cargo.View.PinnedTop.pinCollection.findWhere({content_accommodate_page:!0})&&(v+=Cargo.View.PinnedTop.pinCollection.findWhere({content_accommodate_page:!0}).get("page_height")),v=Math.min(v,.25*k),r=k+-2*v}var w=g.actualWidth,x=g.actualHeight,o=o*s,m=(d.constrain(o-w,1,9e9),d.constrain(r-x,1,9e9),[o/g.actualWidth,r/g.actualHeight]);m=Math.min(m[0],m[1]),x=d.constrain(x*m,-9e9,g.originalHeight),w=d.constrain(w*m,-9e9,g.originalWidth),g.widthIsPercentage?(w=i/100*g.originalWidth,x=g.heightIsPercentage?g.originalHeight/100*w:g.originalHeight):g.heightIsPercentage&&(x=w/100*g.originalHeight),(x<=p||w<=q)&&(m=[q/w,p/x],m=Math.max(m[0],m[1]),x*=m,w*=m),(!1===g.hasBeenHandled||Math.abs(g.actualWidth-w)>.5||Math.abs(g.actualHeight-x)>.5)&&(isNaN(w)||isNaN(x)||(g.actualWidth=w,g.actualHeight=x,g.element.add("object"===g.nodeName?g.element.find("embed"):"").css({width:g.actualWidth+"px",height:g.actualHeight+"px"}),g.hasBeenHandled=!0))}d.options.centerElements&&!g.noCentering&&d.setLeftMargin(g,i);var y=g.isInGallery||g.isInThumbnails?g.element.parent():g.element;if(g.isInSlideshow&&g.isInGallery)var y=a(b(g.element[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.classList.contains("image-gallery")}));n||"undefined"==typeof scrollMonitor||g.isinFixedPinnedPage||(void 0!==g.element[0]._scrollWatcher||g.isInSlideshow&&g.isInGallery||(g.element[0]._scrollWatcher=scrollMonitor.create(g.element[0],screen.height),g.element[0]._scrollWatcher.enterViewport(function(){this.watchItem._animationFrameCancelID=requestAnimationFrame(_.bind(function(){this.watchItem.hasAttribute("data-lazy-src")&&(this.watchItem.setAttribute("src",this.watchItem.getAttribute("data-lazy-src")),this.watchItem.removeAttribute("data-lazy-src")),d.options.scrollTransition&&!n&&y.css("will-change","opacity, transform"),delete this.watchItem._animationFrameCancelID},this))}),g.element[0]._scrollWatcher.exitViewport(function(){this.watchItem._animationFrameCancelID&&cancelAnimationFrame(this.watchItem._animationFrameCancelID),this.isBelowViewport&&d.options.scrollTransition&&!n&&y.css("will-change","")})),d.options.scrollTransition?(n||y.addClass("scroll-transition-fade"),void 0!==g.element[0]._scrollWatchEnterThreshold||y[0]._is_watched||(g.element[0]._scrollWatchEnterThreshold=scrollMonitor.create(y[0],d.options.scrollTransitionThreshold),y[0]._is_watched=!0,g.element[0]._scrollWatchEnterThreshold.enterViewport(function(){this.watchItem._startScrollWatchLeave&&(cancelAnimationFrame(this.watchItem._startScrollWatchLeave),delete this.watchItem._startScrollWatchLeave),this.watchItem._endScrollWatchLeave&&(cancelAnimationFrame(this.watchItem._endScrollWatchLeave),delete this.watchItem._endScrollWatchLeave),a(this.watchItem).css({"transition-duration":""}),a(this.watchItem).removeClass("below-viewport")})),void 0===g.element[0]._referenceScrollWatch&&(g.element[0]._referenceScrollWatch=scrollMonitor.create(y[0]),g.element[0]._referenceScrollWatch.enterViewport(function(){scrollMonitor.documentHeight-this.bottom<=-1*d.options.scrollTransitionThreshold&&a(this.watchItem).removeClass("below-viewport")}),g.element[0]._referenceScrollWatch.exitViewport(function(){this.isBelowViewport&&!n?(a(this.watchItem).css("transition-duration","initial"),this.watchItem._startScrollWatchLeave=requestAnimationFrame(_.bind(function(){a(this.watchItem).addClass("below-viewport"),function(a){
void 0!==a._scrollWatchEnterThreshold&&a._scrollWatchEnterThreshold.recalculateLocation(),void 0!==a._referenceScrollWatch&&a._referenceScrollWatch.recalculateLocation()}(g.element[0]),this.watchItem._endScrollWatchLeave=requestAnimationFrame(_.bind(function(){a(this.watchItem).css("transition-duration","")},this))},this))):this.isAboveViewport&&(a(this.watchItem).removeClass("below-viewport"),a(this.watchItem).css("will-change",""))})),void 0===y[0]._reCalculateScrolMonitorOnTransitionEnd&&(!function(a){y[0]._reCalculateScrolMonitorOnTransitionEnd=function(b){var c=b.propertyName;"transform"!=c&&"top"!=c&&"margin-top"!=c&&"margin"!=c||(void 0!==a._scrollWatchEnterThreshold&&(a._scrollWatchEnterThreshold.recalculateLocation(),a._scrollWatchEnterThreshold.update(),a._scrollWatchEnterThreshold.triggerCallbacks()),void 0!==a._referenceScrollWatch&&(a._referenceScrollWatch.recalculateLocation(),a._referenceScrollWatch.update(),a._referenceScrollWatch.triggerCallbacks()))}}(g.element[0]),y[0].addEventListener("transitionend",y[0]._reCalculateScrolMonitorOnTransitionEnd)),!g.element[0]._referenceScrollWatch.isBelowViewport||g.element[0]._referenceScrollWatch.isInViewport||n?g.element[0]._referenceScrollWatch.isInViewport&&(y.css("transition-duration","initial"),y.removeClass("below-viewport")):(y.css("transition-duration","initial"),y.addClass("below-viewport"))):(void 0!==y[0]._scrollWatchEnterThreshold&&(y[0]._scrollWatchEnterThreshold.destroy(),delete y[0]._scrollWatchEnterThreshold,y.removeClass("scroll-transition-fade below-viewport")),void 0!==y[0]._referenceScrollWatch&&(y[0]._referenceScrollWatch.destroy(),delete y[0]._referenceScrollWatch),void 0!==y[0]._reCalculateScrolMonitorOnTransitionEnd&&(y[0].removeEventListener("transitionend",y[0]._reCalculateScrolMonitorOnTransitionEnd),delete y[0]._reCalculateScrolMonitorOnTransitionEnd)))}}d.setResponsiveImageSrcs(),d.vars.ticking=!1,"undefined"!=typeof scrollMonitor&&scrollMonitor.update(),Cargo.Event.trigger("elementresizer_update_complete",e)},setResponsiveImageSrcs:function(){var a=!1;_.each(this.options.targets,function(d){var e,f,g,h=d.container.width();for(g=0;g<d.children.length;g++)if(f=d.children[g],isNaN(f.actualWidth)||void 0===f.imageModel||"function"!=typeof f.imageModel.get)c&&f.element[0].setAttribute("src",f.element[0].getAttribute("data-src"));else if(c)if(f.imageModel.get("width")>3500){var i=f.imageModel.getImageWithOptions({w:3500});f.element[0].getAttribute("src")!==i.url&&f.element[0].setAttribute("src",i.url)}else f.element[0].setAttribute("src",f.element[0].getAttribute("data-src"));else{var j=!1;if(f.isInThumbnails)h=f.element[0].parentElement.offsetWidth,h=Math.max(.01*parseFloat(f.element[0].style.width)*h,h)||h,e=Math.floor(Math.min(250*Math.ceil(h/250),f.imageModel.get("width"))),j=!0;else if(f.isInGallery){if(null===b(f.element[0],function(a){if(a&&a.nodeType===Node.ELEMENT_NODE)return a.classList.contains("gallery_card")}))continue;h=f.element.closest(".gallery_card")[0].offsetWidth,e=Math.floor(Math.min(250*Math.ceil(h/250),f.imageModel.get("width"))),j=!0}else f.isInColumns?(h=f.element[0].parentElement.offsetWidth,e=Math.floor(Math.min(250*Math.ceil(Math.max(f.actualWidth,h)/250),f.imageModel.get("width")))):e=Math.floor(Math.min(250*Math.ceil(Math.max(f.actualWidth,h)/250),f.imageModel.get("width")));if(0!=e){var i=f.imageModel.getImageWithOptions({w:e});i.retina&&(j&&h/i.w>.51||f.actualWidth/i.w>.51)&&(i=f.imageModel.getImageWithOptions({w:e,q:94})),i.w>=0&&(i.w>f.lastSize||i.q>f.lastQ)&&(f.isInSlideshow&&!f.element[0].hasAttribute("src")?(f.element[0].hasAttribute("data-lazy")||(a=!0),f.element[0].hasAttribute("data-lazy")!==i.url&&f.element[0].setAttribute("data-lazy",i.url)):f.element[0]._scrollWatcher&&!f.isInWallpaper?f.element[0]._scrollWatcher.isInViewport?f.element[0].getAttribute("src")!==i.url&&f.element[0].setAttribute("src",i.url):f.element[0].getAttribute("src")!==i.url&&f.element[0].getAttribute("data-lazy-src")!==i.url&&f.element[0].setAttribute("data-lazy-src",i.url):f.element[0].getAttribute("src")!==i.url&&f.element[0].setAttribute("src",i.url),f.lastSize=i.w,f.lastQ=i.q,f.element[0]._cachedLastSize=i.w,f.element[0]._cachedLastQ=i.q)}}},this),a&&Cargo.Event.trigger("slideshow-lazyload")},setLeftMargin:function(a,b,c){var d;d=a.isSoundCloudFrame?(b-a.element.width())/2:(b-a.actualWidth)/2,isNaN(d)||(a.prevLeftMargin!==d&&a.element.css("marginLeft",d),a.prevLeftMargin=d)}},e={options:d.options,init:d.init,refresh:d.refresh,update:d.update,setOptions:function(b){a.extend(d.options,b),!1!==d.options.forceMargin&&(d.options.forceHorizontalMargin=d.options.forceMargin,d.options.forceVerticalMargin=d.options.forceMargin),d.options.allowInit&&d.vars.initialized&&d.update()},targets:function(){return d.options.targets}};return a(function(){d.init()}),e}(jQuery),function(a,b){"use strict";!function(c,e){c.PhotoSwipe=function(){return function(c,e,f,g){var h={features:null,bind:function(a,b,c,d){var e=(d?"remove":"add")+"EventListener";b=b.split(" ");for(var f=0;f<b.length;f++)b[f]&&a[e](b[f],c,!1)},isArray:function(a){return a instanceof Array},createEl:function(a,b){var c=document.createElement(b||"div");return a&&(c.className=a),c},getScrollY:function(){var c=a.pageYOffset;return c!==b?c:document.documentElement.scrollTop},unbind:function(a,b,c){h.bind(a,b,c,!0)},removeClass:function(a,b){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(a,b){h.hasClass(a,b)||(a.className+=(a.className?" ":"")+b)},hasClass:function(a,b){return a.className&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},getChildByClass:function(a,b){for(var c=a.firstChild;c;){if(h.hasClass(c,b))return c;c=c.nextSibling}},arraySearch:function(a,b,c){for(var d=a.length;d--;)if(a[d][c]===b)return d;return-1},extend:function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){if(c&&a.hasOwnProperty(d))continue;a[d]=b[d]}},easing:{sine:{out:function(a){return Math.sin(a*(Math.PI/2))},inOut:function(a){return-(Math.cos(Math.PI*a)-1)/2}},cubic:{out:function(a){return--a*a*a+1}}},detectFeatures:function(){if(h.features)return h.features;var b=h.createEl(),c=b.style,d="",e={};if(e.oldIE=document.all&&!document.addEventListener,e.touch="ontouchstart"in a,a.requestAnimationFrame&&(e.raf=a.requestAnimationFrame,e.caf=a.cancelAnimationFrame),e.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!e.pointerEvent){var f=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var g=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);g&&g.length>0&&(g=parseInt(g[1],10))>=1&&g<8&&(e.isOldIOSPhone=!0)}var i=f.match(/Android\s([0-9\.]*)/),j=i?i[1]:0;j=parseFloat(j),j>=1&&(j<4.4&&(e.isOldAndroid=!0),e.androidVersion=j),e.isMobileOpera=/opera mini|opera mobi/i.test(f)}for(var k,l,m=["transform","perspective","animationName"],n=["","webkit","Moz","ms","O"],o=0;o<4;o++){d=n[o];for(var p=0;p<3;p++)k=m[p],l=d+(d?k.charAt(0).toUpperCase()+k.slice(1):k),!e[k]&&l in c&&(e[k]=l);d&&!e.raf&&(d=d.toLowerCase(),e.raf=a[d+"RequestAnimationFrame"],e.raf&&(e.caf=a[d+"CancelAnimationFrame"]||a[d+"CancelRequestAnimationFrame"]))}if(!e.raf){var q=0;e.raf=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-q)),e=a.setTimeout(function(){b(c+d)},d);return q=c+d,e},e.caf=function(a){clearTimeout(a)}}return e.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,h.features=e,e}};h.detectFeatures(),h.features.oldIE&&(h.bind=function(a,b,c,d){b=b.split(" ");for(var e,f=(d?"detach":"attach")+"Event",g=function(){c.handleEvent.call(c)},h=0;h<b.length;h++)if(e=b[h])if("object"==typeof c&&c.handleEvent){if(d){if(!c["oldIE"+e])return!1}else c["oldIE"+e]=g;a[f]("on"+e,c["oldIE"+e])}else a[f]("on"+e,c)});var i=this,j={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(a){return"A"===a.tagName},getDoubleTapZoom:function(a,b){return a?1:b.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};h.extend(j,g);var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na=function(){return{x:0,y:0}},oa=na(),pa=na(),qa=na(),ra={},sa=0,ta={},ua=na(),va=0,wa=!0,xa=[],ya={},za=!1,Aa=function(a,b){h.extend(i,b.publicMethods),xa.push(a)},Ba=function(a){var b=_b();return a>b-1?a-b:a<0?b+a:a},Ca={},Da=function(a,b){return Ca[a]||(Ca[a]=[]),Ca[a].push(b)},Ea=function(a){var b=Ca[a];if(b){var c=Array.prototype.slice.call(arguments);c.shift();for(var d=0;d<b.length;d++)b[d].apply(i,c)}},Fa=function(){return(new Date).getTime()},Ga=function(a){ka=a,i.bg.style.opacity=a*j.bgOpacity},Ha=function(a,b,c,d,e){(!za||e&&e!==i.currItem)&&(d/=e?e.fitRatio:i.currItem.fitRatio),a[F]=v+b+"px, "+c+"px"+w+" scale("+d+")"},Ia=function(a){fa&&(a&&(t>i.currItem.fitRatio?za||(lc(i.currItem,!1,!0),za=!0):za&&(lc(i.currItem),za=!1)),Ha(fa,qa.x,qa.y,t))},Ja=function(a){a.container&&Ha(a.container.style,a.initialPosition.x,a.initialPosition.y,a.initialZoomLevel,a)},Ka=function(a,b){b[F]=v+a+"px, 0px"+w},La=function(a,b){if(!j.loop&&b){var c=n+(ua.x*sa-a)/ua.x,d=Math.round(a-sb.x);(c<0&&d>0||c>=_b()-1&&d<0)&&(a=sb.x+d*j.mainScrollEndFriction)}sb.x=a,Ka(a,o)},Ma=function(a,b){var c=tb[a]-ta[a];return pa[a]+oa[a]+c-c*(b/u)},Na=function(a,b){a.x=b.x,a.y=b.y,b.id&&(a.id=b.id)},Oa=function(a){a.x=Math.round(a.x),a.y=Math.round(a.y)},Pa=null,Qa=function(){Pa&&(h.unbind(document,"mousemove",Qa),h.addClass(c,"pswp--has_mouse"),j.mouseUsed=!0,Ea("mouseUsed")),Pa=setTimeout(function(){Pa=null},100)},Ra=function(){h.bind(document,"keydown",i),O.transform&&h.bind(i.scrollWrap,"click",i),j.mouseUsed||h.bind(document,"mousemove",Qa),h.bind(a,"resize scroll orientationchange",i),Ea("bindEvents")},Sa=function(){h.unbind(a,"resize scroll orientationchange",i),h.unbind(a,"scroll",s.scroll),h.unbind(document,"keydown",i),h.unbind(document,"mousemove",Qa),O.transform&&h.unbind(i.scrollWrap,"click",i),W&&h.unbind(a,q,i),clearTimeout(P),Ea("unbindEvents")},Ta=function(a,b){var c=hc(i.currItem,ra,a);return b&&(ea=c),c},Ua=function(a){return a||(a=i.currItem),a.initialZoomLevel},Va=function(a){return a||(a=i.currItem),a.w>0?j.maxSpreadZoom:1},Wa=function(a,b,c,d){return d===i.currItem.initialZoomLevel?(c[a]=i.currItem.initialPosition[a],!0):(c[a]=Ma(a,d),c[a]>b.min[a]?(c[a]=b.min[a],!0):c[a]<b.max[a]&&(c[a]=b.max[a],!0))},Xa=function(){if(F){var a=O.perspective&&!H;return v="translate"+(a?"3d(":"("),void(w=O.perspective?", 0px)":")")}F="left",h.addClass(c,"pswp--ie"),Ka=function(a,b){b.left=a+"px"},Ja=function(a){var b=a.fitRatio>1?1:a.fitRatio,c=a.container.style,d=b*a.w,e=b*a.h;c.width=d+"px",c.height=e+"px",c.left=a.initialPosition.x+"px",c.top=a.initialPosition.y+"px"},Ia=function(){if(fa){var a=fa,b=i.currItem,c=b.fitRatio>1?1:b.fitRatio,d=c*b.w,e=c*b.h;a.width=d+"px",a.height=e+"px",a.left=qa.x+"px",a.top=qa.y+"px"}}},Ya=function(a){var b="";j.escKey&&27===a.keyCode?b="close":j.arrowKeys&&(37===a.keyCode?b="prev":39===a.keyCode&&(b="next")),b&&(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey||(a.preventDefault?a.preventDefault():a.returnValue=!1,i[b]()))},Za=function(a){a&&(Z||Y||ga||U)&&(a.preventDefault(),a.stopPropagation())},$a=function(){i.setScrollOffset(0,h.getScrollY())},_a={},ab=0,bb=function(a){_a[a]&&(_a[a].raf&&J(_a[a].raf),ab--,delete _a[a])},cb=function(a){_a[a]&&bb(a),_a[a]||(ab++,_a[a]={})},db=function(){for(var a in _a)_a.hasOwnProperty(a)&&bb(a)},eb=function(a,b,c,d,e,f,g){var h,i=Fa();cb(a);var j=function(){if(_a[a]){if((h=Fa()-i)>=d)return bb(a),f(c),void(g&&g());f((c-b)*e(h/d)+b),_a[a].raf=I(j)}};j()},fb={shout:Ea,listen:Da,viewportSize:ra,options:j,isMainScrollAnimating:function(){return ga},getZoomLevel:function(){return t},getCurrentIndex:function(){return n},isDragging:function(){return W},isZooming:function(){return ba},setScrollOffset:function(a,b){ta.x=a,N=ta.y=b,Ea("updateScrollOffset",ta)},applyZoomPan:function(a,b,c,d){qa.x=b,qa.y=c,t=a,Ia(d)},init:function(){if(!k&&!l){d("init",i);var a;i.framework=h,i.template=c,i.bg=h.getChildByClass(c,"pswp__bg"),K=c.className,k=!0,O=h.detectFeatures(),I=O.raf,J=O.caf,F=O.transform,M=O.oldIE,i.scrollWrap=h.getChildByClass(c,"pswp__scroll-wrap"),i.container=h.getChildByClass(i.scrollWrap,"pswp__container"),o=i.container.style,i.itemHolders=z=[{el:i.container.children[0],wrap:0,index:-1},{el:i.container.children[1],wrap:0,index:-1},{el:i.container.children[2],wrap:0,index:-1}],z[0].el.style.display=z[2].el.style.display="none",Xa(),s={resize:i.updateSize,orientationchange:function(){clearTimeout(P),P=setTimeout(function(){ra.x!==i.scrollWrap.clientWidth&&i.updateSize()},500)},scroll:$a,keydown:Ya,click:Za};var f=O.isOldIOSPhone||O.isOldAndroid||O.isMobileOpera;for(O.animationName&&O.transform&&!f||(j.showAnimationDuration=j.hideAnimationDuration=0),a=0;a<xa.length;a++)i["init"+xa[a]]();if(e){(i.ui=new e(i,h)).init()}Ea("firstUpdate"),n=n||j.index||0,(isNaN(n)||n<0||n>=_b())&&(n=0),i.currItem=$b(n),(O.isOldIOSPhone||O.isOldAndroid)&&(wa=!1),c.setAttribute("aria-hidden","false"),j.modal&&(wa?c.style.position="fixed":(c.style.position="absolute",c.style.top=h.getScrollY()+"px")),N===b&&(Ea("initialLayout"),N=L=h.getScrollY());var g="pswp--open ";for(j.mainClass&&(g+=j.mainClass+" "),j.showHideOpacity&&(g+="pswp--animate_opacity "),g+=H?"pswp--touch":"pswp--notouch",g+=O.animationName?" pswp--css_animation":"",g+=O.svg?" pswp--svg":"",h.addClass(c,g),i.updateSize(),p=-1,va=null,a=0;a<3;a++)Ka((a+p)*ua.x,z[a].el.style);M||h.bind(i.scrollWrap,r,i),Da("initialZoomInEnd",function(){i.setContent(z[0],n-1),i.setContent(z[2],n+1),z[0].el.style.display=z[2].el.style.display="block",j.focus&&c.focus(),Ra()}),i.setContent(z[1],n),i.updateCurrItem(),Ea("afterInit"),d("after-init",i),wa||(x=setInterval(function(){ab||W||ba||t!==i.currItem.initialZoomLevel||i.updateSize()},1e3)),h.addClass(c,"pswp--visible")}},close:function(){k&&(k=!1,l=!0,Ea("close"),d("closing",i),Sa(),bc(i.currItem,null,!0,i.destroy))},destroy:function(){Ea("destroy"),d("destroy",i),Wb&&clearTimeout(Wb),c.setAttribute("aria-hidden","true"),c.className=K,x&&clearInterval(x),h.unbind(i.scrollWrap,r,i),h.unbind(a,"scroll",i),yb(),db(),Ca=null},panTo:function(a,b,c){c||(a>ea.min.x?a=ea.min.x:a<ea.max.x&&(a=ea.max.x),b>ea.min.y?b=ea.min.y:b<ea.max.y&&(b=ea.max.y)),qa.x=a,qa.y=b,Ia()},handleEvent:function(b){b=b||a.event,s[b.type]&&s[b.type](b)},goTo:function(a){a=Ba(a);var b=a-n;va=b,n=a,i.currItem=$b(n),sa-=b,La(ua.x*sa),db(),ga=!1,i.updateCurrItem()},next:function(){i.goTo(n+1)},prev:function(){i.goTo(n-1)},updateCurrZoomItem:function(a){if(a&&(Ea("beforeChange",0),d("before-slide-change",i,0)),z[1].el.children.length){var b=z[1].el.children[0];fa=h.hasClass(b,"pswp__zoom-wrap")?b.style:null}else fa=null;ea=i.currItem.bounds,u=t=i.currItem.initialZoomLevel,qa.x=ea.center.x,qa.y=ea.center.y,a&&(Ea("afterChange"),d("after-slide-change",i))},invalidateCurrItems:function(){y=!0;for(var a=0;a<3;a++)z[a].item&&(z[a].item.needsUpdate=!0)},updateCurrItem:function(a){if(0!==va){var b,c=Math.abs(va);if(!(a&&c<2)){i.currItem=$b(n),za=!1,Ea("beforeChange",va);var e=va;null===e&&(e=0),d("slide-change",i,e),c>=3&&(p+=va+(va>0?-3:3),c=3);for(var f=0;f<c;f++)va>0?(b=z.shift(),z[2]=b,p++,Ka((p+2)*ua.x,b.el.style),i.setContent(b,n-c+f+1+1)):(b=z.pop(),z.unshift(b),p--,Ka(p*ua.x,b.el.style),i.setContent(b,n+c-f-1-1));if(fa&&1===Math.abs(va)){var g=$b(A);g.initialZoomLevel!==t&&(hc(g,ra),lc(g),Ja(g))}va=0,i.updateCurrZoomItem(),A=n,Ea("afterChange")}}},updateSize:function(d){if(!wa&&j.modal){var e=h.getScrollY();if(N!==e&&(c.style.top=e+"px",N=e),!d&&ya.x===a.innerWidth&&ya.y===a.innerHeight)return;ya.x=a.innerWidth,ya.y=a.innerHeight,c.style.height=ya.y+"px"}if(ra.x=i.scrollWrap.clientWidth,ra.y=i.scrollWrap.clientHeight,$a(),ua.x=ra.x+Math.round(ra.x*j.spacing),ua.y=ra.y,La(ua.x*sa),Ea("beforeResize"),p!==b){for(var f,g,k,l=0;l<3;l++)f=z[l],Ka((l+p)*ua.x,f.el.style),k=n+l-1,j.loop&&_b()>2&&(k=Ba(k)),g=$b(k),g&&(y||g.needsUpdate||!g.bounds)?(i.cleanSlide(g),i.setContent(f,k),1===l&&(i.currItem=g,i.updateCurrZoomItem(!0)),g.needsUpdate=!1):-1===f.index&&k>=0&&i.setContent(f,k),g&&g.container&&(hc(g,ra),lc(g),Ja(g));y=!1}u=t=i.currItem.initialZoomLevel,ea=i.currItem.bounds,ea&&(qa.x=ea.center.x,qa.y=ea.center.y,Ia(!0)),Ea("resize")},zoomTo:function(a,b,c,d,e){b&&(u=t,tb.x=Math.abs(b.x)-qa.x,tb.y=Math.abs(b.y)-qa.y,Na(pa,qa));var f=Ta(a,!1),g={};Wa("x",f,g,a),Wa("y",f,g,a);var i=t,j={x:qa.x,y:qa.y};Oa(g);var k=function(b){1===b?(t=a,qa.x=g.x,qa.y=g.y):(t=(a-i)*b+i,qa.x=(g.x-j.x)*b+j.x,qa.y=(g.y-j.y)*b+j.y),e&&e(b),Ia(1===b)};c?eb("customZoomTo",0,1,c,d||h.easing.sine.inOut,k):k(1)}},gb={},hb={},ib={},jb={},kb={},lb=[],mb={},nb=[],ob={},pb=0,qb=na(),rb=0,sb=na(),tb=na(),ub=na(),vb=function(a,b){return a.x===b.x&&a.y===b.y},wb=function(a,b){return Math.abs(a.x-b.x)<25&&Math.abs(a.y-b.y)<25},xb=function(a,b){return ob.x=Math.abs(a.x-b.x),ob.y=Math.abs(a.y-b.y),Math.sqrt(ob.x*ob.x+ob.y*ob.y)},yb=function(){$&&(J($),$=null)},zb=function(){W&&($=I(zb),Pb())},Ab=function(){return!("fit"===j.scaleMode&&t===i.currItem.initialZoomLevel)},Bb=function(a,b){return!(!a||a===document)&&(!(a.getAttribute("class")&&a.getAttribute("class").indexOf("pswp__scroll-wrap")>-1)&&(b(a)?a:Bb(a.parentNode,b)))},Cb={},Db=function(a,b){return Cb.prevent=!Bb(a.target,j.isClickableElement),Ea("preventDragEvent",a,b,Cb),Cb.prevent},Eb=function(a,b){return b.x=a.pageX,b.y=a.pageY,b.id=a.identifier,b},Fb=function(a,b,c){c.x=.5*(a.x+b.x),c.y=.5*(a.y+b.y)},Gb=function(a,b,c){if(a-R>50){var d=nb.length>2?nb.shift():{};d.x=b,d.y=c,nb.push(d),R=a}},Hb=function(){var a=qa.y-i.currItem.initialPosition.y;return Math.min(1.2-Math.abs(a/(ra.y/2)),1)},Ib={},Jb={},Kb=[],Lb=function(a){for(;Kb.length>0;)Kb.pop();return G?(ma=0,lb.forEach(function(a){0===ma?Kb[0]=a:1===ma&&(Kb[1]=a),ma++})):a.type.indexOf("touch")>-1?a.touches&&a.touches.length>0&&(Kb[0]=Eb(a.touches[0],Ib),a.touches.length>1&&(Kb[1]=Eb(a.touches[1],Jb))):(Ib.x=a.pageX,Ib.y=a.pageY,Ib.id="",Kb[0]=Ib),Kb},Mb=function(a,c){var d,e,f,g,h=qa[a]+c[a],k=c[a]>0,l=sb.x+c.x,m=sb.x-mb.x;if(d=h>ea.min[a]||h<ea.max[a]?j.panEndFriction:1,h=qa[a]+c[a]*d,(j.allowPanToNext||t===i.currItem.initialZoomLevel)&&(fa?"h"!==ha||"x"!==a||Y||(k?(h>ea.min[a]&&(d=j.panEndFriction,ea.min[a]-h,e=ea.min[a]-pa[a]),(e<=0||m<0)&&_b()>1?(g=l,m<0&&l>mb.x&&(g=mb.x)):ea.min.x!==ea.max.x&&(f=h)):(h<ea.max[a]&&(d=j.panEndFriction,h-ea.max[a],e=pa[a]-ea.max[a]),(e<=0||m>0)&&_b()>1?(g=l,m>0&&l<mb.x&&(g=mb.x)):ea.min.x!==ea.max.x&&(f=h))):g=l,"x"===a))return g!==b&&(La(g,!0),_=g!==mb.x),ea.min.x!==ea.max.x&&(f!==b?qa.x=f:_||(qa.x+=c.x*d)),g!==b;ga||_||t>i.currItem.fitRatio&&(qa[a]+=c[a]*d)},Nb=function(b){if(!("mousedown"===b.type&&b.button>0)){if(Zb)return void b.preventDefault();if(!V||"mousedown"!==b.type){if(Db(b,!0)&&b.preventDefault(),Ea("pointerDown"),G){var c=h.arraySearch(lb,b.pointerId,"id");c<0&&(c=lb.length),lb[c]={x:b.pageX,y:b.pageY,id:b.pointerId}}var d=Lb(b),e=d.length;aa=null,db(),W&&1!==e||(W=ia=!0,h.bind(a,q,i),T=la=ja=U=_=Z=X=Y=!1,ha=null,Ea("firstTouchStart",d),Na(pa,qa),oa.x=oa.y=0,Na(jb,d[0]),Na(kb,jb),mb.x=ua.x*sa,nb=[{x:jb.x,y:jb.y}],R=Q=Fa(),Ta(t,!0),yb(),zb()),!ba&&e>1&&!ga&&!_&&(u=t,Y=!1,ba=X=!0,oa.y=oa.x=0,Na(pa,qa),Na(gb,d[0]),Na(hb,d[1]),Fb(gb,hb,ub),tb.x=Math.abs(ub.x)-qa.x,tb.y=Math.abs(ub.y)-qa.y,ca=da=xb(gb,hb))}}},Ob=function(a){if(a.preventDefault(),G){var b=h.arraySearch(lb,a.pointerId,"id");if(b>-1){var c=lb[b];c.x=a.pageX,c.y=a.pageY}}if(W){var d=Lb(a);if(ha||Z||ba)aa=d;else if(sb.x!==ua.x*sa)ha="h";else{var e=Math.abs(d[0].x-jb.x)-Math.abs(d[0].y-jb.y);Math.abs(e)>=10&&(ha=e>0?"h":"v",aa=d)}}},Pb=function(){if(aa){var a=aa.length;if(0!==a)if(Na(gb,aa[0]),ib.x=gb.x-jb.x,ib.y=gb.y-jb.y,ba&&a>1){if(jb.x=gb.x,jb.y=gb.y,!ib.x&&!ib.y&&vb(aa[1],hb))return;Na(hb,aa[1]),Y||(Y=!0,Ea("zoomGestureStarted"));var b=xb(gb,hb),c=Ub(b);c>i.currItem.initialZoomLevel+i.currItem.initialZoomLevel/15&&(la=!0);var d=1,e=Ua(),f=Va();if(c<e)if(j.pinchToClose&&!la&&u<=i.currItem.initialZoomLevel){var g=e-c,h=1-g/(e/1.2);Ga(h),Ea("onPinchClose",h),ja=!0}else d=(e-c)/e,d>1&&(d=1),c=e-d*(e/3);else c>f&&(d=(c-f)/(6*e),d>1&&(d=1),c=f+d*e);d<0&&(d=0),ca=b,Fb(gb,hb,qb),oa.x+=qb.x-ub.x,oa.y+=qb.y-ub.y,Na(ub,qb),qa.x=Ma("x",c),qa.y=Ma("y",c),T=c>t,t=c,Ia()}else{if(!ha)return;if(ia&&(ia=!1,Math.abs(ib.x)>=10&&(ib.x-=aa[0].x-kb.x),Math.abs(ib.y)>=10&&(ib.y-=aa[0].y-kb.y)),jb.x=gb.x,jb.y=gb.y,0===ib.x&&0===ib.y)return;if("v"===ha&&j.closeOnVerticalDrag&&!Ab()){oa.y+=ib.y,qa.y+=ib.y;var k=Hb();return U=!0,Ea("onVerticalDrag",k),Ga(k),void Ia()}Gb(Fa(),gb.x,gb.y),Z=!0,ea=i.currItem.bounds;var l=Mb("x",ib);l||(Mb("y",ib),Oa(qa),Ia())}}},Qb=function(b){if(O.isOldAndroid){if(V&&"mouseup"===b.type)return;b.type.indexOf("touch")>-1&&(clearTimeout(V),V=setTimeout(function(){V=0},600))}Ea("pointerUp"),Db(b,!1)&&b.preventDefault();var c;if(G){var d=h.arraySearch(lb,b.pointerId,"id");if(d>-1)if(c=lb.splice(d,1)[0],navigator.pointerEnabled)c.type=b.pointerType||"mouse";else{var e={4:"mouse",2:"touch",3:"pen"};c.type=e[b.pointerType],c.type||(c.type=b.pointerType||"mouse")}}var f,g=Lb(b),k=g.length;if("mouseup"===b.type&&(k=0),2===k)return aa=null,!0;1===k&&Na(kb,g[0]),0!==k||ha||ga||(c||("mouseup"===b.type?c={x:b.pageX,y:b.pageY,type:"mouse"}:b.changedTouches&&b.changedTouches[0]&&(c={x:b.changedTouches[0].pageX,y:b.changedTouches[0].pageY,type:"touch"})),Ea("touchRelease",b,c));var l=-1;if(0===k&&(W=!1,h.unbind(a,q,i),yb(),ba?l=0:-1!==rb&&(l=Fa()-rb)),rb=1===k?Fa():-1,f=-1!==l&&l<150?"zoom":"swipe",ba&&k<2&&(ba=!1,1===k&&(f="zoomPointerUp"),Ea("zoomGestureEnded")),aa=null,Z||Y||ga||U)if(db(),S||(S=Rb()),S.calculateSwipeSpeed("x"),U){var m=Hb();if(m<j.verticalDragRange)i.close();else{var n=qa.y,o=ka;eb("verticalDrag",0,1,300,h.easing.cubic.out,function(a){qa.y=(i.currItem.initialPosition.y-n)*a+n,Ga((1-o)*a+o),Ia()}),Ea("onVerticalDrag",1)}}else{if((_||ga)&&0===k){var p=Tb(f,S);if(p)return;f="zoomPointerUp"}if(!ga)return"swipe"!==f?void Vb():void(!_&&t>i.currItem.fitRatio&&Sb(S))}},Rb=function(){var a,c,d={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(b){nb.length>1?(a=Fa()-R+50,c=nb[nb.length-2][b]):(a=Fa()-Q,c=kb[b]),d.lastFlickOffset[b]=jb[b]-c,d.lastFlickDist[b]=Math.abs(d.lastFlickOffset[b]),d.lastFlickDist[b]>20?d.lastFlickSpeed[b]=d.lastFlickOffset[b]/a:d.lastFlickSpeed[b]=0,Math.abs(d.lastFlickSpeed[b])<.1&&(d.lastFlickSpeed[b]=0),d.slowDownRatio[b]=.95,d.slowDownRatioReverse[b]=1-d.slowDownRatio[b],d.speedDecelerationRatio[b]=1},calculateOverBoundsAnimOffset:function(a,c){d.backAnimStarted[a]||(qa[a]>ea.min[a]?d.backAnimDestination[a]=ea.min[a]:qa[a]<ea.max[a]&&(d.backAnimDestination[a]=ea.max[a]),d.backAnimDestination[a]!==b&&(d.slowDownRatio[a]=.7,d.slowDownRatioReverse[a]=1-d.slowDownRatio[a],d.speedDecelerationRatioAbs[a]<.05&&(d.lastFlickSpeed[a]=0,d.backAnimStarted[a]=!0,eb("bounceZoomPan"+a,qa[a],d.backAnimDestination[a],c||300,h.easing.sine.out,function(b){qa[a]=b,Ia()}))))},calculateAnimOffset:function(a){d.backAnimStarted[a]||(d.speedDecelerationRatio[a]=d.speedDecelerationRatio[a]*(d.slowDownRatio[a]+d.slowDownRatioReverse[a]-d.slowDownRatioReverse[a]*d.timeDiff/10),d.speedDecelerationRatioAbs[a]=Math.abs(d.lastFlickSpeed[a]*d.speedDecelerationRatio[a]),d.distanceOffset[a]=d.lastFlickSpeed[a]*d.speedDecelerationRatio[a]*d.timeDiff,qa[a]+=d.distanceOffset[a])},panAnimLoop:function(){if(_a.zoomPan&&(_a.zoomPan.raf=I(d.panAnimLoop),d.now=Fa(),d.timeDiff=d.now-d.lastNow,d.lastNow=d.now,d.calculateAnimOffset("x"),d.calculateAnimOffset("y"),Ia(),d.calculateOverBoundsAnimOffset("x"),d.calculateOverBoundsAnimOffset("y"),d.speedDecelerationRatioAbs.x<.05&&d.speedDecelerationRatioAbs.y<.05))return qa.x=Math.round(qa.x),qa.y=Math.round(qa.y),Ia(),void bb("zoomPan")}};return d},Sb=function(a){if(a.calculateSwipeSpeed("y"),ea=i.currItem.bounds,a.backAnimDestination={},a.backAnimStarted={},Math.abs(a.lastFlickSpeed.x)<=.05&&Math.abs(a.lastFlickSpeed.y)<=.05)return a.speedDecelerationRatioAbs.x=a.speedDecelerationRatioAbs.y=0,a.calculateOverBoundsAnimOffset("x"),a.calculateOverBoundsAnimOffset("y"),!0;cb("zoomPan"),a.lastNow=Fa(),a.panAnimLoop()},Tb=function(a,b){var c;ga||(pb=n);var d;if("swipe"===a){var e=jb.x-kb.x,f=b.lastFlickDist.x<10;e>30&&(f||b.lastFlickOffset.x>20)?d=-1:e<-30&&(f||b.lastFlickOffset.x<-20)&&(d=1)}var g;d&&(n+=d,n<0?(n=j.loop?_b()-1:0,g=!0):n>=_b()&&(n=j.loop?0:_b()-1,g=!0),g&&!j.loop||(va+=d,sa-=d,c=!0));var k,l=ua.x*sa,m=Math.abs(l-sb.x);return c||l>sb.x==b.lastFlickSpeed.x>0?(k=Math.abs(b.lastFlickSpeed.x)>0?m/Math.abs(b.lastFlickSpeed.x):333,k=Math.min(k,400),k=Math.max(k,250)):k=333,pb===n&&(c=!1),ga=!0,Ea("mainScrollAnimStart"),eb("mainScroll",sb.x,l,k,h.easing.cubic.out,La,function(){db(),ga=!1,pb=-1,(c||pb!==n)&&i.updateCurrItem(),Ea("mainScrollAnimComplete")}),c&&i.updateCurrItem(!0),c},Ub=function(a){return 1/da*a*u},Vb=function(){var a=t,b=Ua(),c=Va();t<b?a=b:t>c&&(a=c);var d,e=ka;return ja&&!T&&!la&&t<b?(i.close(),!0):(ja&&(d=function(a){Ga((1-e)*a+e)}),i.zoomTo(a,0,200,h.easing.cubic.out,d),!0)};Aa("Gestures",{publicMethods:{initGestures:function(){var a=function(a,b,c,d,e){B=a+b,C=a+c,D=a+d,E=e?a+e:""};G=O.pointerEvent,G&&O.touch&&(O.touch=!1),G?navigator.pointerEnabled?a("pointer","down","move","up","cancel"):a("MSPointer","Down","Move","Up","Cancel"):O.touch?(a("touch","start","move","end","cancel"),H=!0):a("mouse","down","move","up"),q=C+" "+D+" "+E,r=B,G&&!H&&(H=navigator.maxTouchPoints>1||navigator.msMaxTouchPoints>1),i.likelyTouchDevice=H,s[B]=Nb,s[C]=Ob,s[D]=Qb,E&&(s[E]=s[D]),O.touch&&(r+=" mousedown",q+=" mousemove mouseup",s.mousedown=s[B],s.mousemove=s[C],s.mouseup=s[D]),H||(j.allowPanToNext=!1)}}});var Wb,Xb,Yb,Zb,$b,_b,ac,bc=function(a,d,e,f){Wb&&clearTimeout(Wb),Zb=!0,Yb=!0;var g;a.initialLayout?(g=a.initialLayout,a.initialLayout=null):g=j.getThumbBoundsFn&&j.getThumbBoundsFn(n);var k=e?j.hideAnimationDuration:j.showAnimationDuration,l=function(){bb("initialZoom"),e?(i.template.removeAttribute("style"),i.bg.removeAttribute("style")):(Ga(1),d&&(d.style.display="block"),h.addClass(c,"pswp--animated-in"),Ea("initialZoom"+(e?"OutEnd":"InEnd"))),f&&f(),Zb=!1};if(!k||!g||g.x===b)return Ea("initialZoom"+(e?"Out":"In")),t=a.initialZoomLevel,Na(qa,a.initialPosition),Ia(),c.style.opacity=e?0:1,Ga(1),void(k?setTimeout(function(){l()},k):l());!function(){var b=m,d=!i.currItem.src||i.currItem.loadError||j.showHideOpacity;a.miniImg&&(a.miniImg.style.webkitBackfaceVisibility="hidden"),e||(t=g.w/a.w,qa.x=g.x,qa.y=g.y-L,i[d?"template":"bg"].style.opacity=.001,Ia()),cb("initialZoom"),e&&!b&&h.removeClass(c,"pswp--animated-in"),d&&(e?h[(b?"remove":"add")+"Class"](c,"pswp--animate_opacity"):setTimeout(function(){h.addClass(c,"pswp--animate_opacity")},30)),Wb=setTimeout(function(){if(Ea("initialZoom"+(e?"Out":"In")),e){var f=g.w/a.w,i={x:qa.x,y:qa.y},j=t,m=ka,n=function(a){1===a?(t=f,qa.x=g.x,qa.y=g.y-N):(t=(f-j)*a+j,qa.x=(g.x-i.x)*a+i.x,qa.y=(g.y-N-i.y)*a+i.y),Ia(),d?c.style.opacity=1-a:Ga(m-a*m)};b?eb("initialZoom",0,1,k,h.easing.cubic.out,n,l):(n(1),Wb=setTimeout(l,k+20))}else t=a.initialZoomLevel,Na(qa,a.initialPosition),Ia(),Ga(1),d?c.style.opacity=1:Ga(1),Wb=setTimeout(l,k+20)},e?25:90)}()},cc={},dc=[],ec={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Xb.length}},fc=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},gc=function(a,b,c){var d=a.bounds;d.center.x=Math.round((cc.x-b)/2)+a.hGap.left,d.center.y=Math.round((cc.y-c)/2)+a.vGap.top,d.max.x=b>cc.x?Math.round(cc.x-b)+a.hGap.left:d.center.x,d.max.y=c>cc.y?Math.round(cc.y-c)+a.vGap.top:d.center.y,d.min.x=b>cc.x?a.hGap.left:d.center.x,d.min.y=c>cc.y?a.vGap.top:d.center.y},hc=function(a,b,c){if(a.src&&!a.loadError){var d=!c;if(d&&(a.vGap||(a.vGap={top:0,bottom:0}),a.hGap||(a.hGap={left:0,right:0}),Ea("parseVerticalMargin",a)),cc.x=b.x-a.hGap.left-a.hGap.right,cc.y=b.y-a.vGap.top-a.vGap.bottom,d){var e=cc.x/a.w,f=cc.y/a.h;a.fitRatio=e<f?e:f;var g=j.scaleMode;"orig"===g?c=1:"fit"===g&&(c=a.fitRatio),c>1&&(c=1),a.initialZoomLevel=c,a.bounds||(a.bounds=fc())}if(!c)return;return gc(a,a.w*c,a.h*c),d&&c===a.initialZoomLevel&&(a.initialPosition=a.bounds.center),a.bounds}return a.w=a.h=0,a.initialZoomLevel=a.fitRatio=1,a.bounds=fc(),a.initialPosition=a.bounds.center,a.bounds},ic=function(a,b,c,d,e,f){b.loadError||d&&(b.imageAppended=!0,lc(b,d,b===i.currItem&&za),c.appendChild(d),f&&setTimeout(function(){b&&b.loaded&&b.placeholder&&(b.placeholder.style.display="none",b.placeholder=null)},500))},jc=function(a){a.loading=!0,a.loaded=!1;var b=a.img=h.createEl("pswp__img","img"),c=function(){a.loading=!1,a.loaded=!0,a.loadComplete?a.loadComplete(a):a.img=null,b.onload=b.onerror=null,b=null};return b.onload=c,b.onerror=function(){a.loadError=!0,c()},b.src=a.src,b},kc=function(a,b){if(a.src&&a.loadError&&a.container)return b&&(a.container.innerHTML=""),a.container.innerHTML=j.errorMsg.replace("%url%",a.src),!0},lc=function(a,b,c){if(a.src){b||(b=a.container.lastChild);var d=c?a.w:Math.round(a.w*a.fitRatio),e=c?a.h:Math.round(a.h*a.fitRatio);a.placeholder&&!a.loaded&&(a.placeholder.style.width=d+"px",a.placeholder.style.height=e+"px"),b.style.width=d+"px",b.style.height=e+"px"}},mc=function(){if(dc.length){for(var a,b=0;b<dc.length;b++)a=dc[b],a.holder.index===a.index&&ic(a.index,a.item,a.baseDiv,a.img,0,a.clearPlaceholder);dc=[]}};Aa("Controller",{publicMethods:{lazyLoadItem:function(a){a=Ba(a);var b=$b(a);b&&(!b.loaded&&!b.loading||y)&&(Ea("gettingData",a,b),b.src&&jc(b))},initController:function(){h.extend(j,ec,!0),i.items=Xb=f,$b=i.getItemAt,_b=j.getNumItemsFn,ac=j.loop,_b()<3&&(j.loop=!1),Da("beforeChange",function(a){var b,c=j.preload,d=null===a||a>=0,e=Math.min(c[0],_b()),f=Math.min(c[1],_b());for(b=1;b<=(d?f:e);b++)i.lazyLoadItem(n+b);for(b=1;b<=(d?e:f);b++)i.lazyLoadItem(n-b)}),Da("initialLayout",function(){i.currItem.initialLayout=j.getThumbBoundsFn&&j.getThumbBoundsFn(n)}),Da("mainScrollAnimComplete",mc),Da("initialZoomInEnd",mc),Da("destroy",function(){for(var a,b=0;b<Xb.length;b++)a=Xb[b],a.container&&(a.container=null),a.placeholder&&(a.placeholder=null),a.img&&(a.img=null),a.preloader&&(a.preloader=null),a.loadError&&(a.loaded=a.loadError=!1);dc=null})},getItemAt:function(a){return a>=0&&(Xb[a]!==b&&Xb[a])},allowProgressiveImg:function(){return j.forceProgressiveLoading||!H||j.mouseUsed||screen.width>1200},setContent:function(a,b){j.loop&&(b=Ba(b));var c=i.getItemAt(a.index);c&&(c.container=null);var d,e=i.getItemAt(b);if(!e)return void(a.el.innerHTML="");Ea("gettingData",b,e),a.index=b,a.item=e;var f=e.container=h.createEl("pswp__zoom-wrap");if(!e.src&&e.html&&(e.html.tagName?f.appendChild(e.html):f.innerHTML=e.html),kc(e),hc(e,ra),!e.src||e.loadError||e.loaded)e.src&&!e.loadError&&(d=h.createEl("pswp__img","img"),d.style.opacity=1,d.src=e.src,lc(e,d),ic(0,e,f,d));else{if(e.loadComplete=function(c){if(k){if(a&&a.index===b){if(kc(c,!0))return c.loadComplete=c.img=null,hc(c,ra),Ja(c),void(a.index===n&&i.updateCurrZoomItem());c.imageAppended?!Zb&&c.placeholder&&(c.placeholder.style.display="none",c.placeholder=null):O.transform&&(ga||Zb)?dc.push({item:c,baseDiv:f,img:c.img,index:b,holder:a,clearPlaceholder:!0}):ic(0,c,f,c.img,0,!0)}c.loadComplete=null,c.img=null,Ea("imageLoadComplete",b,c)}},h.features.transform){var g="pswp__img pswp__img--placeholder";g+=e.msrc?"":" pswp__img--placeholder--blank"
;var l=h.createEl(g,e.msrc?"img":"");e.msrc&&(l.src=e.msrc),lc(e,l),f.appendChild(l),e.placeholder=l}e.loading||jc(e),i.allowProgressiveImg()&&(!Yb&&O.transform?dc.push({item:e,baseDiv:f,img:e.img,index:b,holder:a}):ic(0,e,f,e.img,0,!0))}Yb||b!==n?Ja(e):(fa=f.style,bc(e,d||e.img)),a.el.innerHTML="",a.el.appendChild(f)},cleanSlide:function(a){a.img&&(a.img.onload=a.img.onerror=null),a.loaded=a.loading=a.img=a.imageAppended=!1}}});var nc,oc={},pc=function(a,b,c){var d=document.createEvent("CustomEvent"),e={origEvent:a,target:a.target,releasePoint:b,pointerType:c||"touch"};d.initCustomEvent("pswpTap",!0,!0,e),a.target.dispatchEvent(d)};Aa("Tap",{publicMethods:{initTap:function(){Da("firstTouchStart",i.onTapStart),Da("touchRelease",i.onTapRelease),Da("destroy",function(){oc={},nc=null})},onTapStart:function(a){a.length>1&&(clearTimeout(nc),nc=null)},onTapRelease:function(a,b){if(b&&!Z&&!X&&!ab){var c=b;if(nc&&(clearTimeout(nc),nc=null,wb(c,oc)))return void Ea("doubleTap",c);if("mouse"===b.type)return void pc(a,b,"mouse");if("BUTTON"===a.target.tagName.toUpperCase()||h.hasClass(a.target,"pswp__single-tap"))return void pc(a,b);Na(oc,c),nc=setTimeout(function(){pc(a,b),nc=null},300)}}}});var qc;Aa("DesktopZoom",{publicMethods:{initDesktopZoom:function(){M||(H?Da("mouseUsed",function(){i.setupDesktopZoom()}):i.setupDesktopZoom(!0))},setupDesktopZoom:function(a){qc={};var b="wheel mousewheel DOMMouseScroll";Da("bindEvents",function(){h.bind(c,b,i.handleMouseWheel)}),Da("unbindEvents",function(){qc&&h.unbind(c,b,i.handleMouseWheel)}),i.mouseZoomedIn=!1;var d,e=function(){i.mouseZoomedIn&&(h.removeClass(c,"pswp--zoomed-in"),i.mouseZoomedIn=!1),t<1?h.addClass(c,"pswp--zoom-allowed"):h.removeClass(c,"pswp--zoom-allowed"),f()},f=function(){d&&(h.removeClass(c,"pswp--dragging"),d=!1)};Da("resize",e),Da("afterChange",e),Da("pointerDown",function(){i.mouseZoomedIn&&(d=!0,h.addClass(c,"pswp--dragging"))}),Da("pointerUp",f),a||e()},handleMouseWheel:function(a){if(t<=i.currItem.fitRatio)return j.modal&&(!j.closeOnScroll||ab||W?a.preventDefault():F&&Math.abs(a.deltaY)>2&&(m=!0,i.close())),!0;if(a.stopPropagation(),qc.x=0,"deltaX"in a)1===a.deltaMode?(qc.x=18*a.deltaX,qc.y=18*a.deltaY):(qc.x=a.deltaX,qc.y=a.deltaY);else if("wheelDelta"in a)a.wheelDeltaX&&(qc.x=-.16*a.wheelDeltaX),a.wheelDeltaY?qc.y=-.16*a.wheelDeltaY:qc.y=-.16*a.wheelDelta;else{if(!("detail"in a))return;qc.y=a.detail}Ta(t,!0);var b=qa.x-qc.x,c=qa.y-qc.y;(j.modal||b<=ea.min.x&&b>=ea.max.x&&c<=ea.min.y&&c>=ea.max.y)&&a.preventDefault(),i.panTo(b,c)},toggleDesktopZoom:function(a){a=a||{x:ra.x/2+ta.x,y:ra.y/2+ta.y};var b=j.getDoubleTapZoom(!0,i.currItem),d=t===b;i.mouseZoomedIn=!d,i.zoomTo(d?i.currItem.initialZoomLevel:b,a,333),h[(d?"remove":"add")+"Class"](c,"pswp--zoomed-in")}}}),h.extend(i,fb)}}()}(this),this.template='<div class="pswp image-zoom-navigation" tabindex="-1" role="dialog" aria-hidden="true"> \t\x3c!-- Background of PhotoSwipe. \t\t It\'s a separate element as animating opacity is faster than rgba(). --\x3e \t<div class="pswp__bg image-zoom-background"></div> \t\x3c!-- Slides wrapper with overflow:hidden. --\x3e \t<div class="pswp__scroll-wrap"> \t\t\x3c!-- Container that holds slides. \t\t\tPhotoSwipe keeps only 3 of them in the DOM to save memory.\t\t\tDon\'t modify these 3 pswp__item elements, data is added later on. --\x3e \t\t<div class="pswp__container"> \t\t\t<div class="pswp__item"></div> \t\t\t<div class="pswp__item"></div> \t\t\t<div class="pswp__item"></div> \t\t</div> \t\t<div class="pswp__ui pswp__ui--hidden pswp__custom_nav"> \t\t\t<div class="pswp__group pswp__group-prev"> \t\t\t\t<div class="pswp__button pswp__button-prev"> \t\t\t\t\t<svg version="1.1" class="left-arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t\t\t\t\t\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">\t\t\t\t\t\t\t<path class="shape-outline outer-color" d="M8.0008001,17.2999992c-0.4000001,0.3999996-0.4000001,1,0,1.3999996l15.7991991,15.7992001\t\t\t\t\t\t\t\tc0.3999996,0.4000015,1,0.4000015,1.3999996,0l2.6992016-2.6991997c0.3999996-0.3999996,0.3999996-1,0-1.3999996\t\t\t\t\t\t\t\tL16.2992001,18.7000008c-0.4000006-0.3999996-0.4000006-1,0-1.3999996L27.8992004,5.6999998\t\t\t\t\t\t\t\tc0.3999996-0.4000001,0.3999996-1,0-1.4000001l-2.6992016-2.6992002c-0.3999996-0.4-1-0.4-1.3999996,0L8.0008001,17.2999992z"/>\t\t\t\t\t\t\t<path class="shape-shape inner-color" d="M9.6999998,17.6000004c-0.1999998,0.2000008-0.1999998,0.5,0,0.7000008l14.500001,14.5000019\t\t\t\t\t\t\t\tc0.2000008,0.2000008,0.5,0.2000008,0.7000008,0l1.3999996-1.3999996c0.2000008-0.2000008,0.2000008-0.5,0-0.7000008\t\t\t\t\t\t\t\tL13.8999996,18.3999996c-0.1999998-0.2000008-0.1999998-0.5,0-0.7000008L26.2999992,5.3000002\t\t\t\t\t\t\t\tc0.2000008-0.1999998,0.2000008-0.5,0-0.6999998l-1.3999996-1.4000001c-0.2000008-0.2-0.5-0.2-0.7000008,0L9.6999998,17.6000004z"/>\t\t\t\t\t</svg>\t\t\t\t</div> \t\t\t</div>\t\t\t<div class="pswp__group pswp__group-next"> \t\t\t\t<div class="pswp__button pswp__button-next"> \t\t\t\t\t<svg version="1.1" class="right-arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t\t\t\t\t\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">\t\t\t\t\t\t\t<path class="shape-outline outer-color" d="M8.0008001,17.2999992c-0.4000001,0.3999996-0.4000001,1,0,1.3999996l15.7991991,15.7992001\t\t\t\t\t\t\t\tc0.3999996,0.4000015,1,0.4000015,1.3999996,0l2.6992016-2.6991997c0.3999996-0.3999996,0.3999996-1,0-1.3999996\t\t\t\t\t\t\t\tL16.2992001,18.7000008c-0.4000006-0.3999996-0.4000006-1,0-1.3999996L27.8992004,5.6999998\t\t\t\t\t\t\t\tc0.3999996-0.4000001,0.3999996-1,0-1.4000001l-2.6992016-2.6992002c-0.3999996-0.4-1-0.4-1.3999996,0L8.0008001,17.2999992z"/>\t\t\t\t\t\t\t<path class="shape-shape inner-color" d="M9.6999998,17.6000004c-0.1999998,0.2000008-0.1999998,0.5,0,0.7000008l14.500001,14.5000019\t\t\t\t\t\t\t\tc0.2000008,0.2000008,0.5,0.2000008,0.7000008,0l1.3999996-1.3999996c0.2000008-0.2000008,0.2000008-0.5,0-0.7000008\t\t\t\t\t\t\t\tL13.8999996,18.3999996c-0.1999998-0.2000008-0.1999998-0.5,0-0.7000008L26.2999992,5.3000002\t\t\t\t\t\t\t\tc0.2000008-0.1999998,0.2000008-0.5,0-0.6999998l-1.3999996-1.4000001c-0.2000008-0.2-0.5-0.2-0.7000008,0L9.6999998,17.6000004z"/>\t\t\t\t\t</svg>\t\t\t\t</div> \t\t\t</div> \t\t\t<div class="pswp__group pswp__group-close"> \t\t\t\t<div class="pswp__button pswp__button-close"> \t\t\t\t\t<svg class="close-button" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t\t\t\t\t\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">\t\t\t\t\t\t\t<path class="shape-outline outer-color" d="M30.4992,9.7l-8,8c-0.2,0.2-0.2,0.5,0,0.7l8.1,8c0.4,0.4,0.4,1,0,1.4L27.9,30.4992c-0.4,0.4-1,0.4-1.4,0l-8-8\t\t\t\t\t\t\t\tc-0.2-0.2-0.5-0.2-0.7,0l-8.2,8c-0.4,0.4-1,0.4-1.4,0L5.5008,27.8c-0.4-0.4-0.4-1,0-1.4l8.1-8.1c0.2-0.2,0.1-0.5,0-0.7l-8-8\t\t\t\t\t\t\t\tc-0.4-0.4-0.4-1,0-1.4L8.3,5.5008c0.4-0.4,1-0.4,1.4,0l0,0l8.1,8.1c0.2,0.2,0.5,0.1,0.7,0l8-8c0.4-0.4,1-0.4,1.4,0L30.5992,8.3\t\t\t\t\t\t\t\tC30.8992,8.6,30.8992,9.3,30.4992,9.7L30.4992,9.7z"/>\t\t\t\t\t\t\t<path class="shape-shape inner-color" d="M28.8,26.7L28.8,26.7L28.8,26.7l-8.3-8.3c-0.2-0.2-0.2-0.5,0-0.7l8.3-8.4c0.2-0.2,0.2-0.5,0-0.7l-1.4-1.4l0,0\t\t\t\t\t\t\t\tc-0.2-0.2-0.5-0.2-0.7,0l-8.3,8.3c-0.2,0.2-0.5,0.2-0.7,0L9.3,7.2l0,0l0,0C9.1,7,8.8,7,8.6,7.2L7.2,8.6C7,8.8,7,9.1,7.2,9.3\t\t\t\t\t\t\t\tl8.4,8.4c0.2,0.2,0.2,0.5,0,0.7l-8.4,8.3c-0.2,0.2-0.2,0.5,0,0.7l1.4,1.4l0,0c0.2,0.2,0.5,0.2,0.7,0l8.4-8.4c0.2-0.2,0.5-0.1,0.7,0\t\t\t\t\t\t\t\tl8.4,8.4c0.2,0.2,0.5,0.2,0.7,0l1.4-1.4C29,27.2,29,26.9,28.8,26.7z"/>\t\t\t\t\t</svg>\t\t\t\t</div> \t\t\t</div>\t\t</div> \t</div><div id="freshbox" style="display: none; width: 0; height: 0;">\x3c!-- legacy support --\x3e</div> </div>';var c=function(){var a=document.createElement("div");for(a.innerHTML=this.template;a.childNodes.length>0;)document.body.appendChild(a.childNodes[0]);a=null}.bind(this),d=function(){};this.setEventProxy=function(a){"function"==typeof a&&(d=a)},this.isActive=!1,this.activeGallery=b,this.openImageArray=function(d,e,f){if(d!==b&&this.activeGallery===b){var g=document.querySelectorAll(".pswp")[0];g===b&&(c(),g=document.querySelectorAll(".pswp")[0]);var h=[],i=0;if(Array.prototype.forEach.call(d,function(a){if(a.hasAttribute("data-src")&&(a.hasAttribute("width_o")||a.hasAttribute("width"))&&(a.hasAttribute("height_o")||a.hasAttribute("height"))){a===e&&(i=h.length);var c=a.getAttribute("data-src"),d=a.hasAttribute("width_o")?a.getAttribute("width_o"):a.getAttribute("width"),f=a.hasAttribute("height_o")?a.getAttribute("height_o"):a.getAttribute("height");a._lightboxSrc!==b&&(c=a._lightboxSrc),a._lightboxWidth!==b&&(d=a._lightboxWidth),a._lightboxHeight!==b&&(f=a._lightboxHeight),h.push({src:c,msrc:a.getAttribute("src"),w:d,h:f,el:a})}}),0==h.length)return!1;var j=this,k={index:i,maxSpreadZoom:1,getThumbBoundsFn:function(c){if(j.activeGallery==b)return!1;var d=j.activeGallery.getItemAt(c);if(d==b||d.el==b||"function"!=typeof d.el.getBoundingClientRect)return!1;var e=d.el.getBoundingClientRect();if(0===e.width)return!1;var f=a.pageYOffset||document.documentElement.scrollTop;return{x:e.left,y:e.top+f,w:e.width}},closeEl:!0,arrowEl:h.length>1,tapToClose:!0,closeOnScroll:!1},l=!1;if(f!==b&&"object"==typeof f){for(var m in f)f.hasOwnProperty(m)&&(k[m]=f[m]);!0===f.disableZoom&&(l=!0,k.zoomEl=!1,k.getDoubleTapZoom=function(a,b){return b.initialZoomLevel},k.pinchToClose=!1)}return this.activeGallery=new this.PhotoSwipe(g,this.PhotoSwipeUI_Default,h,k),l?g.classList.add("pswp--zoom-disabled"):g.classList.remove("pswp--zoom-disabled"),this.activeGallery.init(),this.isActive=!0,this.activeGallery.listen("destroy",function(){null!==g.parentNode&&g.parentNode.removeChild(g),j.isActive=!1,j.activeGallery=b}),this.activeGallery}},function(b,c){b.PhotoSwipeUI_Default=function(){return function(b,c){var d,e,f,g,h,i,j,k,l,m,n=this,o=!1,p=!0,q={closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:1500,timeToIdleOutside:1500,closeEl:!0,fullscreenEl:!0,zoomEl:!0,counterEl:!0,arrowEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,fitControlsWidth:1200},r=function(b){if(j)return!0;b=b||a.event,i.timeToIdle&&i.mouseUsed&&!g&&v();for(var d=b.target||b.srcElement;"svg"===d.nodeName||"path"===d.nodeName;)d=d.parentNode;for(var e,f,h=d.getAttribute("class")||"",l=0;l<A.length;l++)e=A[l],e.onTap&&h.indexOf("pswp__"+e.name)>-1&&(e.onTap(),f=!0);if(f){b.stopPropagation&&b.stopPropagation(),j=!0;var m=c.features.isOldAndroid?600:30;k=setTimeout(function(){j=!1},m)}},s=function(a,b,d){c[(d?"add":"remove")+"Class"](a,"pswp__"+b)},t=function(a){for(var b=0;b<i.closeElClasses.length;b++)if(c.hasClass(a,"pswp__"+i.closeElClasses[b]))return!0},u=0,v=function(){clearTimeout(m),u=0,g&&n.setIdle(!1)},w=function(b){b=b||a.event;var c=b.relatedTarget||b.toElement;c&&"HTML"!==c.nodeName||(clearTimeout(m),m=setTimeout(function(){n.setIdle(!0)},i.timeToIdleOutside))},x=function(){i.fullscreenEl&&!c.features.isOldAndroid&&(d||(d=n.getFullscreenAPI()),d?(c.bind(document,d.eventK,n.updateFullscreen),n.updateFullscreen(),c.addClass(b.template,"pswp--supports-fs")):c.removeClass(b.template,"pswp--supports-fs"))},y=function(){i.timeToIdle&&h("mouseUsed",function(){c.bind(document,"mousemove",v),c.bind(document,"mouseout",w),l=setInterval(function(){2===++u&&n.setIdle(!0)},i.timeToIdle/2)})},z=function(){h("onVerticalDrag",function(a){p&&a<.95?n.hideControls():!p&&a>=.95&&n.showControls()});var a;h("onPinchClose",function(b){p&&b<.9?(n.hideControls(),a=!0):a&&!p&&b>.9&&n.showControls()}),h("zoomGestureEnded",function(){(a=!1)&&!p&&n.showControls()})},A=[{name:"button--zoom",option:"zoomEl",onTap:b.toggleDesktopZoom},{name:"button-close",option:"closeEl",onTap:b.close},{name:"button-prev",option:"arrowEl",onTap:b.prev},{name:"button-next",option:"arrowEl",onTap:b.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){d.isFullscreen()?d.exit():d.enter()}}],B=function(){var a,b,d,f=function(e){if(e){for(var f=e.length,g=[],h=0;h<f;h++){a=e[h],b=a.className;for(var j=0;j<A.length;j++)d=A[j],b.indexOf("pswp__"+d.name)>-1&&(i[d.option]?(c.removeClass(a,"pswp__element--disabled"),g.push(a),d.onInit&&d.onInit(a)):c.addClass(a,"pswp__element--disabled"))}g.length}};f(e.children);for(var g=e.querySelectorAll(".pswp__group"),h=0;h<g.length;h++)f(g[h].children)};n.init=function(){c.extend(b.options,q,!0),i=b.options,e=c.getChildByClass(b.scrollWrap,"pswp__ui"),h=b.listen,z(),h("beforeChange",n.update),h("doubleTap",function(a){var c=b.currItem.initialZoomLevel;b.getZoomLevel()!==c?b.zoomTo(c,a,333):b.zoomTo(i.getDoubleTapZoom(!1,b.currItem),a,333)}),h("preventDragEvent",function(a,b,c){var d=a.target||a.srcElement;d&&d.getAttribute("class")&&a.type.indexOf("mouse")>-1&&(d.getAttribute("class").indexOf("__caption")>0||/(SMALL|STRONG|EM)/i.test(d.tagName))&&(c.prevent=!1)}),h("bindEvents",function(){c.bind(e,"pswpTap click",r),c.bind(b.scrollWrap,"pswpTap",n.onGlobalTap),b.likelyTouchDevice||c.bind(b.scrollWrap,"mouseover",n.onMouseOver)}),h("unbindEvents",function(){l&&clearInterval(l),c.unbind(document,"mouseout",w),c.unbind(document,"mousemove",v),c.unbind(e,"pswpTap click",r),c.unbind(b.scrollWrap,"pswpTap",n.onGlobalTap),c.unbind(b.scrollWrap,"mouseover",n.onMouseOver),d&&(c.unbind(document,d.eventK,n.updateFullscreen),d.isFullscreen()&&(i.hideAnimationDuration=0,d.exit()),d=null)}),h("destroy",function(){i.captionEl&&(_fakeCaptionContainer&&e.removeChild(_fakeCaptionContainer),c.removeClass(_captionContainer,"pswp__caption--empty")),c.removeClass(e,"pswp__ui--over-close"),c.addClass(e,"pswp__ui--hidden"),n.setIdle(!1)}),i.showAnimationDuration||c.removeClass(e,"pswp__ui--hidden"),h("initialZoomInEnd",function(){i.showAnimationDuration&&c.removeClass(e,"pswp__ui--hidden")}),h("initialZoomOut",function(){c.addClass(e,"pswp__ui--hidden")}),B(),y(),clearTimeout(m),m=setTimeout(function(){n.setIdle(!0)},i.timeToIdleOutside),x()},n.setIdle=function(a){g=a,s(e,"ui--idle",a)},n.update=function(){o=!(!p||!b.currItem)},n.updateFullscreen=function(a){a&&setTimeout(function(){b.setScrollOffset(0,c.getScrollY())},50),c[(d.isFullscreen()?"add":"remove")+"Class"](b.template,"pswp--fs")},n.onGlobalTap=function(d){d=d||a.event;var e=d.target||d.srcElement;if(!j)if(d.detail&&"mouse"===d.detail.pointerType){if(t(e))return void b.close();if(c.hasClass(e,"pswp__img")){if(i.disableZoom)return void b.close();if(1===b.getZoomLevel()&&b.getZoomLevel()<=b.currItem.fitRatio){if(i.clickToCloseNonZoomable)return void b.close()}else b.toggleDesktopZoom(d.detail.releasePoint)}}else if(i.tapToToggleControls&&(p?n.hideControls():n.showControls()),i.tapToClose&&(c.hasClass(e,"pswp__img")||t(e)))return void b.close()},n.onMouseOver=function(b){b=b||a.event;var c=b.target||b.srcElement;s(e,"ui--over-close",t(c))},n.hideControls=function(){c.addClass(e,"pswp__ui--hidden"),p=!1},n.showControls=function(){p=!0,o||n.update(),c.removeClass(e,"pswp__ui--hidden")},n.toggleFullscreen=function(){d.isFullscreen()?d.exit():d.enter()},n.supportsFullscreen=function(){var a=document;return!!(a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen)},n.getFullscreenAPI=function(){var a,c=document.documentElement,d="fullscreenchange";return c.requestFullscreen?a={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:d}:c.mozRequestFullScreen?a={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+d}:c.webkitRequestFullscreen?a={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+d}:c.msRequestFullscreen&&(a={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),a&&(a.enter=function(){if(f=i.closeOnScroll,i.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK)return b.template[this.enterK]();b.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},a.exit=function(){return i.closeOnScroll=f,document[this.exitK]()},a.isFullscreen=function(){return document[this.elementK]}),a}}}()}(this)}.call(window.lightbox={},window);var requirejs,require,define;!function(global,setTimeout){function commentReplace(a,b){return b||""}function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){!c&&hasProp(a,e)||(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if("."===(c=a[b]))a.splice(b,1),b-=1;else if(".."===c){if(0===b||1===b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p=c&&c.split("/"),q=x.map,r=q&&q["*"];if(a&&(a=a.split("/"),j=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[j])&&(a[j]=a[j].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&p&&(o=p.slice(0,p.length-1),a=o.concat(a)),b(a),a=a.join("/")),d&&q&&(p||r)){f=a.split("/");a:for(g=f.length;g>0;g-=1){if(i=f.slice(0,g).join("/"),p)for(h=p.length;h>0;h-=1)if((e=getOwn(q,p.slice(0,h).join("/")))&&(e=getOwn(e,i))){k=e,l=g;break a}!m&&r&&getOwn(r,i)&&(m=getOwn(r,i),n=g)}!k&&m&&(k=m,l=n),k&&(f.splice(0,l,k),a=f.join("/"))}return getOwn(x.pkgs,a)||a}function d(a){isBrowser&&each(scripts(),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName)return b.parentNode.removeChild(b),!0})}function e(a){var b=getOwn(x.paths,a);if(b&&isArray(b)&&b.length>1)return b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(each(globalDefQueue,function(a){var b=a[0];"string"==typeof b&&(u.defQueueMap[b]=!0),B.push(a)}),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}u.defQueueMap={}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){if(a.usingExports=!0,a.map.isDefine)return a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(b){a=b}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;if(this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad)){var g=[];each(this.depMaps,function(a){g.push(a.normalizedMap||a)}),req.onResourceLoad(u,this.map,g)}l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(u.defQueueMap,c)||this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.map.normalizedMap=f,this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),void((k=getOwn(y,f.id))&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(a){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+a,a,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.undefed||(this.defineDep(b,a),this.check())})),this.errback?i(a,"error",bind(this,this.errback)):this.events.error&&i(a,"error",bind(this,function(a){this.emit("error",a)}))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,defQueueMap:{},Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){if(a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/"),"string"==typeof a.urlArgs){var b=a.urlArgs;a.urlArgs=function(a,c){return(-1===c.indexOf("?")?"?":"&")+b}}var c=x.shim,d={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){d[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,b){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),c[b]=a}),x.shim=c),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b,null,!0))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);e.undefed=!0,d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),delete u.defQueueMap[a],e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){getOwn(y,a.id)&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(u.defQueueMap={},d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|^blob\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs&&!/^blob\:/.test(h)?h+x.urlArgs(a,h):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);if(!e(b.id)){var c=[];return eachProp(y,function(a,d){0!==d.indexOf("_@r")&&each(a.depMaps,function(a){if(a.id===b.id)return c.push(d),!0})}),j(makeError("scripterror",'Script error for "'+b.id+(c.length?'", needed by: '+c.join(", "):'"'),a,[b.id]))}}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){if("interactive"===a.readyState)return interactiveScript=a}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.2",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g="_";return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick=void 0!==setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version="2.3.2",req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts._;return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],(baseElement=document.getElementsByTagName("base")[0])&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a,b,c){var d=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return d.type=a.scriptType||"text/javascript",d.charset="utf-8",d.async=!0,d},req.load=function(a,b,c){var d,e=a&&a.config||{}
;if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,e.onNodeCreated&&e.onNodeCreated(d,e,b,c),currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{setTimeout(function(){},0),importScripts(c),a.completeLoad(b)}catch(d){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,d,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){if(head||(head=a.parentNode),dataMain=a.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,commentReplace).replace(/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript())&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")]),e?(e.defQueue.push([a,b,c]),e.defQueueMap[a]=!0):globalDefQueue.push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout);